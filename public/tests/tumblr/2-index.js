require = function t(e, i, s) {
  function o(a, r) {
    if (!i[a]) {
      if (!e[a]) {
        var l = "function" == typeof require && require;
        if (!r && l)return l(a, !0);
        if (n)return n(a, !0);
        throw new Error("Cannot find module '" + a + "'")
      }
      var h = i[a] = {exports: {}};
      e[a][0].call(h.exports, function (t) {
        var i = e[a][1][t];
        return o(i ? i : t)
      }, h, h.exports, t, e, i, s)
    }
    return i[a].exports
  }

  for (var n = "function" == typeof require && require, a = 0; a < s.length; a++)o(s[a]);
  return o
}({
  1: [function (t, e, i) {
    "use strict";
    var s = t("prima/bootloader"), o = t("prima/lib/domeventor"), n = t("prima/lib/logger"), a = s.extend({
      setup: function (e) {
        s.prototype.setup.apply(this, arguments), o.init(), n.log("Exec", "Bootstrap/DOMEventor"), n.log("Exec", "Bootstrap/Legacy"), t("./legacy")
      }, initialize: function () {
        this.context = new (t("context"))
      }
    });
    e.exports = a
  }, {
    "./legacy": 455,
    context: "ERJJGK",
    "prima/bootloader": 542,
    "prima/lib/domeventor": 550,
    "prima/lib/logger": 553
  }],
  2: [function (t, e, i) {
    var s = t("prima/collection"), o = t("../models/tumblelog"), n = s.extend({model: o});
    e.exports = n
  }, {"../models/tumblelog": 463, "prima/collection": 544}],
  3: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/component"), n = t("./views/account-popover"), a = t("app/lib/currentuser"), r = o.extend({
      name: "AccountPopover",
      view: function (t) {
        return t = s.extend({}, {
          model: a(),
          pinnedTarget: this.container,
          isFixedPosition: !0,
          autoTeardown: !1,
          teardownOnEscape: !1
        }, t), new n(t)
      },
      show: function () {
        this.view.show()
      },
      render: function () {
        return this.view.render(), this.trigger("append"), this
      }
    });
    e.exports = r
  }, {"./views/account-popover": 9, "app/lib/currentuser": 459, lodash: "MicNly", "prima/component": 545}],
  4: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<ul data-blog-details-inner class="blog-sub-nav-details"><li class="blog-sub-nav-item ', isSelected("/blog/" + model.name) && (__p += "selected"), __p += '" data-js-menu-item><a href="/blog/' + (null == (__t = model.name) ? "" : _.escape(__t)) + '" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">' + (null == (__t = __("Posts")) ? "" : _.escape(__t)) + "</div>", model.post_count > 0 && (__p += '<div class="blog-sub-nav-item-data">' + (null == (__t = numberFormat(model.post_count)) ? "" : _.escape(__t)) + "</div>"), __p += "</a></li>", model.radar_feature_premium && (__p += '<li class="blog-sub-nav-item ', isSelected("/radar/analytics") && (__p += "selected"), __p += '" data-js-menu-item><a href="/radar/analytics" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">' + (null == (__t = __("Reach")) ? "" : _.escape(__t)) + "</div></a></li>"), __p += '<li class="blog-sub-nav-item ', isSelected("/blog/" + model.name + "/followers") && (__p += "selected"), __p += '" data-js-menu-item><a href="/blog/' + (null == (__t = model.name) ? "" : _.escape(__t)) + '/followers" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">' + (null == (__t = __("Followers")) ? "" : _.escape(__t)) + "</div>", model.follower_count > 0 && (__p += '<div class="blog-sub-nav-item-data">' + (null == (__t = numberFormat(model.follower_count)) ? "" : _.escape(__t)) + "</div>"), __p += "</a></li>", model.activity_data && model.activity_data.sparkline && (__p += '<li class="blog-sub-nav-item ', isSelected("/blog/" + model.name + "/activity") && (__p += "selected"), __p += '" data-js-menu-item><a href="/blog/' + (null == (__t = model.name) ? "" : _.escape(__t)) + '/activity" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">' + (null == (__t = __("Activity")) ? "" : _.escape(__t)) + '</div><div class="blog-sub-nav-item-data sparkline" data-sparkline="' + (null == (__t = model.activity_data.sparkline) ? "" : _.escape(__t)) + '"></div></a></li>'), __p += "", model.member_count > 0 && (__p += '<li class="blog-sub-nav-item ', isSelected(model.dashboard_url + "/members") && (__p += "selected"), __p += '" data-js-menu-item><a href="' + (null == (__t = model.dashboard_url) ? "" : _.escape(__t)) + '/members" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">' + (null == (__t = __("Members")) ? "" : _.escape(__t)) + '</div><div class="blog-sub-nav-item-data">' + (null == (__t = numberFormat(model.member_count)) ? "" : _.escape(__t)) + "</div></a></li>"), __p += "", model.draft_count > 0 && (__p += '<li class="blog-sub-nav-item ', isSelected(model.dashboard_url + "/drafts") && (__p += "selected"), __p += '" data-js-menu-item><a href="' + (null == (__t = model.dashboard_url) ? "" : _.escape(__t)) + '/drafts" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">' + (null == (__t = __("Drafts")) ? "" : _.escape(__t)) + '</div><div class="blog-sub-nav-item-data">' + (null == (__t = numberFormat(model.draft_count)) ? "" : _.escape(__t)) + "</div></a></li>"), __p += "", model.queued_post_count > 0 && (__p += '<li class="blog-sub-nav-item ', isSelected(model.dashboard_url + "/queue") && (__p += "selected"), __p += '" data-js-menu-item><a href="' + (null == (__t = model.dashboard_url) ? "" : _.escape(__t)) + '/queue" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">' + (null == (__t = __("Queue")) ? "" : _.escape(__t)) + '</div><div class="blog-sub-nav-item-data">' + (null == (__t = numberFormat(model.queued_post_count)) ? "" : _.escape(__t)) + "</div></a></li>"), __p += "", model.transcoding_count > 0 && (__p += '<li class="blog-sub-nav-item ', isSelected(model.dashboard_url + "/processing") && (__p += "selected"), __p += '" data-js-menu-item><a href="' + (null == (__t = model.dashboard_url) ? "" : _.escape(__t)) + '/processing" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">' + (null == (__t = __("Processing")) ? "" : _.escape(__t)) + '</div><div class="blog-sub-nav-item-data">' + (null == (__t = numberFormat(model.transcoding_count)) ? "" : _.escape(__t)) + "</div></a></li>"), __p += "", model.is_visible_premium_partner && (__p += '<li class="blog-sub-nav-item ', isSelected(model.analytics_url) && (__p += "selected"), __p += '" data-js-menu-item><a href="' + (null == (__t = model.analytics_url) ? "" : _.escape(__t)) + '" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">' + (null == (__t = __("Analytics")) ? "" : _.escape(__t)) + "</div></a></li>"), __p += "", model.can_view_customize && (__p += '<li class="blog-sub-nav-item ', isSelected("/settings/blog/" + model.name) && (__p += "selected"), __p += '" data-js-menu-item><a href="/settings/blog/' + (null == (__t = model.name) ? "" : _.escape(__t)) + '" class="blog-sub-nav-item-link" data-js-menu-item-link><div class="blog-sub-nav-item-label">' + (null == (__t = __("Edit appearance")) ? "" : _.escape(__t)) + "</div></a></li>"), __p += "</ul>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  5: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="blog-list-item blog-list-item--on-light ' + (null == (__t = model.is_private_group_channel ? "blog-list-item--private" : "") ? "" : _.escape(__t)) + '">' + (null == (__t = _subview("loader")) ? "" : __t) + '<a data-js-action-blog-anchor data-js-menu-item-link class="blog-list-item-anchor" href="/blog/' + (null == (__t = model.name) ? "" : _.escape(__t)) + '"><span class="blog-list-item-avatar"><img class="blog-list-item-avatar-image" alt="avatar" src="' + (null == (__t = avatarUrl) ? "" : _.escape(__t)) + '">', model.unread_count > 0 && (__p += ' <span class="blog-list-item-icon blog-list-item-unread-notice tab_notice tab-notice--outlined tab-notice--active on-light"><span class="tab_notice_value">' + (null == (__t = model.unread_count > 99 ? "99+" : model.unread_count) ? "" : _.escape(__t)) + "</span></span>"), __p += '</span> <span class="blog-list-item-info"><span class="blog-list-item-info-name">' + (null == (__t = model.name) ? "" : _.escape(__t)) + "</span>", model.is_private_group_channel && (__p += '<i class="blog-list-item-icon blog-list-item-icon-private icon_lock_12"></i>'), __p += '<br><span class="blog-list-item-info-title">' + (null == (__t = model.directory_safe_title) ? "" : __t) + '</span></span></a> <a data-js-action-details-open class="blog-list-item-button blog-list-item-button-details icon_manburger"></a></div>' + (null == (__t = _subview("details")) ? "" : __t);
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  6: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="popover popover_menu popover_gradient"><div class="popover_inner"><ul data-js-account-list class="popover_inner_list"><li class="popover_subsection"><div class="popover_header">' + (null == (__t = __("Account")) ? "" : _.escape(__t)) + '<div class="popover_item_suffix"><a data-js-action-logout class="logout" href="/logout" id="logout_button">' + (null == (__t = __("Log out")) ? "" : _.escape(__t)) + '</a></div></div><ul class="popover_menu_list"><li class="popover_menu_item" data-js-menu-item><a class="popover_menu_item_anchor" href="/likes" data-js-menu-item-link>', model.liked_post_count && model.liked_post_count > 0 && (__p += '<div class="popover_item_suffix" data-js-like-count>' + (null == (__t = numberFormat(model.liked_post_count)) ? "" : _.escape(__t)) + "</div>"), __p += '<i class="popover_menu_item_anchor_icon icon_like"></i>' + (null == (__t = __("Likes")) ? "" : _.escape(__t)) + "</a></li>", model.friend_count && model.friend_count > 0 && (__p += '<li class="popover_menu_item" data-js-menu-item><a class="popover_menu_item_anchor" href="/following" data-js-menu-item-link><div class="popover_item_suffix" data-js-following-count>' + (null == (__t = numberFormat(model.friend_count)) ? "" : _.escape(__t)) + '</div><i class="popover_menu_item_anchor_icon icon_following"></i>' + (null == (__t = __("Following")) ? "" : _.escape(__t)) + "</a></li>"), __p += '<li class="popover_menu_item" data-js-menu-item><a class="popover_menu_item_anchor" href="/settings" data-js-menu-item-link><i class="popover_menu_item_anchor_icon icon_settings"></i>' + (null == (__t = __("Settings")) ? "" : _.escape(__t)) + '</a></li><li class="popover_menu_item" data-js-menu-item><a class="popover_menu_item_anchor" href="/help" data-js-menu-item-link><i class="popover_menu_item_anchor_icon icon_help"></i>' + (null == (__t = __("Help")) ? "" : _.escape(__t)) + '</a></li></ul></li><li class="popover_subsection"><div class="popover_header">' + (null == (__t = __("Blogs")) ? "" : _.escape(__t)) + '<div class="popover_item_suffix"><a href="/new/blog">+&nbsp;' + (null == (__t = __("New")) ? "" : _.escape(__t)) + '</a></div></div><ul class="popover_menu_list"><li class="popover_menu_sublist"><ul data-js-channel-list></ul></li></ul></li></ul></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  7: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("backbone"), n = t("velocity-animate"), a = t("numeral"), r = t("prima/views/base"), l = t("../templates/account-popover-blog-sub-nav-details.tpl"), h = r.extend({
      template: l,
      className: "popover_menu_item_blog_details",
      serialize: function () {
        return {isSelected: this.isSelected, numberFormat: this.numberFormat}
      },
      isSelected: function (t) {
        var e = "/" + o.history.fragment;
        return e === t
      },
      numberFormat: function (t) {
        return a(t).format("0,0")
      },
      addSparkline: function () {
        var t = this.$el.find(".sparkline"), e = JSON.parse(this.model.get("activity_data").sparkline);
        e && 0 !== s.max(e) && s.isFunction(t.sparkline) && (t.sparkline(e, {
          type: "line",
          lineColor: "#7f7f7f",
          fillColor: !1,
          lineWidth: 4,
          spotColor: !1,
          minSpotColor: !1,
          maxSpotColor: !1,
          disableInteraction: !0,
          width: "72px",
          height: "30px"
        }), t.find("canvas").css({height: "15px", width: "36px"}))
      },
      beforeRender: function () {
        this.stopListening()
      },
      afterRender: function () {
        this.$detailsInner = this.$("[data-blog-details-inner]"), this.listenTo(this.model, "change", function (t) {
          s.any(t.changed, function (t, e) {
            return e.match(/_count$/i)
          }) && this.render()
        }), s.defer(s.bind(this.addSparkline, this))
      },
      show: function () {
        this.animateOpen()
      },
      hide: function () {
        this.animateClosed()
      },
      animateOpen: function () {
        var t = this.$detailsInner.outerHeight();
        return n(this.$el, {height: t}, {duration: 250, easing: "ease-in-out"})
      },
      animateClosed: function () {
        return n(this.$el, {height: 0}, {duration: 250, easing: "ease-in-out"})
      },
      showImmediately: function () {
        this.$el.css({height: "auto"})
      },
      teardown: function () {
        return this.remove(), this
      }
    });
    e.exports = h
  }, {
    "../templates/account-popover-blog-sub-nav-details.tpl": 4,
    backbone: "5kFNoY",
    lodash: "MicNly",
    numeral: "ubjloo",
    "prima/views/base": 613,
    "velocity-animate": "lWl/mc"
  }],
  8: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("when"), n = t("app/lib/avatar-size"), a = t("prima/views/base"), r = t("../templates/account-popover-blog-sub-nav.tpl"), l = t("components/loader"), h = t("./account-popover-blog-sub-nav-details"), c = a.extend({
      tagName: "li",
      className: "popover_menu_item popover_menu_item_blog",
      template: r,
      events: {
        "click [data-js-action-details-open]": "onClickItem",
        "click [data-js-menu-item-link]": "onClickBlogLink"
      },
      defaults: {open: !1, showImmediately: !1, detailsReady: !1, uncloseable: !1},
      initialize: function () {
        this.on("change:open", this.toggleOpen), this.on("change:uncloseable", this.toggleUncloseable), this.setAvatarSize(), this.$el.attr({
          id: "blog-list-item--" + this.model.get("name"),
          "data-js-menu-item": !0
        })
      },
      setAvatarSize: function () {
        var t = n(this.model.get("avatar_url"));
        this.set("avatarUrl", t(64))
      },
      toggleUncloseable: function () {
        this.$el.toggleClass("popover_menu_item_blog--uncloseable", this.get("uncloseable"))
      },
      toggleOpen: function (t, e) {
        s.isObject(t) || (e = !!t), e ? (this.toggleLoader(!0), this.toggleAnimate(!0), this.$el.addClass("popover_menu_item_blog--open")) : (this.toggleAnimate(!1), this.$el.removeClass("popover_menu_item_blog--open"))
      },
      toggleLoader: function (t) {
        t === !0 ? this.loader ? this.loader.set("loading", !0) : this.loader = new l({
          $container: this.$el,
          type: "bar",
          classModifiers: "top",
          loading: !0
        }) : this.loader.set("loading", !1)
      },
      toggleAnimate: function (t, e) {
        s.isObject(t) || (e = !!t), e ? this.getDetailsView().then(s.bind(function (t) {
          this.toggleLoader(!1), this.get("showImmediately") ? (t.showImmediately(), this.set("showImmediately", !1)) : t.show()
        }, this)) : this.getDetailsView().then(function (t) {
          t.hide()
        })
      },
      onClickItem: function (t) {
        t.preventDefault(), this.toggle("open")
      },
      onClickBlogLink: function (t) {
        t.metaKey || this.toggleLoader(!0), t.stopPropagation()
      },
      isLoaded: function () {
        return this.model.has("follower_count")
      },
      loadDetails: function () {
        return this.model.fetch_analytics_data()
      },
      getDetailsView: function () {
        return o.promise(s.bind(function (t, e) {
          return this.subviews.details ? void t(this.subviews.details) : void(this.isLoaded() ? t(this.renderDetailsView()) : this.loadDetails().then(s.bind(function () {
            t(this.renderDetailsView())
          }, this))["catch"](function (t) {
            e(t)
          }))
        }, this))
      },
      renderDetailsView: function () {
        return this.subviews.details ? this.subviews.details : (this.subviews.details = new h({model: this.model}), this.renderSubviews(), this.subviews.details)
      },
      teardown: function () {
        return this.remove(), this
      }
    });
    e.exports = c
  }, {
    "../templates/account-popover-blog-sub-nav.tpl": 5,
    "./account-popover-blog-sub-nav-details": 7,
    "app/lib/avatar-size": 456,
    "components/loader": 499,
    lodash: "MicNly",
    "prima/views/base": 613,
    when: "RG2dij"
  }],
  9: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("numeral"), a = t("app/lib/scrollbar"), r = t("prima/views/base"), l = t("../templates/account-popover.tpl"), h = t("prima/events"), c = t("prima/utils/bindendevent").transition, d = t("prima/lib/clickoutside"), u = t("prima/lib/translate"), p = t("prima/mixins/popoverbase"), m = t("prima/mixins/selectorcache"), g = t("app/components/dialog"), _ = t("./account-popover-blog-sub-nav"), f = r.extend({
      className: "popover--account-popover",
      mixins: [p, m],
      template: l,
      defaults: {popoverData: {}, preventInteraction: !0, order: []},
      events: {"click [data-js-action-logout]": "logout"},
      initialize: function (t) {
        this.options = o.extend({}, this.defaults, t), this.listenTo(this.model, "change:liked_post_count", this.onLikeCountChange), this.listenTo(this.model, "change:friend_count", this.onFollowingCountChange)
      },
      logout: function (t) {
        t.preventDefault();
        var e = s(t.currentTarget), i = e.attr("href"), n = {
          text: u("Are you sure you want to log out?"),
          animate_in: {dialog_class: "fade-in-up log-out-dialog"}
        };
        return this.hide(), g.confirm(n, o.bind(function () {
          window.location.href = i
        })), !1
      },
      numberFormat: function (t) {
        return n(t).format("0,0")
      },
      render: function () {
        return this.$el.html(this.template({
          model: this.model.toJSON(),
          numberFormat: this.numberFormat
        })), this.$pinned.addClass("active"), this.renderUserChannels(), this.makeChannelsSortable(), this.$main = this.$el.find(".popover"), o.delay(o.bind(function () {
          this.$main.addClass("popover--active"), this.updateScrollbar(), this.bindClickOutside()
        }, this), 1), this.bindKeyNavigation(), this
      },
      updateScrollbar: function () {
        this.channelScrollBar && this.channelScrollBar.update()
      },
      afterRender: function () {
      },
      bindClickOutside: function () {
        this.clickOutside = new d(this.el, {preventInteraction: !0}), this.clickOutside.on("click:outside", this.hide, this), this.listenTo(h, "DOMEventor:keyup:escape", this.hide)
      },
      unbindClickOutside: function () {
        this.clickOutside.remove(), this.clickOutside = null, this.stopListening(h, "DOMEventor:keyup:escape")
      },
      renderUserChannels: function () {
        var t = document.createDocumentFragment(), e = this.model.channels.models;
        if (e.length) {
          var i = this.model.channels.findWhere({is_current: !0});
          i && (o.pull(e, i), e.unshift(i)), o.each(e, o.bind(function (e) {
            t.appendChild(this.renderUserChannelItem(e).el)
          }, this)), this.firstItem = this.subViews[e[0].get("name")], this.firstItem.set({
            showImmediately: !0,
            uncloseable: !0,
            open: !0
          }), this.js$("channel-list").append(t), this.model.channels.length > 1 && (o.defer(o.bind(this.addChannelScrollbar, this)), o.defer(o.bind(this.setOrder, this)))
        }
      },
      addChannelScrollbar: function () {
        this.channelScrollBar = new a(this.js$("channel-list")), this.js$("channel-list").addClass("popover_sublist popover_sublist--scrollable")
      },
      renderUserChannelItem: function (t) {
        return this.subViews[t.get("name")] = new _({model: t}), this.listenTo(this.subViews[t.get("name")], "all", this._onSubviewEvent, this), this.subViews[t.get("name")].render()
      },
      _onSubviewEvent: function () {
        var t = o.toArray(arguments);
        t[0] = "subview:" + t[0], this.trigger.apply(this, t)
      },
      _removeSubviewReference: function (t) {
        t.off("all", this._onSubviewEvent, this)
      },
      makeChannelsSortable: function () {
        this.model.channels.length > 1 && window.Tumblr.SortableView && (this.sortable = new window.Tumblr.SortableView({
          el: this.js$("channel-list"),
          items: ".popover_menu_item",
          callback: o.bind(this.saveOrder, this),
          scrollable: !0
        }))
      },
      getOrder: function () {
        return o.map(this.sortable.sequence(), function (t) {
          return t.replace("blog-list-item--", "")
        })
      },
      setOrder: function (t) {
        t || (t = this.getOrder()), this.set("order", t)
      },
      saveOrder: function () {
        if (this.model.channels.length <= 1)return !1;
        var t = this.getOrder();
        o.isEqual(t, this.get("order")) || (this.setOrder(t), s.ajax({
          type: "POST",
          url: "/order",
          data: "channel_names=" + JSON.stringify(t)
        }), this.firstItem.set({uncloseable: !1}))
      },
      hide: function () {
        this.$pinned.removeClass("active"), this.$main.removeClass("popover--active"), this.unbindClickOutside(), this.unbindKeyNavigation(), this.resetKeyboardSelection(), c(this.$el, o.bind(function () {
          this.afterHide()
        }, this))
      },
      afterHide: function () {
        this.$el.css({display: "none"})
      },
      show: function () {
        this.bindKeyNavigation(), this.bindClickOutside(), this.$pinned.addClass("active"), this.$el.css({display: "block"}), o.delay(o.bind(function () {
          this.updateScrollbar(), this.$main.addClass("popover--active")
        }, this), 1)
      },
      bindKeyNavigation: function () {
        this.listenTo(h, "DOMEventor:keydown:up", this.highlightPreviousItem), this.listenTo(h, "DOMEventor:keydown:down", this.highlightNextItem), this.listenTo(h, "DOMEventor:keydown:left", this.collapseItem), this.listenTo(h, "DOMEventor:keydown:right", this.expandItem), this.listenTo(h, "DOMEventor:keydown:enter", this.openItemLink)
      },
      unbindKeyNavigation: function () {
        this.stopListening(h, "DOMEventor:keydown:up"), this.stopListening(h, "DOMEventor:keydown:down"), this.stopListening(h, "DOMEventor:keydown:left"), this.stopListening(h, "DOMEventor:keydown:right"), this.stopListening(h, "DOMEventor:keydown:enter")
      },
      highlightNextItem: function (t) {
        t.preventDefault();
        var e = this.$el.find("[data-js-menu-item]:visible"), i = this.$el.find(".currentItem"), s = i.length > 0 ? o.findIndex(e, i.get(0)) + 1 : 0;
        s === e.length && (s = 0);
        var n = e.get(s);
        this.highlightItem(n)
      },
      highlightPreviousItem: function (t) {
        t.preventDefault();
        var e = this.$el.find("[data-js-menu-item]:visible"), i = o.findIndex(e, this.$el.find(".currentItem").get(0)) - 1;
        -1 === i && (i = e.length - 1);
        var s = e.get(i);
        this.highlightItem(s)
      },
      highlightItem: function (t) {
        this.resetKeyboardSelection();
        var e = s(t);
        e.addClass("currentItem"), this.scrollToItem(e)
      },
      scrollToItem: function (t) {
        var e = this.js$("channel-list");
        if (t.closest(e).length) {
          var i = t.closest(".popover_menu_item_blog--open");
          i.length > 0 && (t = i);
          var s = e.offset().top, o = s + e.height(), n = t.offset().top, a = n + t.height(), r = 0;
          n >= s && o >= a || (r = s > n ? n - s : a - o, e.animate({scrollTop: e.scrollTop() + r}, 100))
        }
      },
      resetKeyboardSelection: function () {
        this.$el.find(".currentItem").removeClass("currentItem")
      },
      expandItem: function (t) {
        t.preventDefault(), this.$el.find(".currentItem.popover_menu_item_blog:not(.popover_menu_item_blog--open) [data-js-action-details-open]").trigger("click")
      },
      collapseItem: function (t) {
        t.preventDefault();
        var e = this.$el.find(".currentItem.popover_menu_item_blog--open");
        if (e.length || (e = this.$el.find("[data-js-menu-item]:has(.currentItem)")), e.length > 0) {
          var i = e.find("[data-js-action-details-open]:visible");
          i.length > 0 && (i.trigger("click"), this.highlightItem(e.get(0)))
        }
      },
      openItemLink: function (t) {
        t.preventDefault();
        var e = this.$el.find(".currentItem [data-js-menu-item-link]:first");
        e.length > 0 && e.get(0).click()
      },
      beforeTeardown: function () {
        return o.each(this.subViews, function (t) {
          this._removeSubviewReference(t)
        }, this), this.channelScrollBar && this.channelScrollBar.destroy(), this.remove(), this.$pinned.removeClass("active"), this
      },
      onFollowingCountChange: function () {
        var t = this.model.get("friend_count");
        this.js$("following-count").text(0 !== t ? this.numberFormat(t) : "")
      },
      onLikeCountChange: function () {
        var t = this.model.get("liked_post_count");
        this.js$("like-count").text(0 !== t ? this.numberFormat(t) : "")
      }
    });
    e.exports = f
  }, {
    "../templates/account-popover.tpl": 6,
    "./account-popover-blog-sub-nav": 8,
    "app/components/dialog": 44,
    "app/lib/scrollbar": 460,
    jquery: "HlZQrA",
    lodash: "MicNly",
    numeral: "ubjloo",
    "prima/events": 546,
    "prima/lib/clickoutside": 547,
    "prima/lib/translate": 575,
    "prima/mixins/popoverbase": 583,
    "prima/mixins/selectorcache": 586,
    "prima/utils/bindendevent": 593,
    "prima/views/base": 613
  }],
  10: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/component"), a = t("prima/events"), r = t("prima/utils/bindendevent").transition, l = t("./views/account-tour-guide"), h = n.extend({
      name: "AccountTourGuide",
      initialize: function () {
        this.$glass = null, this.$container = s(this.container), this.$body = s("body"), this.$tabBar = s(".tab-bar"), this.listenTo(this.view, "clickCloseButton", this.close)
      },
      onClickGlass: function () {
        this.triggerEvent("clickClose"), this.close()
      },
      onClickEsc: function () {
        this.triggerEvent("clickClose"), this.close()
      },
      view: function () {
        return new l({pinnedTarget: this.container, isFixedPosition: !0})
      },
      showGlass: function () {
        this.$glass = s("<div>", {"class": "glass--account-tour-guide"}).appendTo(this.$body);
        var t = o.bind(function () {
          this.$glass.addClass("active")
        }, this);
        o.delay(t, 150), this.$glass.on("click", o.bind(this.onClickGlass, this))
      },
      hideGlass: function () {
        this.$glass.removeClass("active"), this.$glass.remove(), this.$glass = null
      },
      close: function () {
        this.view && (this.view.teardown(), this.hideGlass(), a.trigger("keycommands:resume"), a.trigger("drawer:resume"), a.trigger("toaster:resume"), this.stopListening(a, "DOMEventor:flatresize"), this.stopListening(a, "DOMEventor:keyup:escape"), this.trigger("close"))
      },
      open: function () {
        this.showGlass(), r(this.$glass, o.bind(function () {
          this.append()
        }, this)), a.trigger("keycommands:suspend"), a.trigger("drawer:suspend"), a.trigger("toaster:suspend"), this.listenTo(a, "DOMEventor:keyup:escape", this.onClickEsc), this.triggerEvent("seen"), s.ajax({
          url: "/svc/post/set_seen_atg",
          type: "POST",
          with_form_key: !0
        })
      },
      append: function () {
        return this.view.render(), this.clonedTabNavAccountItem = this.$tabBar.find(".tab_nav_account").clone(), this.clonedTabNavActivityItem = this.$tabBar.find(".tab_activity").clone(), this.view.$tabBar.append([this.clonedTabNavAccountItem, this.clonedTabNavActivityItem]), this.listenTo(a, "DOMEventor:flatresize", this.positionClonedTabNavAccountItem), this.trigger("append"), this
      },
      triggerEvent: function (t) {
        this.trigger(t), a.trigger("TourGuideAccount:" + t, {loggingData: t})
      }
    });
    e.exports = h
  }, {
    "./views/account-tour-guide": 12,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/component": 545,
    "prima/events": 546,
    "prima/utils/bindendevent": 593
  }],
  11: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="popover popover_gradient"><div class="popover_inner"><div class="step current"><h3 class="title">' + (null == (__t = __("Don't freak out. Your things are right here.")) ? "" : _.escape(__t)) + '</h3><p class="content">' + (null == (__t = __("Your blog info, account info, and recent activity are in these menus.")) ? "" : _.escape(__t)) + '</p><button class="button-continue flat-button" type="button" data-js-next-step>' + (null == (__t = __("Wait, why?")) ? "" : _.escape(__t)) + '</button> <button class="button-close blue flat-button" type="button" data-js-close>' + (null == (__t = __("Okay, phew")) ? "" : _.escape(__t)) + '</button></div><div class="step"><h3 class="title">' + (null == (__t = __("Why?")) ? "" : _.escape(__t)) + '</h3><p class="content">' + (null == (__t = __("It's so you never have to scroll to the top of the dashboard to access this stuff.")) ? "" : _.escape(__t)) + '</p><button class="button-close blue flat-button full-width" type="button" data-js-close>' + (null == (__t = __("Ohhh")) ? "" : _.escape(__t)) + '</button></div></div></div><div class="tab_bar"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  12: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("../templates/account-tour-guide.tpl"), a = t("prima/events"), r = t("prima/mixins/popoverbase"), l = o.extend({
      className: "popover--account-tour-guide",
      mixins: [r],
      template: n,
      defaults: {},
      events: {"click [data-js-next-step]": "onClickNexStep", "click [data-js-close]": "onClickClose"},
      initialize: function (t) {
        this.options = s.extend({}, this.defaults, t)
      },
      render: function () {
        return this.duration = 300, this.$el.html(this.template()), this.$wrapper = this.$el.find(".popover_inner"), this.$tabBar = this.$el.find(".tab_bar"), this
      },
      onClickNexStep: function () {
        var t = this.$el.find(".step:nth-child(1)"), e = this.$el.find(".step:nth-child(2)"), i = this.duration, s = e.height();
        t.fadeOut(i), this.$wrapper.animate({height: s}, i, "swing", function () {
          e.fadeIn(i)
        }), this.triggerEvent("clickNextButton")
      },
      onClickClose: function () {
        this.$el.find(".popover_inner").animate({height: 0, opacity: 0}, this.duration, s.bind(function () {
          this.teardown()
        }, this)), this.triggerEvent("clickCloseButton")
      },
      beforeTeardown: function () {
        return this.remove(), this
      },
      triggerEvent: function (t) {
        this.trigger(t), a.trigger("TourGuideAccount:" + t, {loggingData: t})
      }
    });
    e.exports = l
  }, {
    "../templates/account-tour-guide.tpl": 11,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/popoverbase": 583,
    "prima/view": 612
  }],
  13: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/component"), n = t("./views/activity-popover"), a = t("app/lib/currentuser"), r = o.extend({
      name: "ActivityPopover",
      view: function (t) {
        return t = s.extend({}, {
          model: a(),
          pinnedTarget: this.container,
          isFixedPosition: !0,
          autoTeardown: !1,
          teardownOnEscape: !1
        }, t), new n(t)
      },
      show: function () {
        this.view.show()
      },
      render: function () {
        return this.view.render(), this.trigger("append"), this
      }
    });
    e.exports = r
  }, {"./views/activity-popover": 24, "app/lib/currentuser": 459, lodash: "MicNly", "prima/component": 545}],
  14: [function (t, e, i) {
    var s = t("prima/model"), o = s.extend({});
    e.exports = o
  }, {"prima/model": 590}],
  15: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="date_header clearfix"><div class="part_relative_date">' + (null == (__t = model.relativeDate) ? "" : __t) + '</div><div class="part_full_date">' + (null == (__t = model.dateHeader.format("dddd, MMMM D")) ? "" : __t) + "</div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  16: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="ui_note ' + (null == (__t = model.type) ? "" : __t) + " " + (null == (__t = model.from_tumblelog && model.from_tumblelog.is_friend ? " is_friend" : "") ? "" : __t) + '" data-timestamp="' + (null == (__t = model.timestamp) ? "" : __t) + '" data-tumblelog-name="' + (null == (__t = model.from_tumblelog ? model.from_tumblelog.name : "") ? "" : __t) + '"><div class="stage"><div class="part_activity"><div class="part_main"><span class="activity">' + (null == (__t = model.message) ? "" : __t), model.post && model.post.summary && (__p += '<span class="summary">&#8220;' + (null == (__t = model.post.summary) ? "" : _.escape(__t)) + "&#8221;</span>"), __p += '</span></div></div><a class="part_glass" target="_blank" href="' + (null == (__t = model.clickthrough_url) ? "" : __t) + '"></a><div class="part_avatar">', __p += model.from_tumblelog ? '<div class="ui_avatar"><div data-avatar-url="' + (null == (__t = model.from_tumblelog.avatar_url_128) ? "" : __t) + '" target="_blank" class="ui_avatar_link frame ' + (null == (__t = model.type) ? "" : __t) + '" title="' + (null == (__t = model.from_tumblelog.name) ? "" : __t) + '"><a href="' + (null == (__t = model.from_tumblelog.tumblr_url) ? "" : __t) + '" class="avatar" style="background-image: url(\'' + (null == (__t = model.from_tumblelog.avatar_url_48) ? "" : __t) + '\')"><div class="inner_frame"></div><div class="avatar_glass"></div><span class="ui_avatar_tumblelog_name">' + (null == (__t = model.from_tumblelog.name) ? "" : __t) + "</span></a></div></div>" : '<div class="ui_avatar"><div data-avatar-url="/images/anonymous_avatar_64.gif" target="_blank" class="ui_avatar_link frame ' + (null == (__t = model.type) ? "" : __t) + '" title="Anonymous"><div class="avatar" style="background-image: url(\'/images/anonymous_avatar_64.gif\')"><div class="inner_frame"></div><div class="avatar_glass"></div><span class="ui_avatar_tumblelog_name"></span></div></div></div>', __p += '</div><div class="part_icon">', !model.from_tumblelog || model.from_tumblelog.is_friend || "follower" !== model.type && "user_mention" !== model.type ? model.post && (__p += ' <a href="' + (null == (__t = model.post.url) ? "" : __t) + '" target="_blank" class="ui_post_badge ' + (null == (__t = model.post.type) ? "" : __t) + '"><div class="inner_frame"></div></a>') : __p += '<a class="note_follow plus-follow-button blue" href="/follow/' + (null == (__t = model.from_tumblelog.name) ? "" : __t) + '" data-tumblelog-name="' + (null == (__t = model.from_tumblelog.name) ? "" : __t) + '" title="' + (null == (__t = __("Follow")) ? "" : __t) + '"><span class="icon_plus follow_icon"></span></a>', __p += "</div>", model.note_meta && (model.note_meta.answer_text || model.note_meta.reply_text) ? __p += '<div class="part_response ' + (null == (__t = model.note_meta.answer_text ? "is_part_answer" : "") ? "" : __t) + " " + (null == (__t = model.note_meta.reply_text ? "is_part_reply" : "") ? "" : __t) + '"><blockquote>' + (null == (__t = model.note_meta.answer_text ? model.note_meta.answer_text : "") ? "" : __t) + (null == (__t = model.note_meta.reply_text ? model.note_meta.reply_text : "") ? "" : __t) + "</blockquote></div>" : "reblog" === model.type && model.new_post && model.new_post.diff ? __p += '<div class="part_response is_part_reblog"><blockquote>' + (null == (__t = model.new_post.diff) ? "" : __t) + "</blockquote></div>" : "user_mention" == model.type && model.new_post && model.new_post.quote && (__p += '<div class="part_response is_part_user_mention"><blockquote>' + (null == (__t = model.new_post.quote) ? "" : __t) + "</blockquote></div>"), __p += "</div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  17: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", __p += model.activity_notifications.length > 1 ? '<div class="blog-activity-content"><ul data-js-blog-activity-notification-list class="ui_notes"></ul></div><a href="/blog/' + (null == (__t = model.name) ? "" : _.escape(__t)) + '/activity" class="blog-activity-more">' + (null == (__t = __("See everything")) ? "" : _.escape(__t)) + "</a>" : '<div class="blog-activity--empty"><i class="icon_activity"></i><p class="blog-activity--empty-text">' + (null == (__t = __("Check out this tab when you make a post to see Likes, Reblogs, and new followers.")) ? "" : _.escape(__t)) + "</p></div>",
          __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  18: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<a class="activity-popover-sparkline-link" href="' + (null == (__t = activityPageUrl) ? "" : __t) + '" title="Activity"><div class="sparkline"></div></a>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  19: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="popover popover_menu popover_gradient"><div class="popover_inner"><div class="activity-popover-header">' + (null == (__t = _subview("tumblelogSelect")) ? "" : __t) + (null == (__t = _subview("sparkline")) ? "" : __t) + (null == (__t = _subview("loader")) ? "" : __t) + '</div><div class="activity-popover-notifications">' + (null == (__t = _subview("activityNotifications")) ? "" : __t) + "</div></div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  20: [function (t, e, i) {
    "use strict";
    var s = t("prima/views/base"), o = t("../templates/activity-popover-date.tpl"), n = t("moment"), a = t("prima/lib/translate"), r = s.extend({
      tagName: "li",
      className: "blog-activity-date",
      template: o,
      events: {},
      defaults: {},
      beforeRender: function () {
        var t = n();
        this.model.set("relativeDate", this.getRelativeDate(t))
      },
      getRelativeDate: function (t) {
        var e = t.diff(this.model.attributes.dateHeader), i = n.duration(e).asHours(), s = Math.floor(i / 24);
        return 0 >= s ? a("Today") : 1 >= s ? a("Yesterday") : a("%d days ago", s)
      },
      teardown: function () {
        return this.remove(), this
      }
    });
    e.exports = r
  }, {
    "../templates/activity-popover-date.tpl": 15,
    moment: "iROhDJ",
    "prima/lib/translate": 575,
    "prima/views/base": 613
  }],
  21: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../templates/activity-popover-notification-item.tpl"), a = t("app/models/tumblelog"), r = t("prima/utils/bindendevent").animation, l = o.extend({
      tagName: "li",
      className: "blog-activity-notification",
      template: n,
      events: {"click .plus-follow-button": "onClickFollow"},
      defaults: {tumblelogToFollow: !1, followSource: "FOLLOW_SOURCE_ACTIVITY_POPOVER"},
      initialize: function (t) {
        if (this.options = s.defaults(t, this.defaults), !this.model.get("is_friend") && !this.get("tumblelogToFollow")) {
          var e = this.model.get("from_tumblelog");
          e && (this.set("tumblelogToFollow", new a({name: e.name})), this.listenTo(this.get("tumblelogToFollow"), "change:following", this.onFollow))
        }
      },
      beforeRender: function () {
        var t = "";
        this.model.get("new_post") && this.model.get("new_post").url ? t = this.model.get("new_post").url : this.model.get("post") && this.model.get("post").url ? t = this.model.get("post").url : this.model.get("from_tumblelog") && this.model.get("from_tumblelog").tumblr_url && (t = this.model.get("from_tumblelog").tumblr_url), this.model.set("clickthrough_url", t)
      },
      afterRender: function () {
        this.$tumblelogLink = this.$(".notification-tumblelog-link"), this.$followButton = this.$(".plus-follow-button"), this.$ui_post_badge = this.$(".ui_post_badge");
        var t = this.model.get("post"), e = {}, i = "", s = t ? t.type : "regular";
        switch (s) {
          case"photo":
          case"photoset":
            e.backgroundImage = "url('" + t.media_url + "')";
            break;
          case"video":
            t.video_thumbnail_url && (e.backgroundImage = "url('" + t.video_thumbnail_url + "')", i = "has_video_thumbnail");
            break;
          case"note":
            t.is_ask ? i = "ask" : t.is_answer && (i = "ask_answer");
            break;
          case"postcard":
            i = "fanmail"
        }
        this.$tumblelogLink && this.$tumblelogLink.addClass("js-hover-trigger-TumblelogPopover"), this.$ui_post_badge.css(e).addClass(i)
      },
      onClickFollow: function (t) {
        t.preventDefault(), this.$followButton.closest(".ui_note").addClass("is_friend"), this.get("tumblelogToFollow").follow({tumblelog: this.get("tumblelogToFollow").name})
      },
      onFollow: function (t, e) {
        r(this.$followButton, s.bind(function () {
          this.hideFollowButton()
        }, this)), this.$followButton.toggleClass("follow_poof", e)
      },
      hideFollowButton: function () {
        this.$followButton.css({display: "none"})
      },
      teardown: function () {
        return this.remove(), this
      }
    });
    e.exports = l
  }, {
    "../templates/activity-popover-notification-item.tpl": 16,
    "app/models/tumblelog": 463,
    lodash: "MicNly",
    "prima/utils/bindendevent": 593,
    "prima/views/base": 613
  }],
  22: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../templates/activity-popover-notifications.tpl"), a = t("prima/mixins/selectorcache"), r = t("app/lib/scrollbar"), l = t("./activity-popover-notification-item"), h = t("./activity-popover-date"), c = t("../models/activity-notification"), d = t("moment"), u = o.extend({
      className: "blog-activity",
      template: n,
      mixins: [a],
      defaults: {removable: !0},
      initialize: function () {
      },
      addChannelScrollbar: function () {
        this.notificationScrollBar = new r(this.js$("blog-activity-notification-list"))
      },
      afterRender: function () {
        this.model.get("activity_notifications").length > 1 && (s.defer(s.bind(this.addChannelScrollbar, this)), this.js$("blog-activity-notification-list").addClass("popover_sublist popover_sublist--scrollable"), this.createSubviews())
      },
      beforeTeardown: function () {
        this.notificationScrollBar && this.notificationScrollBar.destroy()
      },
      createSubviews: function () {
        for (var t, e = this.model.get("activity_notifications"), i = 0; i < e.length; i++) {
          var s = !1, o = d.unix(e[i].timestamp).startOf("day");
          if (t && o.fromNow() === t.fromNow() || (s = o), s) {
            e[i].dateHeader = s;
            var n = new h({model: new c(e[i])});
            this.appendSubview(n, "ul[data-js-blog-activity-notification-list]")
          }
          var a = new l({model: new c(e[i])});
          this.appendSubview(a, "ul[data-js-blog-activity-notification-list]"), t = d.unix(e[i].timestamp).startOf("day")
        }
      },
      teardown: function () {
        return this.remove(), this
      }
    });
    e.exports = u
  }, {
    "../models/activity-notification": 14,
    "../templates/activity-popover-notifications.tpl": 17,
    "./activity-popover-date": 20,
    "./activity-popover-notification-item": 21,
    "app/lib/scrollbar": 460,
    lodash: "MicNly",
    moment: "iROhDJ",
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  23: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../templates/activity-popover-sparkline.tpl"), a = o.extend({
      template: n,
      className: "activity-popover-sparkline-container",
      defaults: {
        removable: !0,
        sparklineFormatting: {
          type: "line",
          lineColor: "#7f7f7f",
          fillColor: !1,
          lineWidth: 4,
          spotColor: !1,
          minSpotColor: !1,
          maxSpotColor: !1,
          disableInteraction: !0,
          width: "72px",
          height: "30px"
        }
      },
      getTemplateData: function () {
        return {activityPageUrl: "/blog/" + this.model.get("name") + "/activity"}
      },
      addSparkline: function () {
        var t = this.$el.find(".sparkline"), e = JSON.parse(this.model.get("activity_data").sparkline);
        e && 0 !== s.max(e) && s.isFunction(t.sparkline) && (t.sparkline(e, this.get("sparklineFormatting")), t.find("canvas").css({
          height: "15px",
          width: "36px"
        }))
      },
      afterRender: function () {
        s.defer(s.bind(this.addSparkline, this))
      },
      teardown: function () {
        return this.remove(), this
      }
    });
    e.exports = a
  }, {"../templates/activity-popover-sparkline.tpl": 18, lodash: "MicNly", "prima/views/base": 613}],
  24: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/views/base"), a = t("../templates/activity-popover.tpl"), r = t("prima/events"), l = t("prima/utils/url"), h = t("prima/mixins/popoverbase"), c = t("prima/lib/clickoutside"), d = t("prima/utils/bindendevent").transition, u = t("when"), p = t("app/components/blog-selector"), m = t("./activity-popover-sparkline"), g = t("./activity-popover-notifications"), _ = t("components/loader"), f = n.extend({
      defaults: {
        popoverData: {},
        preventInteraction: !0,
        currentTumblelog: !1
      }, className: "popover--activity-popover", mixins: [h], template: a, initialize: function (t) {
        if (this.options = s.extend({}, this.defaults, t), !this.get("currentTumblelog")) {
          var e = this.model.channels.findWhere({is_current: !0});
          this.set("currentTumblelog", e)
        }
      }, render: function () {
        return this.$el.html(this.template()), this.$pinned.addClass("active"), this.$activityNotifications = this.$(".activity-popover-notifications"), this.$activityHeader = this.$(".activity-popover-header"), this.$activityPopoverMenu = this.$(".popover_menu"), s.delay(s.bind(function () {
          this.$activityPopoverMenu.addClass("popover--active"), this.bindClickOutside(), this.addTumblelogPopoverZIndex()
        }, this), 1), this.subviews.tumblelogSelect = new p({
          className: "activity-popover-tumblelog-select-container",
          collection: this.model.channels,
          dropdownClass: "popover--activity-popover-tumblelog-select-dropdown",
          popoverOptions: {popoverContainer: ".popover--activity-popover"}
        }), this.prepareActivityNotifications(), this.listenTo(this.subviews.tumblelogSelect, "change:currentTumblelog", this.updateSubviews), this
      }, addTumblelogPopoverZIndex: function () {
        this.$el.attr("data-tumblelog-popover-zindex", this.$el.css("z-index"))
      }, bindClickOutside: function () {
        var t = {preventInteraction: !0, ignoreSelectors: [".popover_content_wrapper"]};
        this.clickOutside = new c(this.el, t), this.clickOutside.on("click:outside", this.hide, this), this.clickOutside.on("click:inside", this.hideActivityPopover, this), this.listenTo(r, "DOMEventor:keyup:escape", this.hide)
      }, unbindClickOutside: function () {
        this.clickOutside.remove(), this.clickOutside = null, this.stopListening(r, "DOMEventor:keyup:escape")
      }, createSubviews: function () {
        this.removeSubviews(), this.toggleLoader(!1), this.subviews.sparkline = new m({model: this.get("currentTumblelog")}), this.subviews.activityNotifications = new g({model: this.get("currentTumblelog")}), this.rendered && (this.appendSubview(this.subviews.sparkline, this.$activityHeader), this.appendSubview(this.subviews.activityNotifications, this.$activityNotifications))
      }, hasNecessaryData: function () {
        return this.get("currentTumblelog").has("activity_notifications")
      }, loadData: function () {
        return this.get("currentTumblelog").fetch_activity_notifications()
      }, prepareActivityNotifications: function () {
        return u.promise(s.bind(function (t, e) {
          this.hasNecessaryData() ? t(this.createSubviews()) : (this.toggleLoader(!0), this.loadData().then(s.bind(function () {
            t(this.createSubviews())
          }, this))["catch"](function (t) {
            e(t)
          }))
        }, this))
      }, updateSubviews: function (t, e) {
        this.set("currentTumblelog", e), this.prepareActivityNotifications()
      }, removeSubviews: function () {
        this.subviews && s.each(this.subviews, function (t) {
          t.get("removable") && t.remove()
        })
      }, toggleLoader: function (t) {
        t === !0 ? this.loader ? this.loader.set("loading", !0) : this.loader = new _({
          $container: this.$el,
          type: "bar",
          classModifiers: "bottom",
          loading: !0
        }) : this.loader && this.loader.set("loading", !1)
      }, beforeTeardown: function () {
        return this.remove(), this.$pinned.removeClass("active"), this
      }, hideActivityPopover: function (t) {
        var e = o(t.target), i = e.closest(".tumblelog_popover"), n = e.closest("[href]");
        s.isEmpty(i) || s.isEmpty(n) || !l.isTumblelogUrl(n.attr("href")) || this.hide()
      }, hide: function () {
        this.unbindClickOutside(), this.$pinned.removeClass("active"), this.$activityPopoverMenu.removeClass("popover--active"), d(this.$el, s.bind(function () {
          this.afterHide()
        }, this))
      }, afterHide: function () {
        this.$el.css({display: "none"})
      }, show: function () {
        this.bindClickOutside(), this.$pinned.addClass("active"), this.$el.css({display: "block"}), s.delay(s.bind(function () {
          this.$activityPopoverMenu.addClass("popover--active")
        }, this), 1)
      }
    });
    e.exports = f
  }, {
    "../templates/activity-popover.tpl": 19,
    "./activity-popover-notifications": 22,
    "./activity-popover-sparkline": 23,
    "app/components/blog-selector": 37,
    "components/loader": 499,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/clickoutside": 547,
    "prima/mixins/popoverbase": 583,
    "prima/utils/bindendevent": 593,
    "prima/utils/url": 611,
    "prima/views/base": 613,
    when: "RG2dij"
  }],
  25: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/component"), a = t("prima/lib/translate"), r = t("app/lib/avatar-size"), l = t("prima/events"), h = t("../post-form-builder/views/glass"), c = t("../post-form-builder/views/modal"), d = t("./views/ask-form"), u = t("./models/question"), p = n.extend({
      name: "AskComponent",
      initialize: function (t) {
        t = t || {}, this.user = t.user, this.user && (this.blog = this.user.getChannel(), this.question = new u({
          recipient: null,
          anonymous: !1,
          question: ""
        }), this.listenTo(l, "ask:form:open", this.presentAskForm), this.listenTo(this.question, "save:success", this.onSaveSuccess))
      },
      presentAskForm: function (t) {
        return this.askFormView ? this : (this.question.set("recipient", t.recipient), s("body").addClass("postforms-open"), l.trigger("drawer:suspend"), l.trigger("keycommands:suspend"), this.glass = new h, this.modal = new c, this.askFormView = new d({
          model: this.question,
          characterLimit: 500,
          recipient: {name: t.recipient, allowAnonymous: t.allow_anonymous},
          sender: this.blog
        }), this.askFormView.render(), this.modal.setContentSubView(this.askFormView), this.glass.render().$el.appendTo("body"), this.modal.render().$el.appendTo("body"), this.glass.show().then(o.bind(this.modal.show, this.modal)), this.listenTo(this.askFormView, "close", this.dismissAskForm), this.listenTo(this.askFormView, "submit", this.submit), this)
      },
      beforeRemove: function () {
        this.dismissAskForm()
      },
      dismissAskForm: function () {
        this.askFormView && (this.stopListening(this.askFormView), this.modal.hide(), this.modal.remove(), this.modal = null, this.glass.hide(), this.glass.remove(), this.glass = null, this.askFormView.remove(), this.askFormView = null, l.trigger("keycommands:resume"), l.trigger("drawer:resume"), l.trigger("ask:form:hidden"), s("body").removeClass("postforms-open"))
      },
      submit: function (t) {
        this.question.set("anonymous", !!t.anonymous), this.question.set("question", t.question), this.question.save()
      },
      onSaveSuccess: function () {
        l.trigger("ask:form:success"), this.dismissAskForm(), o.delay(o.bind(this.toastSuccess, this, {
          recipient: this.question.get("recipient"),
          avatar: this.question.get("anonymous") ? "https://secure.assets.tumblr.com/images/anonymous_avatar_64.gif" : r(this.blog.get("avatar_url"))(64)
        }), 350)
      },
      toastSuccess: function (t) {
        var e = a("Question sent to %1$s", t.recipient), i = {
          type: "image_text",
          message: "<strong>" + e + " </strong>",
          is_link: !1,
          href: "#",
          img1: {url: t.avatar, is_link: !1, href: "#"}
        };
        l.trigger("toaster:toast", i)
      }
    });
    e.exports = p
  }, {
    "../post-form-builder/views/glass": 235,
    "../post-form-builder/views/modal": 237,
    "./models/question": 26,
    "./views/ask-form": 28,
    "app/lib/avatar-size": 456,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/component": 545,
    "prima/events": 546,
    "prima/lib/translate": 575
  }],
  26: [function (t, e, i) {
    "use strict";
    var s = t("prima/model"), o = t("lodash"), n = t("prima/lib/translate"), a = s.extend({
      urlRoot: "/svc/post/ask",
      validate: function (t) {
        return o.trim(t.question) ? this.isUrl(t.question) ? {error: n("Sorry, but please don't include links in questions.")} : void 0 : {error: n("You need to enter a question!")}
      },
      isUrl: function (t) {
        return !!(t.match(/(http|https):\/\//i) || t.match(/www\./i) || t.match(/[a-zA-Z0-9]+(\.arpa|\.root|\.aero|\.biz|\.cat|\.com|\.coop|\.edu|\.gov|\.info|\.int|\.jobs|\.mil|\.mobi|\.museum|\.name|\.net|\.org|\.pro|\.travel|TLD|\.ac|\.ad|\.ae|\.af|\.ag|\.ai|\.al|\.am|\.an|\.ao|\.aq|\.ar|\.as|\.at|\.au|\.aw|\.ax|\.az|\.ba|\.bb|\.bd|\.be|\.bf|\.bg|\.bh|\.bi|\.bj|\.bm|\.bn|\.bo|\.br|\.bs|\.bt|\.bv|\.bw|\.by|\.bz|\.ca|\.cc|\.cd|\.cf|\.cg|\.ch|\.ci|\.ck|\.cl|\.cm|\.cn|\.co|\.cr|\.cu|\.cv|\.cx|\.cy|\.cz|\.de|\.dj|\.dk|\.dm|\.do|\.dz|\.ec|\.ee|\.eg|\.er|\.es|\.et|\.eu|\.fi|\.fj|\.fk|\.fm|\.fo|\.fr|\.ga|\.gb|\.gd|\.ge|\.gf|\.gg|\.gh|\.gi|\.gl|\.gm|\.gn|\.gp|\.gq|\.gr|\.gs|\.gt|\.gu|\.gw|\.gy|\.hk|\.hm|\.hn|\.hr|\.ht|\.hu|\.id|\.ie|\.il|\.im|\.in|\.io|\.iq|\.ir|\.is|\.it|\.je|\.jm|\.jo|\.jp|\.ke|\.kg|\.kh|\.ki|\.km|\.kn|\.kr|\.kw|\.ky|\.kz|\.la|\.lb|\.lc|\.li|\.lk|\.lr|\.ls|\.lt|\.lu|\.lv|\.ly|\.ma|\.mc|\.md|\.mg|\.mh|\.mk|\.ml|\.mm|\.mn|\.mo|\.mp|\.mq|\.mr|\.ms|\.mt|\.mu|\.mv|\.mw|\.mx|\.my|\.mz|\.na|\.nc|\.ne|\.nf|\.ng|\.ni|\.nl|\.no|\.np|\.nr|\.nu|\.nz|\.om|\.pa|\.pe|\.pf|\.pg|\.ph|\.pk|\.pl|\.pm|\.pn|\.pr|\.ps|\.pt|\.pw|\.py|\.qa|\.re|\.ro|\.ru|\.rw|\.sa|\.sb|\.sc|\.sd|\.se|\.sg|\.sh|\.si|\.sj|\.sk|\.sl|\.sm|\.sn|\.so|\.sr|\.st|\.su|\.sv|\.sy|\.sz|\.tc|\.td|\.tf|\.tg|\.th|\.tj|\.tk|\.tl|\.tm|\.tn|\.to|\.tp|\.tr|\.tt|\.tv|\.tw|\.tz|\.ua|\.ug|\.uk|\.um|\.us|\.uy|\.uz|\.va|\.vc|\.ve|\.vg|\.vi|\.vn|\.vu|\.wf|\.ws|\.ye|\.yt|\.yu|\.za|\.zm|\.zw)/i))
      },
      save: function (t, e) {
        e = e || {};
        var i = e.success, n = e.error;
        e.success = o.bind(function (t, e) {
          if (o.isEmpty(o.result(e.response, "errors")))this.trigger("save:success"), i && i.call(null, t, e); else {
            var s = e.response.errors[0];
            this.trigger("save:error", s), n && n.call(null, t, s)
          }
          this.set("isSaving", !1)
        }, this), e.error = o.bind(function (t, e) {
          this.trigger("save:error", e), n && n.call(null, t, e)
        }, this), this.set("isSaving", !0);
        var a = s.prototype.save.call(this, t, e);
        !a && this.validationError && (this.trigger("save:error", this.validationError.error), this.set("isSaving", !1))
      }
    });
    e.exports = a
  }, {lodash: "MicNly", "prima/lib/translate": 575, "prima/model": 590}],
  27: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {}) {
          __p += '<div class="post_form_wrapper v_center_el"><div class="post_avatar"><a class="post_avatar_link use_blog_avatar animating" data-user-avatar-url="' + (null == (__t = sender.avatar_url) ? "" : _.escape(__t)) + '" data-avatar-url="' + (null == (__t = sender.avatar_url) ? "" : _.escape(__t)) + '" data-blog-url="' + (null == (__t = sender.blog_url) ? "" : _.escape(__t)) + '"><span class="post_avatar_link blog_avatar anonymous" data-anonymous-avatar-url="/images/anonymous_avatar_64.gif" style="background-image: url(/images/anonymous_avatar_64.gif)"></span> <span class="post_avatar_link blog_avatar new" style="background-image: url(' + (null == (__t = sender.avatar_url) ? "" : _.escape(__t)) + ')"></span></a></div><div class="post-container"><form enctype="multipart/form-data" class="active"><div class="post-container-inner post post-form--asks"><div class="post-form--header post-header"><div class="controls-container">';
          var senderMarkup = '<span class="ask-from"><span class="tumblelog_name">' + sender.name + '</span><span class="anonymous">' + __("anonymous") + "</span></span>", recipientMarkup = '<span class="ask-recipient-label">' + recipient.name + "</span>";
          if (__p += "" + (null == (__t = __('%1$s <span class="ask-to-label">to</span> %2$s', senderMarkup, recipientMarkup)) ? "" : __t) + '<span class="ask-character-count"></span></div></div><div class="post-form--form post-content"><textarea class="ask-question" name="question" placeholder="' + (null == (__t = __("Ask me anything")) ? "" : _.escape(__t)) + '" maxlength="' + (null == (__t = character_limit) ? "" : _.escape(__t)) + '" autofocus></textarea></div><div class="post-form--bottom"><div class="post-form--controls"><div class="controls-container"><div class="control left"><button type="button" class="chrome flat close">' + (null == (__t = __("Close")) ? "" : _.escape(__t)) + "</button></div>", recipient.allow_anonymous) {
            __p += '<div class="control right"><div class="ask-anonymously">';
            var randId = Math.floor(1e6 * Math.random());
            __p += '<label class="binary_switch"><input id="ask_anonymously_switch_' + (null == (__t = randId) ? "" : _.escape(__t)) + '" class="ask-anonymously-switch" type="checkbox" name="anonymous" value="1"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label class="ask-anonymously-label" for="ask_anonymously_switch_' + (null == (__t = randId) ? "" : _.escape(__t)) + '">' + (null == (__t = __("Ask anonymously")) ? "" : _.escape(__t)) + "</label></div></div>"
          }
          __p += '<div class="control right"><button class="chrome blue ask-button" type="submit" disabled="disabled">' + (null == (__t = __("Ask")) ? "" : _.escape(__t)) + '</button></div></div></div><ul class="post-form--error-bar messages errors-ask"></ul></div></div></form></div></div>'
        }
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  28: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("app/lib/avatar-size"), a = t("prima/views/base"), r = t("prima/mixins/keycommands"), l = t("prima/mixins/selectorcache"), h = t("../templates/ask-form.tpl"), c = a.extend({
      className: "ask-form",
      template: h,
      mixins: [r, l],
      keycommands: {"keydown:enter": "preventNewlines", "keydown:escape": "dismiss"},
      events: {
        "click button.close": "dismiss",
        "change .ask-anonymously-switch": "toggleAnonymous",
        "submit form": "submit",
        "input .ask-question": "onTextAreaUpdate"
      },
      initialize: function (t) {
        this.characterLimit = t.characterLimit, this.sender = t.sender, this.recipient = t.recipient, this.onTextAreaUpdate = o.throttle(o.bind(this.onTextAreaUpdate, this), 100), this.listenTo(this.model, "change:isSaving", this.toggleSubmit), this.listenTo(this.model, "save:success", this.render), this.listenTo(this.model, "save:error", this.displayErrors)
      },
      getTemplateData: function () {
        var t = {};
        return t.recipient = o.clone(this.recipient) || {}, t.recipient.allow_anonymous = t.recipient.allowAnonymous, t.sender = this.sender.toJSON(), t.sender.avatar_url = n(this.sender.get("avatar_url"))(128), t.character_limit = this.characterLimit, t
      },
      dismiss: function () {
        this.trigger("close")
      },
      toggleSubmit: function (t, e) {
        e ? this.disableSubmit() : this.enableSubmit()
      },
      toggleAnonymous: function (t) {
        var e = this.$(t.target);
        this.isAnonymous = e.prop("checked");
        var i = this.$$(".post_avatar_link"), s = this.$$(".ask-from .tumblelog_name"), o = this.$$(".ask-from .anonymous");
        this.isAnonymous ? (i.removeClass("use_blog_avatar"), s.hide(), o.show()) : (i.addClass("use_blog_avatar"), s.show(), o.hide())
      },
      submit: function (t) {
        t.preventDefault(), this.trigger("submit", {
          question: this.$$(".ask-question").val(),
          anonymous: this.isAnonymous
        })
      },
      preventNewlines: function (t) {
        t.preventDefault()
      },
      onTextAreaUpdate: function () {
        var t = this.$$(".ask-question").val(), e = t;
        t.match(/\n/g) && (t = t.replace(/\n/g, ""));
        var i = o.trim(t).length;
        i > 0 && i <= this.characterLimit ? this.enableSubmit() : this.disableSubmit(), t !== e && this.$$(".ask-question").val(t);
        var s = this.characterLimit - t.length, n = this.$$(".ask-character-count");
        n.text(s), 100 >= s ? (n.addClass("active"), n.removeClass("count-ok count-warning count-danger"), s > 40 ? n.addClass("count-ok") : s > 20 ? n.addClass("count-warning") : n.addClass("count-danger")) : n.removeClass("active")
      },
      enableSubmit: function () {
        this.model.get("isSaving") || this.$$(".ask-button").prop("disabled", !1)
      },
      disableSubmit: function () {
        this.$$(".ask-button").prop("disabled", !0)
      },
      showMessages: function (t, e) {
        var i = this.$$("." + t), n = i.get(0);
        n && (i.removeClass("active").hide().empty(), "string" == typeof e && (e = [e]), o.each(e, o.bind(function (t) {
          var e = s("<li/>", {text: t});
          i.append(e)
        }, this)), i.show(), o.defer(function () {
          i.addClass("active")
        }))
      },
      displayErrors: function (t) {
        this.showMessages("errors-ask", t)
      }
    });
    e.exports = c
  }, {
    "../templates/ask-form.tpl": 27,
    "app/lib/avatar-size": 456,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/mixins/keycommands": 581,
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  29: [function (t, e, i) {
    "use strict";
    var s = t("prima/events"), o = t("lodash"), n = t("backbone"), a = t("prima/class"), r = t("prima/lib/domeventor"), l = a.extend({
      defaults: {
        offset: 175,
        throttle: 200,
        lockStep: !1,
        triggerCachingDelta: -1
      }, constructor: function (t) {
        this.options = o.extend({}, this.defaults, t), this.handler = o.bind(this.options.$target ? this.onTargetScroll : this.onWindowScroll, this), this.options.throttle && (this.handler = o.throttle(this.handler, this.options.throttle)), this.locked = !1, this.bindEvents()
      }, forceCheck: function (t) {
        this.options.$target ? this.handler(null, t) : this.handler(r.rect(), t)
      }, bindEvents: function () {
        this.options.$target ? this.options.$target.parent().on("scroll", this.handler) : (this.listenTo(s, "DOMEventor:flatscroll", this.handler), this.listenTo(s, "DOMEventor:flatresize", this.handler))
      }, unlock: function () {
        this.locked = !1
      }, onWindowScroll: function (t, e) {
        if (!this.locked && (this.buffer || (this.buffer = this.getBuffer(t)), this.nearBottom(t))) {
          var i = o.clone(t);
          if (!e && -1 !== this.options.triggerCachingDelta && this.triggerCache) {
            var s = Math.abs(t.windowScrollTop - this.triggerCache.windowScrollTop);
            if (s < this.options.triggerCachingDelta)return
          }
          this.trigger("trigger"), this.options.lockStep && (this.locked = !0), e || -1 === this.options.triggerCachingDelta || (this.triggerCache = i)
        }
      }, onTargetScroll: function (t, e) {
        var i = this.options.$target.parent().height(), s = this.options.$target.outerHeight(), o = this.options.$target.position().top, n = {
          windowScrollTop: -o,
          documentHeight: s,
          windowHeight: i
        };
        this.onWindowScroll(n, e)
      }, getRemainingDocHeight: function (t) {
        return t.documentHeight - t.windowScrollTop - t.windowHeight - this.buffer
      }, getBuffer: function (t) {
        var e = t.windowHeight;
        return o.isNull(e) ? !1 : Math.round(.666 * e)
      }, nearBottom: function (t) {
        if (o.isNull(t.windowScrollTop))return !1;
        var e = this.options.offset, i = this.getRemainingDocHeight(t);
        return e > i
      }, close: function () {
        this.options.$target && this.options.$target.parent().off("scroll", this.handler)
      }
    });
    o.extend(l.prototype, n.Events), e.exports = l
  }, {backbone: "5kFNoY", lodash: "MicNly", "prima/class": 543, "prima/events": 546, "prima/lib/domeventor": 550}],
  30: [function (t, e, i) {
    "use strict";
    e.exports = t("./views/blog_card_view")
  }, {"./views/blog_card_view": 34}],
  31: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {}) {
          __p += "";
          var is_popover = "boolean" == typeof popover ? popover : !1, has_avatar = avatar_url && global_theme_params.show_avatar, has_bg_img = global_theme_params.header_image_focused && global_theme_params.show_header_image, has_title = title && global_theme_params.show_title, has_description = description_sanitized && global_theme_params.show_description, expanded_name = cname ? cname : name + ".tumblr.com", description_color = title_color_rgb ? "rgba(" + title_color_rgb + ",0.7)" : global_theme_params.title_color, header_class = global_theme_params.header_stretch ? "" : " no_stretch_header";
          header_class += has_bg_img ? "" : " no_header_image", header_class += has_avatar ? "" : " no_avatar", header_class += !has_bg_img || has_avatar || has_title || has_description ? "" : " header_image_only", header_class += has_title || has_description ? " has_info" : " no_info", __p += '<div class="indash_header_wrapper ' + (null == (__t = header_class) ? "" : __t) + " tumblelog_name_" + (null == (__t = name) ? "" : _.escape(__t)) + '" style="background-color:' + (null == (__t = global_theme_params.background_color) ? "" : __t) + "; color:" + (null == (__t = global_theme_params.title_color) ? "" : __t) + '">', show_navigation && (__p += '<div class="navigation"><div class="navigation_bg" style="background-color: ' + (null == (__t = global_theme_params.background_color) ? "" : __t) + '"></div><div class="navigation_inner">', "undefined" !== name && (__p += '<h3><a href="' + (null == (__t = url) ? "" : _.escape(__t)) + '" target="_blank" class="blog_name" data-peepr="{&quot;tumblelog&quot;: &quot;' + (null == (__t = name) ? "" : _.escape(__t)) + '&quot;}"><span class="name">' + (null == (__t = name) ? "" : _.escape(__t)) + '</span> <span class="full_url">' + (null == (__t = expanded_name) ? "" : _.escape(__t)) + "</span></a></h3>"), __p += "", show_share_controls && (__p += '<a class="open_blog_button nav_icon icon_export"></a>'), __p += "", !customizable && show_user_controls && (__p += ' <a class="info_popover_button nav_icon user_dropdown_lockup"><i class="user_dropdown_icon user_dropdown_icon_user icon_user_settings"></i></a>'), __p += "", !customizable && show_follow_button && (__p += "", __p += following ? ' <button class="chrome unfollow" type="button">' + (null == (__t = unfollowText) ? "" : _.escape(__t)) + '</button> <button class="chrome follow" type="button" style="display:none">' + (null == (__t = followText) ? "" : _.escape(__t)) + "</button>" : ' <button class="chrome unfollow" type="button" style="display:none">' + (null == (__t = unfollowText) ? "" : _.escape(__t)) + '</button> <button class="chrome follow" type="button">' + (null == (__t = followText) ? "" : _.escape(__t)) + "</button>", __p += ""), __p += "</div></div>"), __p += "", global_theme_params.header_image_focused && global_theme_params.show_header_image && (__p += '<div class="header_image_wrapper', has_avatar && (__p += " has_avatar"), __p += '"><div class="header_image" style="background-image:url(' + (null == (__t = global_theme_params.header_image_focused) ? "" : _.escape(__t)) + ')">', __p += is_popover || !customizable ? '<a href="' + (null == (__t = url) ? "" : __t) + '" target="_blank"><img src="' + (null == (__t = global_theme_params.header_image_focused) ? "" : _.escape(__t)) + '" data-peepr="{&quot;tumblelog&quot;: &quot;' + (null == (__t = name) ? "" : _.escape(__t)) + '&quot;}" alt="' + (null == (__t = title) ? "" : _.escape(__t)) + '"></a>' : ' <img src="' + (null == (__t = global_theme_params.header_image_focused) ? "" : _.escape(__t)) + '" alt="">', __p += "</div></div>"), __p += "", avatar_url && global_theme_params.show_avatar && (__p += '<div class="avatar ' + (null == (__t = global_theme_params.avatar_shape) ? "" : __t) + '" style="background-color:' + (null == (__t = global_theme_params.background_color) ? "" : __t) + "; background-image:url(" + (null == (__t = avatar_url) ? "" : __t) + "); color:" + (null == (__t = global_theme_params.background_color) ? "" : __t) + '">', __p += is_popover || !customizable ? '<a href="' + (null == (__t = url) ? "" : __t) + '" target="_blank"><img src="' + (null == (__t = avatar_url) ? "" : __t) + '" data-peepr="{&quot;tumblelog&quot;: &quot;' + (null == (__t = name) ? "" : _.escape(__t)) + '&quot;}" alt="' + (null == (__t = title) ? "" : _.escape(__t)) + '"></a>' : ' <img src="' + (null == (__t = avatar_url) ? "" : __t) + '" alt="">', __p += "</div>"), __p += "", (has_title || has_description) && (__p += '<div class="info_wrapper"><div class="info">', has_title && (__p += '<h1 class="title" style="font-family:' + (null == (__t = title_font_family || "inherit") ? "" : __t) + "; font-weight:" + (null == (__t = global_theme_params.title_font_weight) ? "" : __t) + '">' + (null == (__t = title) ? "" : _.escape(__t)) + "</h1>"), __p += "", has_description && (__p += '<div class="description" style="color:' + (null == (__t = description_color) ? "" : __t) + '"><div class="description_inner">' + (null == (__t = description_sanitized) ? "" : __t) + "</div></div>"), __p += "</div></div>"), __p += "</div>"
        }
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  32: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {}) {
          __p += "";
          var color = "undefined" != typeof loader_color ? loader_color : "#D9D9D9";
          __p += '<div class="Knight-Rider-loader centered animate"><div class="Knight-Rider-bar" style="background-color:' + (null == (__t = color) ? "" : __t) + '"></div><div class="Knight-Rider-bar" style="background-color:' + (null == (__t = color) ? "" : __t) + '"></div><div class="Knight-Rider-bar" style="background-color:' + (null == (__t = color) ? "" : __t) + '"></div></div>'
        }
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  33: [function (t, e, i) {
    "use strict";
    var s = {
      "1785 GLC Baskerville": {
        display_name: "1785 Baskerville",
        family: "'1785 GLC Baskerville', serif",
        path: "1785glcbaskerville",
        _v: "1"
      },
      "Alternate Gothic": {
        display_name: "Alternate Gothic",
        family: "'Alternate Gothic', sans-serif",
        path: "alternategothic",
        _v: "3"
      },
      Arquitecta: {display_name: "Arquitecta", family: "'Arquitecta', sans-serif", path: "arquitecta", _v: "3"},
      Avalon: {display_name: "Avalon", family: "'Avalon', sans-serif", path: "avalon", _v: "1"},
      Baskerville: {display_name: "Baskerville", family: "Baskerville, 'Times New Roman', Times, serif"},
      "Bodoni Recut FS": {display_name: "Bodoni", family: "'Bodoni Recut FS', serif", path: "bodonirecutfs", _v: "3"},
      Bookmania: {display_name: "Bookmania", family: "'Bookmania', serif", path: "bookmania", _v: "1"},
      "Brutal Type": {display_name: "Brutal Type", family: "'Brutal Type', sans-serif", path: "brutaltype", _v: "1"},
      Calluna: {display_name: "Calluna", family: "'Calluna', serif", path: "calluna", _v: "3"},
      "Calluna Sans": {
        display_name: "Calluna Sans",
        family: "'Calluna Sans', sans-serif",
        path: "callunasans",
        _v: "3"
      },
      Capita: {display_name: "Capita", family: "'Capita', serif", path: "capita", _v: "1"},
      "Caslon FS": {display_name: "Caslon FS", family: "'Caslon FS', serif", path: "caslonfs", _v: "3"},
      "Clarendon Text Pro": {
        display_name: "Clarendon",
        family: "'Clarendon Text Pro', serif",
        path: "clarendontextpro",
        _v: "3"
      },
      "Clearface FS": {display_name: "Clearface", family: "'Clearface FS', serif", path: "clearface", _v: "4"},
      "Courier New": {display_name: "Courier New", family: "'Courier New', Courier, monospace"},
      FangSong: {display_name: "Fang Song", family: "'FangSong', 'STFangsong', sans-serif"},
      Futura: {display_name: "Futura", family: "Futura, 'Century Gothic', AppleGothic, sans-serif"},
      "Garamond Classic FS": {
        display_name: "Garamond",
        family: "'Garamond Classic FS', serif",
        path: "garamondclassicfs",
        _v: "3"
      },
      Georgia: {
        display_name: "Georgia",
        family: "Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif"
      },
      Gibson: {display_name: "Gibson", family: "'Gibson', sans-serif", path: "gibson", _v: "3"},
      "Grumpy Black 48": {display_name: "Grumpy", family: "'Grumpy Black 48', serif", path: "grumpyblack48", _v: "3"},
      "Helvetica Neue": {
        display_name: "Helvetica",
        family: "'Helvetica Neue', Arial, Helvetica, sans-serif"
      },
      Kaiti: {display_name: "Kaiti", family: "'Kaiti TC', 'KaiTi', sans-serif"},
      "Lorimer No 2": {display_name: "Lorimer No 2", family: "'Lorimer No 2', sans-serif", path: "lorimerno2", _v: "3"},
      "Lucida Sans": {
        display_name: "Lucida Sans",
        family: "'Lucida Sans', 'Lucida Grande', 'Lucida Sans Unicode', sans-serif"
      },
      "News Gothic FS": {
        display_name: "News Gothic",
        family: "'News Gothic FS', sans-serif",
        path: "newsgothicfs",
        _v: "3"
      },
      "Pratt Pro": {display_name: "Pratt Pro", family: "'Pratt Pro', serif", path: "prattpro", _v: "1"},
      Quadrat: {display_name: "Quadrat", family: "'Quadrat', serif", path: "quadrat", _v: "1"},
      SimHei: {display_name: "Sim Hei", family: "'SimHei', 'STHeiti', sans-serif"},
      "Sofia Pro": {display_name: "Sofia Pro", family: "'Sofia Pro', sans-serif", path: "sofiapro", _v: "2"},
      Spade: {display_name: "Spade", family: "'Spade', serif", path: "spade", _v: "1"},
      "Square Serif": {display_name: "Square Serif", family: "'Square Serif', serif", path: "squareserif", _v: "4"},
      Streetscript: {display_name: "Streetscript", family: "'Streetscript', sans-serif", path: "streetscript", _v: "1"},
      "Typewriter FS": {display_name: "Typewriter", family: "'Typewriter FS', serif", path: "typewriterfs", _v: "1"},
      Verdana: {display_name: "Verdana", family: "Verdana, Geneva, Tahoma, sans-serif"},
      Ziclets: {display_name: "Ziclets", family: "'Ziclets', serif", path: "ziclets", _v: "1"}
    };
    e.exports = s
  }, {}],
  34: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("./header/compact"), a = t("./posts/highlighted"), r = o.extend({
      defaults: {
        include_info_popover: !0,
        disableUnfollowConfirm: !1
      }, className: "poptica_header", initialize: function (t) {
        this.options = s.extend({}, this.defaults, t);
        var e = s.extend({model: this.model}, s.pick(this.options, "targetPost", "include_info_popover", "disableUnfollowConfirm"));
        this.header = new n(e), this.posts = new a({model: this.model}), this.bindEvents()
      }, bindEvents: function () {
        this.listenToOnce(this.header, "ready", this._triggerReady)
      }, _triggerReady: function () {
        this.trigger("ready")
      }, render: function () {
        return this.$el.append(this.header.render().el, this.posts.render().el), this
      }
    });
    e.exports = r
  }, {"./header/compact": 35, "./posts/highlighted": 36, lodash: "MicNly", "prima/view": 612}],
  35: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/lib/flags"), a = t("prima/lib/data"), r = t("prima/view"), l = t("prima/events"), h = t("prima/utils/colors"), c = t("prima/utils/url"), d = t("prima/lib/translate"), u = t("../../templates/blog_card.tpl"), p = t("../../utils/webfonts"), m = r.extend({
      className: "indash_tumblelog_compact",
      template: u,
      defaults: {
        current_data: {},
        unfollow_data: {},
        follow_data: {},
        template_data: {},
        hide_posts_on_unfollow: !1,
        stripDescriptionLineBreaks: !1,
        include_info_popover: !0
      },
      events: {
        "click .description a": "_descriptionLinkClicked",
        "click .info_popover_button": "_infoPopoverButtonClicked",
        "click .follow": "_onFollowClick",
        "click .unfollow": "_onFollowClick"
      },
      initialize: function (t) {
        if (this.options = s.extend({}, this.defaults, t || {}), this.bindEvents(), this.is_rendered = !1, this.assets_host = a.get("Context/hosts/assets_host") || "", this.$description = null, this.$description_inner = null, !s.isEmpty(this.current_data)) {
          var e = s.extend({}, this.current_data, this.model.toJSON());
          this.model.set(e, {silent: !0})
        }
        this.model.get("global_theme_params") && s.delay(s.bind(this.render, this), 1)
      },
      bindEvents: function () {
        this.listenTo(this.model, "change:following", this._renderFollowButton), this.listenTo(this.model, "change:global_theme_params", this.render)
      },
      render: function () {
        var t = this.model.toJSON();
        if (t.following || (t.following = !1), this.is_rendered || !t.global_theme_params)return this;
        var e = s.result(p, t.global_theme_params.title_font), i = h.hexToRgb(t.global_theme_params.title_color);
        if (this.$el.html(this.template(s.merge({}, t, {
            show_navigation: !0,
            show_share_controls: !1,
            show_user_controls: this.options.include_info_popover,
            show_follow_button: !0,
            show_dismiss_controls: !1,
            title_font_family: e ? e.family : !1,
            title_color_rgb: String(s.values(i).join(",")),
            followText: d("Follow"),
            unfollowText: d("Unfollow")
          }, this.options.template_data))), this.$description = this.$(".description"), this.$description_inner = this.$description.find(".description_inner"), this._renderFontStyles(), this._renderInlineStyles(), this.options.include_info_popover) {
          var o = {
            el: this.$el,
            auto_show: !1,
            trigger: this.$el.find(".info_popover_button"),
            recipient: this.model.get("name"),
            asks: this.model.get("asks"),
            anonymous_asks: this.model.get("anonymous_asks"),
            url: this.model.get("url"),
            skip_glass: !0,
            model: this.model,
            targetPost: this.options.targetPost
          };
          l.trigger("popticainfopopover:initialize", {options: o})
        }
        return this.is_rendered = !0, this.$description.length && (s.delay(s.bind(this.truncateDescription, this), 100), this.options.stripDescriptionLineBreaks && this.stripDescriptionLineBreaks()), this.trigger("ready"), this
      },
      stripDescriptionLineBreaks: function () {
        this.$description_inner.find("br").remove();
        var t = this.$description_inner.html(), e = t.replace(/[\n\r]/g, " ");
        this.$description_inner.html(e)
      },
      truncateDescription: function () {
        var t = this.$description_inner.get(0);
        if (!(t.scrollHeight <= t.clientHeight)) {
          var e = this.model.get("global_theme_params"), i = e.background_color, o = h.hexToRgb(i);
          this.$description.append(this.description_gradient_template({background_color: String(s.values(o).join(","))}))
        }
      },
      _onFollowClick: function (t) {
        if (t.preventDefault(), !n.bool("is_logged_in"))return void window.open("/follow/" + this.model.get("name"), "_self");
        var e = {follow_data: this.options.follow_data};
        this.model.get("following") ? this._confirm_unfollow(e) : (l.trigger("tumblelog:log_follow"), this.model.follow(e))
      },
      _confirm_unfollow: function (t) {
        var e = {tumblelog: this.model.get("name")}, i = this.model.requestUnfollow();
        if (this.options.disableUnfollowConfirm)i.resolve(), l.trigger("tumblelog:log_unfollow", {loggingData: e}); else {
          var s = d("Are you sure you want to unfollow %1$s?").replace("%1$s", "<strong>" + this.model.get("name") + "</strong>"), o = {
            text: s,
            text_ok: d("Ok"),
            text_cancel: d("Nevermind")
          };
          i.promise.then(function () {
            l.trigger("tumblelog:log_unfollow", {loggingData: e})
          }), l.trigger("dialog:confirm:promise", i, o)
        }
      },
      _infoPopoverButtonClicked: function (t) {
        t.preventDefault(), t.stopPropagation(), l.trigger("popticainfopopover:show")
      },
      _descriptionLinkClicked: function (t) {
        t.preventDefault();
        var e = o(t.currentTarget).attr("href");
        try {
          if (c && c.hasAllowedProtocol(e)) {
            if (!c.isAbsoluteUrl(e)) {
              var i = "http://" + this.model.get("name") + ".tumblr.com/";
              e = "/" === e.charAt(0) ? e.substr(1) : e, e = i + e
            }
            window.open(e, "_blank")
          }
        } catch (s) {
        }
      },
      _renderFollowButton: function () {
        var t = this.model.get("following");
        this.$el.find(".follow").toggle(!t), this.$el.find(".unfollow").toggle(t)
      },
      _hidePosts: function () {
      },
      _open_dialog: function (t, e) {
        function i(t, e) {
          t.is_disabled = t.is_menu_open, e && e()
        }

        this.is_disabled = !0, t.fail(s.bind(i, null, this)), t.done(s.bind(i, null, this, e))
      },
      _renderInlineStyles: function () {
        var t = this.model.get("global_theme_params"), e = t.header_image_focused && t.header_stretch && t.show_header_image, i = h.hexToHsv(t.background_color), s = h.hexToHsv(t.link_color), o = t.link_color;
        return h.compare(s, i) && (o = h.readable(i)), e || (this.$(".navigation .nav_icon").css("color", o), this.$(".navigation .blog_name").css("color", o), this.$(".navigation button").css({
          color: t.background_color,
          "background-color": o
        })), this.$(".description a").css("color", t.link_color), this
      },
      _renderFontStyles: function () {
        if (p) {
          var t = this.model.get("global_theme_params");
          if (s.has(p, t.title_font)) {
            var e = s.result(p, t.title_font), i = "webfont_" + e.path;
            if (e.path && !o("head #" + i).length) {
              var n = this.assets_host + "/fonts/" + e.path + "/stylesheet.css";
              n += s.has(e, "_v") ? "?v=" + e._v : "", o("<link>", {
                id: i,
                rel: "stylesheet",
                type: "text/css",
                href: n
              }).appendTo(o("head"))
            }
          }
        }
      },
      description_gradient_template: s.template('<div class="description_gradient" style="background: -moz-linear-gradient(top,  rgba(<%= background_color %>,0) 0%, rgba(<%= background_color %>,0.75) 50%, rgba(<%= background_color %>,1) 100%);background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(<%= background_color %>,0)), color-stop(50%,rgba(<%= background_color %>,0.75)), color-stop(100%,rgba(<%= background_color %>,1)));background: -webkit-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -o-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: -ms-linear-gradient(top,  rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);background: linear-gradient(to bottom, rgba(<%= background_color %>,0) 0%,rgba(<%= background_color %>,0.75) 50%,rgba(<%= background_color %>,1) 100%);"></div>')
    });
    e.exports = m
  }, {
    "../../templates/blog_card.tpl": 31,
    "../../utils/webfonts": 33,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/data": 548,
    "prima/lib/flags": "f/LVtH",
    "prima/lib/translate": 575,
    "prima/utils/colors": 597,
    "prima/utils/url": 611,
    "prima/view": 612
  }],
  36: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("prima/events"), r = t("../../templates/posts/highlighted_posts.tpl"), l = n.extend({
      className: "recent_posts",
      template: r,
      events: {"click a": "onPostClick", mouseenter: "onMouseEnter"},
      defaults: {on_bottom: !0, blog_bg_color: !0, $popover: o(), min_load_time: 500, model: {}, dashboard_post: {}},
      initialize: function (t) {
        s.extend(this, this.defaults, t), this.model && (this.renderLoader(), this.renderInlineStyles(), this.posts = this.model.get("highlighted_posts"), s.isUndefined(this.posts) && this.fetchPosts(), this.bindEvents())
      },
      bindEvents: function () {
        this.listenTo(this.model, "change:highlighted_posts", this.render), this.listenTo(this.model, "change:global_theme_params", this.renderInlineStyles)
      },
      fetchPosts: function () {
        this.model.fetch_popover_data({is_tumblelog_popover: !0})
      },
      updatePosts: function (t) {
        this.model = t, this.posts = this.model.get("highlighted_posts"), s.isUndefined(this.posts) ? this.fetchPosts() : this.render(!0)
      },
      renderLoader: function () {
        var t = this.model.toJSON();
        this.$el.html(this.template({loader_color: t.global_theme_params ? t.global_theme_params.title_color : "#D9D9D9"}))
      },
      renderInlineStyles: function () {
        var t = this.model.get("global_theme_params");
        t && this.blog_bg_color && this.$el.css("background-color", t.background_color)
      },
      render: function (t) {
        var e = this.posts || this.model.get("highlighted_posts");
        if (!s.isArray(e))return this;
        var i = e.join("");
        return e.length < 2 ? (setTimeout(s.bind(function () {
          this.$popover.addClass("is_empty"), this.$el.html("")
        }, this), this.min_load_time), this) : (this.$el.addClass("has_" + e.length + "_posts"), t === !0 ? this.$el.addClass("is_cached").html(i) : setTimeout(s.bind(function () {
          this.$el.addClass("is_loaded").html(i)
        }, this), this.min_load_time), this)
      },
      onPostClick: function (t) {
      },
      onMouseEnter: function (t) {
        a.trigger("TumblelogPopover:mouseenter_posts")
      }
    });
    e.exports = l
  }, {
    "../../templates/posts/highlighted_posts.tpl": 32,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/view": 612
  }],
  37: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("./templates/index.tpl"), a = t("./views/dropdown"), r = t("prima/mixins/selectorcache"), l = t("app/lib/avatar-size"), h = o.extend({
      template: n,
      mixins: [r],
      defaults: {
        currentTumblelog: !1,
        isOpen: !1,
        requiresDropdown: !1,
        showCaret: !0,
        showName: !0,
        dropdownClass: null,
        popoverOptions: null,
        avatarSize: 96,
        badgeCountField: null,
        showTotalBadge: !0,
        showNumberInBadge: !1,
        includeCurrentBlogInTotalBadge: !1,
        maxBadgeCount: 99,
        badgeActiveClass: "has-badge"
      },
      events: {"click [data-js-button]": "toggleDropdown"},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "collection")), this.get("currentTumblelog") || this.set("currentTumblelog", this.collection.findWhere({is_current: !0})), this.set("requiresDropdown", this.collection.length > 1), (s.isEmpty(this.get("badgeCountField")) || !this.get("requiresDropdown")) && this.set("showTotalBadge", !1)
      },
      getTemplateData: function () {
        var t = this.get("showTotalBadge"), e = t && this.get("showNumberInBadge"), i = t ? this.getBadgeCount() : null;
        return {
          avatarUrl: l(this.getCurrentTumblelogProperty("avatar_url"), this.get("avatarSize")),
          displayName: this.getCurrentTumblelogProperty("name"),
          requiresDropdown: this.get("requiresDropdown"),
          hasBadge: t && i > 0,
          badgeCountString: e ? this.getBadgeCountString(i) : null
        }
      },
      createDropdown: function () {
        var t = s.extend({}, this.get("popoverOptions"), {
          identifier: "blogSelector:dropdown",
          pinnedTarget: this.js$("avatar"),
          shift: {x: 86, y: 10},
          collection: this.collection,
          currentTumblelog: this.getCurrentTumblelog(),
          badgeCountField: this.get("badgeCountField"),
          maxBadgeCount: this.get("maxBadgeCount")
        });
        this.dropdown = new a(t), this.get("dropdownClass") && this.dropdown.$el.addClass(this.get("dropdownClass")), this.listenTo(this.dropdown, "change:currentTumblelog", this.adjustCurrentTumblelog), this.listenTo(this.dropdown, "open", this._onDropdownOpen), this.listenTo(this.dropdown, "close", this._onDropdownClose)
      },
      _onDropdownOpen: function () {
        this.set("isOpen", !0)
      },
      _onDropdownClose: function () {
        this.set("isOpen", !1)
      },
      _onChangeIsOpen: function (t, e) {
        this.js$("caret").toggleClass("is-open", e)
      },
      toggleDropdown: function () {
        this.get("requiresDropdown") && (this.dropdown.isOrWasRecentlyRendered() || this.dropdown.render())
      },
      afterRender: function () {
        return this.get("showTotalBadge") && (this.listenTo(this.collection, "change:" + this.get("badgeCountField"), this._onBadgeCountChange), this._onBadgeCountChange()), this.get("requiresDropdown") && (this.createDropdown(), this.js$("button").addClass("has-dropdown"), this.listenTo(this, "change:isOpen", this._onChangeIsOpen), this.listenTo(this, "change:showCaret", this._onChangeShowCaret), this._onChangeIsOpen(this, this.get("isOpen")), this._onChangeShowCaret(this, this.get("showCaret"))), this.listenTo(this, "change:showName", this._onChangeShowName), this._onChangeShowName(this, this.get("showName")), this
      },
      getCurrentTumblelog: function () {
        return this.get("currentTumblelog")
      },
      getCurrentTumblelogProperty: function (t) {
        var e = this.getCurrentTumblelog();
        return e && e.has(t) && s.isString(t) ? e.get(t) : void 0
      },
      adjustCurrentTumblelog: function () {
        var t;
        this.set("currentTumblelog", this.dropdown.get("currentTumblelog")), this.rendered && (t = l(this.getCurrentTumblelogProperty("avatar_url"), this.get("avatarSize")), this.js$("avatar").attr("src", t), this.js$("label").text(this.getCurrentTumblelogProperty("name")), this.get("showTotalBadge") && !this.get("includeCurrentBlogInTotalBadge") && this._onBadgeCountChange())
      },
      teardown: function () {
        return this.remove(), this
      },
      getBadgeCount: function () {
        var t, e = this.get("currentTumblelog");
        return this.get("badgeCountField") ? (t = s.sum(this.collection.pluck(this.get("badgeCountField"))), e && !this.get("includeCurrentBlogInTotalBadge") && (t -= e.get(this.get("badgeCountField"))), Math.max(0, t)) : null
      },
      getBadgeCountString: function (t) {
        var e = this.get("maxBadgeCount");
        return t > e ? e + "+" : t > 0 ? t : ""
      },
      updateBadge: function (t) {
        var e = this.js$("badge");
        e.toggleClass(this.get("badgeActiveClass"), t > 0), this.get("showNumberInBadge") && e.text(this.getBadgeCountString(t))
      },
      _onBadgeCountChange: function () {
        this.updateBadge(this.getBadgeCount())
      },
      _onChangeShowCaret: function (t, e) {
        this.js$("caret").toggle(e)
      },
      _onChangeShowName: function (t, e) {
        this.js$("label").toggle(e)
      }
    });
    e.exports = h
  }, {
    "./templates/index.tpl": 39,
    "./views/dropdown": 40,
    "app/lib/avatar-size": 456,
    lodash: "MicNly",
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  38: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="pop-menu"><ul class="inner select-right" data-js-scrollbar>', _.forEach(channels, function (t) {
          __p += '<li class="item-option ' + (null == (__t = t.name === currentTumblelog ? "selected" : "") ? "" : _.escape(__t)) + '" data-js-tumblelog><div class="avatar"><img src="' + (null == (__t = t.avatarUrl) ? "" : _.escape(__t)) + '" alt="' + (null == (__t = t.name) ? "" : _.escape(__t)) + '">', isShowBadges && (__p += ' <span class="unread-indicator tab_notice tab-notice--outlined on-light ', t.badgeCountString && (__p += "tab-notice--active "), __p += '" data-js-channel-badge="' + (null == (__t = t.name) ? "" : _.escape(__t)) + '"><span class="tab_notice_value" data-js-channel-badge-text>' + (null == (__t = t.badgeCountString) ? "" : _.escape(__t)) + "</span></span>"), __p += '</div><div class="info-container"><p class="name">' + (null == (__t = t.displayName) ? "" : _.escape(__t)) + '</p><p class="title">' + (null == (__t = t.directory_safe_title) ? "" : __t) + "</p></div></li>"
        }), __p += "</ul></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  39: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="blog-selector-container"><div class="selected-blog" data-js-button><img class="avatar" src="' + (null == (__t = avatarUrl) ? "" : _.escape(__t)) + '" alt="' + (null == (__t = displayName) ? "" : __t) + '" data-js-avatar> <span class="name" data-js-label>' + (null == (__t = displayName) ? "" : __t) + "</span>", requiresDropdown && (__p += ' <span class="caret ' + (null == (__t = hasBadge ? "has-badge" : "") ? "" : _.escape(__t)) + '" data-js-caret data-js-badge>', badgeCountString && (__p += "" + (null == (__t = badgeCountString) ? "" : _.escape(__t))), __p += "</span>"), __p += "</div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  40: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../templates/dropdown.tpl"), a = t("prima/mixins/popoverbase"), r = t("prima/mixins/selectorcache"), l = t("app/lib/avatar-size"), h = t("app/lib/scrollbar"), c = o.extend({
      className: "popover--blog-selector-dropdown",
      events: {"click [data-js-tumblelog]": "selectBlog"},
      mixins: [r, a],
      template: n,
      defaults: {
        currentTumblelog: !1,
        avatarSize: 96,
        badgeCountField: null,
        maxBadgeCount: 99,
        badgeActiveClass: "tab-notice--active"
      },
      initialize: function (t) {
        if (t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "collection")), !this.get("currentTumblelog")) {
          var e = this.collection.findWhere({is_current: !0});
          this.set("currentTumblelog", e)
        }
      },
      selectBlog: function (t) {
        var e = this.$(t.currentTarget).index();
        this.set("currentTumblelog", this.collection.at(e)), this.teardown()
      },
      createScrollbar: function () {
        this.scrollbar || (this.scrollbar = new h(this.js$("scrollbar")))
      },
      afterRender: function () {
        return this.js$("scrollbar").addClass("popover-sublist popover-sublist--scrollable"), s.defer(s.bind(this.createScrollbar, this)), this.delegateEvents(), this.isShowBadges() && this.listenTo(this.collection, "change:" + this.get("badgeCountField"), this._onBadgeCountChange), this
      },
      isShowBadges: function () {
        return !s.isEmpty(this.get("badgeCountField"))
      },
      getBadgeCount: function (t) {
        return this.get("badgeCountField") && t ? t.get(this.get("badgeCountField")) : null
      },
      getBadgeCountString: function (t) {
        var e = this.get("maxBadgeCount");
        return t > e ? e + "+" : t > 0 ? t : ""
      },
      getTemplateData: function () {
        var t, e = this.toJSON(), i = this.get("currentTumblelog");
        return i && s.extend(e, {currentTumblelog: i.get("name")}), t = this.collection.map(function (t) {
          return s.extend({
            avatarUrl: l(t.get("avatar_url"), this.get("avatarSize")),
            displayName: t.getDisplayName(),
            badgeCountString: this.getBadgeCountString(this.getBadgeCount(t))
          }, t.toJSON())
        }, this), s.extend(e, {channels: t, isShowBadges: this.isShowBadges()}), e
      },
      beforeTeardown: function () {
        this.scrollbar && (this.scrollbar.destroy(), this.scrollbar = null), this.stopListening()
      },
      teardown: function () {
        return this.$el.remove(), this
      },
      updateBadge: function (t) {
        var e, i = this.$$("[data-js-channel-badge=" + t.get("name") + "]");
        0 !== i.length && (e = this.getBadgeCount(t), i.toggleClass(this.get("badgeActiveClass"), e > 0), e > 0 && i.find("[data-js-channel-badge-text]").text(this.getBadgeCountString(e)))
      },
      _onBadgeCountChange: function (t) {
        return this.updateBadge(t)
      }
    });
    e.exports = c
  }, {
    "../templates/dropdown.tpl": 38,
    "app/lib/avatar-size": 456,
    "app/lib/scrollbar": 460,
    lodash: "MicNly",
    "prima/mixins/popoverbase": 583,
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  41: [function (t, e, i) {
    "use strict";
    var s = t("app/vendor/ace"), o = s.acequire("ace/lib/dom"), n = t("./post_form.scss").getCSSText(), a = {
      isDark: !1,
      cssClass: "ace-post-form",
      cssText: n
    };
    o.importCssString(a.cssText, a.cssClass), e.exports = a
  }, {"./post_form.scss": 42, "app/vendor/ace": "4e8++S"}],
  42: [function (t, e, i) {
    "use strict";
    var s, o = t("sassr/lib/utils"), n = ".ace-post-form .ace_selection{background-color:rgba(220,236,245,.8)}.ace-post-form .ace_entity{color:#f2992e}.ace-post-form .ace_string{color:#748089}.ace-post-form .ace_underline{color:#56bc8a;text-decoration:underline}.ace-post-form .ace_storage{color:#d95e40}.ace-post-form .ace_operator{color:#748089}.ace-post-form .ace_identifier{color:#444}.ace-post-form .ace_function{color:#f2992e}.ace-post-form .ace_type{color:#a77dc2}.ace-post-form .ace_constant{color:#d95e40}.ace-post-form .ace_variable{color:#56bc8a}.ace-post-form .ace_keyword{color:#f2992e}.ace-post-form .ace_tag,.ace-post-form .ace_attribute-equals,.ace-post-form .ace_attribute-name{color:#529ecc}.ace-post-form .ace_attribute-value{color:#a77dc2}.ace-post-form .ace_heading{color:#529ecc}.ace-post-form .ace_strong{color:#000}.ace-post-form .ace_emphasis{color:#748089}.ace-post-form .ace_list.ace_markup{color:#a77dc2}", a = n;
    i.getStyleElement = function () {
      return o.element
    }, i.getCSSText = function () {
      return a
    }, i.setBaseHost = function (t) {
      return a = o.insertHost(n, t)
    }, i.append = function () {
      return s || (o.inject(a), s = !0), o.element
    }, i.remove = function () {
      return s && (o.eject(a), s = !1), o.element
    };
    var s, o = t("sassr/lib/utils"), n = ".ace-post-form .ace_selection{background-color:rgba(220,236,245,.8)}.ace-post-form .ace_entity{color:#f2992e}.ace-post-form .ace_string{color:#748089}.ace-post-form .ace_underline{color:#56bc8a;text-decoration:underline}.ace-post-form .ace_storage{color:#d95e40}.ace-post-form .ace_operator{color:#748089}.ace-post-form .ace_identifier{color:#444}.ace-post-form .ace_function{color:#f2992e}.ace-post-form .ace_type{color:#a77dc2}.ace-post-form .ace_constant{color:#d95e40}.ace-post-form .ace_variable{color:#56bc8a}.ace-post-form .ace_keyword{color:#f2992e}.ace-post-form .ace_tag,.ace-post-form .ace_attribute-equals,.ace-post-form .ace_attribute-name{color:#529ecc}.ace-post-form .ace_attribute-value{color:#a77dc2}.ace-post-form .ace_heading{color:#529ecc}.ace-post-form .ace_strong{color:#000}.ace-post-form .ace_emphasis{color:#748089}.ace-post-form .ace_list.ace_markup{color:#a77dc2}", a = n;
    i.getStyleElement = function () {
      return o.element
    }, i.getCSSText = function () {
      return a
    }, i.setBaseHost = function (t) {
      return a = o.insertHost(n, t)
    }, i.append = function () {
      return s || (o.inject(a), s = !0), o.element
    }, i.remove = function () {
      return s && (o.eject(a), s = !1), o.element
    }
  }, {"sassr/lib/utils": 661}],
  43: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/view"), a = t("prima/events"), r = n.extend({
      id: "milestone-confetti",
      tagName: "canvas",
      defaults: {
        amount: 100,
        autoParty: !1,
        colors: ["#D95E40", "#F2992E", "#56BC8A", "#529ECC", "#A77DC2", "#748089"],
        size: 40,
        speed: .5,
        onDone: s.noop
      },
      __resize: function () {
        this.$parent.length && (this.el.width = this.$parent.width(), this.el.height = this.$parent.height())
      },
      _updateConfetti: function (t, e) {
        this.confettiAngle += .001, t.off || (t.tiltAngle += t.tiltAngleIncrement, t.tilt = 15 * Math.sin(t.tiltAngle - e / 3), t.y += (Math.cos(this.confettiAngle + t.density) + .5 * t.radius) * this.options.speed), t.y > this.el.height + 20 && (this.isAnimating ? (t.tilt = r.range(-10, 10, !0), t.tileAngle = 0, t.tiltAngleIncrement = r.range(.05, .1), t.x = Math.random() * this.el.width, t.y = -20) : t.off || (t.off = !0, this.confettiOffscreen++))
      },
      _stopAnimating: function () {
        this.animationInterval && (clearInterval(this.animationInterval), this.animationInterval = null), this.isAnimating = !1
      },
      _startAnimating: function (t) {
        t = t || !1, this._stopAnimating(), this.animationInterval = setInterval(o.bind(this.draw, this), 15), this.isAnimating = t ? !0 : this.isAnimating
      },
      initialize: function (t) {
        this.options = o.extend({}, this.defaults, t || {}), this.colors = this.options.colors, this.$win = s(window), this.$parent = s(), this.context = this.el.getContext("2d"), this.animationInterval = null, this.confetti = [], this.confettiAngle = 0, this.confettiOffscreen = 0, this.isAnimating = !1
      },
      render: function () {
        return o.defer(o.bind(this.setup, this)), this
      },
      setup: function () {
        this.$parent = this.$el.parent(), this.$parent.length && (this.el.width = this.$parent.width(), this.el.height = this.$parent.height()), this.listenTo(a, "DOMEventor:flatresize", this.__resize);
        for (var t = this.options.size, e = .5 * t, i = 0, s = this.options.amount; s > i; i++)this.confetti.push({
          x: Math.random() * this.el.width,
          y: Math.random() * -this.el.height,
          radius: r.range(e, t),
          density: r.range(10, s),
          tilt: r.range(-10, 10, !0),
          tiltAngle: 0,
          tiltAngleIncrement: r.range(.05, .1),
          color: this.colors[r.range(0, this.colors.length - 1, !0)],
          off: !1
        });
        this.options.autoParty && this.party()
      },
      draw: function () {
        if (this.context.clearRect(0, 0, this.el.width, this.el.height), this.confettiOffscreen === this.confetti.length)return void this.remove();
        for (var t = 5, e = 0; e < this.confetti.length; e++) {
          var i = this.confetti[e];
          this.context.beginPath(), this.context.lineWidth = .5 * i.radius, this.context.strokeStyle = i.color, this.context.moveTo(i.x + i.tilt + i.radius / t, i.y), this.context.lineTo(i.x + i.tilt, i.y + i.tilt + i.radius / t), this.context.stroke(), this._updateConfetti(i, e)
        }
      },
      party: function () {
        return this.confettiOffscreen = 0, this._startAnimating(!0), this
      },
      stopPartying: function () {
        return this.isAnimating = !1, this
      },
      remove: function () {
        return this._stopAnimating(), this.options.onDone(), n.prototype.remove.call(this)
      }
    }, {
      range: function (t, e, i) {
        i = i || !1;
        var s = (e - t) * Math.random() + t;
        return i ? Math.round(s) : s
      }
    });
    e.exports = r
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/events": 546, "prima/view": 612}],
  44: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/component"), n = t("./views/dialog"), a = o.extend({
      name: "Dialog",
      initialize: function (t) {
        this.dialogView = n, this.options = s.extend({}, this.defaults, t)
      },
      alert: function (t, e, i) {
        return this.dialogView.alert.call(this.dialogView, t, e, i)
      },
      confirm: function (t, e, i, s, o) {
        return this.dialogView.confirm.call(this.dialogView, t, e, i, s, o)
      },
      dialog: function (t) {
        return this.dialogView.dialog.call(this.dialogView, t)
      },
      isActive: function (t) {
        return this.dialogView.isActive.call(this.dialogView, t)
      },
      close: function (t) {
        return this.dialogView.close.call(this.dialogView, t)
      },
      getDialogEl: function () {
        return this.dialogView.getDialogEl.call(this.dialogView)
      },
      __: function (t) {
        return this.dialogView.__.call(this.dialogView, t)
      }
    });
    e.exports = new a
  }, {"./views/dialog": 48, lodash: "MicNly", "prima/component": 545}],
  45: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<button class="ui_button btn_' + (null == (__t = btn_id) ? "" : __t) + " chrome " + (null == (__t = btn_class) ? "" : __t) + '" data-btn-id="' + (null == (__t = btn_id) ? "" : __t) + '"><span>' + (null == (__t = text) ? "" : __t) + "</span></button>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  46: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<span class="text">' + (null == (__t = text) ? "" : __t) + "</span>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  47: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="ui_dialog ' + (null == (__t = type) ? "" : __t) + '">' + (null == (__t = content_html) ? "" : __t) + '<div class="buttons">' + (null == (__t = buttons_html) ? "" : __t) + "</div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  48: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/view"), a = t("prima/events"), r = t("prima/lib/translate"), l = t("prima/utils/bindendevent"), h = n.extend({
      el: ".ui_dialog",
      translations: {},
      defaultTemplates: {
        dialog: t("../templates/dialog.tpl"),
        content: t("../templates/content.tpl"),
        button: t("../templates/button.tpl")
      },
      events: {"click .ui_button": "buttonClick"},
      defaultDialog: {
        text: "",
        type: "default",
        has_form: "auto",
        visible_glass: !0,
        confirm_by_enter: !0,
        close_by_space: !0,
        key_tab: !0,
        key_close: !0,
        scroll_lock: !1,
        keycommand_maintain: !1,
        animate: !0,
        animate_in: {dialog_el: ".ui_dialog", dialog_class: "fade-in-up"},
        on_close: function () {
        },
        on_open: function () {
        }
      },
      initialize: function (t) {
        this.options = o.extend(this.defaults, this.options), this.templates = this.defaultTemplates, this.is_visible = !1, this.dialogQueueOrder = [], this.dialogQueue = {}, this.queueCounter = 0, this.currentDialog = !1, this.currentDialogId = 0, this.uid = 0, this.$body = s("body"), this._initClickLock(), this._setupKeys(), a && !i.Dialog && (this.listenTo(a, "dialog:dialog", this.dialog), this.listenTo(a, "dialog:confirm", this.confirm), this.listenTo(a, "dialog:confirm:promise", this.confirmPromise), this.listenTo(a, "dialog:alert", this.alert), this.listenTo(a, "dialog:close", this.close))
      },
      dialog: function (t) {
        return o.isObject(t) ? this._dialog(t) : !1
      },
      confirm: function (t, e, i, s, n) {
        o.isString(t) && (t = {text: t});
        var a = {callback_ok: e, callback_cancel: i, text_ok: s, text_cancel: n};
        t = o.extend(this.defaultDialog, a, t);
        var l = {
          text: t.text,
          customClass: t.customClass || null,
          type: "confirm",
          visible_glass: !0,
          keycommand_maintain: t.keycommand_maintain || !1,
          templates: t.templates || null,
          escape_button: 0,
          animate_in: {
            dialog_el: t.animate_in.dialog_el || ".ui_dialog",
            dialog_class: t.animate_in.dialog_class || "fade-in-up"
          },
          buttons: {
            0: {
              text: t.text_cancel || r("Cancel"),
              close: !0,
              callback: o.isFunction(t.callback_cancel) ? t.callback_cancel : function () {
              }
            },
            1: {
              text: t.text_ok || r("OK"),
              selected: !0,
              btn_class: "blue",
              close: !0,
              callback: o.isFunction(t.callback_ok) ? t.callback_ok : function () {
              }
            }
          }
        };
        return this._dialog(l)
      },
      confirmPromise: function (t, e) {
        this.confirm(e, t.resolve, t.reject)
      },
      alert: function (t, e, i) {
        o.isString(t) && (t = {text: t});
        var s = {callback_ok: e, text_ok: i};
        t = o.extend({}, s, t);
        var n = {
          text: t.text,
          customClass: t.customClass || null,
          type: "alert",
          visible_glass: !0,
          keycommand_maintain: t.keycommand_maintain || !1,
          templates: t.templates || null,
          escape_button: 0,
          buttons: {
            0: {
              text: t.text_ok || r("OK"),
              selected: !0,
              btn_class: "blue",
              close: !0,
              callback: o.isFunction(t.callback_ok) ? t.callback_ok : function () {
              }
            }
          }
        };
        return this._dialog(n)
      },
      getDialogEl: function () {
        return this.el
      },
      buttonClick: function (t) {
        var e = s(t.currentTarget), i = e.data("btn-id");
        if (o.isUndefined(this.currentDialog.buttons[i]) || e.hasClass("disabled"))return !1;
        var n = this.currentDialog.buttons[i], a = null;
        o.isFunction(n.callback) && (a = n.callback(this)), a !== !1 && (!o.isUndefined(n.close) && n.close || o.isUndefined(n.close)) && this.close()
      },
      isActive: function (t) {
        return this.currentDialog === !1 || this.currentDialog.uid !== t ? !1 : !0
      },
      close: function (t) {
        if (this.currentDialog === !1)return !1;
        if (o.isUndefined(t) && (t = !1), t !== !1 && this.currentDialog.uid !== t)return !1;
        if (this.$dialog_lock.removeClass("opaque"), this.$dialog_el.addClass("fade-out-down"), l.transition(this.$dialog_lock, o.bind(function () {
            this.$dialog_lock.hide()
          }, this)), l.animation(this.$dialog_el, o.bind(function () {
            s(".ui_dialog_pos").remove()
          }, this)), this.is_visible = !1, this.currentDialog.keycommand_maintain || a.trigger("keycommands:resume"), o.isFunction(this.currentDialog.on_close) && this.currentDialog.on_close(), a.trigger("dialog:closed"), this.currentDialog = !1, s("html").removeClass("dialog_lock"), this.dialogQueueOrder.length > 0) {
          var e = this.dialogQueueOrder.shift(), i = this.dialogQueue[e];
          delete this.dialogQueue[e], this._dialog(i)
        }
      },
      _tab: function (t) {
        var e = this.$el.find(".buttons .tab_frame"), i = e.filter(".focus"), s = e.index(i), o = e.length, n = !1;
        n = o > s + 1 ? s + 1 : 0, i.removeClass("focus init_focus");
        var a = e.eq(n);
        a.length > 0 && (a.addClass("focus"), a.find("button").focus())
      },
      _formIsTabToButton: function (t, e) {
        var i = this.$el.find(":focus");
        if (0 === i.length)return !0;
        var s = this.$el.find(".buttons .tab_frame"), o = this.$el.find(":input:visible"), n = o.index(i);
        if (e && n === o.length - 1)return this.$el.find(":input:visible:first").focus(), t.preventDefault(), s.removeClass("focus init_focus"), !1;
        if (n >= 0) {
          var a = this.$el.find(":input:visible:eq(" + (n + 1) + ")");
          if (a.length > 0 && a.hasClass("ui_button"))return !0;
        }
        return s.removeClass("focus init_focus"), !1
      },
      _select: function (t) {
        var e = this.$el.find(".buttons .tab_frame.focus"), i = e;
        1 === i.length && i.find(".ui_button").click()
      },
      _formIsFocusOnButton: function (t) {
        var e = this.$el.find(":focus");
        return 0 === e.length ? !1 : e.hasClass("ui_button")
      },
      _escape: function (t) {
        if (!o.isUndefined(this.currentDialog.escape_button)) {
          var e = this.$el.find(".btn_" + this.currentDialog.escape_button);
          e.length && e.click()
        }
      },
      _dialog: function (t) {
        if (o.isUndefined(t.uid) && (t.uid = this._getUid()), this.currentDialog !== !1)return this.dialogQueueOrder.push(this.queueCounter), this.dialogQueue[this.queueCounter] = t, this.queueCounter++, t.uid;
        o.defaults(t, this.defaultDialog);
        var e = this._buildButtons(t.buttons);
        o.extend(t, {buttons_html: e});
        var i = this.templates;
        o.isObject(t.templates) && (i = o.extend({}, this.templates, t.templates));
        var n = o.isString(i.dialog) ? o.template(i.dialog) : i.dialog, r = o.isString(i.content) ? o.template(i.content) : i.content;
        t.content_html = r(t);
        var l = n(t);
        this.$dialog_lock.show(), o.isUndefined(t.visible_glass) ? this.$dialog_lock.removeClass("opaque") : t.visible_glass && o.defer(o.bind(function () {
          this.$dialog_lock.addClass("opaque")
        }, this)), !o.isUndefined(t.scroll_lock) && t.scroll_lock && s("html").addClass("dialog_lock"), this.currentDialogId = t.uid, this.currentDialog = t;
        var h = s('<div id="dialog_' + this.currentDialogId + '" class="ui_dialog_pos">' + l + "</div>");
        return o.isString(t.customClass) && h.addClass(t.customClass), h.appendTo(this.$body), this.setElement(h), this.is_visible = !0, this.$dialog_el = this.$el.find(t.animate_in.dialog_el), t.animate && o.isObject(t.animate_in) && this.$dialog_el.length && this.$dialog_el.addClass(t.animate_in.dialog_class), this._focus(), this.currentDialog.keycommand_maintain || a.trigger("keycommands:suspend"), o.isUndefined(t.has_form) && (t.has_form = "auto"), "auto" === t.has_form && (t.has_form = this.$el.find("form, input").length > 0), o.isFunction(t.on_open) && t.on_open(), this.el = this.$el[0], this.delegateEvents(), a.trigger("dialog:opened"), t.uid
      },
      _button: function (t, e, i, s) {
        var n, a = o.isString(this.templates.button) ? o.template(this.templates.button) : this.templates.button;
        o.isObject(this.currentDialog.templates) && (n = this.currentDialog.templates.button);
        var r = a({btn_class: e, text: t, btn_id: o.isUndefined(i) ? "" : i});
        return r = '<div class="tab_frame">' + r + "</div>"
      },
      _focus: function () {
        if (!this.currentDialog)return !1;
        for (var t in this.currentDialog.buttons) {
          var e = this.currentDialog.buttons[t];
          if (!o.isUndefined(e.selected) && e.selected) {
            var i = this.$el.find(".btn_" + t);
            i.length > 0 && i.parent().addClass("focus init_focus")
          }
        }
      },
      _setupKeys: function () {
        s(document).on("keydown", o.bind(function (t) {
          var e = t.ctrlKey || t.shiftKey || t.metaKey;
          if (this.is_visible && !e) {
            var i = t.keyCode || t.which;
            if (9 === i && this.currentDialog.key_tab) {
              if (this.currentDialog.has_form && !this._formIsTabToButton(t, !0))return;
              t.preventDefault(), this._tab(t)
            }
            if (13 === i && this.currentDialog.confirm_by_enter || 32 === i && this.currentDialog.close_by_space) {
              if (this.currentDialog.has_form && 32 === i && !this._formIsFocusOnButton(t))return;
              t.preventDefault(), this._select(t)
            }
            27 === i && this.currentDialog.key_close && (t.preventDefault(), this._escape(t))
          }
        }, this))
      },
      _buildButtons: function (t) {
        if (!o.isObject(t))return "";
        var e = 0;
        for (var i in t)t.hasOwnProperty(i) && e++;
        for (var s = "", n = 0; e > n; n++)if (!o.isUndefined(t[n])) {
          var a = o.isUndefined(t[n].text) ? "" : t[n].text, r = o.isUndefined(t[n].btn_class) ? "" : t[n].btn_class, l = o.isUndefined(t[n].selected) ? !1 : t[n].selected;
          s += this._button(a, r, n, l)
        }
        return s
      },
      _initClickLock: function () {
        var t = this.$dialog_lock = s("<div>", {"class": "ui_dialog_lock", css: {display: "none"}});
        s(document).ready(function () {
          t.prependTo("body")
        })
      },
      _getUid: function () {
        return this.uid++
      },
      __: function (t) {
        return r(t)
      }
    });
    e.exports = new h
  }, {
    "../templates/button.tpl": 45,
    "../templates/content.tpl": 46,
    "../templates/dialog.tpl": 47,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/translate": 575,
    "prima/utils/bindendevent": 593,
    "prima/view": 612
  }],
  49: [function (t, e, i) {
    "use strict";
    var s, o = t("jquery"), n = t("lodash"), a = t("prima/lib/translate"), r = t("prima/component"), l = t("prima/events"), h = t("prima/mixins/keycommands"), c = t("app/components/dialog"), d = t("./views/drawer-view"), u = r.extend({
      name: "drawer",
      selector: "body",
      mixins: [h],
      defaults: {suspended: !1, needsCloseConfirmation: !1},
      keycommands: {"keydown:escape": "initiateClose"},
      initialize: function () {
        this.$glass = null, this.$container = o(this.container), this.bindEvents()
      },
      bindEvents: function () {
        this.listenTo(l, "post:form:show", this.suspend), this.listenTo(l, "post:form:hide", this.resume), this.listenTo(l, "drawer:suspend", this.suspend), this.listenTo(l, "drawer:resume", this.resume), this.listenTo(l, "drawer:enableCloseConfirmation", this.enableCloseConfirmation), this.listenTo(l, "drawer:disableCloseConfirmation", this.disableCloseConfirmation), this.listenTo(l, "drawer:hideGlass", this.hideGlass), this.listenTo(l, "indashblog:post:photo_lightbox", this.disableKeys), this.listenTo(l, "tumblr_lightbox:form:hide", this.enableKeys), this.$container.on("click.drawerOpen", "[data-drawer-open]", n.bind(this.onClickOpen, this))
      },
      suspend: function () {
        this.set("suspended", !0)
      },
      resume: function () {
        this.set("suspended", !1)
      },
      enableCloseConfirmation: function () {
        this.set("needsCloseConfirmation", !0)
      },
      disableCloseConfirmation: function () {
        this.set("needsCloseConfirmation", !1)
      },
      canOpen: function () {
        return !this.get("suspended") && !this.view
      },
      isSuspended: function () {
        return this.get("suspended")
      },
      isOpen: function () {
        return !!this.view
      },
      toggle: function (t, e) {
        this.canOpen ? this.open(t, e) : this.close()
      },
      open: function (t, e, i) {
        this.view = new d({
          subviews: {
            "drawer-content": {
              constructor: t,
              options: e || {}
            }
          }
        }), this.view.$el.addClass(i), this.showGlass(), l.trigger("keycommands:suspend"), l.trigger("toaster:suspend"), this.append(), this.trigger("open"), l.trigger("drawer:open")
      },
      replace: function (t, e, i) {
        this.view ? (this.view.animateRemove(), this.view = null, n.delay(n.bind(function () {
          this.view = new d({
            subviews: {
              "drawer-content": {
                constructor: t,
                options: e || {}
              }
            }
          }), this.view.$el.addClass(i), this.append()
        }, this), 400)) : this.open(t, e, i)
      },
      onClickOpen: function (t) {
        t.preventDefault();
        var e = o(t.currentTarget).attr("data-drawer-open");
        this.trigger("open:" + e), l.trigger("drawer:open:" + e)
      },
      initiateClose: function () {
        this.view && !this.get("suspended") && (this.get("needsCloseConfirmation") === !0 ? c.confirm(a("Close without sending?"), n.bind(this.close, this), this.noop, a("OK"), a("Cancel")) : this.close())
      },
      close: function () {
        this.view && (this.view.animateRemove(), this.view = null, this.hideGlass(), l.trigger("keycommands:resume"), l.trigger("toaster:resume"), this.trigger("close"), l.trigger("drawer:close"))
      },
      remove: function () {
        return this.close(), this
      },
      showGlass: function () {
        this.$glass = o("<div>", {"class": "ui_peepr_glass"}).appendTo(this.$container);
        var t = n.bind(function () {
          this.$container.addClass("peepr")
        }, this);
        this.animationDelay = n.delay(t, 50), this.$glass.on("click", n.bind(this.initiateClose, this))
      },
      hideGlass: function () {
        var t = this.$glass;
        this.$glass = null, this.$container.removeClass("peepr"), this.animationDelay && clearTimeout(this.animationDelay), n.delay(function () {
          t.remove()
        }, 150)
      }
    });
    e.exports = function () {
      return s || (s = new u), s
    }
  }, {
    "./views/drawer-view": 51,
    "app/components/dialog": 44,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/component": 545,
    "prima/events": 546,
    "prima/lib/translate": 575,
    "prima/mixins/keycommands": 581
  }],
  50: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "" + (null == (__t = _subview("drawer-content")) ? "" : __t);
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  51: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/events"), a = t("prima/views/base"), r = t("../templates/drawer-view.tpl"), l = a.extend({
      template: r,
      className: "drawer",
      defaults: {visible: !1},
      initialize: function (t) {
        t.subviews && (this.$body = s("body"), this.bindEvents())
      },
      bindEvents: function () {
        this.listenTo(n, "DOMEventor:keydown:tab", this.disableKey)
      },
      afterRender: function () {
        this.show()
      },
      disableKey: function (t) {
        var e = s(t.target).is("input");
        e || t.preventDefault()
      },
      show: function () {
        this.get("visible") || (this.set("visible", !0), this.toggleAnimation("open", !0))
      },
      hide: function (t) {
        this.get("visible") ? (this.set("visible", !1), this.toggleAnimation("open", !1), o.delay(t, 500)) : t()
      },
      toggleAnimation: function (t, e) {
        var i = o.bind(function () {
          this.$el.toggleClass(t, e)
        }, this);
        window.requestAnimationFrame ? window.requestAnimationFrame(i) : o.defer(i)
      },
      animateRemove: function () {
        return this.hide(o.bind(function () {
          this.remove()
        }, this)), this
      }
    });
    e.exports = l
  }, {
    "../templates/drawer-view.tpl": 50,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/views/base": 613
  }],
  52: [function (t, e, i) {
    "use strict";
    var s = t("prima/component"), o = t("./views/flat-select"), n = s.extend({
      name: "FlatSelect", view: function (t) {
        return new o(t)
      }
    });
    e.exports = n
  }, {"./views/flat-select": 53, "prima/component": 545}],
  53: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/view"), a = n.extend({
      el: "body",
      defaults: {},
      events: {"change .flat_select select": "__selectChange"},
      __selectChange: function (t) {
        var e = s(t.currentTarget);
        this.updateSelect(e)
      },
      initialize: function (t) {
        this.options = o.extend({}, this.defaults, t)
      },
      updateSelect: function (t) {
        var e = t.siblings("label");
        e.text(t.find(":selected").text())
      }
    });
    e.exports = a
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/view": 612}],
  54: [function (t, e, i) {
    "use strict";
    var s, o = t("jquery"), n = t("prima/component"), a = t("./views/footer"), r = t("./views/sidebar_footer"), l = n.extend({
      name: "footer",
      initialize: function () {
        this.createFooter()
      },
      createFooter: function () {
        o(".l-footer").length && (this.footerView = new a({el: ".l-footer"})), o(".sidebar_nav").length && (this.sidebarFooterView = new r({el: ".pinned_sidebar_footer"}))
      }
    });
    e.exports = function () {
      return s || (s = new l), s
    }
  }, {"./views/footer": 55, "./views/sidebar_footer": 56, jquery: "HlZQrA", "prima/component": 545}],
  55: [function (t, e, i) {
    "use strict";
    var s = t("prima/view"), o = s.extend({
      initialize: function () {
      }
    });
    e.exports = o
  }, {"prima/view": 612}],
  56: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("prima/events"), a = t("prima/utils/bindendevent").transition, r = o.extend({
      defaults: {
        fadeScrollDistance: 2e3,
        visible: !0
      }, initialize: function () {
        this.listenTo(n, "DOMEventor:flatscroll", this.onScroll), this.on("change:visible", this.toggleVisibility), this.$nav = this.$el.find(".sidebar_nav")
      }, onScroll: function (t) {
        t && (t.windowScrollY >= this.get("fadeScrollDistance") ? this.set("visible", !1) : this.set("visible", !0))
      }, toggleVisibility: function (t, e) {
        e === !0 ? (this.showElement(), s.defer(s.bind(function () {
          this.$nav.toggleClass("visible", e)
        }, this))) : (a(this.$nav, s.bind(function () {
          this.hideElement()
        }, this)), this.$nav.toggleClass("visible", e))
      }, hideElement: function () {
        this.$el.css({display: "none"})
      }, showElement: function () {
        this.$el.css({display: "block"})
      }
    });
    e.exports = r
  }, {lodash: "MicNly", "prima/events": 546, "prima/utils/bindendevent": 593, "prima/views/base": 613}],
  57: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("when"), n = t("prima/collection"), a = t("../models/search-image-query"), r = 3e5, l = n.extend({
      model: a,
      resultCountForQuery: function (t) {
        t = (t || "").toLowerCase().trim();
        var e = this.get(t);
        return e ? e.media.length : 0
      },
      fetchGifs: function (t, e, i) {
        var n, l = o.defer();
        t = (t || "").toLowerCase().trim();
        var h = this.get(t);
        return h || (h = new a({
          query: t,
          limit: e
        }), this.add(h)), !i && s.now() - h.get("ts") < r ? (this.trigger("search", t, !0), l.resolve(h)) : (this.trigger("search", t, !1), n = h.fetch({
          success: function () {
            n = null, l.resolve(h)
          }, error: function (t) {
            n = null, l.reject(t)
          }
        })), l.promise["catch"](function () {
          n && n.abort()
        }), l
      },
      clearCache: function (t) {
        this.remove(t)
      }
    });
    e.exports = l
  }, {"../models/search-image-query": 60, lodash: "MicNly", "prima/collection": 544, when: "RG2dij"}],
  58: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/collection"), n = t("../models/search-image"), a = o.extend({
      model: n,
      previousFrom: function (t) {
        return this.rotateFrom(t, -1)
      },
      nextFrom: function (t) {
        return this.rotateFrom(t, 1)
      },
      rotateFrom: function (t, e) {
        for (var i = (s.isNumber(t) ? this.at(t) : this.findWhere({mediaUrl: t})) || this.sample(), o = this.indexOf(i) + e; 0 > o;)o += this.length;
        return this.at(o % this.length)
      }
    });
    e.exports = a
  }, {"../models/search-image": 61, lodash: "MicNly", "prima/collection": 544}],
  59: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("backbone"), n = t("prima/events"), a = t("prima/component"), r = t("./views/image-search-container"), l = t("./collections/search-image-queries"), h = function () {
    };
    h.extend = o.Model.extend, s.extend(h.prototype, o.Events);
    var c = new h, d = a.extend({
      name: "ImageSearch", selector: "body", initialize: function (t) {
        t = t || {}, this.collection = t.collection || new l, this.view = new r(s.extend({
          eventBus: c,
          collection: this.collection,
          query: t.query,
          imageWidth: t.imageWidth,
          resultLimit: t.resultLimit,
          selectedImageUrl: t.selectedImageUrl
        }, this.viewOptions)), this.listenTo(c, "image:select", function (t, e) {
          this.logGifSearchEvent("select", e), this.trigger("selectImage", t.toJSON(), this.getQuery())
        }), this.listenTo(c, "image:impression", function (t) {
          this.logGifSearchEvent("impression", t)
        }), this.listenTo(c, "gifsearch:resultChange", function (t) {
          this.logGifSearchResultChange("search", t)
        }), this.listenTo(this.view, "dismiss", function () {
          this.trigger("dismiss")
        })
      }, render: function () {
        return this.view.render(), this.trigger("append"), this.view
      }, setQuery: function (t) {
        this.view.setQuery(t)
      }, getQuery: function () {
        return this.view.getQuery()
      }, getCurrentResults: function () {
        return this.view.get("currentResults")
      }, logGifSearchEvent: function (t, e) {
        var i = {
          popularSearch: e.model.get("popularSearchTag") ? e.model.get("popularSearchTag") : null,
          query: this.getQuery() ? this.getQuery() : null,
          resultsIndex: this.getCurrentResults().indexOf(e.model),
          top: Math.round(e.$el.position().top),
          left: Math.round(e.$el.position().left),
          postBlog: e.model.get("postBlog"),
          postId: e.model.get("postId")
        };
        n.trigger("gifsearch:" + t, {loggingData: i})
      }, logGifSearchResultChange: function (t, e) {
        var i = this.getQuery();
        if (i) {
          var s = {query: i};
          n.trigger("gifsearch:" + t, {loggingData: s})
        }
      }
    });
    e.exports = d
  }, {
    "./collections/search-image-queries": 57,
    "./views/image-search-container": 67,
    backbone: "5kFNoY",
    lodash: "MicNly",
    "prima/component": 545,
    "prima/events": 546
  }],
  60: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/model"), n = o.prototype, a = t("../collections/search-images"), r = function (t, e, i) {
      this.name = "EmbedError", this.message = t, this.input = e, this.data = i, this.stack = (new Error).stack
    }, l = o.extend({
      idAttribute: "query",
      url: "/svc/search/inline_gif",
      defaults: {query: "", limit: 200},
      initialize: function (t, e) {
        this.media = new a
      },
      fetch: function (t) {
        return t = s.extend({
          type: "POST",
          with_form_key: !0,
          data: {q: this.get("query"), limit: this.get("limit")}
        }, t), n.fetch.call(this, t)
      },
      parse: function (t, e) {
        if (e && e.xhr && (t = (t || {}).response), s.isEmpty(t))throw new r("Invalid GIF search response", this.get("query"), t);
        return this.media.reset(t.media), delete t.media, t.ts = s.now(), t
      },
      toJSON: function () {
        var t = n.toJSON.apply(this, arguments);
        return t.media = this.media ? this.media.toJSON() : [], t
      }
    });
    e.exports = l
  }, {"../collections/search-images": 58, lodash: "MicNly", "prima/model": 590}],
  61: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/model"), n = t("prima/utils/camelize-keys"), a = o.extend({
      defaults: {
        mediaUrl: "",
        postUrl: "",
        rootPostUrl: "",
        rootPostUrlHash: "",
        rootBlog: "",
        rootBlogUrl: "",
        rootBlogKey: "",
        postTags: [],
        popularSearchTag: "",
        width: 0,
        height: 0
      }, initialize: function (t, e) {
        this.attributes = {}, this.set(s.defaults(n(t || {}), this.defaults))
      }
    });
    e.exports = a
  }, {lodash: "MicNly", "prima/model": 590, "prima/utils/camelize-keys": 594}],
  62: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="searchInput"></div><div data-subview="loader"></div><div data-subview="searchResults"></div><div data-subview="searchMessage"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  63: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="textEditor"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  64: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="gif-search-message-container">', header && (__p += '<h2 class="gif-search-message-header">' + (null == (__t = header) ? "" : __t) + "</h2>"), __p += '<div class="gif-search-message-body">' + (null == (__t = body) ? "" : __t) + "</div>", hasResults && (__p += '<p><span class="gif-search-show-results" data-js-showresults>' + (null == (__t = __("View results anyway")) ? "" : _.escape(__t)) + "</span></p>"), __p += "</div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  65: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<figure data-js-select style="width: ' + (null == (__t = width) ? "" : _.escape(__t)) + "px; height: " + (null == (__t = height) ? "" : _.escape(__t)) + 'px"><img data-js-img data-img-src="' + (null == (__t = mediaUrl) ? "" : _.escape(__t)) + '" width="' + (null == (__t = width) ? "" : _.escape(__t)) + '" height="' + (null == (__t = height) ? "" : _.escape(__t)) + '"></figure><footer><nav class="tags">', _.each(tags, function (t) {
          __p += "", _.isEmpty(t) || (__p += '<a href="#" data-js-tag="' + (null == (__t = t) ? "" : _.escape(__t)) + '">#' + (null == (__t = t) ? "" : _.escape(__t)) + "</a>"), __p += ""
        }), __p += '</nav><a class="attribution" href="http://tmblr.co/' + (null == (__t = rootPostUrlHash) ? "" : _.escape(__t)) + '" target="_blank">' + (null == (__t = __("Originally posted by %1$s", rootBlog)) ? "" : _.escape(__t)) + "</a></footer>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  66: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="results-scroller" data-subview="searchResults[]"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  67: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/lib/translate"), a = t("prima/views/base"), r = t("./image-search-input"), l = t("./image-search-results"), h = t("./image-search-message"), c = t("components/loader"), d = t("../templates/image-search-container.tpl"), u = a.extend({
      className: "gif-search-container",
      template: d,
      subviews: {
        searchInput: {
          constructor: r, options: function (t) {
            return {eventBus: t.eventBus}
          }
        }, searchResults: {
          constructor: l, options: function (t) {
            return {imageWidth: t.get("imageWidth"), selectedImageUrl: t.get("selectedImageUrl"), eventBus: t.eventBus}
          }
        }, searchMessage: {
          constructor: h, options: function (t) {
            return {eventBus: t.eventBus}
          }
        }
      },
      defaults: {imageWidth: null, resultLimit: 200, selectedImageUrl: "", query: null},
      initialize: function (t) {
        t = o.extend({}, t), o.extend(this.attributes, o.pick(t, o.keys(this.defaults))), o.extend(this, o.pick(t, "eventBus", "collection")), this.noResults = [n("Nothing turned up. Bummer."), n("Looked around but didn't see anything about that."), n("Sadly, nothing."), n("Tragically, nothing."), n("Welcome to the void. There is nothing here."), n("We found nothing. Here it isn't."), n("Couldn't find that. Please, don't be upset. Please."), n("Sincerely, we found nothing."), n("Maybe try a similar search but use different words? Dunno.")], this.listenTo(this, "change:query", this._onChangeQuery), this.listenTo(this.eventBus, "image:tag", function (t, e) {
          this.set("query", t), this.searchInput.setValue(this.get("query"))
        }), this.listenTo(this.eventBus, "showHiddenResults", function () {
          this.searchResults.setCollection(this.get("currentResults")), this.hasResults() && this.searchMessage.hide()
        })
      },
      hasResults: function () {
        return !(o.isEmpty(this.get("currentResults")) || o.isEmpty(this.get("currentResults").models))
      },
      dismiss: function () {
        this.trigger("dismiss")
      },
      _onKeyDown: function (t) {
        27 === t.keyCode && (t.stopPropagation(), this.dismiss())
      },
      _onChangeQuery: function (t, e) {
        o.isString(e) && (this.rendered && this.loader.set("loading", !0), this.currentQuery && this.currentQuery.reject(), this.searchResults.cancelPreloads(), this.searchResults.cancelFullImageLoads(), this.currentQuery = this.collection.fetchGifs(e, this.get("resultLimit")), this.currentQuery.promise.then(o.bind(function (t) {
          if (this.set("currentResults", t.media), this.rendered) {
            this.loader.set("loading", !1);
            var e = t.get("message");
            e && (e.header || e.body) ? this.searchMessage.setMessage(e.header, e.body, this.hasResults()) : (this.searchResults.setCollection(this.get("currentResults")), this.hasResults() ? this.searchMessage.hide() : this.searchMessage.setMessage("", o.sample(this.noResults), !1))
          }
          this.currentQuery = null
        }, this)))
      },
      afterRenderSubviews: function () {
        o.defer(o.bind(function () {
          this.searchInput.focus()
        }, this)), this.listenTo(this.searchInput, "userQueryChanged", function (t) {
          this.setQuery(t)
        }), this.loader = new c({
          $container: this.$el,
          type: "bar",
          classModifiers: "top",
          loading: !1
        }), o.isString(this.get("query")) && (this._onChangeQuery(this, this.get("query")), this.searchInput.setValue(this.get("query"))), s("body").on("keydown.image-search-container", o.bind(this._onKeyDown, this))
      },
      setQuery: function (t) {
        this.set("query", t)
      },
      getQuery: function () {
        return this.get("query")
      },
      beforeRemove: function () {
        s("body").off(".image-search-container"), this.currentQuery && this.currentQuery.reject()
      }
    });
    e.exports = u
  }, {
    "../templates/image-search-container.tpl": 62,
    "./image-search-input": 68,
    "./image-search-message": 69,
    "./image-search-results": 71,
    "components/loader": 499,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/views/base": 613
  }],
  68: [function (t, e, i) {
    "use strict";
    var s = t("prima/views/base"), o = t("../templates/image-search-input.tpl"), n = t("prima/lib/translate"), a = t("lodash"), r = t("app/components/post-form/views/plaintext_editor"), l = s.extend({
      className: "gif-search-input",
      template: o,
      subviews: {
        textEditor: {
          constructor: r, options: function (t) {
            return {
              forceSingleLine: !0,
              placeholder: n("Find a GIF"),
              syncWithModel: !1,
              onChange: a.debounce(a.bind(t._onUserChangeInput, t), 250)
            }
          }
        }
      },
      _onUserChangeInput: function () {
        this.trigger("userQueryChanged", this.textEditor.getEditorValue())
      },
      focus: function () {
        this.textEditor.focus()
      },
      setValue: function (t) {
        this.textEditor.setEditorValue(t)
      }
    });
    e.exports = l
  }, {
    "../templates/image-search-input.tpl": 63,
    "app/components/post-form/views/plaintext_editor": 345,
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/views/base": 613
  }],
  69: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("app/components/post-form/utils/filter-html-by-dom"), n = t("prima/views/base"), a = t("../templates/image-search-message.tpl"), r = n.extend({
      className: "gif-search-message",
      template: a,
      defaults: {header: "", body: "", hasResults: !1},
      events: {"click [data-js-showResults]": "_onClickShowResults"},
      initialize: function (t) {
        s.extend(this, s.pick(t, "eventBus"))
      },
      _onClickShowResults: function () {
        this.eventBus.trigger("showHiddenResults")
      },
      _filterMessageHtml: function (t, e) {
        e.find("script, link").remove(), e.find("a[onerror]").removeAttr("onerror")
      },
      getTemplateData: function () {
        var t = n.prototype.getTemplateData.apply(this, arguments);
        return t.body = o(t.body || "", this._filterMessageHtml), t
      },
      afterRender: function () {
        this.rendered || this.listenTo(this, "change", this.render), this.$el.toggleClass("gif-search-message--hidden", !(this.get("header") || this.get("message")))
      },
      setMessage: function (t, e, i) {
        s.isString(e) || (e = t, t = ""), s.isBoolean(i) || (i = this.get("hasResults")), this.set({
          header: t,
          body: e,
          hasResults: i
        }), e || t ? this.show() : this.hide()
      },
      show: function () {
        this.$el.removeClass("gif-search-message--hidden")
      },
      hide: function () {
        this.$el.addClass("gif-search-message--hidden")
      }
    });
    e.exports = r
  }, {
    "../templates/image-search-message.tpl": 64,
    "app/components/post-form/utils/filter-html-by-dom": 316,
    lodash: "MicNly",
    "prima/views/base": 613
  }],
  70: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/views/base"), a = t("../templates/image-search-result.tpl"), r = t("prima/utils/image/loader"), l = t("prima/mixins/selectorcache"), h = t("components/knight-rider-loader"), c = t("when"), d = n.extend({
      className: "gif-search-result",
      template: a,
      events: {"click [data-js-select]": "_onClickSelect", "click [data-js-tag]": "_onClickTag"},
      mixins: [l],
      defaults: {
        skipTags: ["gif", "gifs"],
        imageWidth: null,
        isVirtualized: !0,
        hasStillImage: !0,
        isPreselected: !1,
        unloadImageOnVirtualize: !1,
        isLoaded: !1,
        isSelectable: !0,
        loadFullImageBeforeSelect: !0,
        loadingFullImage: !1,
        containerWidth: 150,
        isImpressionLogged: !1
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus")), this._loadDefer = c.defer()
      },
      afterRender: function () {
        this.listenTo(this, "change:isPreselected", this._onChangeIsPreselected), this.listenTo(this, "change:isVirtualized", this._onChangeIsVirtualized), this.listenTo(this, "change:hasStillImage", this._onChangeHasStillImage), this.listenTo(this, "change:isSelectable", this._onChangeIsSelectable), this.listenTo(this, "change:isLoaded", this._onChangeIsLoaded), this.listenTo(this.eventBus, "image:full:cancelLoad", this._onCancelAllFullImageLoads), this._onChangeIsVirtualized(this, this.get("isVirtualized")), this._onChangeHasStillImage(this, this.get("hasStillImage")), this._onChangeIsPreselected(this, this.get("isPreselected")), this._onChangeIsSelectable(this, this.get("isSelectable")), this._onChangeIsLoaded(this, this.get("isLoaded"))
      },
      getTemplateData: function () {
        var t = this.model.toJSON(), e = t.popularSearchTag ? [t.popularSearchTag] : t.postTags, i = this.get("skipTags"), o = this.get("containerWidth"), n = Math.round(this.model.get("height") * (o / this.model.get("width")));
        return e = s.reject(e, function (t) {
          return s.contains(i, t.toLowerCase())
        }), s.extend(t, {
          tags: e.slice(0, 3),
          width: o,
          height: n
        }), this.get("imageWidth") && s.extend(t, {mediaUrl: t.mediaUrl.replace(/_\d+\./, "_" + this.get("imageWidth") + ".")}), t
      },
      loadImage: function () {
        var t = this.js$("img"), e = t.attr("data-img-src");
        return this.get("isLoaded") || (t.attr("src", e), r.load(e, 100).then(s.bind(function () {
          this.rendered && this.set("isLoaded", !0), this._loadDefer.resolve()
        }, this))), this._loadDefer.promise
      },
      unloadImage: function () {
        this.js$("img").removeAttr("src")
      },
      refreshStillImage: function () {
        this._onChangeHasStillImage(this, this.get("hasStillImage"))
      },
      getLoadPromise: function () {
        return this._loadDefer.promise
      },
      _onCancelAllFullImageLoads: function () {
        this._cancelLoadFullImage()
      },
      _onClickSelect: function () {
        var t = this.model.get("mediaUrl"), e = this.js$("img").attr("src"), i = function () {
          this.$el.addClass("gif-search-result--selected"), this.eventBus.trigger("image:select", this.model, this)
        };
        this.get("loadFullImageBeforeSelect") && t !== e ? this._loadFullImage(t, i) : i.call(this)
      },
      _loadFullImage: function (t, e) {
        this.eventBus.trigger("image:full:cancelLoad"), this.set("loadingFullImage", !0), this.eventBus.trigger("image:full:loading"), this.loader = new h({
          variation: "centered small",
          loading: !0
        }), this.$el.addClass("loading-full").append(this.loader.render().$el), r.load(t).then(s.bind(function () {
          this.get("loadingFullImage") && s.isFunction(e) && e.call(this)
        }, this))["finally"](s.bind(this._cancelLoadFullImage, this))
      },
      _cancelLoadFullImage: function () {
        this.rendered && this.get("loadingFullImage") && (this.loader && (this.loader.remove(), this.loader = null), this.$el.removeClass("loading-full"), this.set("loadingFullImage", !1))
      },
      _onClickTag: function (t) {
        var e = o(t.target).attr("data-js-tag");
        this.eventBus.trigger("image:tag", e, this.model), t.preventDefault(), t.stopPropagation()
      },
      _onChangeIsPreselected: function (t, e) {
        this.$el.toggleClass("gif-search-result--preselected", e)
      },
      _onChangeIsVirtualized: function (t, e) {
        this.$el.toggleClass("off", e), e && this.get("unloadImageOnVirtualize") ? this.unloadImage() : e || this.loadImage()
      },
      _onChangeHasStillImage: function (t, e) {
        this._removeStillCanvas(), e && this._prepareCreateStillCanvas()
      },
      _onChangeIsSelectable: function (t, e) {
        this.$el.toggleClass("gif-search-result--selectable", e)
      },
      _onChangeIsLoaded: function (t, e) {
        this.$el.toggleClass("loaded", e)
      },
      _createStillCanvas: function () {
        if (this.rendered) {
          var t, e = this.js$("img"), i = e.parent(), s = parseInt(e.width(), 10), n = parseInt(e.height(), 10), a = o("<canvas />").attr({
            width: s,
            height: n
          });
          this.$("canvas").remove(), i.append(a), t = a.get(0).getContext("2d"), t.drawImage(e.get(0), 0, 0, s, n), this.$el.addClass("show-still")
        }
      },
      _prepareCreateStillCanvas: function () {
        this.getLoadPromise().then(s.bind(this._createStillCanvas, this))["catch"](s.noop)
      },
      _removeStillCanvas: function () {
        this.$("canvas").remove(), this.$el.removeClass("show-still")
      }
    });
    e.exports = d
  }, {
    "../templates/image-search-result.tpl": 65,
    "components/knight-rider-loader": 496,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/mixins/selectorcache": 586,
    "prima/utils/image/loader": 605,
    "prima/views/base": 613,
    when: "RG2dij"
  }],
  71: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = o.prototype, a = t("../templates/image-search-results.tpl"), r = t("./image-search-result"), l = t("masonry-layout"), h = t("velocity-animate"), c = h.animate, d = h.hook, u = t("when"), p = t("app/lib/scrollbar"), m = function (t) {
      var e = Math.round(t.position().top), i = Math.round(e + t.height());
      return {top: e, bottom: i}
    }, g = function (t, e) {
      return !(e.bottom < t.top || e.top > t.bottom)
    }, _ = function (t, e) {
      return e.bottom >= t.bottom && e.top <= t.top
    }, f = function (t) {
      return {top: Math.round(t.scrollTop()), bottom: Math.round(t.scrollTop() + t.height())}
    }, v = function (t, e) {
      return Math.floor(e.position().top / t.height())
    }, b = function (t) {
      return Math.floor(t.scrollTop() / t.outerHeight(!0))
    }, y = function (t) {
      return Math.ceil(t.get(0).scrollHeight / t.height())
    }, w = o.extend({
      className: "gif-search-results",
      template: a,
      subviews: {
        searchResults: {
          constructor: r, options: function (t) {
            return {eventBus: t.eventBus, imageWidth: t.get("imageWidth")}
          }, collection: function (t) {
            return t.collection
          }
        }
      },
      defaults: {
        renderBatchSize: 50,
        renderBatchDelay: 5,
        selectedImageUrl: "",
        imageWidth: null,
        enablePreloading: !0,
        isPreloading: !1,
        preloadPollInterval: 1e3
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "collection"))
      },
      setCollection: function (t) {
        this.collection && this.stopListening(this.collection), this.collection = t, this.eventBus.trigger("gifsearch:resultChange", this.collection), this.rendered && this.render()
      },
      populatePreloadQueue: function () {
        this._preloadQueue = s.range(y(this.$el)), this.sortPreloadQueue()
      },
      sortPreloadQueue: function () {
        var t;
        s.isEmpty(this._preloadQueue) || (t = b(this.$el), this._preloadQueue = s.sortBy(this._preloadQueue, function (e) {
          return Math.abs(t - e) + (t > e ? .1 : 0)
        }))
      },
      clearPreloadQueue: function () {
        this._preloadQueue && (this._preloadQueue.length = 0)
      },
      processPreloadQueue: function () {
        var t, e;
        if (!this.get("isPreloading")) {
          if (!this.rendered || s.isEmpty(this._preloadQueue))return this.stopPreloadPoller();
          t = this._preloadQueue.shift(), e = this.getViewsAtPageIndex(t), this.set("isPreloading", !0), this.preloadSubviews(e)["finally"](s.bind(function () {
            this.set("isPreloading", !1)
          }, this))["catch"](s.noop)
        }
      },
      startPreloadPoller: function () {
        this.stopPreloadPoller(), this._preloadTimer = setInterval(s.bind(this.processPreloadQueue, this), this.get("preloadPollInterval"))
      },
      stopPreloadPoller: function () {
        this._preloadTimer && (clearInterval(this._preloadTimer), this._preloadTimer = null)
      },
      renderCollectionSubviews: function (t) {
        if ("searchResults" !== t)return n.renderCollectionSubviews.apply(this, arguments);
        var e = this.subviews[t], i = e.container || s.bind(function () {
            return this.$('[data-subview="' + t + '[]"]')
          }, this), o = e.prepareView || function (i, s) {
            var o = new e.constructor(s);
            return o.$el.attr("data-subview", t), i.append(o.$el), o
          }, a = e.options || {}, r = e.collection;
        if (s.isFunction(r) && (r = r(this)), r) {
          var l = this.get("renderBatchSize"), h = this.get("renderBatchDelay");
          this._deferredRenders = s(r.models).groupBy(function (t, e) {
            return Math.floor(e / l)
          }).toArray().map(function (e, n) {
            return s.delay(this.createCollectionSubviewRenderer(e, i, o, a, t, !!n), n * h)
          }, this).value()
        }
      },
      hideViews: function (t) {
        s.each(t, function (t) {
          t.rendered && (t.set("isSelectable", !1), t.$el.css("opacity", 0))
        })
      },
      animateShowViews: function (t) {
        var e = 0;
        s.each(t, function (t) {
          this.animateShowView(t, 100 * e++)
        }, this)
      },
      animateShowView: function (t, e, i, o) {
        var n, a = !1;
        o = s.isNumber(o) ? o : 250, e = s.isNumber(e) ? e : 0, i = s.isNumber(i) ? i : 1e3, d(t.$el, "translateY", "40px");
        var r = function () {
          a = !0, c(t.$el, "stop"), c(t.$el, {translateY: 0, opacity: 1}, {
            duration: o,
            delay: e,
            complete: s.bind(function () {
              t.rendered && (t.set("isSelectable", !0), t.$el.css({transform: "", opacity: ""}))
            }, this)
          })
        };
        i > 0 && (n = setTimeout(r, i)), t.getLoadPromise().then(function () {
          n && clearTimeout(n), a || r()
        })
      },
      beforeRender: function () {
        this.$el.css("visibility", "hidden"), this.removeSubviews()
      },
      afterRender: function () {
        this.collection && 0 !== this.collection.length && (this.listenTo(this.eventBus, "image:full:loading", this.cancelPreloads), s.defer(s.bind(function () {
          if (this.rendered) {
            this._deferredRenders || (this._deferredRenders = []);
            var t = s.delay(s.bind(this.resetMasonry, this), this.get("renderBatchDelay") * this._deferredRenders.length);
            this._deferredRenders.push(t), this.scrollbar ? this.scrollbar.update() : this.scrollbar = new p(this.$el)
          }
        }, this)))
      },
      removeSubviews: function () {
        return s.forEach(this._deferredRenders, clearTimeout), this._deferredRenders = [], delete this.masonry, n.removeSubviews.apply(this, arguments)
      },
      resetMasonry: function () {
        this.setupMasonary(), this.setupElementCaches(), this.get("enablePreloading") && (this.populatePreloadQueue(), this.startPreloadPoller()), this.setSelectedImage(), this.setupVirtualization();
        var t = this.getSubviewsInBounds();
        this.hideViews(t), this.$el.css("visibility", ""), this.animateShowViews(t)
      },
      getViewBounds: function (t) {
        return s.result(this._elementPositionCache, t.cid) ? this._elementPositionCache[t.cid] : m(t.$el)
      },
      getSubviewsInBounds: function (t) {
        return t = t || f(this.$el), s.filter(this.searchResults, function (e) {
          return g(this.getViewBounds(e), t)
        }, this)
      },
      setupMasonary: function () {
        this.masonry ? this.masonry.reload() : this.masonry = new l(this.$(".results-scroller").get(0), {
          transitionDuration: 0,
          isFitWidth: !0,
          gutter: 10
        }, this)
      },
      setupElementCaches: function () {
        var t = this.$el;
        this._pageIndexCache = {}, this._elementPositionCache = {}, s.each(this.searchResults, function (e) {
          var i = v(t, e.$el);
          s.isArray(this._pageIndexCache[i]) || (this._pageIndexCache[i] = []), this._pageIndexCache[i].push(e), this._elementPositionCache[e.cid] = m(e.$el)
        }, this)
      },
      getViewsAtPageIndex: function (t) {
        return this._pageIndexCache[t] || []
      },
      setupVirtualization: function () {
        var t = s.bind(function () {
          this.rendered && (this.sortPreloadQueue(), this.virtualizeSubviews())
        }, this), e = s.debounce(t, 250);
        this.$el.off(".image-search-virtualization").on("scroll.image-search-virtualization", e), this.virtualizeSubviews()
      },
      setSelectedImage: function () {
        var t, e;
        if (this.get("selectedImageUrl") && (e = s.find(this.searchResults, function (t, e) {
            return t.model.get("mediaUrl") === this.get("selectedImageUrl")
          }, this))) {
          if (e.set("isPreselected", !0), t = e.$el.offset().top - this.$el.offset().top, 0 === t)return;
          t -= (this.$el.height() - e.$el.height()) / 2, this.$el.scrollTop(t)
        }
      },
      cancelPreloads: function () {
        this.stopPreloadPoller(), this.clearPreloadQueue()
      },
      cancelFullImageLoads: function () {
        this.eventBus.trigger("image:full:cancelLoad")
      },
      preloadSubviews: function (t, e) {
        return u.all(s.map(t, function (t) {
          return t.loadImage()
        }))
      },
      _virtualizeSubviews: function (t, e, i) {
        s.forEach(this.searchResults, function (o, n) {
          if (o && o.$el) {
            var a = this.getViewBounds(o);
            g(a, t) ? s.isFunction(e) && e.call(this, o, _(a, t)) : s.isFunction(i) && i.call(this, o)
          }
        }, this)
      },
      virtualizeSubviews: function () {
        var t = this.$el, e = {top: t.scrollTop(), bottom: t.scrollTop() + t.height()};
        this._virtualizeSubviews(e, function (t, e) {
          t.set({isVirtualized: !1}), e && t.get("isImpressionLogged") === !1 && (this.eventBus.trigger("image:impression", t), t.set("isImpressionLogged", !0))
        }, function (t) {
          t.set({isVirtualized: !0})
        })
      },
      beforeRemove: function () {
        this.$el.off(), this.cancelPreloads(), this.cancelFullImageLoads(), this.scrollbar && this.scrollbar.destroy()
      }
    });
    e.exports = w
  }, {
    "../templates/image-search-results.tpl": 66,
    "./image-search-result": 70,
    "app/lib/scrollbar": 460,
    lodash: "MicNly",
    "masonry-layout": "EDlLR4",
    "prima/views/base": 613,
    "velocity-animate": "lWl/mc",
    when: "RG2dij"
  }],
  72: [function (t, e, i) {
    "use strict";
    var s = t("prima/component"), o = t("prima/lib/domeventor"), n = t("prima/events"), a = t("jquery"), r = t("lodash"), l = s.extend({
      name: "GutterMediaManager",
      gutteredView: null,
      gutterMargin: 20,
      gutterWidth: 215,
      maxViewWidth: 300,
      viewportTransitionWidth: 900,
      initialize: function () {
        this.layoutHasGutter = this.$right_column().length > 0, this.layoutHasGutter || (this.gutterMargin = -65)
      },
      $right_column: function () {
        return this._$right_column || (this._$right_column = a(".right_column")), this._$right_column
      },
      toggleBackground: function (t) {
        this.layoutHasGutter && (t ? (this.$right_column().addClass("has_docked_post"), this.$right_column().on("click.gutterManager", r.bind(this.handleGutterClick, this))) : (this.$right_column().removeClass("has_docked_post"), this.$right_column().off("click.gutterManager")))
      },
      putViewInGutter: function (t, e) {
        return e = r.defaults(e || {}, {
          winRect: o.rect(),
          gutterPosition: this.gutterPosition(),
          animation: null,
          dimRadar: !0,
          removeOnGutterClick: !1,
          onDock: r.noop,
          onUndock: r.noop,
          dockLoggingName: "post:docked",
          dockLoggingData: null,
          undockLoggingName: "post:undocked",
          undockLoggingData: null
        }), this.isDockable(t, e) ? (e.onDock = e.onDock || r.noop, this.gutteredView && this.removeGutteredView(), this.gutteredView = {
          view: t,
          options: e
        }, e.onDock.call(t, e), e.dimRadar && this.toggleBackground(!0), e.dockLoggingName && e.dockLoggingData && n.trigger(e.dockLoggingName, {loggingData: e.dockLoggingData}), this.gutteredView) : !1
      },
      removeGutteredView: function () {
        if (this.gutteredView) {
          var t = this.gutteredView.options, e = this.gutteredView.view;
          t.onUndock = t.onUndock || r.noop, t.onUndock.call(e, t), this.gutteredView = null, t.dimRadar && this.toggleBackground(!1), t.undockLoggingName && t.undockLoggingData && n.trigger(t.undockLoggingName, {loggingData: t.undockLoggingData})
        }
      },
      isViewInGutter: function (t) {
        return this.gutteredView && this.gutteredView.view === t
      },
      isDockable: function (t, e) {
        if (!this.gutteredView)return !0;
        var i = this.gutteredView ? this.gutteredView.options.alwaysEvict : !0, s = e.alwaysEvict;
        return this.gutteredView.view === t || s && !i ? !1 : !0
      },
      handleGutterClick: function (t) {
        this.gutteredView && (t.preventDefault(), this.gutteredView.options.removeOnGutterClick && this.removeGutteredView())
      },
      gutterPosition: function () {
        var t = o.rect(), e = this.viewportTransitionWidth / 2 - this.gutterMargin - this.gutterWidth, i = {
          width: this.maxViewWidth,
          left: "50%",
          bottom: 20,
          translateX: e
        }, s = this.maxViewWidth - this.gutterWidth + this.viewportTransitionWidth;
        return t.windowWidth < s && (i.width = s - t.windowWidth), i.width < this.gutterWidth && (i.width = this.gutterWidth), i
      }
    });
    e.exports = new l
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/component": 545, "prima/events": 546, "prima/lib/domeventor": 550}],
  73: [function (t, e, i) {
    "use strict";
    var s, o = t("prima/component"), n = t("./views/header"), a = o.extend({
      name: "header",
      autoAppend: !0,
      append: function () {
        this.headerView = new n({el: this.container}), this.enableFunctionality()
      },
      enableFunctionality: function () {
        this.headerView.enableCompose()
      },
      disableSticky: function () {
        this.headerView.disableSticky()
      }
    });
    e.exports = function () {
      return s || (s = new a), s
    }
  }, {"./views/header": 78, "prima/component": 545}],
  74: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<span class="tab_notice tab-notice--outlined ', value > 0 && (__p += "tab-notice--active"), __p += '"><span class="tab_notice_value">' + (null == (__t = value) ? "" : _.escape(__t)) + "</span></span>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  75: [function (t, e, i) {
    "use strict";
    var s = t("prima/view"), o = t("app/components/account-popover"), n = t("app/components/account-tour-guide"), a = t("app/lib/currentuser"), r = t("../templates/tab-notice.tpl"), l = s.extend({
      events: {click: "openPopover"},
      addUnreadCount: function () {
        this.$el.append(r({value: this.user.getUnreadCount()}))
      },
      initialize: function () {
        this.popover = null, this.user = a(), this.addUnreadCount(), this.popoverOptions = {
          container: this.$el,
          viewOptions: {}
        }, this.user.get("seen_atg") || this.beginTourGuide()
      },
      openPopover: function (t) {
        if (t.preventDefault(), this.popover)this.popover.show(); else {
          var e = this.$el.closest(".l-header-container");
          e.length && (this.popoverOptions.viewOptions.isFixedPosition = "fixed" === e.css("position")), this.popover = new o(this.popoverOptions).render()
        }
      },
      beginTourGuide: function () {
        this.tourGuide = new n({container: this.$el}), this.tourGuide.open()
      }
    });
    e.exports = l
  }, {
    "../templates/tab-notice.tpl": 74,
    "app/components/account-popover": 3,
    "app/components/account-tour-guide": 10,
    "app/lib/currentuser": 459,
    "prima/view": 612
  }],
  76: [function (t, e, i) {
    "use strict";
    var s = t("prima/view"), o = t("prima/events"), n = t("app/components/activity-popover"), a = t("app/lib/currentuser"), r = s.extend({
      events: {click: "openPopover"},
      addUnreadCount: function () {
      },
      initialize: function () {
        this.popover = null, this.user = a(), this.addUnreadCount(), this.popoverOptions = {
          container: this.$el,
          viewOptions: {}
        }
      },
      openPopover: function (t) {
        if (t.preventDefault(), this.popover)this.popover.show(); else {
          var e = this.$el.closest(".l-header-container");
          e.length && (this.popoverOptions.viewOptions.isFixedPosition = "fixed" === e.css("position")), this.popover = new n(this.popoverOptions).render()
        }
        o.trigger("activityLinks:click", {loggingData: {source: "app-header"}})
      }
    });
    e.exports = r
  }, {"app/components/activity-popover": 13, "app/lib/currentuser": 459, "prima/events": 546, "prima/view": 612}],
  77: [function (t, e, i) {
    "use strict";
    var s = t("prima/lib/flags"), o = t("prima/view"), n = t("prima/events"), a = t("prima/mixins/accessor"), r = o.extend({
      mixins: [a],
      el: ".compose-button",
      events: {click: "toggleOpen"},
      defaults: {open: !1},
      loggingData: {source: "compose-button"},
      initialize: function () {
        this.on("change:open", this.onChangeOpen), s.bool("dashboard_refresh") ? (this.listenTo(n, "fastCompose:init:complete", this.open), this.listenTo(n, "fastCompose:dismiss:complete", this.close)) : (this.listenTo(n, "fastCompose:init:complete", this.open), this.listenTo(n, "fastCompose:dismiss:complete", this.close))
      },
      toggleOpen: function () {
        this.toggle("open")
      },
      open: function () {
        this.set("open", !0)
      },
      close: function () {
        this.set("open", !1)
      },
      onChangeOpen: function (t, e) {
        s.bool("dashboard_refresh") ? e ? n.trigger("fastCompose:init", {loggingData: this.loggingData}) : n.trigger("fastCompose:dismiss", {loggingData: this.loggingData}) : e ? n.trigger("fastCompose:init") : n.trigger("fastCompose:dismiss")
      }
    });
    e.exports = r
  }, {"prima/events": 546, "prima/lib/flags": "f/LVtH", "prima/mixins/accessor": 577, "prima/view": 612}],
  78: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("prima/views/base"), n = t("prima/lib/flags"), a = t("prima/events"), r = t("./compose_btn"), l = t("app/components/switcher"), h = t("./logo"), c = t("./account-menu"), d = t("./activity-menu"), u = t("app/components/messaging"), p = t("app/lib/currentuser"), m = o.extend({
      defaults: {
        headerHeight: 52,
        headerTop: 0
      },
      events: {"click .tab_discover > a": "onClickExplore", mouseenter: "__mouseenter", mouseleave: "__mouseleave"},
      initialize: function () {
        var t = n.bool("is_logged_in");
        this.logo = new h({el: '[prima-component="svg-logo"]'}), t && (this.accountMenu = new c({el: ".tab_nav_account"}), s(".tab_activity").length && (this.activityMenu = new d({el: ".tab_activity"})), this._initializeMessaging()), this.set("headerTop", this.$el.position().top), this.listenTo(a, "Header:hide", this.hide), this.listenTo(a, "Header:show", this.show), this.listenTo(a, "Header:setTransparent", this.setTransparent), this.$window = s(window)
      },
      enableCompose: function () {
        this.composeBtn = new r, this.switcher = new l
      },
      disableSticky: function () {
        this.$el.addClass("l-header-container--unstuck")
      },
      setTransparent: function (t) {
        this.$el.toggleClass("l-header-container--transparent", !!t)
      },
      hide: function () {
        var t = this.$window.scrollTop() + this.get("headerTop"), e = t < this.get("headerHeight") ? t : this.get("headerHeight");
        this.$el.css({position: "absolute", top: t + "px"}), this.$el.velocity({
          translateY: [-e, 0],
          translateZ: "0px"
        }, 150).velocity({translateY: "0px", translateZ: "0px", top: 0}, 0)
      },
      show: function () {
        var t = this.$window.scrollTop(), e = t < this.get("headerHeight") ? t : this.get("headerHeight");
        this.$el.css({
          position: "absolute",
          top: t + "px",
          transform: "translateY(" + -e + "px) translateZ(0)"
        }), this.$el.velocity({translateY: [0, -e], translateZ: "0px"}, 150).css({
          position: "fixed",
          top: this.get("headerTop")
        })
      },
      onClickExplore: function () {
        a.trigger("explore-links:click", {loggingData: {source: "app-header"}})
      },
      _initializeMessaging: function () {
        var t = p(), e = this.$(".tab_messaging"), i = n.bool("is_logged_in") && e.length > 0 && t.canMessage();
        i ? this.messaging = new u({
          inboxAnchorEl: e,
          inboxPopoverOptions: {isFixedPosition: "fixed" === this.$el.css("position")}
        }).render() : e.length && e.hide()
      },
      __mouseenter: function () {
        a.trigger("Header:mouseenter")
      },
      __mouseleave: function () {
        a.trigger("Header:mouseleave")
      }
    });
    e.exports = m
  }, {
    "./account-menu": 75,
    "./activity-menu": 76,
    "./compose_btn": 77,
    "./logo": 79,
    "app/components/messaging": 100,
    "app/components/switcher": 389,
    "app/lib/currentuser": 459,
    jquery: "HlZQrA",
    "prima/events": 546,
    "prima/lib/flags": "f/LVtH",
    "prima/views/base": 613
  }],
  79: [function (t, e, i) {
    "use strict";
    var s = t("prima/views/base"), o = t("prima/lib/data"), n = t("lodash"), a = s.extend({
      events: {mouseleave: "onMouseLeave"},
      defaults: {totalImages: 10, changeOnHover: !0, image: !1},
      initialize: function () {
        this.$rolloverImage = this.$("#rollover-image"), this.generateImageIds(), this.get("image") || this.applyRandomImage(), this.setBackgroundImage(this.get("image")), this.listenTo(this, "change:image", function (t, e) {
          this.setBackgroundImage(e)
        })
      },
      generateImageIds: function () {
        this.imageIds = n.shuffle(n.range(1, this.get("totalImages") + 1))
      },
      onMouseLeave: function (t) {
        this.get("changeOnHover") && this.applyRandomImage()
      },
      applyRandomImage: function () {
        0 === this.imageIds.length && this.generateImageIds(), this.set("image", this.imageIds[0]), this.imageIds.shift()
      },
      setBackgroundImage: function (t) {
        var e = o.get("Context/hosts/assets_host"), i = e + "/images/logo/hover-animations/" + t + ".gif";
        this.$rolloverImage.attr("xlink:href", i)
      }
    });
    e.exports = a
  }, {lodash: "MicNly", "prima/lib/data": 548, "prima/views/base": 613}],
  80: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("backbone"), n = t("prima/component"), a = t("app/lib/currentuser"), r = t("./views/messaging-share-post-popover"), l = t("app/components/messaging/collections/compose-recipients"), h = new l, c = n.extend({
      name: "MessagingSharePost",
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "blogUuid", "postId", "pinnedTarget", "popoverContainer")), this.user = a(), this.channels = this._getChannelsEnabledForMessagingAsCollection()
      },
      render: function () {
        return s.isEmpty(this.blogUuid) || s.isEmpty(this.postId) || s.isEmpty(this.pinnedTarget) || this.openPopover(this.postId, this.blogUuid, this.pinnedTarget, this.popoverContainer), this
      },
      openPopover: function (t, e, i, o) {
        var n = this.channels, a = {
          viewOptions: s.bind(function (i) {
            return {shareData: {blogUuid: e, postId: t}, popoverContainer: i.el, favoritesCollection: h, channels: n}
          }, this), autoTeardown: !0, pinnedSide: "bottom", isFixedPosition: !1, pinnedTarget: i, popoverContainer: o
        }, l = new r(a);
        return l.render(), l
      },
      _getChannelsEnabledForMessagingAsCollection: function () {
        return new o.Collection(this.user.getChannelsEnabledForMessaging())
      }
    });
    e.exports = c
  }, {
    "./views/messaging-share-post-popover": 88,
    "app/components/messaging/collections/compose-recipients": 94,
    "app/lib/currentuser": 459,
    backbone: "5kFNoY",
    lodash: "MicNly",
    "prima/component": 545
  }],
  81: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="searchView"></div><div class="messaging-share-post-main"><div class="messaging-share-post-results-wrapper" data-js-result-wrapper><div data-subview="errorView"></div><div data-subview="resultsView"></div><div data-subview="favoritesView"></div><div data-subview="favoritesLoaderView"></div></div><div data-subview="loader"></div></div><div data-js-submission class="messaging-share-post-submission"><div data-subview="messageView"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  82: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "" + (null == (__t = _("These flavors are too bold.")) ? "" : _.escape(__t));
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  83: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<a href="#" data-js-selectable data-js-theme-accent-color-on-grey><div class="avatar" data-js-theme-avatar-shape-class><img src="' + (null == (__t = avatarUrl) ? "" : _.escape(__t)) + '" alt="' + (null == (__t = name) ? "" : _.escape(__t)) + '" title="' + (null == (__t = name) ? "" : _.escape(__t)) + '"></div><div class="name">' + (null == (__t = name) ? "" : _.escape(__t)) + '</div><div class="title">', __p += _.isEmpty(title) ? "&nbsp;" : "" + (null == (__t = title) ? "" : _.escape(__t)), __p += "</div></a>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  84: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="resultView[]"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  85: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<h2 class="search-input-header">' + (null == (__t = _("Message to")) ? "" : _.escape(__t)) + '</h2><div class="search-input-wrapper" data-js-search-container><div class="search-input-container"><input type="text" class="search-input" data-js-input></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  86: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("prima/events"), a = t("prima/mixins/selectorcache"), r = t("prima/views/base"), l = t("components/loader"), h = t("../templates/index.tpl"), c = t("components/knight-rider-loader"), d = t("./messaging-share-post-search"), u = t("./messaging-share-post-results"), p = t("./messaging-share-post-error"), m = t("app/components/messaging/models/conversation"), g = t("app/components/messaging/views/conversation/conversation-theme"), _ = t("app/components/messaging/views/conversation/conversation-compose"), f = t("app/components/messaging/collections/compose-recipients"), v = r.extend({
      className: "messaging-share-post",
      template: h,
      defaults: {
        selectedBlog: null,
        senderBlog: null,
        isSending: !1,
        isLoading: !1,
        isLoadingFavorites: !1,
        isDisabled: !1,
        isEmpty: !1,
        isShowFavorites: !0,
        showLoadingAfterMs: 250,
        searchQuery: null,
        numFavorites: 20
      },
      mixins: [a],
      subviews: {
        searchView: {
          constructor: d, options: function (t) {
            return {collection: t.collection}
          }
        },
        resultsView: {
          constructor: u, options: function (t) {
            return {collection: t.collection}
          }
        },
        favoritesView: {
          constructor: u, options: function (t) {
            return {collection: t.favoritesCollection}
          }
        },
        messageView: {
          constructor: _, options: function (t) {
            return {
              showBlogSelector: !0,
              isAutoValidationEnabled: !1,
              className: "messaging-share-post-message",
              defaultPlaceholder: o("Say something if you like..."),
              isCyclePlaceholder: !1,
              channels: t.channels,
              popoverContainer: t.popoverContainer
            }
          }
        },
        errorView: {constructor: p},
        favoritesLoaderView: {constructor: c, options: {variation: "small centered", loading: !1}}
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "favoritesCollection", "shareData", "channels", "popoverContainer")), this.set("senderBlog", this.channels.first()), this.collection = new f, this._onSearchInputDebounced = s.bind(s.debounce(this._onSearchInput, 250), this)
      },
      afterRenderSubviews: function () {
        this.loader = new l({
          $container: this.$el,
          type: "bar",
          classModifiers: "top",
          loading: !1
        }), this.conversationTheme = new g({
          removeDataAttrAfterApplyingTheme: !1,
          el: this.messageView.el
        }), this.listenTo(this.resultsView, "selected", this._onResultsBlogSelected), this.listenTo(this.favoritesView, "selected", this._onFavoritesBlogSelected), this.listenTo(this, "change:selectedBlog", this._onChangeSelectedBlog), this.listenTo(this, "change:isSending", this._onChangeIsSending), this.listenTo(this, "change:isDisabled", this._onChangeIsDisabled), this.listenTo(this, "change:isLoading", this._onChangeIsLoading), this.listenTo(this, "change:isLoadingFavorites", this._onChangeisLoadingFavorites), this.listenTo(this, "change:isEmpty", this._onChangeIsEmpty), this.listenTo(this, "change:isShowFavorites", this._onChangeIsShowFavorites), this.listenTo(this, "change:searchQuery", this._onChangeSearchQuery), this.listenTo(this.messageView, "change:currentTumblelog", this._onBlogSelectorChange), this.listenTo(this.messageView, "submit", this._onMessageSubmit), this.listenTo(this.searchView, "search", this._onSearchInputDebounced), this._setViewStates(), this._fetchFavorites()
      },
      fetchByQuery: function (t) {
        return s.isEmpty(t) ? (this.set({
          isEmpty: !1,
          isShowFavorites: !0
        }), void this.js$("result-wrapper").scrollLeft(0)) : (this.set("isLoading", !0), void this.collection.fetchByQuery(t, this.get("senderBlog").get("uuid")).always(s.bind(function () {
          this.rendered && this.set({isLoading: !1, isEmpty: 0 === this.collection.length, isShowFavorites: !1})
        }, this)))
      },
      sendPost: function (t) {
        var e = this.shareData, i = this.get("senderBlog"), o = this.get("selectedBlog");
        if (!(this.get("isDisabled") || this.get("isSending") || s.isEmpty(e) || s.isEmpty(i) || s.isEmpty(o))) {
          var n, a = i.toJSON(), r = o.toJSON(), l = new m({
            participant: a,
            participants: [a, r]
          }), h = l.createPostMessage(s.get(this.shareData, "postId"), s.get(this.shareData, "blogUuid"));
          this.set("isSending", !0), l.sendMessage(h).then(s.bind(function () {
            s.isEmpty(t) ? this._afterSendPostComplete(l) : (n = l.createTextMessage(t), l.sendMessage(n).always(s.bind(function () {
              this._afterSendPostComplete(l)
            }, this)))
          }, this)).fail(s.bind(function () {
            this.set("isSending", !1)
          }, this))
        }
      },
      _afterSendPostComplete: function (t) {
        n.trigger("messaging:conversation:open:model", t), this.trigger("sent", t), this.rendered && this.set("isSending", !1)
      },
      _applyTheme: function (t) {
        this.conversationTheme.setTheme(t)
      },
      _setViewStates: function () {
        var t = this.get("selectedBlog"), e = !s.isEmpty(t), i = this.get("isEmpty"), o = this.get("isShowFavorites"), n = this.get("isLoadingFavorites");
        this.js$("submission").toggleClass("show-submission", e), this.errorView.$el.toggle(i), this.resultsView.$el.toggle(!i && !o), this.favoritesView.$el.toggle(!i && o), this.searchView.toggleSearch(!e), this.favoritesLoaderView.set("loading", n), e && this.messageView.focus()
      },
      _onChangeSearchQuery: function (t, e) {
        this.fetchByQuery(e)
      },
      _onSearchInput: function (t) {
        this.set("searchQuery", t)
      },
      _onChangeSelectedBlog: function (t, e) {
        s.isEmpty(e) || (this.set({
          searchQuery: null,
          isShowFavorites: !0
        }), this._applyTheme(e.get("theme"))), this._setViewStates(), this._setDisabledState()
      },
      _setButtonState: function () {
        var t = this.get("isSending"), e = this.get("isDisabled"), i = t || e;
        this.messageView.set("isDisabled", i)
      },
      _setDisabledState: function () {
        var t = this.get("selectedBlog"), e = this.get("senderBlog"), i = !s.isEmpty(t) && t.get("uuid") === e.get("uuid");
        this.set("isDisabled", i)
      },
      _onChangeIsSending: function (t, e) {
        this._setButtonState()
      },
      _onChangeIsDisabled: function (t, e) {
        this._setButtonState()
      },
      _onResultsBlogSelected: function (t) {
        this.set("selectedBlog", t), s.isEmpty(t) || (this.favoritesCollection.remove(t.id), this.favoritesCollection.unshift(t)), this.favoritesView.selectModel(t)
      },
      _onFavoritesBlogSelected: function (t) {
        this.set("selectedBlog", t), this.resultsView.selectModel(t)
      },
      _onChangeIsEmpty: function () {
        this._setViewStates()
      },
      _onChangeIsShowFavorites: function () {
        this._setViewStates()
      },
      _onBlogSelectorChange: function (t, e) {
        this.set("senderBlog", e), this.messageView.focus(), this._setDisabledState()
      },
      _onChangeIsLoading: function (t, e) {
        return this._loaderTimeout && (clearTimeout(this._loaderTimeout), this._loaderTimeout = null), e ? void(this._loaderTimeout = setTimeout(s.bind(function () {
          this.loader.set("loading", !0)
        }, this), this.get("showLoadingAfterMs"))) : this.loader.set("loading", !1)
      },
      _onChangeisLoadingFavorites: function () {
        this._setViewStates()
      },
      _onMessageSubmit: function (t) {
        this.sendPost(t)
      },
      _fetchFavorites: function () {
        this.set("isLoadingFavorites", !0), this.favoritesCollection.fetchFavorites(this.get("numFavorites")).always(s.bind(function () {
          this.rendered && this.set("isLoadingFavorites", !1)
        }, this))
      }
    });
    e.exports = v
  }, {
    "../templates/index.tpl": 81,
    "./messaging-share-post-error": 87,
    "./messaging-share-post-results": 90,
    "./messaging-share-post-search": 91,
    "app/components/messaging/collections/compose-recipients": 94,
    "app/components/messaging/models/conversation": 120,
    "app/components/messaging/views/conversation/conversation-compose": 156,
    "app/components/messaging/views/conversation/conversation-theme": 168,
    "components/knight-rider-loader": 496,
    "components/loader": 499,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/translate": 575,
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  87: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../templates/messaging-share-post-error.tpl"), a = o.extend({
      className: "messaging-share-post-error",
      template: n,
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults)))
      }
    });
    e.exports = a
  }, {"../templates/messaging-share-post-error.tpl": 82, lodash: "MicNly", "prima/views/base": 613}],
  88: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/views/base"), a = t("prima/mixins/popoverbase"), r = t("./index"), l = n.extend({
      className: "popover--messaging-share-post popover popover_menu popover_gradient",
      mixins: [a],
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "viewOptions"))
      },
      render: function () {
        var t = s.isFunction(this.viewOptions) ? this.viewOptions.call(this, this) : this.viewOptions;
        return this.$wrapper = o("<div />").addClass("popover-inner popover_inner").appendTo(this.$el), this.$pinned.addClass("active"), this.sharePostView && (this.stopListening(this.sharePostView), this.sharePostView.remove()), this.sharePostView = new r(t), this.listenTo(this.sharePostView, "sent", this.teardown), this.$wrapper.html(this.sharePostView.render().$el), this
      },
      teardown: function () {
        return this.sharePostView && this.sharePostView.remove(), this.$el.remove(), this
      }
    });
    e.exports = l
  }, {"./index": 86, jquery: "HlZQrA", lodash: "MicNly", "prima/mixins/popoverbase": 583, "prima/views/base": 613}],
  89: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../templates/messaging-share-post-result.tpl"), a = t("app/components/messaging/views/conversation/conversation-theme"), r = o.extend({
      className: "messaging-share-post-result",
      events: {"click [data-js-selectable]": "_onSelect"},
      defaults: {isSelected: !1, selectedClass: "is-selected"},
      template: n,
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "onSelectView", "onSelectModel"))
      },
      afterRender: function () {
        this.listenTo(this, "change:isSelected", this._onChangeIsSelected), this.conversationTheme = new a({
          theme: this.model.get("theme"),
          el: this.el
        }).render()
      },
      getTemplateData: function () {
        return {
          name: this.model.get("name"),
          title: this.model.get("title"),
          avatarUrl: this.model.getAvatarUrl(),
          avatarShape: this.model.getAvatarShape()
        }
      },
      setSelected: function (t) {
        this.set("isSelected", t)
      },
      _onSelect: function (t) {
        t.preventDefault(), s.isFunction(this.onSelectModel) && this.onSelectModel(this.model), s.isFunction(this.onSelectView) && this.onSelectView(this)
      },
      _onChangeIsSelected: function (t, e) {
        this.$el.toggleClass(this.get("selectedClass"), e)
      }
    });
    e.exports = r
  }, {
    "../templates/messaging-share-post-result.tpl": 83,
    "app/components/messaging/views/conversation/conversation-theme": 168,
    lodash: "MicNly",
    "prima/views/base": 613
  }],
  90: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("app/components/messaging/views/base/collection-base-view"), n = t("./messaging-share-post-result"), a = t("../templates/messaging-share-post-results.tpl"), r = o.extend({
      className: "messaging-share-post-results",
      template: a,
      defaults: {selectedUuid: null},
      subviews: {
        resultView: {
          constructor: n, options: function (t) {
            return {onSelectModel: s.bind(t._onSubviewSelectModel, t)}
          }, collection: function (t) {
            return t.collection
          }
        }
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "collection"))
      },
      afterRender: function () {
        this.listenTo(this.collection, "reset update", this._onCollectionChange), this.listenTo(this, "change:selectedUuid", this._onChangeSelectedUuid), this._onChangeSelectedUuid(this, this.get("selectedUuid"))
      },
      selectModel: function (t) {
        this.set("selectedUuid", t ? t.get("uuid") : null)
      },
      _selectViewByUuid: function (t) {
        var e;
        return s.each(this.resultView, function (i) {
          var s = i.model.get("uuid") === t;
          i.set("isSelected", s), s && (e = i)
        }, this), e
      },
      _onSubviewSelectModel: function (t) {
        var e = t.get("uuid") !== this.get("selectedUuid") ? t : null;
        this.trigger("selected", e), this.selectModel(e)
      },
      _onChangeSelectedUuid: function (t, e) {
        this._selectViewByUuid(e)
      },
      _onCollectionChange: function () {
        s.defer(s.bind(function () {
          this._selectViewByUuid(this.get("selectedUuid"))
        }, this))
      }
    });
    e.exports = r
  }, {
    "../templates/messaging-share-post-results.tpl": 84,
    "./messaging-share-post-result": 89,
    "app/components/messaging/views/base/collection-base-view": 152,
    lodash: "MicNly"
  }],
  91: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/lib/translate"), a = t("prima/views/base"), r = t("prima/mixins/selectorcache"), l = t("../templates/messaging-share-post-search.tpl"), h = a.extend({
      className: "messaging-share-post-search",
      template: l,
      mixins: [r],
      events: {
        "input [data-js-input]": "_onInputChange",
        "focus [data-js-input]": "_onInputFocus",
        "blur [data-js-input]": "_onInputBlur",
        click: "_onContainerClick"
      },
      defaults: {
        placeholder: null,
        hideHeader: !1,
        hideSearch: !1,
        searchQuery: null,
        hideHeaderClass: "hide-header",
        hideSearchClass: "hide-search"
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults)))
      },
      afterRender: function () {
        this.listenTo(this, "change:hideHeader", this._onChangeHideHeader), this.listenTo(this, "change:hideSearch", this._onChangeHideSearch), this.listenTo(this, "change:placeholder", this._onChangePlaceholder), this.listenTo(this, "change:searchQuery", this._onChangeSearchQuery), this._onChangeHideHeader(this, this.get("hideHeader")), this._onChangeHideSearch(this, this.get("hideSearch")), this._onChangePlaceholder(this, this.get("placeholder"))
      },
      focus: function () {
        this.get("hideSearch") || this.js$("input").focus()
      },
      clear: function () {
        this.set("searchQuery", null), this.js$("input").val("")
      },
      toggleSearch: function (t) {
        this.set("hideSearch", !t)
      },
      _onChangeHideHeader: function (t, e) {
        this.$el.toggleClass(this.get("hideHeaderClass"), e)
      },
      _onChangeHideSearch: function (t, e) {
        this.$el.toggleClass(this.get("hideSearchClass"), e)
      },
      _onChangePlaceholder: function (t, e) {
        this.js$("input").attr("placeholder", e || "")
      },
      _onChangeSearchQuery: function (t, e) {
        this.trigger("search", e)
      },
      _onInputChange: function (t) {
        this.set("searchQuery", o(t.currentTarget).val())
      },
      _onContainerClick: function () {
        this.focus()
      },
      _onInputFocus: function () {
        this.set({hideHeader: !0, placeholder: n("Search")})
      },
      _onInputBlur: function () {
        this.set({hideHeader: !1, placeholder: null, searchQuery: null}), this.clear()
      }
    });
    e.exports = h
  }, {
    "../templates/messaging-share-post-search.tpl": 85,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  92: [function (t, e, i) {
    "use strict";
    var s = t("prima/collection"), o = t("../models/channel-unread-count"), n = s.extend({model: o});
    e.exports = n
  }, {"../models/channel-unread-count": 117, "prima/collection": 544}],
  93: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/collection"), n = t("../models/channel"), a = o.extend({
      model: n,
      getSortedModels: function (t) {
        return this.sortBy(function (e) {
          return e.get("uuid") === t ? -1 : 0
        })
      },
      getSortedIds: function (t) {
        var e = this.getSortedModels(t);
        return s.pluck(s.invoke(e, "toJSON"), "uuid")
      }
    });
    e.exports = a
  }, {"../models/channel": 118, lodash: "MicNly", "prima/collection": 544}],
  94: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/collection"), a = t("../models/participant"), r = n.extend({
      url: "/svc/conversations/participant_suggestions", model: a, resultCache: {}, parse: function (t, e) {
        return o.get(t, "response.blogs") || t
      }, fetchByQuery: function (t, e, i) {
        return i = i || {}, o.extend(i, {data: {q: t, participant: e}}), this.fetch(i)
      }, fetchFavorites: function (t, e, i) {
        return t = t || 8, i = i || {}, o.extend(i, {data: {limit: t, participant: e}}), this.fetch(i)
      }, fetch: function (t) {
        var e = JSON.stringify(o.get(t, "data")), i = new s.Deferred, a = o.get(this.resultCache, e);
        return this.cancelFetch(), a ? (this.set(a), i.resolve(), i) : (this._request = n.prototype.fetch.apply(this, arguments), this._request.then(o.bind(function (t) {
          o.set(this.resultCache, e, this.parse(t))
        }, this)).always(o.bind(function () {
          this._request = null
        }, this)), this._request)
      }, cancelFetch: function () {
        this._request && (this._request.abort(), this._request = null)
      }
    });
    e.exports = r
  }, {"../models/participant": 126, jquery: "HlZQrA", lodash: "MicNly", "prima/collection": 544}],
  95: [function (t, e, i) {
    "use strict";
    var s = t("prima/collection"), o = t("../models/conversation-window"), n = s.extend({model: o});
    e.exports = n
  }, {"../models/conversation-window": 119, "prima/collection": 544}],
  96: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/collection"), n = t("../mixins/paginated-fetch"), a = t("../models/conversation"), r = o.extend({
      url: "/svc/conversations",
      mixins: [n],
      model: a,
      comparator: function (t) {
        return -t.get("last_modified_ts")
      },
      _getRoot: function (t) {
        return s.has(t, "response") ? s.get(t, "response") : t
      },
      parse: function (t, e) {
        return s.get(this._getRoot(t), "conversations") || []
      },
      parsePreviousLink: function (t, e) {
        return s.get(this._getRoot(t), "_links.previous")
      },
      parseNextLink: function (t, e) {
        return s.get(this._getRoot(t), "_links.next")
      },
      fetchInbox: function (t, e) {
        e = e || {};
        var i = s.extend({}, e.data, {participant: t});
        return s.extend(e, {cache: !1, remove: !1, skipParseLinks: 0 !== this.length, data: i}), this.fetch(e)
      },
      getUnreadCount: function () {
        return s.reduce(this.models, function (t, e) {
          return e.isUnread() ? t + 1 : t
        }, 0)
      }
    });
    e.exports = r
  }, {"../mixins/paginated-fetch": 116, "../models/conversation": 120, lodash: "MicNly", "prima/collection": 544}],
  97: [function (t, e, i) {
    "use strict";
    var s = t("prima/collection"), o = t("../models/keyboard-stack-item"), n = s.extend({
      model: o,
      getByNamespace: function (t) {
        return this.filter(function (e) {
          return this._isNamespaceMatch(t, e.get("namespace"))
        }, this)
      },
      _isNamespaceMatch: function (t, e) {
        return t === e ? !0 : 0 === e.indexOf(t + ":")
      }
    });
    e.exports = n
  }, {"../models/keyboard-stack-item": 122, "prima/collection": 544}],
  98: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/collection"), n = t("../mixins/paginated-fetch"), a = t("../models/message"), r = o.extend({
      url: "/svc/conversations/messages",
      mixins: [n],
      model: a,
      comparator: function (t) {
        return t.getTimestamp()
      },
      _getRoot: function (t) {
        return s.has(t, "response") ? s.get(t, "response.messages") : t
      },
      parse: function (t, e) {
        return s.get(this._getRoot(t), "data") || []
      },
      parsePreviousLink: function (t, e) {
        return s.get(this._getRoot(t), "_links.previous")
      },
      parseNextLink: function (t, e) {
        return s.get(this._getRoot(t), "_links.next")
      },
      poll: function (t) {
        return t = t || {}, s.extend(t, {cache: !1, remove: !1, skipParseLinks: !0}), this.fetch(t)
      }
    });
    e.exports = r
  }, {"../mixins/paginated-fetch": 116, "../models/message": 125, lodash: "MicNly", "prima/collection": 544}],
  99: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/collection"), n = t("../models/participant"), a = o.extend({
      model: n,
      getSortedByChannels: function (t, e) {
        var i = this.clone(), o = e ? -1 : 1, n = t.length;
        return i.sortBy(function (e) {
          var i = s.indexOf(t, e.get("uuid")), a = i > -1, r = a ? n - i : -1;
          return o * r
        })
      },
      getWithout: function (t) {
        var e = this.clone();
        return e.filter(function (e) {
          return !s.contains(t, e.get("uuid"))
        })
      }
    });
    e.exports = a
  }, {"../models/participant": 126, lodash: "MicNly", "prima/collection": 544}],
  100: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("prima/component"), a = t("prima/events"), r = t("prima/utils/url"), l = t("app/lib/currentuser"), h = t("app/lib/block"), c = t("app/components/dialog"), d = t("app/models/tumblelog"), u = t("./lib/messaging-logger"), p = t("./lib/messaging-poller"), m = t("./lib/messaging-event-bus"), g = t("./lib/messaging-unread-manager"), _ = t("./lib/messaging-window-manager"), f = t("./lib/messaging-keyboard-manager"), v = t("./views/inbox/inbox-badge"), b = t("./views/tutorial"), y = t("./models/current-blog"), w = t("./models/participant"), x = t("./models/conversation"), C = t("./collections/conversations"), k = t("./collections/channels"), S = t("./collections/compose-recipients"), T = new m, E = {
      CONVERSATION_OPEN_TUMBLELOGS: "messaging:conversation:open:tumblelogs",
      CONVERSATION_OPEN_MODEL: "messaging:conversation:open:model"
    }, $ = n.extend({
      name: "Messaging",
      defaults: {
        isMultipleConversationPopoversEnabled: !1,
        blogNetworkQueryParameter: "conversation",
        blogNetworkQueryParameterPathWhitelist: ["/dashboard"]
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "inboxAnchorEl", "inboxPopoverOptions")), this.eventBus = T, this.user = l(), this.channels = this._getChannelsEnabledForMessagingAsCollection(), this.inboxCollection = new C, this.currentBlogModel = new y({channel: this._getInitiallySelectedChannel()}), this.favoritesCollection = new S, this.emptyInboxCollection = new S, this.unreadManager = new g({channels: this.channels}), this.inboxBadge = new v({
          el: this.inboxAnchorEl,
          channels: this.channels
        }).render(), this.messagingLogger = new u, this.keyboardManager = new f, this.windowManager = new _({
          eventBus: this.eventBus,
          user: this.user,
          channels: this.channels,
          currentBlogModel: this.currentBlogModel,
          keyboardManager: this.keyboardManager,
          inboxViewOptions: {
            favoritesCollection: this.favoritesCollection,
            emptyInboxCollection: this.emptyInboxCollection,
            appendFavoritesToInboxLimit: this.getAppendFavoritesToInboxLimit(),
            isAutoFetch: !1
          },
          inboxPopoverOptions: s.extend({
            autoTeardown: !0,
            pinnedSide: "bottom",
            isFixedPosition: !0,
            pinnedTarget: this.inboxAnchorEl
          }, this.inboxPopoverOptions),
          conversationViewOptions: {followBlogName: s.bind(this._followBlogName, this), isAutoFetch: !1}
        }), this.listenTo(a, E.CONVERSATION_OPEN_TUMBLELOGS, this._onEventBusOpenConversationUsingTumblelogModels), this.listenTo(a, E.CONVERSATION_OPEN_MODEL, this._onEventBusOpenConversationUsingModel), this.listenTo(this.eventBus, this.eventBus.CONVERSATION_OPEN_CONVERSATION_MODEL, this._onOpenConversationUsingConversationModel), this.listenTo(this.eventBus, this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS, this._onOpenConversationUsingParticipantModels), this.listenTo(this.eventBus, this.eventBus.CONVERSATION_OPEN_TUMBLR_URL, this._onConversationClickBlog), this.listenTo(this.eventBus, this.eventBus.CONVERSATION_DELETE_MODEL, this._onConversationDelete), this.listenTo(this.eventBus, this.eventBus.CONVERSATION_FETCHING, this._onConversationFetching), this.listenTo(this.eventBus, this.eventBus.BLOCK, this._onBlock), this.listenTo(this.eventBus, this.eventBus.CONVERSATION_MESSAGE_SENT, this._onConversationMessageSent), this.listenTo(this.eventBus, this.eventBus.CONVERSATION_MESSAGE_FAILED, this._onConversationMessageFailed), this.listenTo(a, "toaster:updateMessagingUnreadCounts", this._onPollUpdate), this.listenTo(this.currentBlogModel, "change", this._onCurrentBlogModelChange), this.listenTo(this.windowManager, "change", this._onWindowManagerChange), this.listenTo(this.unreadManager, "change:channel", this._onUnreadManagerChannelChange), this.listenTo(this.unreadManager, "change:conversation", this._onUnreadManagerConversationChange), this.listenTo(this.windowManager, "inbox:added", this._onWindowManagerInboxAdded), this.listenTo(this.windowManager, "inbox:removed", this._onWindowManagerInboxRemoved), this.listenTo(this.windowManager, "conversation:added", this._onWindowManagerConversationAdded), this.listenTo(this.windowManager, "conversation:removed", this._onWindowManagerConversationRemoved), this.messagingPoller = new p({
          channels: this.channels,
          user: this.user,
          callback: s.bind(this._onPollUpdate, this),
          frequency: this.getPollingFrequencyInbox()
        }), this.hasTutorial() && this.openTutorialPopover(), this._onWindowManagerChange(this.windowManager), this._processMessagingQuery()
      },
      render: function () {
        this.inboxAnchorEl && this.inboxAnchorEl.on("click.messaging", s.bind(this._onClickInboxAnchor, this))
      },
      openInboxPopover: function () {
        this.windowManager.addInbox(this.inboxCollection), this.tutorialPopover && this.tutorialPopover.hideTutorial()
      },
      openConversationPopover: function (t, e) {
        var i;
        return s.isEmpty(t.get("participant").get("uuid")) && t.set("participant", t.get("participants").get(this.getCurrentChannel().get("uuid"))), i = this.windowManager.getOpenConversationPopover(t), this.windowManager.removeInbox(this.inboxCollection), i ? (i.poll(), void s.defer(function () {
          i.focus()
        })) : (this.get("isMultipleConversationPopoversEnabled") || this.windowManager.removeConversations(), this.windowManager.addConversation(t, {context: e}), void(this.tutorialPopover && this.tutorialPopover.hideTutorial()))
      },
      openTutorialPopover: function () {
        return this.tutorialPopover ? void 0 : (this.tutorialPopover = new b({
          eventBus: this.eventBus,
          viewOptions: {
            title: o("You've got messaging!"),
            content: o("Yup, messaging. Real, threaded, instant messaging. Message other Tumblrs and they'll get messaging too."),
            ok_text: o("Send a real message"),
            pinnedTarget: this.inboxAnchorEl,
            fixed_position: s.get(this.inboxPopoverOptions, "isFixedPosition", !0)
          }
        }), this.listenToOnce(this.tutorialPopover, "dismiss", s.bind(function () {
          s.delay(s.bind(function () {
            this.openInboxPopover()
          }, this), 250)
        }, this)), this.listenToOnce(this.tutorialPopover, "hide", s.bind(function () {
          this.stopListening(this.tutorialPopover), this.tutorialPopover = null
        }, this)), this.tutorialPopover.render(), this.tutorialPopover)
      },
      fetchInbox: function () {
        var t = this.getCurrentBlogId();
        if (this._pendingInboxRequest && this._pendingInboxBlog) {
          if (t === this._pendingInboxBlog)return;
          this._pendingInboxRequest.abort()
        }
        this._pendingInboxBlog = t, this._pendingInboxRequest = this.inboxCollection.fetchInbox(t).always(s.bind(function () {
          this._pendingInboxRequest = null, this._pendingInboxBlog = null
        }, this))
      },
      getCurrentChannel: function () {
        return this.currentBlogModel.getChannel()
      },
      getCurrentBlogId: function () {
        return this.currentBlogModel.getId()
      },
      getPollingFrequencyInbox: function () {
        return s.get(this.data, "polling_frequency_inbox")
      },
      getPollingFrequencyConversation: function () {
        return s.get(this.data, "polling_frequency_conversation")
      },
      hasTutorial: function () {
        return s.get(this.data, "has_tutorial")
      },
      getAppendFavoritesToInboxLimit: function () {
        return s.get(this.data, "append_favorites_to_inbox_limit")
      },
      _onWindowManagerInboxAdded: function (t, e) {
        this.fetchInbox(), this.messagingLogger.logInboxOpened()
      },
      _onWindowManagerInboxRemoved: function (t, e) {
        this.messagingLogger.logInboxClosed()
      },
      _onWindowManagerConversationAdded: function (t, e, i) {
        e.fetch().always(s.bind(function () {
          this.messagingLogger.logConversationOpened(t, s.get(i, "context"))
        }, this)), e.focus()
      },
      _onWindowManagerConversationRemoved: function (t, e, i) {
        this.messagingLogger.logConversationClosed(t, s.get(i, "context"))
      },
      _getChannelsEnabledForMessagingAsCollection: function () {
        return new k(s.invoke(this.user.getChannelsEnabledForMessaging(), "toJSON"))
      },
      _getInitiallySelectedChannel: function () {
        return this.channels.findWhere({is_current: !0}) || s.first(this.channels.models)
      },
      _onClickInboxAnchor: function (t) {
        t.preventDefault(), this.openInboxPopover()
      },
      _onEventBusOpenConversationUsingTumblelogModels: function (t, e) {
        this._openConversationUsingTumblelogModels(t, e)
      },
      _onEventBusOpenConversationUsingModel: function (t, e) {
        this.openConversationPopover(t, e)
      },
      _onOpenConversationUsingConversationModel: function (t, e) {
        this.openConversationPopover(t, e)
      },
      _openConversationUsingTumblelogModels: function (t, e) {
        var i = s.map(t, function (t) {
          var e = t.toJSON();
          return t.has("global_theme_params") && s.extend(e, {theme: t.get("global_theme_params")}), new w(e)
        });
        this._onOpenConversationUsingParticipantModels(i, e)
      },
      _onOpenConversationUsingParticipantModels: function (t, e) {
        var i = new w(this.getCurrentChannel().toJSON()), s = new x({participants: [i].concat(t), participant: i});
        this.openConversationPopover(s, e)
      },
      _onPollUpdate: function (t, e) {
        this.unreadManager.setData(s.get(t, "unread_messages"))
      },
      _onConversationClickBlog: function (t) {
        t = t || {}, t.originalEvent && t.originalEvent.preventDefault(), a.trigger("peepr-open-request", {
          url: t.url,
          tumblelog_name: t.blogName,
          post_id: t.postId
        })
      },
      _onBlock: function (t, e) {
        s.isEmpty(t) || h.confirmBlock(t).then(s.bind(function () {
          h.block(t).then(s.bind(function () {
            this._onBlockSuccess(t, e)
          }, this))
        }, this))
      },
      _onBlockSuccess: function (t, e) {
        s.isEmpty(t) || (e && (this.windowManager.removeConversation(e), this.inboxCollection.remove(e)), a.trigger("blocks:block_added", {loggingData: {from: "messaging"}}), this.messagingLogger.logBlock(t))
      },
      _copyCollectionData: function (t, e) {
        e.reset(t.models), e.setNextLink(t.getNextLink())
      },
      _onCurrentBlogModelChange: function () {
        var t = this.currentBlogModel.getPrevChannel(), e = this.currentBlogModel.getChannel();
        t && this._copyCollectionData(this.inboxCollection, t.get("conversations")), e && this._copyCollectionData(e.get("conversations"), this.inboxCollection), this.fetchInbox()
      },
      _onConversationDelete: function (t) {
        c.confirm(o("Permanently delete this conversation?"), s.bind(function () {
          this.messagingLogger.logConversationDeleted(t), t.destroy(), this.windowManager.removeConversation(t), this.inboxCollection.remove(t.get("id"))
        }, this), null, o("Delete"), o("Nevermind"))
      },
      _onConversationFetching: function (t) {
        this.unreadManager.setConversationModelCount(t, 0)
      },
      _onUnreadManagerChannelChange: function (t, e) {
        var i = this.getCurrentChannel(), o = s.sum(e);
        this.windowManager.get("isInboxOpen") && i === t && this.fetchInbox(), t.set("unread_messages_count_sum", o)
      },
      _onUnreadManagerConversationChange: function (t, e, i) {
        var s;
        this.windowManager.get("isConversationOpen") && (s = this.windowManager.getOpenConversationModelByIdAndParticipant(t, i.get("uuid")), s && s.set("unreadCount", e))
      },
      _onWindowManagerChange: function (t) {
        var e, i = t.get("isInboxOpen"), s = t.get("isConversationOpen");
        return i || s ? (e = s ? this.getPollingFrequencyConversation() : this.getPollingFrequencyInbox(), this.messagingPoller.set("frequency", e), void this.messagingPoller.start()) : void this.messagingPoller.stop()
      },
      _onConversationMessageSent: function (t, e) {
        this.messagingLogger.logMessageSent(t, e)
      },
      _onConversationMessageFailed: function (t, e) {
        this.messagingLogger.logMessageFailed(t, e)
      },
      _followBlogName: function (t) {
        var e = {source: "FOLLOW_SOURCE_MESSAGING"}, i = new d({name: t});
        return i.save_following({following: !0}, e).then(s.bind(function () {
          this.messagingLogger.logFollow(t)
        }, this))
      },
      _getRecipientURLParam: function () {
        return r.getParameter(this.get("blogNetworkQueryParameter"))
      },
      _removeRecipientURLParam: function () {
        var t, e = window.location, i = this.get("blogNetworkQueryParameter"), o = r.parseUrl(e), n = s.get(o, "query"), a = s.get(o, "path", "");
        s.isEmpty(n) || (t = r.getQueryStringHash(n), !s.isEmpty(t) && s.has(t, i) && (delete t[i], history.replaceState({}, null, r.buildUrl(a, t))))
      },
      _openConversationFromBlogName: function (t, e) {
        var i = new d({name: t});
        return i.fetch_popover_data().then(s.bind(function () {
          return s.isEmpty(i.get("uuid")) ? void 0 : this._openConversationUsingTumblelogModels([i], e)
        }, this))
      },
      _processMessagingQuery: function () {
        var t = window.location, e = r.parseUrl(t), i = e.path;
        if (s.contains(this.get("blogNetworkQueryParameterPathWhitelist"), i)) {
          var o = this._getRecipientURLParam();
          s.isEmpty(o) || (this._removeRecipientURLParam(), this._openConversationFromBlogName(o, "blog-network"))
        }
      }
    });
    e.exports = $
  }, {
    "./collections/channels": 93,
    "./collections/compose-recipients": 94,
    "./collections/conversations": 96,
    "./lib/messaging-event-bus": 108,
    "./lib/messaging-keyboard-manager": 109,
    "./lib/messaging-logger": 110,
    "./lib/messaging-poller": 111,
    "./lib/messaging-unread-manager": 112,
    "./lib/messaging-window-manager": 113,
    "./models/conversation": 120,
    "./models/current-blog": 121,
    "./models/participant": 126,
    "./views/inbox/inbox-badge": 170,
    "./views/tutorial": 183,
    "app/components/dialog": 44,
    "app/lib/block": 457,
    "app/lib/currentuser": 459,
    "app/models/tumblelog": 463,
    lodash: "MicNly",
    "prima/component": 545,
    "prima/events": 546,
    "prima/lib/translate": 575,
    "prima/utils/url": 611
  }],
  101: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/component"), n = t("../collections/keyboard-stack"), a = o.extend({
      name: "BaseKeyboardManager",
      defaults: {isDebugEnabled: !1, keepInactiveItems: !0},
      collection: new n,
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), this.listenTo(this.collection, "add", this._onAddItem), this.listenTo(this.collection, "remove", this._onRemoveItem), this.listenTo(this.collection, "change:isActive", this._onItemActiveChange)
      },
      addKeyboardAccess: s.noop,
      removeKeyboardAccess: s.noop,
      add: function (t, e) {
        return t && e ? this.collection.get(t) ? !1 : (this.get("keepInactiveElements") || this.collection.reset(), this.collection.unshift({
          namespace: t,
          view: e
        }), this._adjustActiveStates(), !0) : !1
      },
      remove: function (t) {
        var e = this.collection.getByNamespace(t);
        return s.isEmpty(e) ? !1 : (this.collection.remove(e), this._adjustActiveStates(), !0)
      },
      toggle: function (t, e, i) {
        return i ? this.add(t, e) : this.remove(t)
      },
      _onAddItem: function (t) {
        return this.addKeyboardAccess(t.get("view"))
      },
      _onRemoveItem: function (t) {
        return this.removeKeyboardAccess(t.get("view"))
      },
      _adjustActiveStates: function () {
        var t, e;
        0 !== this.collection.length && (t = this.collection.first(), e = this.collection.rest(), t && t.set("isActive", !0), s.each(e, function (t) {
          t.set("isActive", !1)
        }, this))
      },
      _onItemActiveChange: function (t, e) {
        return e ? this.addKeyboardAccess(t.get("view")) : this.removeKeyboardAccess(t.get("view"))
      }
    });
    e.exports = a
  }, {"../collections/keyboard-stack": 97, lodash: "MicNly", "prima/component": 545}],
  102: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/component"), a = n.extend({
      name: "BasePoller",
      defaults: {
        url: null,
        requestType: "GET",
        dataType: "JSON",
        cache: !1,
        frequency: 6e4,
        stopAfterNumErrors: 3,
        isPolling: !1
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "callback")), this.currentErrorCount = 0
      },
      start: function (t) {
        this.set("isPolling", !0), t ? this._scheduleNextPoll() : this.poll()
      },
      stop: function () {
        this.set("isPolling", !1), this.cancel()
      },
      cancel: function () {
        this.cancelCurrent(), this.cancelNext()
      },
      cancelCurrent: function () {
        this._currentRequest && (s.result(this._currentRequest, "abort"), this._currentRequest = null)
      },
      cancelNext: function () {
        this._nextPollToken && (clearTimeout(this._nextPollToken), this._nextPollToken = null)
      },
      beforeRemove: function () {
        this.stop()
      },
      poll: function () {
        this.cancel(), this._lastPollTime = (new Date).getTime();
        var t = this.makeRequest.call(this);
        return t.done(s.bind(this._onRequestSuccess, this)).fail(s.bind(this._onRequestFail, this)).always(s.bind(this._scheduleNextPoll, this)), this._currentRequest = t, t
      },
      getRequestData: function () {
        return {}
      },
      resetErrorCount: function () {
        this.currentErrorCount = 0, this.start()
      },
      parse: function (t) {
        return t
      },
      makeRequest: function () {
        var t = this.getRequestData(), e = {
          url: this.get("url"),
          type: this.get("requestType"),
          dataType: this.get("dataType"),
          cache: this.get("cache"),
          data: t
        };
        return o.ajax(e)
      },
      _onRequestSuccess: function (t) {
        this.currentErrorCount = 0, this.callback && this.callback(this.parse(t), this._lastPollTime)
      },
      _onRequestFail: function () {
        this.currentErrorCount++
      },
      _scheduleNextPoll: function () {
        var t = this.get("frequency");
        return this.get("isPolling") ? void(!s.isFinite(t) || 0 >= t || (this.currentErrorCount <= this.get("stopAfterNumErrors") ? this._nextPollToken = setTimeout(s.bind(this.poll, this), t) : this.stop())) : !1
      }
    });
    e.exports = a
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/component": 545}],
  103: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("app/lib/scrollbar"), n = o.extend({
      defaults: s.defaults({
        isDisabled: !1,
        isAtTop: !1,
        isAtBottom: !1,
        topThreshold: 50,
        bottomThreshold: 50,
        isInitialized: !1
      }, o.prototype.defaults), initialize: function (t) {
        return this.options = t || {}, o.prototype.initialize.call(this, this.options.el, this.options)
      }, render: function () {
        return s.extend(this.attributes, s.pick(this.options, s.keys(this.defaults))), this.listenTo(this, "change:isAtTop", this._changeIsAtTop), this.listenTo(this, "change:isAtBottom", this._changeIsAtBottom), this.listenToOnce(this, "change:scrolling", function () {
          this.set("isInitialized", !0)
        }), this
      }, stealScroll: function (t) {
        return this.get("isDisabled") ? (t.preventDefault(), void t.stopPropagation()) : o.prototype.stealScroll.apply(this, arguments)
      }, update: function () {
        return this._updateInfiniteScrollFlags(), o.prototype.update.apply(this, arguments)
      }, onScrollStop: function () {
        return this._updateInfiniteScrollFlags(), o.prototype.onScrollStop.apply(this, arguments)
      }, getCurrentPositions: function () {
        return {height: this._currentHeight, scrollBottom: this._currentScrollBottom, scrollTop: this._currentScrollTop}
      }, isAtTop: function () {
        return this.get("isAtTop")
      }, isAtBottom: function () {
        return this.get("isAtBottom")
      }, _isAtTop: function (t) {
        return this._currentScrollTop <= t && this._currentHeight > t
      }, _isAtBottom: function (t) {
        return this._currentScrollBottom <= t && this._currentHeight > t
      }, setDisabled: function (t) {
        this.set("isDisabled", t)
      }, _setCurrentPositions: function () {
        this._currentHeight = this.container.clientHeight, this._currentScrollBottom = this.container.scrollHeight - this.container.scrollTop - this.container.clientHeight, this._currentScrollTop = this.container.scrollTop
      }, _updateInfiniteScrollFlags: function () {
        return !this.destroyed && this.container && this.get("isInitialized") ? (this._setCurrentPositions(), void this.set({
          isAtTop: this._isAtTop(this.get("topThreshold")),
          isAtBottom: this._isAtBottom(this.get("bottomThreshold"))
        })) : !1
      }, _changeIsAtTop: function (t, e) {
        this.trigger("scrolltop", e)
      }, _changeIsAtBottom: function (t, e) {
        this.trigger("scrollbottom", e)
      }
    });
    e.exports = n
  }, {"app/lib/scrollbar": 460, lodash: "MicNly"}],
  104: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/class"), n = o.extend({
      name: "unknown",
      formatters: {},
      constructor: function (t) {
        this.options = t || {}, s.isFunction(this.formatters) ? this.formatters = this.formatters() : this.formatters = s.clone(this.formatters || {})
      },
      registerFormatter: function (t, e) {
        this.formatters[t] = e
      },
      getFormatter: function (t) {
        return s.result(this.formatters, t)
      },
      escape: function (t) {
        return t
      },
      applyFormatting: function (t, e) {
        return this.escape(t)
      },
      postFilter: function (t) {
        return t
      },
      render: function (t, e) {
        return this.postFilter(this.applyFormatting(t, e))
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "prima/class": 543}],
  105: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("../base"), n = t("./link"), a = o.extend({
      name: "html",
      formatters: {link: n},
      escape: function (t) {
        return s.escape(t)
      },
      applyFormatting: function (t, e) {
        var i = s.bind(this.escape, this), o = s.bind(this.getFormatter, this), n = {};
        s.forEach(e, function (t) {
          var e = o(t.type);
          if (e) {
            var i = t.position, a = t.attributes, r = i[0], l = i[1];
            s.isEmpty(n[r]) && (n[r] = []), s.isEmpty(n[l]) && (n[l] = []), n[r].push(s.bind(e.open, this, a)), n[l].unshift(s.bind(e.close, this, a))
          }
        }, this);
        var a, r, l = s.sortBy(s.keys(n), function (t) {
          return s.parseInt(t)
        }), h = "", c = 0;
        return s.forEach(l, function (e) {
          a = n[e], r = t.substr(c, e - c), h += i(r), s.forEach(a, function (t) {
            h += t()
          }), c = e
        }, this), r = t.substr(c), h += i(r)
      }
    });
    e.exports = a
  }, {"../base": 104, "./link": 106, lodash: "MicNly"}],
  106: [function (t, e, i) {
    "use strict";
    function s(t) {
      return o(t).omit(o.isUndefined).reduce(function (t, e, i) {
        return (t ? t + " " : "") + n('%s="%s"', o.escape(i), o.escape(e))
      }, "")
    }

    var o = t("lodash"), n = t("sprintf-js").sprintf, a = {
      open: function (t) {
        var e = s({"data-js-tumblelog-name": t.blog_name, "data-js-post-id": t.post_id, target: "_blank", href: t.url});
        return "<a " + e + ">"
      }, close: function (t) {
        return "</a>"
      }
    };
    e.exports = a
  }, {lodash: "MicNly", "sprintf-js": "qPOUxN"}],
  107: [function (t, e, i) {
    e.exports = {html: t("./formatters/html")}
  }, {"./formatters/html": 105}],
  108: [function (t, e, i) {
    var s = t("backbone"), o = t("lodash"), n = {
      CONVERSATION_FETCHING: "conversation:fetching",
      CONVERSATION_OPEN_CONVERSATION_MODEL: "conversation:open:model:conversation",
      CONVERSATION_OPEN_PARTICIPANT_MODELS: "conversation:open:model:partipants",
      CONVERSATION_OPEN_TUMBLR_URL: "conversation:open:tumblr:url",
      CONVERSATION_DELETE_MODEL: "conversation:delete:model",
      CONVERSATION_MESSAGE_SENT: "conversation:message:sent",
      CONVERSATION_MESSAGE_FAILED: "conversation:message:failed",
      BLOCK: "block"
    }, a = function () {
    };
    a.extend = s.Model.extend, o.extend(a.prototype, s.Events), o.extend(a.prototype, n), e.exports = a
  }, {backbone: "5kFNoY", lodash: "MicNly"}],
  109: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("./base-keyboard-manager"), n = o.extend({
      name: "MessagingKeyboardManager",
      addKeyboardAccess: function (t) {
        return s.isFunction(s.get(t, "soloKeys")) ? (t.enableKeys(), t.soloKeys(!0), !0) : !1
      },
      removeKeyboardAccess: function (t) {
        return s.isFunction(s.get(t, "unSoloKeys")) ? (t.disableKeys(), t.unSoloKeys(), !0) : !1
      }
    });
    e.exports = n
  }, {"./base-keyboard-manager": 101, lodash: "MicNly"}],
  110: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/component"), n = t("prima/events"), a = o.extend({
      name: "MessagingLogger",
      defaults: {namespace: "messaging-interaction"},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults)))
      },
      logInboxOpened: function () {
        this._logIt("inbox:open")
      },
      logInboxClosed: function () {
        this._logIt("inbox:closed")
      },
      logConversationOpened: function (t, e) {
        this._logIt("conversation:open", {conversationId: t.get("id"), context: e})
      },
      logConversationClosed: function (t, e) {
        this._logIt("conversation:closed", {conversationId: t.get("id"), context: e})
      },
      logConversationDeleted: function (t) {
        this._logIt("conversation:deleted", {conversationId: t.get("id")})
      },
      logConversationStarted: function (t, e, i) {
        this._logIt("conversation:started", {messageLength: t.get("message").length, context: i})
      },
      logMessageSent: function (t, e) {
        e.isNew() && this.logConversationStarted(t, e), this._logIt("message:sent", {
          conversationId: e.get("id"),
          messageLength: t.get("message").length
        })
      },
      logMessageFailed: function (t, e) {
        this._logIt("message:failure", {conversationId: e.get("id"), messageLength: t.get("message").length})
      },
      logFollow: function (t) {
        this._logIt("conversation:follow", {blogName: t})
      },
      logBlock: function (t) {
        this._logIt("block", {blockingBlog: t.currentTumblelog, blockedBlog: t.blockedTumblelog})
      },
      _logIt: function (t, e) {
        e = e || {}, n.trigger(this.get("namespace") + ":" + t, {loggingData: e})
      }
    });
    e.exports = a
  }, {lodash: "MicNly", "prima/component": 545, "prima/events": 546}],
  111: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("./base-poller"), n = o.extend({
      name: "MessagingPoller",
      defaults: s.defaults({url: "/services/poll", frequency: 15e3}, o.prototype.defaults),
      initialize: function (t) {
        return t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "channels", "user")), this._requestData = {
          token: this.user.get("polling_token"),
          unread_messages: !0,
          mention_keys: this.channels.pluck("mention_key").join(",")
        }, o.prototype.initialize.apply(this, arguments)
      },
      getRequestData: function () {
        return this._requestData
      }
    });
    e.exports = n
  }, {"./base-poller": 102, lodash: "MicNly"}],
  112: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/component"), n = t("../collections/channels-unread-count"), a = o.extend({
      name: "MessagingUnreadManager",
      defaults: {dataChannelKey: "mention_key", overridesExpirationInMs: 500},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "channels"));
        var e = this.channels.map(function (t) {
          return {channelId: t.get("uuid")}
        });
        this.unreadCollection = new n(e), this.unreadCollectionOverrides = new n(e), this.listenTo(this.unreadCollection, "change:data", this._onUnreadCollectionChange)
      },
      setData: function (t) {
        this._pruneOverrides(), this._updateUnreadCollection(t), this.unreadData = t
      },
      setConversationModelCount: function (t, e) {
        var i, s = t.get("id"), o = t.get("participant").get("uuid"), n = this.unreadCollectionOverrides.findWhere({channelId: o});
        n && (i = n.get("data") || {}, i[s] = e, n.set({
          data: i,
          updateDate: new Date
        }), this._updateUnreadCollection(this.unreadData))
      },
      _getOverridesData: function () {
        var t = this.get("dataChannelKey");
        return this.unreadCollectionOverrides.reduce(function (e, i) {
          var o = i.get("data"), n = this.channels.get(i.get("channelId")), a = n.get(t);
          return s.isEmpty(o) || (e[a] = o), e
        }, {}, this)
      },
      _pruneOverrides: function () {
        var t = new Date, e = this.get("overridesExpirationInMs");
        this.unreadCollectionOverrides.each(function (i) {
          var o = i.get("updateDate");
          s.isDate(o) && t - o > e && i.unset({updateDate: null, data: null})
        })
      },
      _updateUnreadCollection: function (t, e) {
        var i = this._getOverridesData();
        this.unreadCollection.each(function (e) {
          var o = this.channels.get(e.get("channelId")), n = o.get(this.get("dataChannelKey")), a = s.get(t, n), r = s.get(i, n);
          r && (a = s.merge({}, a, r)), e.set("data", a)
        }, this)
      },
      _onUnreadCollectionChange: function (t) {
        var e = t.get("data"), i = this.channels.get(t.get("channelId"));
        this.trigger("change:channel", i, e), s.each(e, function (t, e) {
          this.trigger("change:conversation", e, t, i)
        }, this)
      }
    });
    e.exports = a
  }, {"../collections/channels-unread-count": 92, lodash: "MicNly", "prima/component": 545}],
  113: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/component"), a = t("../collections/conversation-windows"), r = t("../views/inbox/inbox-popover"), l = t("../views/conversation/conversation-popover"), h = n.extend({
      name: "MessagingWindowManager",
      defaults: {
        isInboxOpen: !1,
        isConversationOpen: !1,
        inboxAnimationSpeed: 100,
        conversationAnimationSpeed: 250,
        conversationPopoversContainerClass: "messaging-conversation-popovers"
      },
      initialize: function (t) {
        t = o.extend({}, t), o.extend(this.attributes, o.pick(t, o.keys(this.defaults))), o.extend(this, o.pick(t, "eventBus", "user", "channels", "currentBlogModel", "keyboardManager", "inboxViewOptions", "inboxPopoverOptions", "conversationViewOptions", "conversationPopoverOptions")), this.openConversations = new a, this.listenTo(this.openConversations, "add remove", this._onConversationsCollectionChange)
      },
      addInbox: function (t, e) {
        return this.get("isInboxOpen") ? void 0 : (this.inboxCollection = t, this.inboxPopover = this._createInboxPopover(t), this.trigger("inbox:adding", t, this.inboxPopover, e), setTimeout(o.bind(function () {
          this._afterInboxOpened(e)
        }, this), this.get("inboxAnimationSpeed")), this.listenToOnce(this.inboxPopover, "close", function () {
          this._onInboxClose(e)
        }), this.inboxPopover)
      },
      removeInbox: function (t) {
        t === this.inboxCollection && this.inboxPopover && this.inboxPopover.teardown()
      },
      addConversation: function (t, e) {
        var i = this._createConversationPopover(t);
        return this.trigger("conversation:adding", t, i, e), setTimeout(o.bind(function () {
          this.trigger("conversation:added", t, i, e)
        }, this), this.get("conversationAnimationSpeed")), this.openConversations.add({
          model: t,
          view: i,
          options: e
        }), i
      },
      removeConversation: function (t, e) {
        var i = this._getWindowModel(t);
        return i ? this._removeConversationWindowModel(i, e) : void 0
      },
      removeConversations: function (t) {
        this.openConversations.each(function (t) {
          this._removeConversationWindowModel(t, !0)
        }, this)
      },
      getOpenConversationPopover: function (t) {
        var e = this._getWindowModel(t);
        return e ? e.get("view") : void 0
      },
      getOpenConversationModelByIdAndParticipant: function (t, e) {
        var i = this.openConversations.find(function (i) {
          var s = i.get("model");
          return s.get("id") === t && s.get("participant").get("uuid") === e
        });
        return i ? i.get("model") : void 0
      },
      _createConversationPopover: function (t) {
        var e = o.bind(function (e) {
          return o.extend({}, this.conversationViewOptions, {
            eventBus: this.eventBus,
            user: this.user,
            channels: this.channels,
            model: t,
            popoverContainer: e.el,
            keyboardManager: this.keyboardManager
          })
        }, this), i = o.extend({}, this.conversationPopoverOptions, {viewOptions: e}), s = new l(i);
        s.render(), this.listenToOnce(s.getView(), "close", function () {
          this.removeConversation(t)
        });
        var n = this._getConversationsPopoversContainer();
        return n.append(s.$el), this._removeTimer && clearTimeout(this._removeTimer), s
      },
      _createInboxPopover: function (t) {
        var e = o.bind(function (e) {
          return o.extend({}, this.inboxViewOptions, {
            eventBus: this.eventBus,
            collection: t,
            user: this.user,
            channels: this.channels,
            currentBlogModel: this.currentBlogModel,
            keyboardManager: this.keyboardManager,
            popoverContainer: e.el
          })
        }, this), i = o.extend({}, this.inboxPopoverOptions, {viewOptions: e}), s = new r(i);
        return s.render(), s
      },
      _removeConversationPopover: function (t, e) {
        this.stopListening(t.getView()), e ? t.remove() : t.teardown(), this._removeTimer && (clearTimeout(this._removeTimer), this._removeTimer = null), 0 === this.openConversations.length && (this._removeTimer = setTimeout(o.bind(function () {
          0 === this.openConversations.length && this._removeConversationPopoversContainer(), this._removeTimer = null
        }, this), this.get("conversationAnimationSpeed")))
      },
      _onConversationsCollectionChange: function () {
        this.set("isConversationOpen", this.openConversations.length > 0)
      },
      _onInboxClose: function (t) {
        this.trigger("inbox:removing", this.inboxCollection, this.inboxPopover, t),
          setTimeout(o.bind(function () {
            this._afterInboxClosed(t)
          }, this), this.get("inboxAnimationSpeed"))
      },
      _afterInboxOpened: function (t) {
        this.set("isInboxOpen", !0), this.trigger("inbox:added", this.inboxCollection, this.inboxPopover, t)
      },
      _afterInboxClosed: function (t) {
        this.set("isInboxOpen", !1), this.trigger("inbox:removed", this.inboxCollection, this.inboxPopover, t), this.inboxPopover = null, this.inboxCollection = null
      },
      _getConversationsPopoversContainer: function () {
        return this.conversationsPopoversContainer || (this.conversationsPopoversContainer = s("<div />").addClass(this.get("conversationPopoversContainerClass")).appendTo(s("body"))), this.conversationsPopoversContainer
      },
      _removeConversationPopoversContainer: function () {
        this.conversationsPopoversContainer && (this.conversationsPopoversContainer.remove(), this.conversationsPopoversContainer = null)
      },
      _getWindowModel: function (t) {
        var e = t.get("participant").get("uuid"), i = t.get("participants").pluck("uuid");
        return this.openConversations.find(function (t) {
          var s = t.get("model"), n = s.get("participant").get("uuid"), a = s.get("participants").pluck("uuid");
          return n === e && o.union(i, a).length === a.length
        })
      },
      _removeConversationWindowModel: function (t, e) {
        var i = t.get("view"), s = t.get("model"), n = t.get("options");
        this.openConversations.remove(t), this._removeConversationPopover(i, e), this.trigger("conversation:removing", s, i, n), e ? this.trigger("conversation:removed", s, i, n) : setTimeout(o.bind(function () {
          this.trigger("conversation:removed", s, i, n)
        }, this), this.get("conversationAnimationSpeed"))
      }
    });
    e.exports = h
  }, {
    "../collections/conversation-windows": 95,
    "../views/conversation/conversation-popover": 167,
    "../views/inbox/inbox-popover": 178,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/component": 545
  }],
  114: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      return t.scrollHeight <= e.maxHeight
    }

    function o(t) {
      return parseInt(h(t).css("max-height"), 10)
    }

    function n(t, e, i) {
      var o, n = t.nodeValue, a = l.get(e, "truncationString", "..."), r = "", h = "", c = 0, d = n.length;
      if (s(i, e))return !0;
      for (; d >= c;)o = c + d >>> 1, r = l.trimRight(n.substring(0, o)) + a, t.nodeValue = r, s(i, e) ? (c = o + 1, r.length > h.length && (h = r)) : d = o - 1;
      return h.length > 0 ? (t.nodeValue = h, !0) : (t.nodeValue = "", !1)
    }

    function a(t, e, i) {
      var s = h(t).contents();
      l.each(s.get().reverse(), function (t) {
        t.nodeType === Node.TEXT_NODE ? n(t, e, i) : a(t, e, i)
      })
    }

    function r(t, e) {
      return e = e || {}, l.defaults(e, {truncationString: "..."}), t instanceof h && (t = t.get(0)), l.has(e, "maxHeight") || l.extend(e, {maxHeight: o(t)}), l.isFinite(l.get(e, "maxHeight")) && !s(t, e) ? a(t, e, t) : void 0
    }

    var l = t("lodash"), h = t("jquery");
    e.exports = r
  }, {jquery: "HlZQrA", lodash: "MicNly"}],
  115: [function (t, e, i) {
    "use strict";
    function s(t) {
      var e, i;
      return t = t || [], function () {
        return o.isEmpty(e) && (e = o.shuffle(t), o.isEmpty(i) || (e = o.without(e, i))), i = e.pop()
      }
    }

    var o = t("lodash");
    e.exports = s
  }, {lodash: "MicNly"}],
  116: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/mixin"), n = new o({
      extend: {
        setNextLink: function (t) {
          var e, i = this.hasNextPage();
          this._nextLink = t, e = this.hasNextPage(), i !== e && this.trigger("change:hasNextPage", this, e)
        }, setPreviousLink: function (t) {
          var e, i = this.hasPreviousPage();
          this._previousLink = t, e = this.hasPreviousPage(), i !== e && this.trigger("change:hasPreviousPage", this, e)
        }, getNextLink: function () {
          return this._nextLink
        }, getPreviousLink: function () {
          return this.previousLink
        }, hasNextPage: function () {
          return !s.isEmpty(this.getNextLink())
        }, hasPreviousPage: function () {
          return !s.isEmpty(this.getPreviousLink())
        }, fetchNextPage: function (t, e) {
          return t = t || {}, this.hasNextPage() ? (t.isInfiniteScroll !== !1 && s.extend(t, {
            skipParsePreviousLink: !0,
            remove: !1
          }), this._fetchPage(this.getNextLink(), t)) : null
        }, fetchPreviousPage: function (t, e) {
          return t = t || {}, this.hasPreviousPage() ? (t.isInfiniteScroll !== !1 && s.extend(t, {
            skipParseNextLink: !0,
            remove: !1
          }), this._fetchPage(this.getPreviousLink(), t)) : null
        }, _fetchPage: function (t, e) {
          var i = s.isString(t) ? t : t.href;
          return e = e || {}, s.extend(e, {url: i}), this.fetch(e)
        }
      }, defaults: {
        parsePreviousLink: function (t, e) {
          return null
        }, parseNextLink: function (t, e) {
          return null
        }
      }, before: {
        reset: function (t) {
          this.setPreviousLink(null), this.setNextLink(null)
        }, parse: function (t, e) {
          e = e || {}, e.skipParseLinks || (!e.skipParsePreviousLink && s.isFunction(this.parsePreviousLink) && this.setPreviousLink(this.parsePreviousLink(t, e)), !e.skipParseNextLink && s.isFunction(this.parseNextLink) && this.setNextLink(this.parseNextLink(t, e)))
        }
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "prima/lib/mixin": 572}],
  117: [function (t, e, i) {
    "use strict";
    var s = t("prima/model"), o = s.extend({idAttribute: "channelId", defaults: {channelId: null, data: null}});
    e.exports = o
  }, {"prima/model": 590}],
  118: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/model"), n = t("prima/mixins/relational-model"), a = t("../collections/conversations"), r = t("app/models/tumblelog"), l = o.extend({
      idAttribute: "uuid",
      mixins: [n],
      relations: {conversations: a},
      defaults: {conversations: null, unread_messages_count_sum: 0}
    });
    s.defaults(l.prototype, r.prototype), e.exports = l
  }, {
    "../collections/conversations": 96,
    "app/models/tumblelog": 463,
    lodash: "MicNly",
    "prima/mixins/relational-model": 585,
    "prima/model": 590
  }],
  119: [function (t, e, i) {
    "use strict";
    var s = t("prima/model"), o = s.extend({defaults: {view: null, model: null, options: null}});
    e.exports = o
  }, {"prima/model": 590}],
  120: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/mixins/relational-model"), a = t("prima/model"), r = t("../models/message"), l = t("../collections/messages"), h = t("../collections/participants"), c = t("./participant"), d = a.extend({
      url: "/svc/conversations/messages",
      mixins: [n],
      relations: {messages: l, participants: h, participant: c},
      relationsOrder: ["participants", "participant", "messages"],
      defaults: {
        id: null,
        status: null,
        last_modified_ts: null,
        last_read_ts: null,
        participants: null,
        messages: null,
        can_send: !0,
        isFetched: !1,
        participant: null,
        unreadCount: 0
      },
      isUnread: function () {
        return this.get("last_modified_ts") > this.get("last_read_ts")
      },
      markAsRead: function () {
        var t = (new Date).getTime();
        this.set({last_read_ts: parseInt(t / 1e3, 10), unreadCount: 0})
      },
      parse: function (t, e) {
        var i = s.get(t, "response") || t;
        return i
      },
      destroy: function (t) {
        var e = {conversation_id: this.get("id"), participant: this.getParticipantId()};
        return t = s.extend({}, t, {url: this.url + "?" + o.param(e)}), a.prototype.destroy.call(this, t)
      },
      fetchConversation: function (t) {
        return this.isNew() ? this.fetchByParticipants(t) : this.fetchById(t)
      },
      fetchById: function (t) {
        return t = t || {}, s.extend(t, {
          isFetching: !0,
          cache: !1,
          reset: !0,
          data: {conversation_id: this.get("id"), participant: this.getParticipantId()}
        }), this.fetch(t)
      },
      fetchByParticipants: function (t) {
        return t = t || {}, s.extend(t, {
          isFetching: !0,
          cache: !1,
          reset: !0,
          data: {participants: this.getParticipantsIds(), participant: this.getParticipantId()}
        }), this.fetch(t)
      },
      poll: function (t, e) {
        var i;
        if (!this.isNew())return i = {
          participant: this.getParticipantId(),
          conversation_id: this.get("id")
        }, e && s.extend(i, {limit: e}), this.get("messages").poll({isPolling: !0, data: i})
      },
      getConversationDataForMessage: function () {
        var t = {participant: this.getParticipantId()};
        return this.isNew() ? s.extend(t, {participants: this.getParticipantsIds()}) : s.extend(t, {conversation_id: this.get("id")}), t
      },
      createTextMessage: function (t) {
        return this.createMessage({type: r.TEXT, message: t, content: {text: t}})
      },
      createPostMessage: function (t, e) {
        return this.createMessage({type: r.POST, post: {blog: e, id: t}})
      },
      createMessage: function (t) {
        return new r(s.extend({}, t, this.getConversationDataForMessage()))
      },
      sendMessage: function (t, e) {
        e = e || {};
        var i = new o.Deferred, n = s.get(e, "success"), a = s.get(e, "error");
        return s.extend(e, {
          success: s.bind(function (t, e, o) {
            return this.isNew() && this.set(s.omit(this.parse(e, o), "messages")), s.isFunction(n) && n.apply(this, arguments), i.resolve.apply(this, arguments)
          }, this), error: s.bind(function () {
            return s.isFunction(a) && a.apply(this, arguments), i.reject.apply(this, arguments)
          }, this)
        }), this.get("messages").create(t, e), i
      },
      getParticipantId: function () {
        return this.get("participant").get("uuid")
      },
      getParticipantsIds: function () {
        return this.get("participants").pluck("uuid")
      },
      getInboxMessage: function () {
        var t = this.get("messages").where({isError: !1});
        return s.last(t)
      }
    });
    e.exports = d
  }, {
    "../collections/messages": 98,
    "../collections/participants": 99,
    "../models/message": 125,
    "./participant": 126,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/mixins/relational-model": 585,
    "prima/model": 590
  }],
  121: [function (t, e, i) {
    "use strict";
    var s = t("prima/model"), o = s.extend({
      defaults: {channel: null}, getChannel: function () {
        return this.get("channel")
      }, setChannel: function (t) {
        return this.set("channel", t)
      }, getId: function () {
        return this.get("channel").get("uuid")
      }, getPrevChannel: function () {
        return this.previous("channel")
      }, getPrevProperty: function (t) {
        var e = this.getPrevChannel();
        return e ? e.get(t) : null
      }, getPrevId: function () {
        return this.getPrevProperty("uuid")
      }
    });
    e.exports = o
  }, {"prima/model": 590}],
  122: [function (t, e, i) {
    "use strict";
    var s = t("prima/model"), o = s.extend({
      idAttribute: "namespace",
      defaults: {namespace: null, view: null, isActive: !0}
    });
    e.exports = o
  }, {"prima/model": 590}],
  123: [function (t, e, i) {
    "use strict";
    var s = t("prima/model"), o = s.extend({defaults: {text: null, formatting: []}});
    e.exports = o
  }, {"prima/model": 590}],
  124: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("prima/model"), a = n.extend({
      defaults: {
        type: null,
        summary: null,
        photos: []
      }, getMessage: function () {
        return s.get(this.get("summary"), "text")
      }, getSentString: function (t) {
        var e = {
          text: o("%1$s sent a post:", t),
          photo: o("%1$s sent a photo:", t),
          photoset: o("%1$s sent a photoset:", t),
          link: o("%1$s sent a link:", t),
          quote: o("%1$s sent a quote:", t),
          audio: o("%1$s sent an audio post:", t),
          video: o("%1$s sent a video:", t),
          chat: o("%1$s sent a chat:", t)
        };
        return s.get(e, this.getType())
      }, getType: function () {
        return "photo" === this.get("type") && (this.get("photos") || []).length > 1 ? "photoset" : this.get("type")
      }, getThumbnailUrl: function () {
        var t, e = this.get("thumbnail_url"), i = this.get("photos");
        return s.isEmpty(e) ? s.isEmpty(i) ? void 0 : (t = s.get(s.first(i), "alt_sizes"), s.get(s.last(t), "url")) : e
      }
    });
    e.exports = a
  }, {lodash: "MicNly", "prima/lib/translate": 575, "prima/model": 590}],
  125: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/model"), n = t("prima/mixins/relational-model"), a = t("./message-content"), r = t("./message-post"), l = {
      TEXT: "TEXT",
      POST: "POSTREF"
    }, h = o.extend({
      mixins: [n],
      relations: {content: a, post: r},
      idAttribute: "ts",
      defaults: {
        type: l.TEXT,
        ts: null,
        participant: null,
        content: null,
        message: null,
        post: null,
        collapseGroup: null,
        clientTs: null,
        tsHeader: null,
        isPending: !1,
        isError: !1,
        isCollapsed: !1,
        canRetry: !0,
        hasAnimation: !1
      },
      parse: function (t, e) {
        return s.get(t, "response.messages.data.0") || t
      },
      save: function (t, e) {
        return e = e || {}, t = t || {}, t && this.set(t), s.extend(e, {
          data: this.toJSON(),
          emulateJSON: !0
        }), o.prototype.save.call(this, t, e)
      },
      updateClientTimestamp: function () {
        this.set("clientTs", (new Date).getTime())
      },
      getTimestamp: function () {
        return this.get("clientTs") || parseInt(this.get("ts"), 10)
      },
      getMessage: function () {
        var t = this.get("type");
        return t === l.TEXT ? this.get("content").get("text") : t === l.POST ? this.get("post").getMessage() : void 0
      }
    }, l);
    e.exports = h
  }, {
    "./message-content": 123,
    "./message-post": 124,
    lodash: "MicNly",
    "prima/mixins/relational-model": 585,
    "prima/model": 590
  }],
  126: [function (t, e, i) {
    "use strict";
    var s = t("prima/mixins/relational-model"), o = t("app/lib/avatar-size"), n = t("prima/model"), a = t("./theme"), r = n.extend({
      mixins: [s],
      relations: {theme: a},
      defaults: {theme: null},
      idAttribute: "uuid",
      getAvatarUrl: function (t) {
        return t = t || 96, o(this.get("avatar_url"), t)
      },
      getAvatarShape: function () {
        return this.get("theme").get("avatar_shape")
      }
    });
    e.exports = r
  }, {"./theme": 127, "app/lib/avatar-size": 456, "prima/mixins/relational-model": 585, "prima/model": 590}],
  127: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/utils/colors"), n = t("prima/model"), a = n.extend({
      defaults: {
        background_color: null,
        link_color: null,
        avatar_shape: null,
        header_image_focused: null,
        show_header_image: !0,
        adjustBrightnessFactor: .3
      }, getHeaderImage: function () {
        return this.get("show_header_image") === !0 ? this.get("header_image_focused") : null
      }, getBackgroundTint: function () {
        return this.getTint(this.get("background_color"))
      }, getAccentTint: function () {
        return this.getTint(this.get("link_color"))
      }, getTint: function (t) {
        var e;
        return this.get("tint" + t) ? this.get("tint" + t) : s.isEmpty(t) ? null : (e = o.isLight(t, .5) ? o.isLight(t, .05, .95) ? a.TINT_WHITE : a.TINT_LIGHT : a.TINT_DARK, this.set("tint" + t, e), e)
      }, isDark: function (t) {
        return this.getTint(t) === a.TINT_DARK
      }, isReadableOn: function (t, e) {
        return t = o.hexToHsv(t), e = o.hexToHsv(e), !o.compare(t, e)
      }, adjustColorForBackground: function (t, e) {
        var i = this.get("adjustBrightnessFactor");
        return this.isReadableOn(t, e) ? t : this.adjustBrightness(t, this.isDark(t) ? i : -1 * i)
      }, getReadableColor: function (t, e) {
        return this.isReadableOn(t, e) ? t : o.readable(t)
      }, adjustBrightness: function (t, e) {
        return o.brighten(t, e)
      }, getTintSuffix: function (t) {
        return t === a.TINT_WHITE ? "-white" : t === a.TINT_LIGHT ? "-light" : t === a.TINT_DARK ? "-dark" : void 0
      }
    }, {TINT_LIGHT: "light", TINT_DARK: "dark", TINT_WHITE: "white"});
    e.exports = a
  }, {lodash: "MicNly", "prima/model": 590, "prima/utils/colors": 597}],
  128: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<li><a href="#" data-js-delete-conversation>' + (null == (__t = __("Delete conversation")) ? "" : _.escape(__t)) + "</a></li>", _.each(blockableParticipants, function (t) {
          __p += '<li><a href="#" data-js-block-blogname="' + (null == (__t = t.name) ? "" : _.escape(__t)) + '">' + (null == (__t = __("Block %1$s", t.name)) ? "" : _.escape(__t)) + "</a></li>"
        }), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  129: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="blogSelectorView" class="blog-selector-container"></div><div class="text-input-container"><textarea class="text-input" placeholder="' + (null == (__t = placeholder) ? "" : _.escape(__t)) + '" rows="1" maxlength="4096" data-js-text-input></textarea></div><button type="submit" data-js-submit-button data-js-theme-accent-color-on-white class="submit">' + (null == (__t = __("Send")) ? "" : _.escape(__t)) + "</button>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  130: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="content"><label>' + (null == (__t = message) ? "" : _.escape(__t)) + '</label><button data-js-theme-button data-js-button class="chrome">' + (null == (__t = buttonText) ? "" : _.escape(__t)) + "</button></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  131: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {}) {
          __p += '<div class="conversation-header-image" data-js-theme-header-image></div><div class="conversation-header-main"><div data-js-title class="title">';
          var lastIndex = participants.length - 2;
          __p += "", _.each(participants, function (t, e) {
            __p += '<a href="' + (null == (__t = t.url) ? "" : _.escape(__t)) + '" target="_blank" data-js-tumblelog-name="' + (null == (__t = t.name) ? "" : _.escape(__t)) + '">' + (null == (__t = t.name) ? "" : _.escape(__t)) + "</a>" + (null == (__t = e === lastIndex ? " " + separator + " " : lastIndex > e ? ", " : "") ? "" : _.escape(__t))
          }), __p += '</div><div class="controls" data-js-theme-accent-color-on-background><a href="#" data-js-more-actions class="more-actions">' + (null == (__t = __("Actions")) ? "" : _.escape(__t)) + '</a> <a href="#" data-js-close class="close">' + (null == (__t = __("Close")) ? "" : _.escape(__t)) + "</a></div></div>"
        }
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  132: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="message">' + (null == (__t = message) ? "" : _.escape(__t)) + "</div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  133: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<a class="avatar" href="' + (null == (__t = url) ? "" : _.escape(__t)) + '" target="_blank" data-js-tumblelog-name="' + (null == (__t = name) ? "" : _.escape(__t)) + '"><img src="' + (null == (__t = avatarUrl) ? "" : _.escape(__t)) + '"></a><div class="message-bubble" data-js-message-bubble><a href="' + (null == (__t = url) ? "" : _.escape(__t)) + '" target="_blank" data-js-tumblelog-name="' + (null == (__t = postBlogName) ? "" : _.escape(__t)) + '" data-js-post-id="' + (null == (__t = postId) ? "" : _.escape(__t)) + '"><div class="message-bubble-header"><span class="name">' + (null == (__t = sentString) ? "" : _.escape(__t)) + '</span></div><div class="message">', _.isEmpty(message) || (__p += '<span class="text">' + (null == (__t = message) ? "" : _.escape(__t)) + "</span>"), __p += '</div></a></div><a href="' + (null == (__t = url) ? "" : _.escape(__t)) + '" target="_blank" data-js-tumblelog-name="' + (null == (__t = postBlogName) ? "" : _.escape(__t)) + '" data-js-post-id="' + (null == (__t = postId) ? "" : _.escape(__t)) + '" class="thumbnail">', _.isEmpty(thumbnailUrl) || (__p += '<img src="' + (null == (__t = thumbnailUrl) ? "" : _.escape(__t)) + '">'), __p += "</a>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  134: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<a class="avatar" href="' + (null == (__t = url) ? "" : _.escape(__t)) + '" target="_blank" data-js-tumblelog-name="' + (null == (__t = name) ? "" : _.escape(__t)) + '"><img src="' + (null == (__t = avatarUrl) ? "" : _.escape(__t)) + '"></a><div class="message-bubble" data-js-message-bubble><div class="message-bubble-header"><a href="' + (null == (__t = url) ? "" : _.escape(__t)) + '" class="name" target="_blank" data-js-tumblelog-name="' + (null == (__t = name) ? "" : _.escape(__t)) + '">' + (null == (__t = name) ? "" : _.escape(__t)) + '</a> <button class="retry-button" data-text-default="' + (null == (__t = __("Retry")) ? "" : _.escape(__t)) + '" data-text-is-pending="' + (null == (__t = __("Trying...")) ? "" : _.escape(__t)) + '" data-text-no-retry="' + (null == (__t = __("Could not send")) ? "" : _.escape(__t)) + '" data-js-retry-button>' + (null == (__t = __("Retry")) ? "" : _.escape(__t)) + '</button></div><div class="message">' + (null == (__t = message) ? "" : __t) + "</div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  135: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-js-label class="inline-activity timestamp">' + (null == (__t = label) ? "" : _.escape(__t)) + "</div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  136: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += "<div data-js-message-container></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  137: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="conversation-pagination-loader" data-js-loader-container><div data-subview="paginationLoaderView"></div></div><div data-subview="messagesView[]" class="message-list"></div><div data-subview="pillView"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  138: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += "<p></p>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  139: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<button data-js-theme-button data-js-unread-button class="unread-button">' + (null == (__t = title) ? "" : _.escape(__t)) + "</button>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  140: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="messaging-conversation" data-js-theme-background-tint><div data-subview="headerView"></div><div class="conversation-main" data-js-theme-background-color data-js-main><div data-subview="messagesView"></div><div data-subview="conversationLoaderView"></div><div data-subview="newConversationView"></div></div><div data-subview="composeView"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  141: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<a href="#" class="compose-toggle compose-start" data-js-compose-toggle>' + (null == (__t = __("Compose message")) ? "" : _.escape(__t)) + '</a> <a href="#" class="compose-toggle compose-cancel" data-js-compose-toggle>' + (null == (__t = __("Nevermind")) ? "" : _.escape(__t)) + "</a>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  142: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="inbox-compose-input"><label class="label"><span class="label-text-container">' + (null == (__t = __("To:")) ? "" : _.escape(__t)) + '</span> <span class="input-container"><input type="text" class="input" data-js-textinput></span></label></div><div class="inbox-compose-main"><div data-subview="loader"></div><div data-subview="favoritesView"></div><div data-subview="searchResultView"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  143: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<a data-open-conversation href="#" class="inbox-row"><img class="avatar" src="' + (null == (__t = avatarUrl) ? "" : _.escape(__t)) + '"><div class="info-container"><div class="name-container"><h3 class="name">' + (null == (__t = name) ? "" : _.escape(__t)) + '</h3></div><h4 class="message" data-js-message><span class="additional-blog-name" data-js-additional-blog-name>' + (null == (__t = additionalBlogName) ? "" : _.escape(__t)) + '</span> <span class="text" data-js-message-text>' + (null == (__t = message) ? "" : _.escape(__t)) + "</span></h4></div></a>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  144: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-js-conversations-container><div data-subview="conversations[]"></div><div data-subview="favoritesView"></div></div><div class="inbox-pagination-loader" data-js-loader-container><div data-subview="paginationLoaderView"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  145: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", _.isEmpty(blogs) || (__p += '<div class="blogs">', _.each(blogs, function (t) {
          __p += '<a class="blog" href="/messaging/conversation/' + (null == (__t = t.name) ? "" : _.escape(__t)) + '" data-js-start-conversation="' + (null == (__t = t.name) ? "" : _.escape(__t)) + '"><img class="avatar" src="' + (null == (__t = t.avatarUrl) ? "" : _.escape(__t)) + '" alt="' + (null == (__t = t.name) ? "" : _.escape(__t)) + '" title="' + (null == (__t = t.name) ? "" : _.escape(__t)) + '" width="40" height="40"></a>'
        }), __p += "</div>"), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  146: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="content"><div class="header-container"><h2 class="header" data-js-header>' + (null == (__t = header) ? "" : _.escape(__t)) + '</h2></div><div data-subview="blogsView"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  147: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="senderView"></div><div data-subview="composeToggleView"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  148: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<a data-start-conversation href="/conversation/new/' + (null == (__t = name) ? "" : _.escape(__t)) + '" class="inbox-row"><img class="avatar" src="' + (null == (__t = avatarUrl) ? "" : _.escape(__t)) + '"><div class="info-container"><h3>' + (null == (__t = name) ? "" : _.escape(__t)) + "</h3><h4>" + (null == (__t = title) ? "" : _.escape(__t)) + "</h4></div></a>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  149: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "<div data-js-container>", title && (__p += "<h2>" + (null == (__t = title) ? "" : _.escape(__t)) + "</h2>"), __p += '<div data-subview="recipients[]"></div><div data-js-no-results-container class="no-results"><p data-js-no-results-text>' + (null == (__t = noResultsText) ? "" : _.escape(__t)) + "</p></div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  150: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="blogSelector" class="blog-selector"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  151: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="headerView"></div><div data-subview="composeView"></div><div class="inbox-main"><div data-subview="loader"></div><div data-subview="conversationsView"></div></div><div data-subview="emptyView"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  152: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = o.extend({
      removeCollectionSubviews: function (t) {
        var e = this[t];
        this.subviews[t] && !s.isEmpty(e) && (e = this[t], this._subviews = s.difference(this._subviews, e), s.invoke(e, "remove"), this[t].length = 0)
      }, removeCollectionSubview: function (t, e) {
        var i, o = this[t];
        this.subviews[t] && !s.isEmpty(o) && (i = s.findWhere(o, {model: e}), i && (this._subviews = s.without(this._subviews, i), i.remove(), this[t] = s.without(this[t], i)))
      }, addNewCollectionSubview: function (t, e, i) {
        var o = this.subviews[t];
        if (i || (i = this._getSubviewCollection(t)), o && i) {
          var n = o.container || this._createDefaultContainerFunction(t), a = o.prepareViewForAdd || this._createDefaultPrepareViewForAddFunction(t), r = o.options || {}, l = {insertionIndex: i.indexOf(e)}, h = s.has(this, t), c = this.createCollectionSubviewRenderer([e], n, a, r, t, h, l);
          return this._isBatchRenderingInProgress(t) ? void this.once("rendered:" + t, c, this) : void(this.rendered ? c() : this.once("rendered", c, this))
        }
      }, renderSubviews: function () {
        return s.each(this.subviews, function (t, e) {
          t.collection && this._attachCollectionListeners(e)
        }, this), o.prototype.renderSubviews.apply(this, arguments)
      }, renderCollectionSubviews: function (t) {
        var e = this.subviews[t];
        if (e)return this.removeCollectionSubviews(t), s.result(e, "enableBatchRendering") === !0 ? this.batchRenderCollectionSubviews(t) : o.prototype.renderCollectionSubviews.apply(this, arguments)
      }, batchRenderCollectionSubviews: function (t) {
        var e = this.subviews[t];
        if (e) {
          var i = e.container || this._createDefaultContainerFunction(t), o = e.prepareView || this._createDefaultPrepareViewFunction(t), n = e.options || {}, a = s.result(e, "batchSize") || 5, r = s.result(e, "batchDelay") || 100, l = this._getSubviewCollection(t), h = s.chunk(l.models, a), c = s.map(h, function (e, a) {
            return s.bind(function () {
              var s = this.createCollectionSubviewRenderer(e, i, o, n, t, a > 0);
              return s.call(this)
            }, this)
          }, this), d = s.bind(function () {
            this._scheduleBatchRenders(t, c, r)
          }, this);
          this.rendered ? d() : this.once("rendered", d, this)
        }
      }, beforeRemove: function () {
        return this._cancelBatchRenders(), o.prototype.beforeRemove.apply(this, arguments)
      }, _isBatchRenderingInProgress: function (t) {
        return s.get(this._deferredRenders, t, []).length > 0
      }, _scheduleBatchRenders: function (t, e, i) {
        var o = e.length, n = function () {
          this._afterBatchRenderCollectionSubviews(t)
        }, a = function (e) {
          e.call(this, t), this._afterEachBatchRenderCollectionSubviews(t), o--, 0 === o && n.call(this)
        };
        return this._deferredRenders || (this._deferredRenders = {}), s.has(this._deferredRenders, t) || (this._deferredRenders[t] = []), this._cancelBatchRenders(t), 0 === o ? void n.call(this) : void s.each(e, function (e, o) {
          var n;
          return 0 === o ? void a.call(this, e) : (n = setTimeout(s.bind(function () {
            a.call(this, e), this._deferredRenders[t] = s.without(this._deferredRenders[t], n)
          }, this), i * (o + 1)), void this._deferredRenders[t].push(n))
        }, this)
      }, _cancelBatchRenders: function (t) {
        s.isEmpty(this._deferredRenders) || (s.isEmpty(t) || s.has(this._deferredRenders, t)) && (s.isEmpty(t) ? (s.each(this._deferredRenders, function (t, e) {
          s.each(t, function (t) {
            clearTimeout(t)
          }, this)
        }, this), this._deferredRenders = {}) : (s.each(this._deferredRenders[t], function (t) {
          clearTimeout(t)
        }, this), this._deferredRenders[t].length = 0))
      }, _afterEachBatchRenderCollectionSubviews: function (t) {
        this.trigger("batch:rendered:" + t)
      }, _afterBatchRenderCollectionSubviews: function (t) {
        this.trigger("rendered:" + t)
      }, _attachCollectionListeners: function (t) {
        var e = this._getSubviewCollection(t);
        e && (this.listenTo(e, "add", s.partial(this.addNewCollectionSubview, t)), this.listenTo(e, "remove", s.partial(this.removeCollectionSubview, t)), this.listenTo(e, "reset", s.partial(this.renderCollectionSubviews, t)))
      }, _getSubviewCollection: function (t) {
        var e = this.subviews[t];
        return e && e.collection ? s.isFunction(e.collection) ? e.collection(this) : e.collection : null
      }, _createDefaultPrepareViewForAddFunction: function (t) {
        var e = this.subviews[t];
        return s.bind(function (i, o) {
          var n = i.children(), a = new e.constructor(o), r = o.insertionIndex;
          return a.$el.attr("data-subview", t), s.isNumber(r) && r < n.length ? a.$el.insertBefore(n.get(r)) : i.append(a.$el), a
        }, this)
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "prima/views/base": 613}],
  153: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("./collection-base-view"), n = t("prima/mixins/keycommands"), a = o.extend({
      mixins: [n],
      keycommands: {
        "keydown:up": "_onKeyPressUp",
        "keydown:down": "_onKeyPressDown",
        "keydown:enter": "_onKeyPressEnter"
      },
      initialize: function () {
        return this.disableKeys(), this.currentIndex = -1, o.prototype.initialize.apply(this, arguments)
      },
      clearSelectedModel: function () {
        return this._setSelectedCollectionView(-1)
      },
      setSelectedModel: function (t) {
        var e;
        if (this.keyboardCollectionName) {
          if (s.isEmpty(t))return this.clearSelectedModel();
          e = this._getSubviewCollection(this.keyboardCollectionName), e && this._setSelectedCollectionView(e.indexOf(t))
        }
      },
      _setSelectedCollectionView: function (t) {
        var e, i, o = this.keyboardCollectionName, n = this.subviews[o], a = this[o];
        o && n && (e = this._getSubviewCollection(o), e && !s.isEmpty(a) && (this.currentIndex = t, t >= 0 && (i = s.findWhere(a, {model: e.at(t)})), this.set("selectedView", i)))
      },
      _getNextIndex: function (t) {
        var e, i = this.currentIndex;
        return this.keyboardCollectionName && (e = this._getSubviewCollection(this.keyboardCollectionName)) ? (i += t, t > 0 && i >= e.length ? i = 0 : 0 > t && 0 > i && (i = e.length - 1), i) : -1
      },
      _navigateUp: function () {
        this._setSelectedCollectionView(this._getNextIndex(-1))
      },
      _navigateDown: function () {
        this._setSelectedCollectionView(this._getNextIndex(1))
      },
      _selectCurrentItem: function () {
        var t, e, i, o = this.keyboardCollectionName;
        -1 !== this.currentIndex && o && (t = this._getSubviewCollection(o), e = t.at(this.currentIndex), i = this.subviews[o], s.isFunction(s.get(i, "onSelect")) && i.onSelect.call(this, e))
      },
      _onKeyPressDown: function (t) {
        t.preventDefault(), this._navigateDown()
      },
      _onKeyPressUp: function (t) {
        t.preventDefault(), this._navigateUp()
      },
      _onKeyPressEnter: function (t) {
        t.preventDefault(), this._selectCurrentItem()
      }
    });
    e.exports = a
  }, {"./collection-base-view": 152, lodash: "MicNly", "prima/mixins/keycommands": 581}],
  154: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/views/base"), a = t("prima/mixins/popoverbase"), r = t("./conversation-actions"), l = n.extend({
      className: "popover--conversation-actions info_popover popover_gradient popover",
      mixins: [a],
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "viewOptions")), this.view = new r(this.viewOptions)
      },
      render: function () {
        return this.$wrapper = o("<div />").addClass("popover-inner popover_inner").appendTo(this.$el), this.$wrapper.html(this.view.render().$el), this
      },
      teardown: function () {
        this.view && this.view.remove(), this.$el.remove()
      },
      getView: function () {
        return this.view
      }
    });
    e.exports = l
  }, {
    "./conversation-actions": 155,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/mixins/popoverbase": 583,
    "prima/views/base": 613
  }],
  155: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/views/base"), a = t("../../templates/conversation/conversation-actions.tpl"), r = n.extend({
      className: "conversation-actions",
      tagName: "ul",
      template: a,
      events: {
        "click [data-js-block-blogname]": "_onBlockClick",
        "click [data-js-delete-conversation]": "_onDeleteConversationClick"
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "user", "participants")), this.blockableParticipants = this.participants.getWithout(this.user.channels.pluck("uuid"))
      },
      getTemplateData: function () {
        return {blockableParticipants: s.invoke(this.blockableParticipants, "toJSON")}
      },
      _onBlockClick: function (t) {
        var e = o(t.currentTarget), i = e.attr("data-js-block-blogname");
        t.preventDefault(), s.isEmpty(i) || this.trigger("block", i)
      },
      _onDeleteConversationClick: function (t) {
        t.preventDefault(), this.trigger("delete")
      }
    });
    e.exports = r
  }, {
    "../../templates/conversation/conversation-actions.tpl": 128,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/views/base": 613
  }],
  156: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("prima/mixins/selectorcache"), a = t("prima/mixins/keycommands"), r = t("prima/views/base"), l = t("app/components/blog-selector"), h = t("../../lib/random-text-responder"), c = t("../../templates/conversation/conversation-compose.tpl"), d = r.extend({
      className: "conversation-compose",
      template: c,
      mixins: [n, a],
      events: {
        "click [data-js-submit-button]": "_onSubmitButtonClick",
        "input [data-js-text-input]": "_onTextInputChange",
        "focus [data-js-text-input]": "_onTextInputFocus",
        "blur [data-js-text-input]": "_onTextInputBlur"
      },
      keycommands: {"keydown:enter": "_onKeyPressEnter", "keydown:escape": "_onKeyPressEscape"},
      defaults: {
        isValid: !0,
        isDisabled: !1,
        isOffline: !1,
        defaultPlaceholder: null,
        offlinePlaceholder: null,
        placeholder: null,
        currentText: null,
        hasEditorFocus: !1,
        showBlogSelector: !1,
        isAutoValidationEnabled: !0,
        currentTumblelog: null,
        buttonSubmittedClass: "submitted",
        isCyclePlaceholder: !0
      },
      subviews: {
        blogSelectorView: {
          constructor: l, options: function (t) {
            return {
              className: "conversation-compose-blog-selector",
              collection: t.channels,
              currentTumblelog: t.get("currentTumblelog"),
              showName: !1,
              showCaret: !1,
              popoverOptions: {popoverContainer: t.popoverContainer}
            }
          }
        }
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "keyboardManager", "keyboardNamespace", "channels", "currentTumblelog", "popoverContainer")), this.getRandomPlaceholder = h([o("New message"), o("Your message here"), o("Write a message"), o("Say something"), o("Say your thing")]), s.isEmpty(this.get("defaultPlaceholder")) && this.set("defaultPlaceholder", this.get("isCyclePlaceholder") ? this.getRandomPlaceholder() : o("New message")), s.isEmpty(this.get("offlinePlaceholder")) && this.set("offlinePlaceholder", o("Currently offline")), s.isEmpty(this.get("placeholder")) && this.set("placeholder", this.get("defaultPlaceholder")), this.keyboardManager && this.disableKeys()
      },
      afterRenderSubviews: function () {
        this.listenTo(this, "change:isValid", this._onChangeIsValid), this.listenTo(this, "change:isDisabled", this._onChangeIsDisabled), this.listenTo(this, "change:isOffline", this._onChangeIsOffline), this.listenTo(this, "change:placeholder", this._onChangePlaceholder), this.listenTo(this, "change:currentText", this._onChangeCurrentText), this.listenTo(this, "change:hasEditorFocus", this._onChangeHasEditorFocus), this.listenTo(this, "change:showBlogSelector", this._onChangeShowBlogSelector), this.listenTo(this.blogSelectorView, "change:currentTumblelog", this._onChangeBlogCurrentTumblelog), this._onChangeIsValid(this, this.get("isValid")), this._onChangeIsDisabled(this, this.get("isDisabled")), this._onChangeIsOffline(this, this.get("isOffline")), this._onChangePlaceholder(this, this.get("placeholder")), this._onChangeCurrentText(this, this.get("currentText")), this._onChangeShowBlogSelector(this, this.get("showBlogSelector")), this._onChangeBlogCurrentTumblelog(this.blogSelectorView, this.blogSelectorView.get("currentTumblelog")), this._setValidState(), s.defer(s.bind(function () {
          this._resizeInput()
        }, this))
      },
      getTemplateData: function () {
        return {placeholder: this.get("placeholder")}
      },
      submit: function () {
        this.get("isValid") && !this.get("isDisabled") && (this.trigger("submit", this.get("currentText")), this._startAnimation(), this.clear())
      },
      escape: function () {
        s.isEmpty(this.get("currentText")) ? this.trigger("close") : this.clear()
      },
      clear: function () {
        this.js$("text-input").val(""), this.set("currentText", ""), this.get("isCyclePlaceholder") && (this.set("defaultPlaceholder", this.getRandomPlaceholder()), this._setPlaceholderState()), this._resizeInput()
      },
      focus: function () {
        s.defer(s.bind(function () {
          this.js$("text-input").focus()
        }, this))
      },
      getMessage: function () {
        return this.js$("text-input").val()
      },
      beforeRemove: function () {
        this.keyboardManager && this.keyboardManager.remove(this.keyboardNamespace)
      },
      _onKeyPressEnter: function (t) {
        t.preventDefault(), this.submit()
      },
      _onKeyPressEscape: function (t) {
        t.preventDefault(), this.escape()
      },
      _onTextInputChange: function () {
        this._resizeInput(), this.set("currentText", s.trim(this.js$("text-input").val()))
      },
      _setValidState: function () {
        this.get("isAutoValidationEnabled") && this.set("isValid", !s.isEmpty(this.get("currentText")))
      },
      _resizeInput: function () {
        var t, e = this.js$("text-input"), i = e.get(0);
        this._originalInputHeight || (this._originalInputHeight = e.outerHeight()), this.$el.css("height", this.$el.height()), e.css("height", "auto"), t = i.scrollHeight, Math.abs(t - this._originalInputHeight) < 5 && (t = this._originalInputHeight), e.css("height", t), this.$el.css("height", ""), this._detectResize()
      },
      _detectResize: function () {
        var t = this.$el.height();
        return this._previousHeight ? void(t !== this._previousHeight && (this.trigger("resize", t), this._previousHeight = t)) : void(this._previousHeight = t)
      },
      _startAnimation: function () {
        var t = this.js$("submit-button"), e = this.get("buttonSubmittedClass");
        s.isEmpty(e) || (t.addClass(e), s.delay(function () {
          t.removeClass(e)
        }, 500))
      },
      _setPlaceholderState: function () {
        this.set("placeholder", this.get("isOffline") ? this.get("offlinePlaceholder") : this.get("defaultPlaceholder"))
      },
      _onChangeCurrentText: function (t, e) {
        this._setValidState()
      },
      _onChangeIsValid: function (t, e) {
        this.js$("submit-button").prop("disabled", !e || this.get("isDisabled"))
      },
      _onSubmitButtonClick: function (t) {
        t.preventDefault(), this.submit()
      },
      _onChangeIsDisabled: function (t, e) {
        this.js$("text-input").prop("disabled", e), this.js$("submit-button").prop("disabled", e || !this.get("isValid"))
      },
      _onChangeIsOffline: function (t, e) {
        this._setPlaceholderState()
      },
      _onChangePlaceholder: function (t, e) {
        this.js$("text-input").attr("placeholder", e)
      },
      _onTextInputFocus: function () {
        this.set("hasEditorFocus", !0)
      },
      _onTextInputBlur: function () {
        this.set("hasEditorFocus", !1)
      },
      _onChangeHasEditorFocus: function (t, e) {
        this.keyboardManager && this.keyboardManager.toggle(this.keyboardNamespace, t, e)
      },
      _onChangeShowBlogSelector: function (t, e) {
        this.blogSelectorView.$el.toggle(e), this.$el.toggleClass("hide-blog-selector", !e)
      },
      _onChangeBlogCurrentTumblelog: function (t, e) {
        this.set("currentTumblelog", e)
      }
    });
    e.exports = d
  }, {
    "../../lib/random-text-responder": 115,
    "../../templates/conversation/conversation-compose.tpl": 129,
    "app/components/blog-selector": 37,
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/keycommands": 581,
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  157: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("prima/views/base"), a = t("prima/mixins/selectorcache"), r = t("../../templates/conversation/conversation-error.tpl"), l = n.extend({
      className: "conversation-error",
      mixins: [a],
      template: r,
      defaults: {
        message: null,
        isLoading: !1,
        showButton: !0,
        buttonText: null,
        buttonTextLoading: null,
        buttonTextCurrent: null
      },
      events: {"click [data-js-button]": "_onClickButton"},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "buttonCallback")), s.isEmpty(this.get("message")) && this.set("message", o("Something went screwy.")), s.isEmpty(this.get("buttonText")) && this.set("buttonText", o("Retry")), s.isEmpty(this.get("buttonTextLoading")) && this.set("buttonTextLoading", o("Retrying...")), s.isEmpty(this.get("buttonTextCurrent")) && this.set("buttonTextCurrent", this.get("buttonText"))
      },
      afterRender: function () {
        this.listenTo(this, "change:isLoading", this._onChangeIsLoading), this.listenTo(this, "change:buttonTextCurrent", this._onChangeButtonTextCurrent), this.listenTo(this, "change:showButton", this._onChangeShowButton), this._onChangeIsLoading(this, this.get("isLoading")), this._onChangeShowButton(this, this.get("showButton"))
      },
      getTemplateData: function () {
        return {message: this.get("message"), buttonText: this.get("buttonTextCurrent")}
      },
      _onClickButton: function (t) {
        t.preventDefault(), this.get("isLoading") || (s.isFunction(this.buttonCallback) && this.buttonCallback.call(this, this), this.set("isLoading", !0), this.trigger("buttonClick"))
      },
      _onChangeIsLoading: function (t, e) {
        var i = e ? this.get("buttonTextLoading") : this.get("buttonText");
        this.set("buttonTextCurrent", i), this.js$("button").toggleClass("disabled", e).prop("disabled", e)
      },
      _onChangeButtonTextCurrent: function (t, e) {
        this.js$("button").text(e)
      },
      _onChangeShowButton: function (t, e) {
        this.js$("button").toggle(e)
      }
    });
    e.exports = l
  }, {
    "../../templates/conversation/conversation-error.tpl": 130,
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  158: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("prima/mixins/selectorcache"), a = t("../../templates/conversation/conversation-header.tpl"), r = o.extend({
      className: "conversation-header",
      template: a,
      mixins: [n],
      defaults: {separator: "+"},
      attributes: {"data-js-theme-background-color-or-image-class": !0, "data-js-theme-accent-color-on-background": !0},
      events: {"click [data-js-close]": "_onClickCloseButton", "click [data-js-more-actions]": "_onClickMoreActions"},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "participants", "user", "channels"))
      },
      getTemplateData: function () {
        var t;
        return t = this.channels.length > 1 ? this.participants.toJSON() : s.invoke(this.participants.getWithout(this.channels.pluck("uuid")), "toJSON"), t = s.filter(t, function (t) {
          return !s.isEmpty(s.get(t, "name"))
        }), {participants: t, separator: this.get("separator")}
      },
      _onClickCloseButton: function (t) {
        this.trigger("closeClick"), t.preventDefault()
      },
      _onClickMoreActions: function (t) {
        var e = t.currentTarget;
        this.trigger("moreActionsClick", e), t.preventDefault()
      }
    });
    e.exports = r
  }, {
    "../../templates/conversation/conversation-header.tpl": 131,
    lodash: "MicNly",
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  159: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../../templates/conversation/conversation-message-error.tpl"), a = o.extend({
      className: "conversation-message-error",
      template: n,
      defaults: {message: null},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus"))
      },
      getTemplateData: function () {
        return {message: this.get("message")}
      }
    });
    e.exports = a
  }, {"../../templates/conversation/conversation-message-error.tpl": 132, lodash: "MicNly", "prima/views/base": 613}],
  160: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("prima/mixins/selectorcache"), a = t("../../templates/conversation/conversation-message-post.tpl"), r = o.extend({
      className: "conversation-message-post message-container",
      mixins: [n],
      template: a,
      defaults: {postTypeClassPrefix: "conversation-message-post--"},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "participants", "model")), this.post = this.model.get("post"), this.participant = this.participants.get(this.model.get("participant"))
      },
      afterRender: function () {
        this.$el.addClass(this.get("postTypeClassPrefix") + this.post.get("type"))
      },
      getTemplateData: function () {
        return {
          sentString: this.post.getSentString(this.participant.get("name")),
          message: this.post.getMessage(),
          thumbnailUrl: this.post.getThumbnailUrl(),
          avatarUrl: this.participant ? this.participant.getAvatarUrl() : null,
          name: this.participant ? this.participant.get("name") : null,
          url: this.post.get("post_url"),
          postBlogName: this.post.get("blog_name"),
          postId: this.post.get("id")
        }
      }
    });
    e.exports = r
  }, {
    "../../templates/conversation/conversation-message-post.tpl": 133,
    lodash: "MicNly",
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  161: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("prima/mixins/selectorcache"), a = t("app/components/messaging/lib/message-formatter").html, r = t("../../templates/conversation/conversation-message-text.tpl"), l = o.extend({
      className: "conversation-message-text message-container",
      mixins: [n],
      template: r,
      defaults: {showRetryButton: !1, fullWidthBubblePercentThreshold: 60, fullWidthBubbleClass: "full-width-bubble"},
      events: {"click [data-js-retry-button]": "_onRetryClick"},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "participants", "afterRetryClick")), this.formatter = t.formatter || new a
      },
      afterRender: function () {
        this.listenTo(this.model, "change:isPending", this._onChangeIsPending), this.listenTo(this.model, "change:isError", this._onChangeIsError), this.listenTo(this.model, "change:canRetry", this._onChangeCanRetry), this.listenTo(this.model.get("content"), "change", this.render), this.listenTo(this, "change:showRetryButton", this._onChangeShowRetryButton), this._onChangeIsPending(this.model, this.model.get("isPending")), this._onChangeIsError(this.model, this.model.get("isError")), this._onChangeCanRetry(this.model, this.model.get("canRetry")), this._onChangeShowRetryButton(this, this.get("showRetryButton")), this.$el.width() ? this._setBubbleStyles() : s.defer(s.bind(this._setBubbleStyles, this))
      },
      getTemplateData: function () {
        var t = this.participants.get(this.model.get("participant")), e = this.model.toJSON(), i = this.formatter.render(s.get(e, "content.text"), s.get(e, "content.formatting"));
        return {
          message: i,
          avatarUrl: t ? t.getAvatarUrl() : null,
          name: t ? t.get("name") : null,
          url: t ? t.get("url") : null
        }
      },
      _setBubbleStyles: function () {
        var t = this.get("fullWidthBubblePercentThreshold"), e = this.js$("message-bubble"), i = this.$el.width(), s = e.width();
        s > t / 100 * i && e.addClass(this.get("fullWidthBubbleClass"))
      },
      _setRetryButtonIsDisabled: function (t, e, i) {
        var s = this.js$("retry-button"), o = s.attr(t ? e : "data-text-default");
        s.text(o).prop("disabled", t).toggleClass(i, t)
      },
      _onChangeIsPending: function (t, e) {
        this._setRetryButtonIsDisabled(e, "data-text-is-pending", "is-pending")
      },
      _onChangeCanRetry: function (t, e) {
        this._setRetryButtonIsDisabled(!e, "data-text-no-retry", "no-retry")
      },
      _onChangeIsError: function (t, e) {
        this.set("showRetryButton", e)
      },
      _onChangeShowRetryButton: function (t, e) {
        this.js$("retry-button").toggle(e)
      },
      _onRetryClick: function (t) {
        t.preventDefault(), this.model.get("canRetry") && (this.trigger("retryClick", this.model), s.isFunction(this.afterRetryClick) && this.afterRetryClick(this.model))
      }
    });
    e.exports = l
  }, {
    "../../templates/conversation/conversation-message-text.tpl": 134,
    "app/components/messaging/lib/message-formatter": 107,
    lodash: "MicNly",
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  162: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../../templates/conversation/conversation-message-timestamp.tpl"), a = o.extend({
      className: "conversation-message-timestamp",
      template: n,
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus"))
      },
      getTemplateData: function () {
        return {label: this.model.get("tsHeader")}
      }
    });
    e.exports = a
  }, {
    "../../templates/conversation/conversation-message-timestamp.tpl": 135,
    lodash: "MicNly",
    "prima/views/base": 613
  }],
  163: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("prima/mixins/selectorcache"), a = t("../../models/message"), r = t("../../templates/conversation/conversation-message.tpl"), l = t("./conversation-message-text"), h = t("./conversation-message-post"), c = t("./conversation-message-timestamp"), d = o.extend({
      className: "conversation-message",
      mixins: [n],
      template: r,
      messagesTypes: {},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "participants", "afterRetryClick", "formatter", "animateInMessage")), this.addMessageType(a.POST, h), this.addMessageType(a.TEXT, l, function (t) {
          return {afterRetryClick: t.afterRetryClick, formatter: t.formatter}
        })
      },
      afterRender: function () {
        var t = this.createMessageView(this.model.get("type"));
        return t ? (this.js$("message-container").html(t.render().$el), this.model.get("hasAnimation") && s.isFunction(this.animateInMessage) && this.animateInMessage(this, this.js$("message-bubble"), this.model), this.listenTo(this.model, "change:isPending", this._onChangeIsPending), this.listenTo(this.model, "change:isError", this._onChangeIsError), this.listenTo(this.model, "change:isCollapsed", this._onChangeIsCollapsed), this.listenTo(this.model, "change:tsHeader", this._onChangeTsHeader), this._onChangeTsHeader(this.model, this.model.get("tsHeader")), void this._onChangeIsCollapsed(this.model, this.model.get("isCollapsed"))) : this.remove()
      },
      addMessageType: function (t, e, i) {
        this.messagesTypes[t] = {constructor: e, options: i}
      },
      getMessageType: function (t) {
        return s.get(this.messagesTypes, t)
      },
      createMessageView: function (t) {
        var e, i = this.getMessageType(t);
        return s.isEmpty(i) || !s.has(i, "constructor") ? null : (e = s.get(i, "options", {}), s.isFunction(e) && (e = e.call(this, this)), s.extend(e, {
          model: this.model,
          participants: this.participants,
          eventBus: this.eventBus
        }), new i.constructor(e))
      },
      _onChangeTsHeader: function (t, e) {
        this.timestampView && this.timestampView.remove(), s.isEmpty(e) || (this.timestampView = new c({model: this.model}), this.$el.prepend(this.timestampView.render().$el))
      },
      _onChangeIsCollapsed: function (t, e) {
        this.$el.toggleClass("collapsed", e)
      },
      _onChangeIsPending: function (t, e) {
        this.$el.toggleClass("pending", e)
      },
      _onChangeIsError: function (t, e) {
        this.$el.toggleClass("error", e)
      }
    });
    e.exports = d
  }, {
    "../../models/message": 125,
    "../../templates/conversation/conversation-message.tpl": 136,
    "./conversation-message-post": 160,
    "./conversation-message-text": 161,
    "./conversation-message-timestamp": 162,
    lodash: "MicNly",
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  164: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("moment"), n = t("when"), a = t("prima/mixins/selectorcache"), r = t("components/knight-rider-loader"), l = t("../../lib/infinite-scrollbar"), h = t("../base/collection-base-view"), c = t("./conversation-message"), d = t("./conversation-pill"), u = t("./conversation-message-error"), p = t("../../models/message"), m = t("../../templates/conversation/conversation-messages.tpl"), g = h.extend({
      className: "conversation-messages",
      template: m,
      mixins: [a],
      defaults: {
        isPaginating: !1,
        tsHeaderThreshold: 36e5,
        collapseMessagesThreshold: 6e4,
        pillClickScrollSpeed: 500,
        pillBottomThreshold: 80
      },
      subviews: {
        paginationLoaderView: {constructor: r, options: {variation: "small h-centered", loading: !1}},
        messagesView: {
          constructor: c, options: function (t) {
            return {
              eventBus: t.eventBus,
              participants: t.participants,
              formatter: t.messageFormatter,
              animateInMessage: t.animateInMessage,
              afterRetryClick: s.bind(t.afterRetryClick, t)
            }
          }, collection: function (t) {
            return t.collection
          }
        },
        pillView: {
          constructor: d, options: function (t) {
            return {eventBus: t.eventBus}
          }
        }
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "collection", "participants", "messageFormatter", "animateInMessage"))
      },
      afterRenderSubviews: function () {
        this.scrollBar = new l({
          el: this.el,
          bottomThreshold: this.get("pillBottomThreshold")
        }).render(), this.listenTo(this.collection, "update reset", this._onCollectionUpdate), this.listenTo(this.collection, "change:hasNextPage", this._onChangeHasNextPage), this.listenTo(this.collection, "change:isError", this._onChangeMessageIsError), this.listenTo(this.scrollBar, "scrolltop", this._onScrollChangeIsAtTop), this.listenTo(this.scrollBar, "scrollbottom", this._onScrollChangeIsAtBottom), this.listenTo(this.scrollBar, "scrollstop", this._createPositionSnapshot), this.listenTo(this.pillView, "click", this._onPillViewClick), this.listenTo(this, "change:isPaginating", this._onChangeIsPaginating), this._onChangeHasNextPage(this.collection, this.collection.hasNextPage()), s.defer(s.bind(function () {
          this._processMessages(), this.updateScrollBar(), this.scrollToBottom()
        }, this))
      },
      beforeRemove: function () {
        return this.scrollBar && this.scrollBar.destroy(), h.prototype.beforeRemove.apply(this, arguments)
      },
      scrollToBottom: function (t) {
        this._setScrollTop(this.el.scrollHeight, t)
      },
      getNextPage: function () {
        this.collection.hasNextPage() && (this.set("isPaginating", !0), this.collection.fetchNextPage({
          isPaginating: !0,
          scrollBottom: this.el.scrollHeight - this.$el.scrollTop()
        }).always(s.bind(function () {
          this.set("isPaginating", !1)
        }, this)))
      },
      updateScrollBar: function () {
        var t;
        this.scrollBar && this.scrollBar.update(), t = this._getPositionDiff(), t && this._setScrollTop(this.$el.scrollTop() + t.height + t.scrollTop), this._createPositionSnapshot()
      },
      afterRetryClick: function (t) {
        this.trigger("messageRetryClick", t)
      },
      toggle: function (t) {
        this.$el.toggle(t), t && (this.updateScrollBar(), this.scrollToBottom())
      },
      isAtBottom: function () {
        return this._lastPosition && this.scrollBar && this.scrollBar.get("isInitialized") ? this._lastPosition.scrollBottom < this.get("pillBottomThreshold") : !0
      },
      showPill: function (t) {
        return this._pillDefer && this._pillDefer.reject(), this._pillDefer = n.defer(), this.pillView.setCount(t), this._pillDefer.promise
      },
      addErrorMessage: function (t) {
        var e = new u({message: t});
        return this.$el.append(e.render().$el), e
      },
      setIsAnimating: function (t) {
        this.$el.toggleClass("is-animating", t)
      },
      _setScrollTop: function (t, e) {
        e ? this.$el.animate({scrollTop: t}, e) : this.$el.scrollTop(t)
      },
      _onCollectionUpdate: function (t, e) {
        e = e || {}, this._processMessages(e), e.isPaginating && this._adjustScrollbarAfterPagination(t, e), s.defer(s.bind(function () {
          this.rendered && this._adjustScrollbarAfterFetch(t, e)
        }, this))
      },
      _adjustScrollbarAfterFetch: function (t, e) {
        this.scrollBar && this.scrollBar.update(), (e.isSendingMessage || e.isResendingMessage || e.isFetching) && this.scrollToBottom(), this._createPositionSnapshot()
      },
      _adjustScrollbarAfterPagination: function (t, e) {
        e.scrollBottom && (this.scrollBar.setDisabled(!0), this._setScrollTop(this.el.scrollHeight - e.scrollBottom), s.delay(s.bind(function () {
          this.scrollBar.setDisabled(!1)
        }, this), 500))
      },
      _onChangeIsPaginating: function (t, e) {
        this.paginationLoaderView.set("loading", e)
      },
      _onChangeHasNextPage: function (t, e) {
        this.js$("loader-container").toggle(e)
      },
      _processMessages: function (t) {
        var e, i = this.get("tsHeaderThreshold"), s = this.get("collapseMessagesThreshold"), o = (new Date).getTime();
        t = t || {}, t.isPolling && (o = "new"), this.collection.each(function (t) {
          t.set({tsHeader: this._getTimestampHeader(t, e, i), isCollapsed: this._getIsCollapsed(t, e, s, o)}), e = t
        }, this)
      },
      _getTimestampHeader: function (t, e, i) {
        var s = t ? t.getTimestamp() : null, n = e ? e.getTimestamp() : null, a = !n || s - n > i;
        return a ? o(s).calendar() : null
      },
      _getIsCollapsed: function (t, e, i, s) {
        return t.has("collapseGroup") || t.set("collapseGroup", t.isNew() ? "new" : s), e ? t.get("type") !== p.TEXT || e.get("type") !== p.TEXT ? !1 : t.get("collapseGroup") !== e.get("collapseGroup") ? !1 : t.get("participant") !== e.get("participant") ? !1 : t.getTimestamp() - e.getTimestamp() < i : !1
      },
      _getScrollPosition: function () {
        return this.scrollBar.getCurrentPositions()
      },
      _createPositionSnapshot: function () {
        this._lastPosition = this._getScrollPosition()
      },
      _getPositionDiff: function () {
        if (this._lastPosition) {
          var t = this._getScrollPosition();
          return {
            scrollTop: this._lastPosition.scrollTop - t.scrollTop,
            scrollBottom: this._lastPosition.scrollBottom - t.scrollBottom,
            height: this._lastPosition.height - t.height
          }
        }
      },
      _onScrollChangeIsAtTop: function (t) {
        t && this.getNextPage()
      },
      _onScrollChangeIsAtBottom: function (t) {
        t && this._pillDefer && (this._pillDefer.resolve(this.pillView.getCount()), this.pillView.setCount(0))
      },
      _onPillViewClick: function () {
        this.pillView.setCount(0), this.scrollToBottom(this.get("pillClickScrollSpeed")), this._pillDefer && this._pillDefer.resolve()
      },
      _onChangeMessageIsError: function () {
        this.scrollToBottom()
      }
    });
    e.exports = g
  }, {
    "../../lib/infinite-scrollbar": 103,
    "../../models/message": 125,
    "../../templates/conversation/conversation-messages.tpl": 137,
    "../base/collection-base-view": 152,
    "./conversation-message": 163,
    "./conversation-message-error": 159,
    "./conversation-pill": 166,
    "components/knight-rider-loader": 496,
    lodash: "MicNly",
    moment: "iROhDJ",
    "prima/mixins/selectorcache": 586,
    when: "RG2dij"
  }],
  165: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../../templates/conversation/conversation-new.tpl"), a = o.extend({
      className: "conversation-new",
      template: n,
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus"))
      }
    });
    e.exports = a
  }, {"../../templates/conversation/conversation-new.tpl": 138, lodash: "MicNly", "prima/views/base": 613}],
  166: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("prima/views/base"), a = t("prima/mixins/selectorcache"), r = t("../../templates/conversation/conversation-pill.tpl"), l = n.extend({
      className: "conversation-pill hide-pill",
      template: r,
      mixins: [a],
      events: {"click [data-js-unread-button]": "_onClick"},
      defaults: {count: 0, maxCount: 99},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus"))
      },
      afterRender: function () {
        this.listenTo(this, "change:count", this._onChangeCount), this._onChangeCount(this, this.get("count"))
      },
      setCount: function (t) {
        this.set("count", s.isFinite(t) ? t : 0)
      },
      getCount: function () {
        return this.get("count")
      },
      getTitle: function (t) {
        var e, i;
        return s.isFinite(t) ? (e = this.get("maxCount"), i = t > e ? e + "+" : t, t > 1 ? o("%1$s unread messages", i) : o("%1$s unread message", i)) : null
      },
      getTemplateData: function () {
        return {title: this.getTitle(this.get("count"))}
      },
      _onChangeCount: function (t, e) {
        var i = this.getTitle(e);
        this.$el.toggleClass("hide-pill", 0 === e || s.isEmpty(i)), e > 0 && this.js$("unread-button").text(i)
      },
      _onClick: function (t) {
        t.preventDefault(), this.trigger("click")
      }
    });
    e.exports = l
  }, {
    "../../templates/conversation/conversation-pill.tpl": 139,
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  167: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/utils/bindendevent").transition, n = t("prima/views/base"), a = t("./index"), r = n.extend({
      className: "popover--conversation-popover hide-popover",
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "viewOptions")), s.isFunction(this.viewOptions) && (this.viewOptions = this.viewOptions.call(this, this))
      },
      render: function () {
        return this.conversationView = new a(this.viewOptions), this.$el.html(this.conversationView.render().$el), s.defer(s.bind(function () {
          this.$el.removeClass("hide-popover")
        }, this)), this
      },
      teardown: function () {
        return o(this.$el, s.bind(function () {
          this.remove()
        }, this)), this.$el.addClass("hide-popover"), this
      },
      beforeRemove: function () {
        this.conversationView && this.conversationView.remove()
      },
      getView: function () {
        return this.conversationView
      },
      poll: function () {
        var t = this.getView();
        return t ? t.poll() : void 0
      },
      fetch: function () {
        var t = this.getView();
        return t ? t.fetch() : void 0
      },
      focus: function () {
        var t = this.getView();
        return t ? t.focus() : void 0
      }
    });
    e.exports = r
  }, {"./index": 169, lodash: "MicNly", "prima/utils/bindendevent": 593, "prima/views/base": 613}],
  168: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/selectorcache"), a = t("prima/mixins/accessor"), r = o.extend({
      mixins: [n, a],
      defaults: {removeDataAttrAfterApplyingTheme: !0},
      configuration: {
        "theme-background-color": {themeField: "background_color", applyStyle: "background-color"},
        "theme-accent-color": {themeField: "link_color", applyStyle: "color"},
        "theme-accent-color-on-white": {
          themeField: function (t) {
            return t.adjustColorForBackground(t.get("link_color"), "#ffffff")
          }, applyStyle: "color"
        },
        "theme-accent-color-on-grey": {
          themeField: function (t) {
            return t.adjustColorForBackground(t.get("link_color"), "#f2f2f2")
          }, applyStyle: "color"
        },
        "theme-accent-color-on-background": {
          themeField: function (t) {
            return t.getReadableColor(t.get("link_color"), t.get("background_color"))
          }, applyStyle: "color"
        },
        "theme-button": {
          themeField: function (t) {
            var e = t.get("background_color"), i = t.get("link_color");
            return {text: e, background: t.getReadableColor(i, e)}
          }, applyStyle: function (t, e, i) {
            t.addClass("themed"), i.getHeaderImage() || t.css({
              "background-color": e.background,
              "border-color": e.background,
              color: e.text
            })
          }
        },
        "theme-header-image": {
          themeField: function (t) {
            return t.getHeaderImage()
          }, applyStyle: function (t, e) {
            t.css("background-image", "url(" + e + ")")
          }
        },
        "theme-background-tint": {
          themeField: function (t) {
            return t.getTintSuffix(t.getBackgroundTint())
          }, applyStyle: function (t, e, i) {
            t.addClass("theme-background" + e)
          }
        },
        "theme-background-color-or-image-class": {
          themeField: "background_color", applyStyle: function (t, e, i) {
            s.isEmpty(i.getHeaderImage()) ? t.css("background-color", e) : t.addClass("has-image")
          }
        },
        "theme-avatar-shape-class": {
          themeField: "avatar_shape", applyStyle: function (t, e) {
            t.addClass("avatar-shape--" + e)
          }
        }
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "theme"))
      },
      render: function () {
        this.theme && s.each(this.configuration, function (t, e) {
          var i, o;
          i = s.isFunction(t.themeField) ? t.themeField.call(this, this.theme) : this.theme.get(t.themeField), i && (o = this.js$(e), 0 !== o.length && (s.isFunction(t.applyStyle) ? t.applyStyle.call(this, o, i, this.theme) : o.css(t.applyStyle, i), this.get("removeDataAttrAfterApplyingTheme") && o.removeAttr("data-js-" + e)))
        }, this)
      },
      setTheme: function (t) {
        return this.theme = t, this.render()
      }
    });
    e.exports = r
  }, {lodash: "MicNly", "prima/mixins/accessor": 577, "prima/mixins/selectorcache": 586, "prima/view": 612}],
  169: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("velocity-animate"), a = t("prima/lib/translate"), r = t("prima/views/base"), l = t("components/knight-rider-loader"), h = t("prima/mixins/selectorcache"), c = t("./conversation-header"), d = t("./conversation-messages"), u = t("./conversation-new"), p = t("./conversation-compose"), m = t("./conversation-error"), g = t("./conversation-theme"), _ = t("../../models/conversation"), f = t("./conversation-actions-popover"), v = t("app/components/messaging/lib/message-formatter").html, b = t("../../lib/random-text-responder"), y = t("../../templates/conversation/index.tpl"), w = r.extend({
      template: y,
      className: "messaging-conversation-wrapper",
      defaults: {
        isNewConversation: !1,
        isError: !1,
        canSend: !0,
        isLoading: !0,
        isOffline: !1,
        isAutoFetch: !0,
        disableRetryOnConversationErrorCodes: [403, 428, 429],
        disableRetryOnMessageErrorCodes: [403],
        showFollowButtonOnErrorCodes: [409],
        animateInMessageDuration: 500
      },
      events: {"click [data-js-tumblelog-name]": "_onBlogClick", "click [data-js-main]": "_onMainContainerClick"},
      mixins: [h],
      subviews: {
        conversationLoaderView: {constructor: l, options: {variation: "small centered", loading: !1}},
        headerView: {
          constructor: c, options: function (t) {
            return {
              eventBus: t.eventBus,
              participants: t.sortedParticipants,
              theme: t.theme,
              channels: t.channels,
              user: t.user
            }
          }
        },
        newConversationView: {
          constructor: u, options: function (t) {
            return {eventBus: t.eventBus}
          }
        },
        messagesView: {
          constructor: d, options: function (t) {
            return {
              eventBus: t.eventBus,
              collection: t.model.get("messages"),
              participants: t.model.get("participants"),
              messageFormatter: t.messageFormatter,
              animateInMessage: s.bind(t._animateInMessage, t)
            }
          }
        },
        composeView: {
          constructor: p, options: function (t) {
            return {
              eventBus: t.eventBus,
              keyboardManager: t.keyboardManager,
              keyboardNamespace: t.keyboardNamespace + ":compose",
              channels: t.nonParticipantingChannels,
              currentTumblelog: t.model.get("participant"),
              popoverContainer: t.popoverContainer
            }
          }
        }
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "user", "model", "channels", "messageFormatter", "popoverContainer", "followBlogName", "keyboardManager")), this.keyboardNamespace = "conversation:" + this.cid, this.model || (this.model = new _), this.messageFormatter || (this.messageFormatter = new v), this.sortedParticipants = this._getSortedParticipantsCopy(), this.nonParticipantingChannels = this._getNonParticipantingChannels(), this.otherParticipant = this.sortedParticipants.last(), this.getGenericErrorMessage = b([a("Something went screwy."), a("Something's busted."), a("Something got snagged."), a("Something's acting up."), a("Something sucks!"), a("Internet is being dumb."), a("Computer weirdness."), a("The server is being foolish."), a("Something fizzled."), a("The internet evaporated."), a("The internet is being wiggly."), a("Something went splat."), a("Server turned to dust."), a("Something's wonky."), a("Something's not happening."), a("Something's not working."), a("Something got messed up."), a("Unknown, totally annoying error."), a("A nameless error mysteriously occurred."), a("Our computer is a loser."), a("Something pooped out."), a("Something fell into a volcano."), a("Something is all gummed up."), a("Something melted.")]), this.customErrorMessages = {
          409: a("You can only send messages to Tumblrs you follow."),
          428: a("Sorry, %1$s only allows messages from Tumblrs they follow.", this.otherParticipant.get("name")),
          429: a("You've hit the daily limit on new conversations. Impressive.")
        }
      },
      afterRenderSubviews: function () {
        this.listenTo(this, "change:isNewConversation change:isError change:isLoading", this._onChangeViewFlags), this.listenTo(this, "change:isLoading", this._onChangeIsLoading), this.listenTo(this, "change:isOffline", this._onChangeIsOffline), this.listenTo(this, "change:canSend", this._onChangeCanSend), this.listenTo(this.composeView, "submit", this._onComposeSubmit), this.listenTo(this.composeView, "resize", this._onComposeResize), this.listenTo(this.composeView, "change:currentTumblelog", this._onComposeViewChangeBlog), this.listenTo(this.headerView, "closeClick", this._onTriggeredClose), this.listenTo(this.headerView, "moreActionsClick", this._onHeaderMoreActions), this.listenTo(this.model, "change:id", this._onChangeId), this.listenTo(this.model, "change:unreadCount", this._onChangeUnreadCount), this.listenTo(this.model, "change:can_send", this._onChangeConversationCanSend), this.listenTo(this.messagesView, "pillClick", this._onPillClick), this.listenTo(this.messagesView, "messageRetryClick", this._onMessageRetryClick), this.listenTo(this.composeView, "close", this._onTriggeredClose), this._onChangeViewFlags(this), this._onChangeIsLoading(this, this.get("isLoading")), this._onChangeConversationCanSend(this.model, this.model.get("can_send")), this._onChangeCanSend(this, this.get("canSend")), this.set({isNewConversation: this.model.isNew()}), this.get("isAutoFetch") && this.fetch(), this.mainTheme = this._applyTheme(this.el)
      },
      beforeRemove: function () {
        this.model.get("messages").reset(this.model.getInboxMessage()), this.keyboardManager.remove(this.keyboardNamespace), this.trigger("close")
      },
      fetch: function (t) {
        return t = t || {}, s.extend(t, {error: s.bind(this._onFetchConversationFail, this)}), this.set("isLoading", !this.get("isError")), this.eventBus.trigger(this.eventBus.CONVERSATION_FETCHING, this.model), this.model.fetchConversation(t).then(s.bind(this._onFetchConversationSuccess, this)).always(s.bind(this._onFetchConversationAlways, this))
      },
      poll: function (t, e) {
        return t = t || {}, this.eventBus.trigger(this.eventBus.CONVERSATION_FETCHING, this.model), this.model.poll(t, e).then(s.bind(function () {
          this.messagesView.scrollToBottom()
        }, this))
      },
      focus: function () {
        return this.composeView && this.composeView.focus(), this
      },
      _showError: function (t) {
        var e, i;
        return this.conversationErrorView && this.conversationErrorView.remove(), i = this.js$("main"), e = new m(t), i.append(e.render().$el), this.conversationErrorView = e, this.set({
          isError: !0,
          isOffline: !0
        }), this._applyTheme(e.el), e
      },
      _hideError: function () {
        this.conversationErrorView && (this.conversationErrorView.remove(), this.conversationErrorView = null), this.set({
          isError: !1,
          isOffline: !1
        }), this.focus()
      },
      _canRetryConversation: function (t) {
        return !s.contains(this.get("disableRetryOnConversationErrorCodes"), t.status)
      },
      _canRetryMessage: function (t) {
        return !s.contains(this.get("disableRetryOnMessageErrorCodes"), t.status)
      },
      _shouldShowFollowButton: function (t) {
        return s.contains(this.get("showFollowButtonOnErrorCodes"), t.status)
      },
      _onFetchConversationSuccess: function () {
        this.rendered && (this._hideError(), this.model.markAsRead())
      },
      _onFetchConversationFail: function (t, e) {
        var i, o = e.status;
        if (this.rendered) {
          if (this.model.isNew() && 404 === o)return void this._hideError();
          i = s.get(this.customErrorMessages, o, this.getGenericErrorMessage()), this._shouldShowFollowButton(e) && this.otherParticipant && s.isFunction(this.followBlogName) ? this._showError({
            message: i,
            buttonCallback: s.bind(this._onConversationErrorFollowClick, this),
            buttonText: a("Follow %1$s", this.otherParticipant.get("name")),
            buttonTextLoading: a("Following %1$s...", this.otherParticipant.get("name"))
          }) : this._showError({
            message: i,
            buttonCallback: s.bind(this._onConversationErrorRetryClick, this),
            showButton: this._canRetryConversation(e)
          })
        }
      },
      _onFetchConversationAlways: function () {
        this.rendered && this.set("isLoading", !1)
      },
      _onComposeSubmit: function (t) {
        var e = this.model.createTextMessage(t);
        return e.set({
          isPending: !0,
          hasAnimation: !0,
          clientTs: new Date
        }), this._sendMessage(e, {isSendingMessage: !0})
      },
      _sendMessage: function (t, e) {
        this.model.sendMessage(t, e).then(s.bind(this._onSendMessageSuccess, this)).fail(s.bind(this._onSendMessageError, this))
      },
      _resendMessage: function (t) {
        var e = this.model.get("messages"), i = {isResendingMessage: !0};
        t.set("isPending", !0), this.model.sendMessage(t, i).then(s.bind(function () {
          e.last() !== t && (e.remove(t), t.updateClientTimestamp(), e.add(t, i)), this._onSendMessageSuccess(t)
        }, this)).fail(s.bind(this._onSendMessageError, this))
      },
      _onSendMessageSuccess: function (t) {
        this.rendered && (this.set("isNewConversation", !1), t.set({
          isPending: !1,
          isError: !1
        }), this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_SENT, t, this.model))
      },
      _onSendMessageError: function (t, e) {
        this.rendered && (this.set("isNewConversation", !1), t.set({
          isPending: !1,
          isError: !0,
          canRetry: this._canRetryMessage(e)
        }), this.eventBus.trigger(this.eventBus.CONVERSATION_MESSAGE_FAILED, t, this.model))
      },
      _onComposeResize: function () {
        this.messagesView.updateScrollBar()
      },
      _onChangeId: function (t) {
        t.isNew() || (this.set("isNewConversation", !1), this.trigger("created", t))
      },
      _onChangeUnreadCount: function (t, e) {
        var i;
        0 !== e && (i = function () {
          var t = this.model.get("unreadCount"), e = Math.min(10, t + 5);
          return this.model.markAsRead(), this.poll(null, e)
        }, this.messagesView.isAtBottom() ? i.call(this) : this.messagesView.showPill(e).then(s.bind(i, this))["catch"](s.noop))
      },
      _getSortedParticipantsCopy: function () {
        var t = this.model.get("participants"), e = this.channels.getSortedIds(this.model.get("participant").get("uuid")), i = t.getSortedByChannels(e, !0);
        return new t.constructor(i)
      },
      _getNonParticipantingChannels: function () {
        var t = this.channels, e = this.model.get("participants").pluck("uuid"), i = t.filter(function (t) {
          return !s.contains(e, t.get("uuid"))
        });
        return new t.constructor(i)
      },
      _onChangeViewFlags: function (t) {
        var e = t.get("isError"), i = t.get("isLoading"), s = t.get("isNewConversation");
        this.messagesView.toggle(!e && !i), this.newConversationView.$el.toggle(!e && s), this.composeView.set("isDisabled", e || i)
      },
      _onChangeIsLoading: function (t, e) {
        this.conversationLoaderView && this.conversationLoaderView.set("loading", e)
      },
      _onTriggeredClose: function () {
        this.trigger("close")
      },
      _onHeaderMoreActions: function (t) {
        this.actionsPopover && this.actionsPopover.isOrWasRecentlyRendered() || this._showMoreActionsPopover(t)
      },
      _onPillClick: function () {
        this.focus()
      },
      _onBlogClick: function (t) {
        var e = o(t.currentTarget);
        this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_TUMBLR_URL, {
          blogName: e.attr("data-js-tumblelog-name"),
          postId: e.attr("data-js-post-id"),
          url: e.attr("href"),
          originalEvent: t
        })
      },
      _onActionsBlock: function (t) {
        this.eventBus.trigger(this.eventBus.BLOCK, {
          currentTumblelog: this.model.get("participant").get("name"),
          blockedTumblelog: t
        }, this.model)
      },
      _onActionsDelete: function () {
        this.eventBus.trigger(this.eventBus.CONVERSATION_DELETE_MODEL, this.model)
      },
      _applyTheme: function (t) {
        var e;
        if (!s.isEmpty(this.otherParticipant) && (e = this.otherParticipant.get("theme"), !s.isEmpty(e)))return new g({
          el: t,
          theme: e
        }).render()
      },
      _showMoreActionsPopover: function (t) {
        var e;
        this.actionsPopover && this.actionsPopover.remove(), this.actionsPopover = new f({
          autoTeardown: !0,
          pinnedSide: "bottom",
          pinnedTarget: t,
          popoverContainer: this.popoverContainer,
          viewOptions: {participants: this.model.get("participants"), user: this.user}
        }), e = this.actionsPopover.getView(), this.listenTo(e, "block", this._onActionsBlock), this.listenTo(e, "delete", this._onActionsDelete), this.actionsPopover.render()
      },
      _animateInMessage: function (t, e, i) {
        var o = t.$el, a = this.composeView.$el.offset(), r = o.offset(), l = e.offset(), h = Math.max(0, a.top - r.top) + o.height(), c = a.left - l.left;
        this.messagesView.setIsAnimating(!0), n.animate(o, {
          translateY: [0, h],
          translateX: [0, c],
          opacity: [1, 1]
        }, {
          duration: this.get("animateInMessageDuration"), easing: [.19, 1, .22, 1], complete: s.bind(function () {
            this.messagesView.setIsAnimating(!1), i.set("hasAnimation", !1), o.css("transform", "")
          }, this)
        })
      },
      _onConversationErrorRetryClick: function (t) {
        return this.fetch()
      },
      _onConversationErrorFollowClick: function () {
        s.isFunction(this.followBlogName) && this.followBlogName(this.otherParticipant.get("name")).always(s.bind(function () {
          this.fetch()
        }, this))
      },
      _onChangeIsOffline: function (t, e) {
        this.composeView.set("isOffline", e)
      },
      _onMessageRetryClick: function (t) {
        this._resendMessage(t)
      },
      _onChangeConversationCanSend: function (t, e) {
        this.set("canSend", e)
      },
      _onChangeCanSend: function (t, e) {
        var i = a("This Tumblr can't receive messages.");
        this.composeView.$el.toggle(e), e ? this.canSendErrorView && this.canSendErrorView.remove() : this.canSendErrorView || (this.canSendErrorView = this.messagesView.addErrorMessage(i))
      },
      _onComposeViewChangeBlog: function (t, e) {
        var i = new _({participant: e, participants: [e, this.otherParticipant]});
        this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_CONVERSATION_MODEL, i)
      },
      _onMainContainerClick: function () {
        window.getSelection().isCollapsed && this.focus()
      }
    });
    e.exports = w
  }, {
    "../../lib/random-text-responder": 115,
    "../../models/conversation": 120,
    "../../templates/conversation/index.tpl": 140,
    "./conversation-actions-popover": 154,
    "./conversation-compose": 156,
    "./conversation-error": 157,
    "./conversation-header": 158,
    "./conversation-messages": 164,
    "./conversation-new": 165,
    "./conversation-theme": 168,
    "app/components/messaging/lib/message-formatter": 107,
    "components/knight-rider-loader": 496,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613,
    "velocity-animate": "lWl/mc"
  }],
  170: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = o.extend({
      renderWithTemplate: s.noop, initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "channels"))
      }, afterRender: function () {
        this.listenTo(this.channels, "change:unread_messages_count_sum", this._onChangeChannelUnreadCount), this._onChangeChannelUnreadCount()
      }, updateBadge: function (t) {
        t > 0 && this.$(".tab_notice_value").text(t > 99 ? "99+" : t), this.$(".tab_notice").toggleClass("tab-notice--active", t > 0)
      }, _onChangeChannelUnreadCount: function () {
        this.updateBadge(s.sum(this.channels.pluck("unread_messages_count_sum")))
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "prima/views/base": 613}],
  171: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../../templates/inbox/inbox-compose-toggle.tpl"), a = o.extend({
      className: "inbox-compose-toggle",
      template: n,
      defaults: {isComposing: !1},
      events: {"click [data-js-compose-toggle]": "_onClickToggleCompose"},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus"))
      },
      afterRender: function () {
        this.listenTo(this, "change:isComposing", this._onChangeIsComposing)
      },
      _onChangeIsComposing: function (t, e) {
        this.$el.toggleClass("active", e)
      },
      _onClickToggleCompose: function (t) {
        t.preventDefault(), this.set("isComposing", !this.get("isComposing"))
      }
    });
    e.exports = a
  }, {"../../templates/inbox/inbox-compose-toggle.tpl": 141, lodash: "MicNly", "prima/views/base": 613}],
  172: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/lib/translate"), a = t("prima/views/base"), r = t("prima/mixins/selectorcache"), l = t("../../collections/compose-recipients"), h = t("./inbox-recipients"), c = t("components/loader"), d = t("../../templates/inbox/inbox-compose.tpl"), u = a.extend({
      className: "inbox-compose",
      template: d,
      defaults: {isShowFavorites: !0, isLoading: !1, showLoadingAfterMs: 250, hasEditorFocus: !1},
      events: {
        "input [data-js-textinput]": "_onTextInputChange",
        "focus [data-js-textinput]": "_onTextInputFocus",
        "blur [data-js-textinput]": "_onTextInputBlur"
      },
      mixins: [r],
      subviews: {
        favoritesView: {
          constructor: h, options: function (t) {
            return {
              showMessageOnEmpty: !1,
              eventBus: t.eventBus,
              collection: t.favoritesCollection,
              title: n("Favorites"),
              context: "inbox:favorites"
            }
          }
        }, searchResultView: {
          constructor: h, options: function (t) {
            return {eventBus: t.eventBus, collection: t.collection, context: "inbox:typeahead"}
          }
        }
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "favoritesCollection", "currentBlogModel", "keyboardManager")), this.collection = new l, this._debouncedSearch = s.bind(s.debounce(this._search, 250), this)
      },
      afterRenderSubviews: function () {
        this.loader = new c({
          $container: this.$el,
          type: "bar",
          classModifiers: "top",
          loading: !1
        }), this.listenTo(this, "change:isShowFavorites", this._onChangeIsShowFavorites), this.listenTo(this, "change:isLoading", this._onChangeIsLoading), this.listenTo(this, "change:hasEditorFocus", this._onChangeHasEditorFocus), this._onChangeIsShowFavorites(this, this.get("isShowFavorites"))
      },
      _setKeyboardState: function () {
        this.keyboardManager.remove("inbox:compose"), this.get("hasEditorFocus") && (this.get("isShowFavorites") ? this.keyboardManager.add("inbox:compose:favorites", this.favoritesView) : this.keyboardManager.add("inbox:compose:results", this.searchResultView))
      },
      _onChangeHasEditorFocus: function (t, e) {
        this._setKeyboardState()
      },
      fetchResults: function (t) {
        var e = this.currentBlogModel.getChannel().get("uuid");
        return this.set("isLoading", !0), this.collection.fetchByQuery(t, e).always(s.bind(function () {
          this.rendered && this.set({isShowFavorites: !1, isLoading: !1})
        }, this))
      },
      clear: function () {
        this.js$("textinput").val("")
      },
      focus: function () {
        this.js$("textinput").focus()
      },
      blur: function () {
        this.js$("textinput").blur()
      },
      beforeRemove: function () {
        this.keyboardManager.remove("inbox:compose")
      },
      _search: function (t) {
        s.isEmpty(t) ? this.set("isShowFavorites", !0) : this.fetchResults(t)
      },
      _onTextInputChange: function (t) {
        this._debouncedSearch(o(t.target).val())
      },
      _onTextInputBlur: function (t) {
        this.set("hasEditorFocus", !1)
      },
      _onTextInputFocus: function (t) {
        this.set("hasEditorFocus", !0)
      },
      _onChangeIsShowFavorites: function (t, e) {
        this.favoritesView.toggle(e), this.searchResultView.toggle(!e), this._setKeyboardState()
      },
      _onChangeIsLoading: function (t, e) {
        return this._loaderTimeout && (clearTimeout(this._loaderTimeout), this._loaderTimeout = null), e ? void(this._loaderTimeout = setTimeout(s.bind(function () {
          this.loader.set("loading", !0)
        }, this), this.get("showLoadingAfterMs"))) : this.loader.set("loading", !1)
      }
    });
    e.exports = u
  }, {
    "../../collections/compose-recipients": 94,
    "../../templates/inbox/inbox-compose.tpl": 142,
    "./inbox-recipients": 180,
    "components/loader": 499,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  173: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../../templates/inbox/inbox-conversation.tpl"), a = t("../../models/message"), r = t("../../lib/multiline-truncate"), l = t("prima/mixins/selectorcache"), h = o.extend({
      className: "inbox-conversation",
      template: n,
      mixins: [l],
      defaults: {maxInitialMessageLength: 100},
      events: {"click [data-open-conversation]": "_onClickConversation"},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "channels", "currentBlogModel")), this.participants = this.model.get("participants"), this.sortedParticipants = this.participants.getSortedByChannels(this._getOwnSortedBlogIds()), this.message = this.model.getInboxMessage(), this.otherParticipant = s.first(this.sortedParticipants), this.messageParticipant = this.participants.get(this.message.get("participant"))
      },
      afterRender: function () {
        this.listenTo(this.model, "change:last_read_ts change:last_modified_ts", this._onChangeTimestamps), this._onChangeTimestamps(this.model), this._updateMessage()
      },
      openConversation: function () {
        this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_CONVERSATION_MODEL, this.model, "inbox")
      },
      getTemplateData: function () {
        return {
          name: this.otherParticipant.get("name"),
          avatarUrl: this.otherParticipant.getAvatarUrl(),
          message: this._getMessageText(),
          additionalBlogName: this._getAdditionalBlogName(this.message)
        }
      },
      _updateMessage: function () {
        var t = this.message.get("truncatedText"), e = this._getAdditionalBlogName(this.message);
        this.js$("additional-blog-name").text(e).toggle(!s.isEmpty(e)), s.isEmpty(t) ? (this.js$("message-text").text(this._getMessageText()), this._safeTruncateMessage(function (t) {
          this.message.set("truncatedText", t)
        })) : this.js$("message-text").text(t)
      },
      _getMessageText: function () {
        var t, e = this.message.getMessage();
        return this.message.get("type") === a.POST && (t = this.message.get("post").getSentString(this.messageParticipant.get("name")), e = s.compact([t, e]).join(" ")), e.substring(0, this.get("maxInitialMessageLength"))
      },
      _safeTruncateMessage: function (t) {
        var e = this.js$("message"), i = this.js$("message-text"), o = function () {
          r(e), s.isFunction(t) && t.call(this, i.text())
        };
        e.height() ? o.call(this) : (this.$el.css("visibility", "hidden"), s.defer(s.bind(function () {
          this.rendered && (o.call(this), this.$el.css("visibility", ""))
        }, this)))
      },
      _isLastMessageFromSelf: function (t) {
        return this.otherParticipant.get("uuid") !== this.messageParticipant.get("uuid")
      },
      _getAdditionalBlogName: function (t) {
        return this._isLastMessageFromSelf() ? this.messageParticipant.get("name") : void 0
      },
      _onChangeTimestamps: function (t) {
        var e = this.model.getInboxMessage();
        this.$el.toggleClass("is-unread", t.isUnread() && !this._isLastMessageFromSelf()), this.message !== e && (this.message = e, this._updateMessage())
      },
      _onClickConversation: function (t) {
        t.preventDefault(), this.openConversation()
      },
      _getOwnSortedBlogIds: function () {
        return this.channels.getSortedIds(this.currentBlogModel.getId())
      }
    });
    e.exports = h
  }, {
    "../../lib/multiline-truncate": 114,
    "../../models/message": 125,
    "../../templates/inbox/inbox-conversation.tpl": 143,
    lodash: "MicNly",
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  174: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("prima/mixins/selectorcache"), a = t("components/knight-rider-loader"), r = t("../base/collection-base-view"), l = t("./inbox-conversation"), h = t("../../lib/infinite-scrollbar"), c = t("./inbox-recipients"), d = t("../../templates/inbox/inbox-conversations.tpl"), u = r.extend({
      className: "inbox-conversations",
      template: d,
      mixins: [n],
      defaults: {
        isPaginating: !1,
        showFavorites: !1,
        hasNextPage: !0,
        showLoadingContainer: !0,
        appendFavoritesToInboxLimit: 3
      },
      subviews: {
        conversations: {
          constructor: l, enableBatchRendering: !0, options: function (t) {
            return {eventBus: t.eventBus, channels: t.channels, currentBlogModel: t.currentBlogModel}
          }, collection: function (t) {
            return t.collection
          }
        },
        paginationLoaderView: {constructor: a, options: {variation: "small h-centered", loading: !1}},
        favoritesView: {
          constructor: c, options: function (t) {
            return {
              showMessageOnEmpty: !1,
              eventBus: t.eventBus,
              collection: t.favoritesCollection,
              title: o("More Tumblrs to talk to"),
              context: "inbox:moretumblrs"
            }
          }
        }
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "collection", "channels", "favoritesCollection", "currentBlogModel"))
      },
      afterRenderSubviews: function () {
        this.scrollBar = new h({el: this.el}).render(), this.listenTo(this, "change:isPaginating", this._onChangeIsPaginating), this.listenTo(this, "change:showFavorites", this._onChangeShowFavorites), this.listenTo(this, "change:hasNextPage", this._onChangeHasNextPage), this.listenTo(this, "change:showLoadingContainer", this._onChangeShowLoadingContainer), this.listenTo(this.collection, "sort", this._onCollectionSort), this.listenTo(this.collection, "update reset change", this._onCollectionChange), this.listenTo(this.favoritesCollection, "update reset", this._onFavoritesCollectionChange), this.listenTo(this.collection, "reset", this._onCollectionReset), this.listenTo(this, "batch:rendered:conversations", this._onConversationsBatchRendered), this.listenTo(this.collection, "sync", this._onCollectionSync), this.listenTo(this.collection, "change:hasNextPage", this._onChangeCollectionHasNextPage), this.listenTo(this.scrollBar, "scrollbottom", this._onScrollBottom), this._setViewStates(), this._onChangeCollectionHasNextPage(this.collection, this.collection.hasNextPage()), this._onChangeShowFavorites(this, this.get("showFavorites")), this._onChangeHasNextPage(this, this.get("hasNextPage")), this._onChangeShowLoadingContainer(this, this.get("showLoadingContainer")), s.defer(s.bind(this.updateScrollBar, this))
      },
      toggle: function (t) {
        this.$el.toggle(t), this.updateScrollBar()
      },
      beforeRemove: function () {
        return this.scrollBar && this.scrollBar.destroy(), r.prototype.beforeRemove.apply(this, arguments)
      },
      getNextPage: function () {
        this.rendered && this.collection.hasNextPage() && (this.set("isPaginating", !0), this.collection.fetchNextPage().always(s.bind(function () {
          this.rendered && this.set("isPaginating", !1)
        }, this)))
      },
      updateScrollBar: function () {
        this.scrollBar && this.scrollBar.update()
      },
      _setViewStates: function () {
        var t = this.get("hasNextPage"), e = this.collection.length > 0 && !t && this.collection.length <= this.get("appendFavoritesToInboxLimit");
        this.set({showFavorites: e, showLoadingContainer: t}), this.updateScrollBar()
      },
      _saveModelOrder: function () {
        this.lastModelOrder = this._getModelOrderString()
      },
      _getModelOrderString: function () {
        return s.pluck(this.collection.models, "cid").join(" ")
      },
      _onCollectionSort: function (t) {
        var e = this._getModelOrderString();
        this.lastModelOrder && -1 === e.indexOf(this.lastModelOrder) && this.renderCollectionSubviews("conversations"), this._saveModelOrder()
      },
      _onCollectionChange: function (t, e) {
        this._setViewStates(), this._saveModelOrder()
      },
      _onCollectionSync: function () {
        this._onChangeCollectionHasNextPage(this.collection, this.collection.hasNextPage())
      },
      _onCollectionReset: function (t) {
        this.$el.scrollTop(0), this._saveModelOrder()
      },
      _onConversationsBatchRendered: function () {
        this.updateScrollBar()
      },
      _onChangeCollectionHasNextPage: function (t, e) {
        this.set("hasNextPage", e && t.length >= 10)
      },
      _onChangeHasNextPage: function (t, e) {
        this._setViewStates()
      },
      _onChangeIsPaginating: function (t, e) {
        this.paginationLoaderView.set("loading", e)
      },
      _onScrollBottom: function (t) {
        t && this.getNextPage()
      },
      _onChangeShowFavorites: function (t, e) {
        this.favoritesView.$el.toggle(e)
      },
      _onChangeShowLoadingContainer: function (t, e) {
        this.js$("loader-container").toggle(e)
      },
      _onFavoritesCollectionChange: function () {
        this.updateScrollBar()
      }
    });
    e.exports = u
  }, {
    "../../lib/infinite-scrollbar": 103,
    "../../templates/inbox/inbox-conversations.tpl": 144,
    "../base/collection-base-view": 152,
    "./inbox-conversation": 173,
    "./inbox-recipients": 180,
    "components/knight-rider-loader": 496,
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/selectorcache": 586
  }],
  175: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/views/base"), a = t("../../templates/inbox/inbox-empty-blogs.tpl"), r = n.extend({
      className: "inbox-empty-blogs",
      template: a,
      defaults: {numItemsPerRow: 4},
      events: {"click [data-js-start-conversation]": "_onStartConversation"},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "collection"))
      },
      afterRender: function () {
        this.listenTo(this.collection, "update reset", this.render)
      },
      getTemplateData: function () {
        var t, e = this.get("numItemsPerRow"), i = s.map(this.collection.models, function (t) {
          return s.extend(t.toJSON(), {avatarUrl: t.getAvatarUrl()})
        });
        return i.length > 0 && (t = Math.max(1, Math.floor(i.length / e)), i = i.slice(0, t * e)), {blogs: i}
      },
      _onStartConversation: function (t) {
        var e = o(t.currentTarget).attr("data-js-start-conversation"), i = this.collection.findWhere({name: e});
        this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS, [i], "inbox:empty"), t.preventDefault()
      }
    });
    e.exports = r
  }, {"../../templates/inbox/inbox-empty-blogs.tpl": 145, jquery: "HlZQrA", lodash: "MicNly", "prima/views/base": 613}],
  176: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("prima/mixins/selectorcache"), a = t("prima/views/base"), r = t("./inbox-empty-blogs"), l = t("../../templates/inbox/inbox-empty.tpl"), h = a.extend({
      className: "inbox-empty",
      template: l,
      mixins: [n],
      subviews: {
        blogsView: {
          constructor: r, options: function (t) {
            return {collection: t.collection, eventBus: t.eventBus}
          }
        }
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "collection"))
      },
      getTemplateData: function () {
        return {header: o("Talk to a Tumblr")}
      },
      toggle: function (t) {
        this.$el.toggle(t)
      }
    });
    e.exports = h
  }, {
    "../../templates/inbox/inbox-empty.tpl": 146,
    "./inbox-empty-blogs": 175,
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  177: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("./inbox-sender"), a = t("./inbox-compose-toggle"), r = t("../../templates/inbox/inbox-header.tpl"), l = o.extend({
      className: "inbox-header",
      template: r,
      defaults: {isComposing: !1},
      subviews: {
        senderView: {
          constructor: n, options: function (t) {
            return {
              eventBus: t.eventBus,
              user: t.user,
              channels: t.channels,
              popoverContainer: t.popoverContainer,
              currentBlogModel: t.currentBlogModel
            }
          }
        }, composeToggleView: {
          constructor: a, options: function (t) {
            return {eventBus: t.eventBus}
          }
        }
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "user", "channels", "popoverContainer", "currentBlogModel"))
      },
      afterRenderSubviews: function () {
        this.listenTo(this.composeToggleView, "change:isComposing", function (t, e) {
          this.set("isComposing", e)
        }), this.listenTo(this, "change:isComposing", function (t, e) {
          this.composeToggleView.set("isComposing", e)
        })
      }
    });
    e.exports = l
  }, {
    "../../templates/inbox/inbox-header.tpl": 147,
    "./inbox-compose-toggle": 171,
    "./inbox-sender": 181,
    lodash: "MicNly",
    "prima/views/base": 613
  }],
  178: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/views/base"), a = t("prima/mixins/popoverbase"), r = t("./index"), l = t("prima/utils/bindendevent").transition, h = n.extend({
      className: "popover--inbox-popover",
      mixins: [a],
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "viewOptions"))
      },
      render: function () {
        return this.$wrapper = o("<div />").addClass("popover-inner").appendTo(this.$el), this.$wrapper.addClass("hide-popover"), this.$pinned.addClass("active"), this._createView(this.viewOptions), s.defer(s.bind(function () {
          this.$wrapper.removeClass("hide-popover")
        }, this)), this
      },
      teardown: function () {
        return l(this.$wrapper, s.bind(this._afterHide, this)), this.$wrapper.addClass("hide-popover"), this.$pinned.removeClass("active"), this
      },
      _createView: function (t) {
        t = s.isFunction(t) ? t.call(this, this) : t, this.inboxView && this.inboxView.remove(), this.inboxView = new r(t), this.$wrapper.html(this.inboxView.render().$el)
      },
      _afterHide: function () {
        this.inboxView && this.inboxView.remove(), this.$el.remove()
      }
    });
    e.exports = h
  }, {
    "./index": 182,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/mixins/popoverbase": 583,
    "prima/utils/bindendevent": 593,
    "prima/views/base": 613
  }],
  179: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../../templates/inbox/inbox-recipient.tpl"), a = o.extend({
      className: "inbox-recipient",
      template: n,
      defaults: {isSelected: !1, context: "inbox:recipients"},
      events: {
        "click [data-start-conversation]": "_onStartConversationClick",
        mouseenter: "_onRecipientHover",
        mouseleave: "_onRecipientLeave"
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "setSelectedModel", "context"))
      },
      afterRender: function () {
        this.listenTo(this, "change:isSelected", this._onChangeIsSelected)
      },
      getTemplateData: function () {
        return {name: this.model.get("name"), title: this.model.get("title"), avatarUrl: this.model.getAvatarUrl()}
      },
      _onStartConversationClick: function (t) {
        t.preventDefault(), this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS, [this.model], this.get("context"))
      },
      _onChangeIsSelected: function (t, e) {
        this.$el.toggleClass("selected", e)
      },
      _setSelectedModel: function (t) {
        s.isFunction(this.setSelectedModel) && this.setSelectedModel(t)
      },
      _onRecipientHover: function () {
        this._setSelectedModel(this.model)
      },
      _onRecipientLeave: function () {
        this._setSelectedModel(null)
      }
    });
    e.exports = a
  }, {"../../templates/inbox/inbox-recipient.tpl": 148, lodash: "MicNly", "prima/views/base": 613}],
  180: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("prima/mixins/selectorcache"), a = t("../base/selectable-collection-base-view"), r = t("./inbox-recipient"), l = t("../../templates/inbox/inbox-recipients.tpl"), h = t("../../lib/random-text-responder"), c = a.extend({
      className: "inbox-recipients",
      template: l,
      mixins: [n],
      defaults: {isEmpty: !0, showMessageOnEmpty: !0, selectedView: null, context: "inbox:recipients"},
      keyboardCollectionName: "recipients",
      subviews: {
        recipients: {
          constructor: r, options: function (t) {
            return {eventBus: t.eventBus, setSelectedModel: s.bind(t.setSelectedModel, t), context: t.context}
          }, collection: function (t) {
            return t.collection
          }, onSelect: function (t) {
            this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_MODELS, [t], this.context)
          }
        }
      },
      initialize: function (t) {
        return t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "collection", "title", "context")), this.getNoResultsText = h([o("That isn't anyone."), o("Uh, who?"), o("Huh what?"), o("Never heard of 'em."), o("???"), o("Eh?"), o("Whaaa?")]), a.prototype.initialize.apply(this, arguments)
      },
      afterRender: function () {
        this.listenTo(this.collection, "reset update", this._onCollectionChange), this.listenTo(this.collection, "sync", this._onCollectionSync), this.listenTo(this.collection, "sort", this._onCollectionSort), this.listenTo(this, "change:isEmpty", this._onChangeIsEmpty), this.listenTo(this, "change:selectedView", this._onChangeSelectedView), this._onCollectionChange(this.collection), this._onChangeIsEmpty(this, this.get("isEmpty"))
      },
      getTemplateData: function () {
        return {title: this.title, noResultsText: this.getNoResultsText()}
      },
      toggle: function (t) {
        this.$el.toggle(t), t && this.clearSelectedModel();
      },
      _onChangeSelectedView: function (t, e) {
        var i = this.previous("selectedView");
        i && i.rendered && i.set("isSelected", !1), e && e.rendered && e.set("isSelected", !0)
      },
      _onChangeIsEmpty: function (t, e) {
        this.get("showMessageOnEmpty") ? this.js$("no-results-container").toggle(e) : (this.js$("container").toggle(!e), this.js$("no-results-container").hide())
      },
      _cycleNoResultsText: function () {
        this.js$("no-results-text").text(this.getNoResultsText())
      },
      _onCollectionSort: function () {
        this.renderCollectionSubviews("recipients")
      },
      _onCollectionChange: function (t) {
        this.set("isEmpty", 0 === t.length), this.clearSelectedModel()
      },
      _onCollectionSync: function (t) {
        0 === t.length && this.get("showMessageOnEmpty") && this._cycleNoResultsText()
      }
    });
    e.exports = c
  }, {
    "../../lib/random-text-responder": 115,
    "../../templates/inbox/inbox-recipients.tpl": 149,
    "../base/selectable-collection-base-view": 153,
    "./inbox-recipient": 179,
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/selectorcache": 586
  }],
  181: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("app/components/blog-selector"), a = t("../../templates/inbox/inbox-sender.tpl"), r = o.extend({
      className: "inbox-sender",
      template: a,
      subviews: {
        blogSelector: {
          constructor: n, options: function (t) {
            return {
              className: "inbox-sender-blog-selector",
              collection: t.channels,
              popoverOptions: {popoverContainer: t.popoverContainer},
              currentTumblelog: t.channels.findWhere({uuid: t.currentBlogModel.getId()}),
              badgeCountField: "unread_messages_count_sum"
            }
          }
        }
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "user", "channels", "currentBlogModel", "popoverContainer"))
      },
      afterRenderSubviews: function () {
        this.listenTo(this.blogSelector, "change:currentTumblelog", this._onBlogSelectorChange)
      },
      _onBlogSelectorChange: function (t, e) {
        this.currentBlogModel.setChannel(e)
      }
    });
    e.exports = r
  }, {
    "../../templates/inbox/inbox-sender.tpl": 150,
    "app/components/blog-selector": 37,
    lodash: "MicNly",
    "prima/views/base": 613
  }],
  182: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/mixins/selectorcache"), n = t("prima/views/base"), a = t("components/loader"), r = t("./inbox-conversations"), l = t("./inbox-header"), h = t("./inbox-compose"), c = t("./inbox-empty"), d = t("../../templates/inbox/index.tpl"), u = n.extend({
      className: "messaging-inbox",
      template: d,
      defaults: {isLoading: !1, isAutoFetch: !0, isEmpty: !1, isLoadingEmptyInboxFavorites: !1, numFavorites: 5},
      mixins: [o],
      subviews: {
        headerView: {
          constructor: l, options: function (t) {
            return {
              eventBus: t.eventBus,
              user: t.user,
              channels: t.channels,
              currentBlogModel: t.currentBlogModel,
              popoverContainer: t.popoverContainer
            }
          }
        }, composeView: {
          constructor: h, options: function (t) {
            return {
              eventBus: t.eventBus,
              favoritesCollection: t.favoritesCollection,
              currentBlogModel: t.currentBlogModel,
              keyboardManager: t.keyboardManager
            }
          }
        }, conversationsView: {
          constructor: r, options: function (t) {
            return {
              eventBus: t.eventBus,
              collection: t.collection,
              emptyInboxCollection: t.emptyInboxCollection,
              currentBlogModel: t.currentBlogModel,
              channels: t.channels,
              favoritesCollection: t.favoritesCollection,
              appendFavoritesToInboxLimit: t.appendFavoritesToInboxLimit
            }
          }
        }, emptyView: {
          constructor: c, options: function (t) {
            return {eventBus: t.eventBus, collection: t.emptyInboxCollection}
          }
        }
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "eventBus", "collection", "user", "channels", "favoritesCollection", "emptyInboxCollection", "popoverContainer", "currentBlogModel", "appendFavoritesToInboxLimit", "keyboardManager"))
      },
      afterRenderSubviews: function () {
        this.loader = new a({
          $container: this.$el,
          type: "bar",
          classModifiers: "top",
          loading: !1
        }), this.set({
          isLoading: !this.getCurrentChannel().get("isInboxFetched"),
          isEmpty: 0 === this.collection.length
        }), this.listenTo(this, "change", this._setViewStates), this.listenTo(this.collection, "sync error", this._onSyncCollection), this.listenTo(this.collection, "update reset", this._onChangeCollection), this.listenTo(this.collection, "request", this._onRequestCollection), this.listenTo(this.composeView, "submit", this._onComposeSubmitRecipient), this.listenTo(this.headerView, "change:isComposing", this._setViewStates), this._setViewStates(), this.get("isAutoFetch") && this.fetch(), this._fetchEmptyInboxFavorites()
      },
      beforeRemove: function () {
        this.keyboardManager.remove("inbox")
      },
      getCurrentChannel: function () {
        return this.currentBlogModel.getChannel()
      },
      fetch: function (t) {
        this.collection.fetchInbox(this.currentBlogModel.getId(), t)
      },
      _onComposeSubmitRecipient: function (t) {
        this.eventBus.trigger(this.eventBus.CONVERSATION_OPEN_PARTICIPANT_NAMES, t)
      },
      _setViewStates: function () {
        var t = this.get("isEmpty"), e = this.get("isLoading") || this.get("isLoadingEmptyInboxFavorites"), i = this.headerView.get("isComposing");
        this.loader.set("loading", e && !i), this.conversationsView.toggle(!i && !t && !e), this.emptyView.toggle(t && !i && !e), this.composeView.$el.toggle(i), i && this.composeView.focus()
      },
      _onChangeCollection: function () {
        this.set("isEmpty", 0 === this.collection.length)
      },
      _onSyncCollection: function () {
        this.set({
          isLoading: !1,
          isEmpty: 0 === this.collection.length
        }), this.getCurrentChannel().set("isInboxFetched", !0)
      },
      _onRequestCollection: function (t, e, i) {
        this.set({isEmpty: 0 === this.collection.length, isLoading: !this.getCurrentChannel().get("isInboxFetched")})
      },
      _fetchEmptyInboxFavorites: function () {
        this.set("isLoadingEmptyInboxFavorites", !0), this.emptyInboxCollection.fetchFavorites().then(s.bind(function () {
          this.rendered && this.favoritesCollection.reset(s.take(this.emptyInboxCollection.toJSON(), this.get("numFavorites")))
        }, this)).always(s.bind(function () {
          this.rendered && this.set("isLoadingEmptyInboxFavorites", !1)
        }, this))
      }
    });
    e.exports = u
  }, {
    "../../templates/inbox/index.tpl": 151,
    "./inbox-compose": 172,
    "./inbox-conversations": 174,
    "./inbox-empty": 176,
    "./inbox-header": 177,
    "components/loader": 499,
    lodash: "MicNly",
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  183: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/component"), a = t("components/popover").FeatureHelpPopoverView, r = t("app/components/confetti/views/confetti-view"), l = n.extend({
      name: "MessagingTutorial",
      initialize: function (t) {
        t = o.extend({}, t), o.extend(this.attributes, o.pick(t, o.keys(this.defaults))), o.extend(this, o.pick(t, "viewOptions")), this.viewOptions = o.extend({}, this.viewOptions, {
          name: "messaging",
          template: "standard",
          className: "messaging-tutorial-popover",
          glass: !0,
          position: a.POSITION.BOTTOM,
          isFadeOnScroll: !1
        })
      },
      render: function () {
        var t;
        this.popover = this.createPopover(), this.confettiView = this.createConfetti(), t = s("<div />").addClass("messaging-tutorial-confetti"), t.append(this.confettiView.$el), this.popover.show(this.viewOptions), this.popover.getGlassElement().after(t), this.confettiView.render()
      },
      createConfetti: function () {
        var t = new r({autoParty: !0, amount: 50});
        return t.$el.on("click", o.bind(this._onConfettiClick, this)), t
      },
      createPopover: function () {
        var t = new a;
        return this.listenTo(t, "dismiss", this._onPopoverDismiss), this.listenTo(t, "removed", this._onPopoverRemoved), t
      },
      setSeen: function () {
        s.ajax({url: "/svc/conversations/tutorial_seen", method: "POST", with_form_key: !0, dataType: "json"})
      },
      hideTutorial: function () {
        this.popover.hide()
      },
      _onConfettiClick: function () {
        this.popover.hide()
      },
      _onPopoverDismiss: function () {
        this.trigger("dismiss")
      },
      _onPopoverRemoved: function () {
        this.remove()
      },
      remove: function () {
        return this.confettiView && this.confettiView.remove(), this.trigger("hide"), this.setSeen(), n.prototype.remove.apply(this, arguments)
      }
    });
    e.exports = l
  }, {
    "app/components/confetti/views/confetti-view": 43,
    "components/popover": 504,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/component": 545
  }],
  184: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/component"), a = t("./views/app-banner-view"), r = n.extend({
      name: "MobileAppBanner",
      defaults: {type: "download-banner"},
      initialize: function (t) {
        this.options = o.extend(this.defaults, t || {})
      },
      render: function () {
        return this.data && (o.extend(this.data, this.options), (this.data.has_app || "app-gate" === this.options.type) && (this.bannerView = new a(this.data).render().el, s(this.options.attachTo).append(this.bannerView))), this
      }
    });
    e.exports = r
  }, {"./views/app-banner-view": 189, jquery: "HlZQrA", lodash: "MicNly", "prima/component": 545}],
  185: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="mobile-banner-body"><span class="mobile-banner-heading">' + (null == (__t = __("Want to see more stuff?")) ? "" : _.escape(__t)) + '</span> <span class="mobile-banner-subheading">' + (null == (__t = __("Use the Tumblr app!")) ? "" : _.escape(__t)) + '</span></div><div class="mobile-banner-controls"><a href="' + (null == (__t = open_url) ? "" : _.escape(__t)) + '" class="open mobile-banner-button mobile-banner-open secondary-cta flat-button">' + (null == (__t = __("Open")) ? "" : _.escape(__t)) + '</a> <a href="' + (null == (__t = install_url) ? "" : _.escape(__t)) + '" class="install mobile-banner-button mobile-banner-install primary-cta flat-button blue">' + (null == (__t = __("Install the app")) ? "" : _.escape(__t)) + "</a></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  186: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="mobile-banner-body"><span class="mobile-banner-heading">' + (null == (__t = __("Use the Tumblr app!")) ? "" : _.escape(__t)) + '</span> <span class="mobile-banner-subheading">' + (null == (__t = __("It's faster and a zillion times better.")) ? "" : _.escape(__t)) + '</span></div><div class="mobile-banner-controls"><a href="' + (null == (__t = open_url) ? "" : _.escape(__t)) + '" class="open mobile-banner-button secondary-cta flat-button">' + (null == (__t = __("Open")) ? "" : _.escape(__t)) + '</a> <a href="' + (null == (__t = install_url) ? "" : _.escape(__t)) + '" class="install mobile-banner-button primary-cta flat-button white">' + (null == (__t = __("Install the app")) ? "" : _.escape(__t)) + "</a>", show_close_button && (__p += ' <a href="#" class="mobile-banner-close"></a>'), __p += "</div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  187: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="mobile-banner-body"><span class="mobile-banner-heading">' + (null == (__t = __("Want to see more stuff?")) ? "" : _.escape(__t)) + '</span></div><div class="mobile-banner-controls"><a href="/register" class="mobile-banner-button signup primary-cta flat-button blue">' + (null == (__t = __("Sign up")) ? "" : _.escape(__t)) + '</a> <a href="/login" class="mobile-banner-button login secondary-cta flat-button white">' + (null == (__t = __("Log in")) ? "" : _.escape(__t)) + "</a></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  188: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="mobile-banner banner-context-dashboard ' + (null == (__t = banner_class) ? "" : _.escape(__t)) + '"><div class="mobile-banner-inner"><div class="mobile-banner-full"><div data-subview="bannerInternals"></div></div></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  189: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/utils/cookie"), a = t("jquery"), r = t("prima/mixins/subviewable"), l = t("prima/mixins/accessor"), h = t("../templates/app-banner.tpl"), c = t("./download-banner-view"), d = t("./app-gate-view"), u = t("./signup-view"), p = o.extend({
      className: "mobile-app-banner",
      mixins: [r, l],
      events: {"click .open.mobile-banner-button": "__clickOpen", "click .mobile-banner-close": "__clickClose"},
      template: h,
      __clickOpen: function (t) {
        if (this.isIos() && !this.isAtLeastIos9()) {
          t.preventDefault();
          var e = t.target.href;
          this.openInAppOrStore(e)
        }
      },
      __clickClose: function (t) {
        t.preventDefault(), this.closeBanner(), this.setCookie(), this.hideBanner()
      },
      closeBanner: function () {
        this.$el.remove()
      },
      setCookie: function () {
        var t = new Date;
        t.setDate(t.getDate() + 3), n.set("hide_download_app_prompt", "1", t)
      },
      showBanner: function () {
        a(document.documentElement).addClass("mobile-app-banner-visible")
      },
      hideBanner: function () {
        a(document.documentElement).removeClass("mobile-app-banner-visible")
      },
      isIos: function () {
        var t = this.attributes.handset;
        return "iphone" === t || "ipad" === t
      },
      getMajorIosVersion: function () {
        var t = /\bOS ([0-9]+)/g.exec(navigator.userAgent);
        return this.isIos() && t && 2 === t.length && t[1] ? parseInt(t[1]) : !1
      },
      isAtLeastIos9: function () {
        return this.getMajorIosVersion() >= 9
      },
      openInAppOrStore: function (t) {
        var e = "itms-apps://itunes.com/apps/tumblr/tumblr", i = document.getElementById("app_protocol_check") || document.createElement("iFrame");
        i.setAttribute("id", "app_protocol_check"), i.style.display = "none", document.body.appendChild(i), i.src = t, setTimeout(function () {
          document.location.href = e
        }, 1e3)
      },
      initialize: function (t) {
        s.extend(this.attributes, t), this.$el.addClass(this.get("type")), "app-gate" === this.get("type") ? this.get("has_app") ? this.subViews.bannerInternals = new d(t) : this.subViews.bannerInternals = new u(t) : this.subViews.bannerInternals = new c(t)
      },
      render: function () {
        return n.get("hide_download_app_prompt") ? !1 : (this.showBanner(), this.$el.html(this.template(this.toJSON())), this.attachSubViews(), this)
      }
    });
    e.exports = p
  }, {
    "../templates/app-banner.tpl": 188,
    "./app-gate-view": 190,
    "./download-banner-view": 191,
    "./signup-view": 192,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/subviewable": 587,
    "prima/utils/cookie": 598,
    "prima/view": 612
  }],
  190: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("../templates/_app-gate.tpl"), r = o.extend({
      mixins: [n],
      template: a,
      initialize: function (t) {
        s.extend(this.attributes, t)
      },
      render: function () {
        return this.set("install_url", this.get("install_url") + "?referrer=mobile_gate"), this.set("open_url", this.get("open_url") + "&referrer=mobile_gate"), this.$el.html(this.template(this.toJSON())), this
      }
    });
    e.exports = r
  }, {"../templates/_app-gate.tpl": 185, lodash: "MicNly", "prima/mixins/accessor": 577, "prima/view": 612}],
  191: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("../templates/_download-banner.tpl"), r = o.extend({
      mixins: [n],
      template: a,
      initialize: function (t) {
        s.extend(this.attributes, t)
      },
      render: function () {
        return this.set("install_url", this.get("install_url") + "?referrer=mobile_banner_dashboard"), this.set("open_url", this.get("open_url") + "&referrer=mobile_banner_dashboard"), this.$el.html(this.template(this.toJSON())), this
      }
    });
    e.exports = r
  }, {"../templates/_download-banner.tpl": 186, lodash: "MicNly", "prima/mixins/accessor": 577, "prima/view": 612}],
  192: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("../templates/_signup.tpl"), r = o.extend({
      mixins: [n],
      template: a,
      initialize: function (t) {
        s.extend(this.attributes, t)
      },
      render: function () {
        return this.$el.html(this.template(this.toJSON())), this
      }
    });
    e.exports = r
  }, {"../templates/_signup.tpl": 187, lodash: "MicNly", "prima/mixins/accessor": 577, "prima/view": 612}],
  193: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/events"), n = t("app/models/post"), o = t("prima/events"), a = t("prima/collection"), r = t("../models/header"), l = a.extend({
      model: n,
      url: "/svc/indash_blog/posts",
      blogNameOrId: "",
      _hasFetchedEverything: !1,
      initialize: function (t, e) {
        this.loading = !1, this.tumblelog = new r, e = e || {}, this.blogNameOrId = e.blogNameOrId, this.postId = e.postId, e.url && (this.url = e.url), this.listenTo(o, "indashblog:post:like", this.likePostbyId), this.bindBlogSearchEvents()
      },
      bindBlogSearchEvents: function () {
        this.listenTo(o, "indashblog:search:start", this.blogSearchStarted), this.listenTo(o, "indashblog:search:complete", this.blogSearchCompleted), this.listenTo(o, "indashblog:search:post-added", this.blogSearchPostAdded), this.listenTo(o, "indashblog:search:results-end", this.blogSearchResultsEnd), this.listenTo(o, "indashblog:search:clear", this.blogSearchClear)
      },
      blogSearchStarted: function () {
        this.searchMode = !0, this.reset(), this.trigger("request", this), this.loading = !0, o.trigger("indashblog:search:fetch-requested")
      },
      blogSearchPostAdded: function (t) {
        this.add(t)
      },
      blogSearchCompleted: function (t) {
        this.reset(t), this.trigger("sync", this), this.loading = !1
      },
      blogSearchResultsEnd: function (t) {
        this._hasFetchedEverything = !0, this.loading = !1, this.trigger("sync", this)
      },
      blogSearchClear: function () {
        this.searchMode = !1, this.reset(), this.trigger("request", this), this.fetch()
      },
      fetch: function (t) {
        return this.loading ? void 0 : this.searchMode ? (this.trigger("request", this), void o.trigger("indashblog:search:fetch-requested", t)) : (t = t || {}, t.blogNameOrId && (this.blogNameOrId = t.blogNameOrId), t.data = {
          tumblelog_name_or_id: this.blogNameOrId,
          post_id: this.postId || null,
          limit: this.postId ? 1 : t.limit || 10,
          offset: t.offset || 0
        }, this.loading = !0, a.prototype.fetch.call(this, t))
      },
      fetchMore: function (t) {
        if (t = t || {}, !this.hasFetchedEverything() && !this.loading) {
          if (this.searchMode)return this.trigger("request", this), void o.trigger("indashblog:search:fetch-requested", t);
          var e = this.models.length;
          return this.postId && (e -= 1, this.postId = null), t = s.extend({offset: e, remove: !1}, t), this.fetch(t)
        }
      },
      parse: function (t, e) {
        return (!t.response.posts.length || t.response.posts.length < e.data.limit) && (this._hasFetchedEverything = !0), t.response.tumblelog && this.tumblelog.set(t.response.tumblelog), t.response.tracking_html && !s.isEmpty(t.response.tracking_html) && o.trigger("component:TrackingPixels", {init: t.response.tracking_html}), this.loading = !1, t.response.posts
      },
      reset: function () {
        this._hasFetchedEverything = !1, a.prototype.reset.apply(this, arguments)
      },
      hasFetchedEverything: function () {
        return this._hasFetchedEverything
      },
      likePostbyId: function (t, e) {
        var i = this.get(t);
        i && (e = e || "mouse", i.like(e), o.trigger("peepr:like_update", i.get("tumblelog"), i.toJSON()))
      }
    });
    e.exports = l
  }, {"../models/header": 202, "app/models/post": 462, lodash: "MicNly", "prima/collection": 544, "prima/events": 546}],
  194: [function (t, e, i) {
    "use strict";
    e.exports = t("./views/messaging-popover-icon")
  }, {"./views/messaging-popover-icon": 198}],
  195: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "" + (null == (__t = _("Send a message")) ? "" : _.escape(__t));
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  196: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", hasAsks && (__p += '<li data-js-ask><a class="ask" href="' + (null == (__t = url) ? "" : _.escape(__t)) + '/ask">' + (null == (__t = _("Ask a question")) ? "" : _.escape(__t)) + "</a></li>"), __p += "", hasMessaging && (__p += '<li data-js-message><a href="#">' + (null == (__t = _("Send a message")) ? "" : _.escape(__t)) + "</a></li>"), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  197: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="popover_inner"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  198: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/events"), n = t("prima/views/base"), a = t("./messaging-popover"), r = t("../templates/messaging-popover-icon.tpl"), l = n.extend({
      template: r,
      className: "messaging-popover-icon nav_icon",
      events: {click: "_onIconClick"},
      initialize: function (t) {
        this.options = s.extend({}, this.defaults, t), s.extend(this, s.pick(t, "model"))
      },
      showPopover: function () {
        this.popover || (this.popover = new a({
          pinnedTarget: this.$el,
          model: this.model,
          preventInteraction: !0
        }), this.popover.render(), this.listenTo(this.popover.getView(), "messagingSelected", this._onMessagingSelected), this.listenTo(this.popover.getView(), "askSelected", this._onAskSelected), this.listenTo(this.popover, "close", this._onPopoverClose))
      },
      openMessaging: function () {
        o.trigger("messaging:conversation:open:tumblelogs", [this.model], "peepr")
      },
      openAsk: function () {
        o.trigger("ask:form:open", {
          recipient: this.model.get("name"),
          allow_anonymous: this.model.get("anonymous_asks")
        })
      },
      _onIconClick: function () {
        this.model.get("asks") ? this.showPopover() : this.openMessaging()
      },
      _onMessagingSelected: function () {
        this.openMessaging()
      },
      _onAskSelected: function () {
        this.openAsk()
      },
      _onPopoverClose: function () {
        this.stopListening(this.popover), this.stopListening(this.popover.getView()), this.popover = null
      }
    });
    e.exports = l
  }, {
    "../templates/messaging-popover-icon.tpl": 195,
    "./messaging-popover": 200,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/views/base": 613
  }],
  199: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../templates/messaging-popover-list.tpl"), a = o.extend({
      tagName: "ul",
      template: n,
      events: {"click [data-js-ask]": "_onClickAsk", "click [data-js-message]": "_onClickMessage"},
      getTemplateData: function () {
        return {
          hasMessaging: this.model.get("can_receive_messages") === !0,
          hasAsks: this.model.get("asks") === !0,
          url: this.model.get("url")
        }
      },
      _onClickMessage: function (t) {
        t.preventDefault(), this.trigger("messagingSelected"), this.trigger("popoverClose")
      },
      _onClickAsk: function (t) {
        t.preventDefault(), this.trigger("askSelected"), s.delay(s.bind(function () {
          this.trigger("popoverClose")
        }, this), 1)
      }
    });
    e.exports = a
  }, {"../templates/messaging-popover-list.tpl": 196, lodash: "MicNly", "prima/views/base": 613}],
  200: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("./messaging-popover-list"), a = t("prima/mixins/popoverbase"), r = t("../templates/messaging-popover.tpl"), l = o.extend({
      className: "popover--messaging-peepr popover info_popover popover_gradient",
      template: r,
      mixins: [a],
      initialize: function (t) {
        this.options = s.extend({}, this.defaults, t), this.view = new n({model: this.model})
      },
      render: function () {
        return this.$el.html(this.template), this.$(".popover_inner").append(this.view.render().$el), this.listenTo(this.view, "popoverClose", this.teardown), this
      },
      teardown: function () {
        this.view.remove(), this.remove()
      },
      getView: function () {
        return this.view
      }
    });
    e.exports = l
  }, {
    "../templates/messaging-popover.tpl": 197,
    "./messaging-popover-list": 199,
    lodash: "MicNly",
    "prima/mixins/popoverbase": 583,
    "prima/view": 612
  }],
  201: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/events"), a = t("prima/component"), r = t("app/components/drawer"), l = t("./views/body"), h = t("prima/lib/data"), c = a.extend({
      name: "peepr",
      params: "",
      initialize: function () {
        this.listenTo(n, "peepr-open-request", this.onPeeprRequest);
        var t = h.get("Components/Peepr") || {};
        this.params = t, t.blog_name && (this.listenToOnce(n, "peepr:close", this.onPeeprClose), s(document).ready(o.bind(this.onPeeprRequestWithParams, this)))
      },
      onPeeprClose: function () {
        window.Backbone.history.navigate("/dashboard")
      },
      onPeeprRequestWithParams: function () {
        n.trigger("peepr-open-request", {tumblelog_name: this.params.blog_name, post_id: this.params.post_id})
      },
      onPeeprRequest: function (t) {
        t.tumblelog_name && this.open(t)
      },
      open: function (t) {
        t.className = "peepr-drawer", r().canOpen() && (s("body").addClass("flag--peepr-redux"), r().open(l, t, "peepr-drawer-container"))
      }
    });
    e.exports = c
  }, {
    "./views/body": 205,
    "app/components/drawer": 49,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/component": 545,
    "prima/events": 546,
    "prima/lib/data": 548
  }],
  202: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("app/models/tumblelog"), n = t("prima/events"), a = t("prima/model"), r = t("app/components/blog-card/utils/webfonts"), l = a.extend({
      url: "/svc/indash_blog/header",
      initialize: function (t, e) {
        e = e || {}, this.listenTo(this, "change", this.onModelChange)
      },
      onModelChange: function () {
        this.tumblelog = this.tumblelog || new o({name: this.get("name")}), this.tumblelog_name_or_id = this.get("name");
        var t = this.tumblelog.get("following");
        if (!s.isUndefined(t) && this.get("following") !== t) {
          var e = {source: this.get("following") ? "FOLLOW_SOURCE_PEEPR_HEADER" : "UNFOLLOW_SOURCE_PEEPR_HEADER"};
          this.tumblelog.save_following({following: this.get("following")}, e), n.trigger("peepr:follow_update", this.get("following"))
        }
        this.tumblelog.set(this.toJSON())
      },
      get_theme_param: function (t) {
        var e = this.get("global_theme_params") || {};
        return e[t]
      },
      set_theme_params: function (t) {
        var e = s.clone(this.get("global_theme_params"));
        this.set("global_theme_params", s.extend({}, e, t))
      },
      fetch: function (t) {
        t = t || {}, t.data = {tumblelog_name_or_id: t.tumblelog_name_or_id || this.get("name")}, a.prototype.fetch.call(this, t)
      },
      save: function (t, e) {
        var i = s.extend({}, this.defaults, t);
        return i.global_theme_params = s.omit(i.global_theme_params, ["header_image_dimens", "header_image_focused"]), e = e || {}, e.contentType = "application/json", e.data = JSON.stringify({
          tumblelog_name_or_id: this.get("name"),
          tumblelog: i
        }), e.with_form_key = !0, a.prototype.save.call(this, t, e)
      },
      getAvailableFonts: function () {
        return r
      }
    });
    e.exports = l
  }, {
    "app/components/blog-card/utils/webfonts": 33,
    "app/models/tumblelog": 463,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/model": 590
  }],
  203: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="peepr-body"><div class="indash_blog"><header data-subview="header" class="header"></header><main data-subview="posts" class="posts"></main></div></div><div data-subview="bigLoader"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  204: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("components/knight-rider-loader"), a = o.extend({
      renderWithTemplate: s.noop,
      className: "peepr-big-loader",
      initialize: function (t) {
        this.options = s.defaults({}, t), this.loader = new n, this.loader.set("loading", this.options.loading)
      },
      render: function () {
        this.$el.append(this.loader.render().$el)
      },
      toggle: function (t) {
        this.options.loading = t, this.loader.set("loading", t), this.$el.toggleClass("hidden", !t)
      },
      show: function () {
        this.toggle(!0)
      },
      hide: function () {
        this.toggle(!1)
      }
    });
    e.exports = a
  }, {"components/knight-rider-loader": 496, lodash: "MicNly", "prima/views/base": 613}],
  205: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/events"), a = t("prima/views/base"), r = t("app/components/tracking-pixels"), l = t("app/components/auto-pager"), h = t("../templates/body.tpl"), c = t("./posts"), d = t("./header"), u = t("../collections/posts"), p = t("./big-loader"), m = t("./post-keycommands-view"), g = a.extend({
      template: h,
      subviews: {posts: {constructor: c}, header: {constructor: d}, bigLoader: {constructor: p}},
      initialize: function (t) {
        this.$body = o("body"), this.options = t, this.loadCount = 0, this.setCollection(), this.postKeycommandsView = new m({el: this.$el}), this.collection.fetch().then(s.bind(this.onFirstSync, this)), this.bindEvents(), n.trigger("peepr:open", {
          tumblelog_name: this.options.tumblelog_name,
          post_id: this.options.post_id,
          loggingData: {tumblelog_name: this.options.tumblelog_name, post_id: this.options.post_id}
        }), r.setup()
      },
      setCollection: function () {
        this.collection && this.collection.stopListening(), this.collection = new u([], {
          blogNameOrId: this.options.tumblelog_name,
          postId: this.options.post_id
        }), this.listenTo(this.collection.tumblelog, "change:global_theme_params", this.setBkgColor), this.listenTo(this.collection, "error", this.onSyncError), s.each(this.subviews, function (t) {
          t.options = s.defaults({
            collection: this.collection,
            editing_appearance: this.options.editing_appearance,
            searchTagTerm: this.options.searchTagTerm || ""
          }, t.options || {})
        }, this)
      },
      bindEvents: function () {
        this.$el.scroll(this.onBodyScroll), this.listenTo(n, "peepr-open-request", this.onPeeprOpenRequest), this.listenTo(n, "peepr:like_update", this.onPostLike), this.listenTo(n, "peepr:follow_update", this.onHeaderFollow), this.listenTo(n, "indashblog:post:reblog", this.onLegacyReblog), this.listenTo(n, "indashblog:search:start indashblog:search:clear", this.scrollToPosts)
      },
      afterRender: function () {
        this.autoPager && (this.autoPager.close(), this.autoPager = null), this.autoPager = new l({$target: this.$(".peepr-body")}), this.listenTo(this.autoPager, "trigger", s.throttle(this.onAutopagerTrigger, 500, {trailing: !1})), document.activeElement.blur()
      },
      onAutopagerTrigger: function () {
        this.collection.fetchMore(), this.log("paginate", {postCount: this.collection.length})
      },
      onBodyScroll: function (t) {
        var e = {windowScrollTop: o(t.currentTarget).scrollTop()};
        window.requestAnimationFrame ? requestAnimationFrame(function () {
          n.trigger("peepr-body-scroll", e)
        }) : n.trigger("peepr-body-scroll", e)
      },
      onLegacyReblog: function (t) {
        var e = "POST_CONTEXT_PEEPR";
        t.reblog_key || (t.reblog_key = this.collection.get(t.id).get("reblog_key")), n.trigger("postForms:reblog", {
          reblogSource: e,
          reblogId: t.id,
          reblogKey: t.reblog_key,
          pt: t.pt
        }), this.listenToOnce(n, "postForms:saved", this.onPostFormReblogSuccess), this.log("peepr_reblog", {postId: t.id})
      },
      onPostFormReblogSuccess: function (t, e) {
        this.log("peepr_reblog_success", {postId: e.responseJSON.post.id})
      },
      onPostLike: function (t, e) {
        this.log("peepr_like_update", {postId: e.id, liked: e.liked})
      },
      onHeaderFollow: function (t) {
        this.log("peepr_follow", {following: t})
      },
      onFirstSync: function () {
        this.rendered && (this.bigLoader.hide(), this.$(".indash_blog").addClass("intro"), s.delay(s.bind(function () {
          this.rendered && this.$(".indash_blog").removeClass("intro")
        }, this), 1e3), this.log(this.loadCount ? "reload" : "load"), this.loadCount++)
      },
      onPeeprOpenRequest: function (t) {
        t.tumblelog_name && (this.options = t, this.setCollection(), this.reload())
      },
      reload: function () {
        this.stopListening(this.autoPager), this.removeSubviews(), this.render(), this.collection.fetch().then(s.bind(this.onFirstSync, this))
      },
      setBkgColor: function () {
        var t = this.collection.tumblelog.get("global_theme_params") || {};
        s.has(t, "background_color") && this.$(".peepr-body").css("background-color", t.background_color)
      },
      scrollToPosts: function () {
        this.headerScrollHeight = this.headerScrollHeight || this.$(".header_image_wrapper").height() - this.$(".navigation").height(), this.$el.scrollTop(this.headerScrollHeight)
      },
      onSyncError: function () {
        this.log("ajax-error", {offset: this.collection.length, path: window.location.href})
      },
      log: function (t, e) {
        var i = s.defaults({
          blogname: this.options.tumblelog_name,
          postId: this.options.postId,
          loadCount: this.loadCount
        }, e || {});
        n.trigger("peepr:log:" + t, {loggingData: {payload: i}})
      },
      remove: function () {
        this.log("close"), this.collection.stopListening(), this.postKeycommandsView && this.postKeycommandsView.remove(), n.trigger("peepr:close", this.options.tumblelog_name, this.options.post_id), a.prototype.remove.call(this)
      }
    });
    e.exports = g
  }, {
    "../collections/posts": 193,
    "../templates/body.tpl": 203,
    "./big-loader": 204,
    "./header": 206,
    "./post-keycommands-view": 207,
    "./posts": 208,
    "app/components/auto-pager": 29,
    "app/components/tracking-pixels": 395,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/views/base": 613
  }],
  206: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/events"), a = t("prima/views/base"), r = t("prima/lib/data"), l = t("app/components/blog-card/utils/webfonts"), h = a.extend({
      renderWithTemplate: s.noop, className: "header", initialize: function (t) {
        this.options = t, this.listenToOnce(this.collection, "sync", this.insertHeader)
      }, insertHeader: function () {
        this.header = new window.Tumblr.IndashBlog.HeaderView({
          model: this.collection.tumblelog,
          el: this.$el,
          is_peepr: !0,
          show_share_controls: !0,
          show_follow_button: !0,
          show_user_controls: !0,
          show_dismiss_controls: !1,
          on_customize_open: s.bind(this.renderAllFontStyles, this)
        }).render(), this.setupHeader()
      }, setupHeader: function () {
        var t = this.collection.tumblelog.get("global_theme_params").title_font;
        this.renderSingleFontStyle(t), this.$(".navigation").width(this.$el.width() || 585), n.trigger("indashblog:ready-animation-start"), this.options.editing_appearance && this.header.start_customizing(), this.options.searchTagTerm && n.trigger("peeprsearch:change:term", {term: this.options.searchTagTerm})
      }, renderAllFontStyles: function () {
        s.each(l, function (t) {
          this.appendFontToHead(t)
        }, this)
      }, renderSingleFontStyle: function (t) {
        var e = s.result(l, t);
        e && this.appendFontToHead(e)
      }, appendFontToHead: function (t) {
        var e = r.get("Context/hosts/assets_host") || "", i = "webfont_" + t.path;
        if (t.path && !o("head #" + i).length) {
          var n = e + "/fonts/" + t.path + "/stylesheet.css";
          n += s.has(t, "_v") ? "?v=" + t._v : "", o("<link>", {
            id: i,
            rel: "stylesheet",
            type: "text/css",
            href: n
          }).appendTo(o("head"))
        }
      }, remove: function () {
        this.header && this.header.remove(), a.prototype.remove.call(this)
      }
    });
    e.exports = h
  }, {
    "app/components/blog-card/utils/webfonts": 33,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/data": 548,
    "prima/views/base": 613
  }],
  207: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/events"), a = t("prima/mixins/keycommands"), r = t("prima/view"), l = r.extend({
      mixins: [a],
      keycommands: {
        "keydown:j": "scrollToNextItem",
        "keydown:k": "scrollToPrevItem",
        "keydown:l": "like",
        "keydown:r": "reblog",
        "keydown:period": "ttt",
        "keydown:enter": "openBlog"
      },
      defaults: {selector: ".post", scrollOffset: 60, speed: 200},
      initialize: function (t) {
        this.options = s.defaults(t || {}, this.defaults), this.listenTo(n, "post:form:show indashblog:keycommands:suspend", this.disableKeys), this.listenTo(n, "post:form:hide indashblog:keycommands:resume", this.enableKeys), this.listenTo(n, "keycommands:resume", this.onDashboardKeycommandsResume), this.listenTo(n, "drawer:close", this.resumeDashboardKeycommands)
      },
      onDashboardKeycommandsResume: function () {
        n.trigger("keycommands:suspend")
      },
      resumeDashboardKeycommands: function () {
        this.stopListening(n, "keycommands:resume"), n.trigger("keycommands:resume")
      },
      indexPageableItems: function () {
        var t = {};
        this.currentPosition = this.getScrollOffset(), this.goToPosition = 0, this.$(this.options.selector).each(function (e) {
          var i = o(this);
          t[e] = Math.round(i.position().top)
        }), this.positions = t
      },
      getScrollOffset: function () {
        return this.$el.scrollTop()
      },
      like: function () {
        var t = this.findPostId();
        t && n.trigger("indashblog:post:like", t, "keyboard")
      },
      reblog: function () {
        var t = this.findPostId();
        t && n.trigger("indashblog:post:reblog", {id: t}, "keyboard")
      },
      ttt: function () {
        this.goToPosition = 1, this.$el.stop().animate({scrollTop: 0}, this.options.speed, s.bind(function () {
          this.animating = !1
        }, this))
      },
      openBlog: function () {
        var t = this.$("[data-post-id=" + this.findPostId() + "] .reblog_info.post_info_link");
        t.length && n.trigger("peepr-open-request", {url: t.attr("href"), tumblelog_name: t.data("tumblelog-name")})
      },
      scrollToNextItem: function () {
        this.indexPageableItems(), this.nextPosition(), n.trigger("keycommands:jk", {loggingData: {source: "peepr"}})
      },
      scrollToPrevItem: function () {
        this.indexPageableItems(), this.previousPosition(), n.trigger("keycommands:jk", {loggingData: {source: "peepr"}})
      },
      nextPosition: function () {
        for (var t in this.positions) {
          var e = this.positions[t];
          e > this.currentPosition + this.options.scrollOffset && (e < this.goToPosition || !this.goToPosition) && (this.goToPosition = e)
        }
        this.animate()
      },
      previousPosition: function () {
        for (var t in this.positions) {
          var e = this.positions[t];
          e < this.currentPosition - this.options.scrollOffset && e > this.goToPosition && (this.goToPosition = e)
        }
        this.animate()
      },
      animate: function () {
        this.goToPosition && !this.animating && (this.animating = !0, this.$el.stop().animate({scrollTop: this.goToPosition - this.options.scrollOffset}, this.options.speed, s.bind(function () {
          this.animating = !1
        }, this)))
      },
      findPostId: function () {
        if (this.goToPosition - this.options.scrollOffset === this.getScrollOffset()) {
          var t = s.invert(this.positions)[this.goToPosition];
          if (t) {
            var e = this.$(this.options.selector).get(t);
            if (e)return o(e).data("post-id")
          }
        }
        return !1
      }
    });
    e.exports = l
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/events": 546, "prima/mixins/keycommands": 581, "prima/view": 612}],
  208: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/events"), a = t("prima/views/base"), r = t("prima/lib/flags"), l = t("components/knight-rider-loader"), h = a.extend({
      className: "posts",
      initialize: function () {
        this.postViews = [], this.listenTo(n, "indashblog:post:photo_lightbox", this.onLightboxRequest), this.listenTo(this.collection, "sync", this.onCollectionSync), this.listenTo(this.collection, "reset", this.onCollectionReset), this.listenTo(this.collection, "request", this.onCollectionRequest), this.listenTo(this.collection, "add", this.renderPost), this.listenTo(n, "DOMEventor:flatresize", this.setMinHeight), this.listenTo(n, "indashblog:search:results-end", this.onSearchResultsEnd)
      },
      render: function () {
        return this.loader = new l, this.$el.append(this.loader.render().$el), this.setMinHeight(), this
      },
      renderWithTemplate: s.noop,
      setMinHeight: function () {
        var t = o(window).height();
        this.navHeight = this.navHeight || o(".peepr-body .navigation").height() + o(".peepr-body .info_wrapper").height(), this.$el.css("min-height", t - this.navHeight + "px")
      },
      renderPost: function (t) {
        if (!r.bool("hide_legacy_posts")) {
          var e = new window.Tumblr.IndashBlog.PostView({model: t});
          this.postViews.push(e), this.$(".knight-rider-container").before(e.render().el), s.defer(s.bind(function () {
            this.make_tags_draggable()
          }, e))
        }
      },
      onSearchResultsEnd: function (t) {
        t && (this.searchResultsEndView = t, this.$(".knight-rider-container").before(this.searchResultsEndView.render().$el))
      },
      onCollectionReset: function () {
        this.searchResultsEndView && this.searchResultsEndView.remove(), this.collection.length ? this.collection.each(this.renderPost, this) : (s.each(this.postViews, function (t) {
          t.remove()
        }), this.postViews = [])
      },
      onCollectionRequest: function () {
        this.loader.set("loading", !0)
      },
      onCollectionSync: function () {
        this.loader.set("loading", !1)
      },
      onLightboxRequest: function (t) {
        var e = t.post, i = e.get("photos"), o = t.photosetIndex || 0, a = [];
        s.each(i, function (t) {
          a.push({
            width: t.original_size.width,
            height: t.original_size.height,
            low_res: t.alt_sizes[0].url,
            high_res: t.original_size.url
          })
        }), n.trigger("lightbox-open-request", a, o)
      }
    });
    e.exports = h
  }, {
    "components/knight-rider-loader": 496,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/flags": "f/LVtH",
    "prima/views/base": 613
  }],
  209: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/collection"), n = t("../models/photo"), a = o.extend({
      model: n,
      getSubset: function (t) {
        return s.isUndefined(t) ? [] : s.map(s.isArray(t) ? t : s.toArray(arguments), this.get, this)
      },
      getSubCollection: function (t) {
        return new a(this.getSubset.apply(this, arguments))
      },
      setIdOrder: function (t, e) {
        e || (e = {}), this.models = s.map(t, function (t) {
          return this.get(t)
        }, this), e.silent || this.trigger("sort", this, e)
      }
    });
    e.exports = a
  }, {"../models/photo": 211, lodash: "MicNly", "prima/collection": 544}],
  210: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/component"), n = t("./models/photoset"), a = (t("./models/photo"), t("./collections/photos"), t("./utils"), t("./views/photoset")), r = t("./views/photo"), l = o.extend({
      name: "Photoset",
      initialize: function (t) {
        (s.isArray(t) || t instanceof n) && (t = {photoset: t}), this.options = t = s.extend({}, t), t.photoset instanceof n ? this.model = t.photoset : this.model = new n(t.photoset);
        var e = s.keys(a.prototype.defaults);
        e.push("PhotoView"), e.push("post");
        var i = s.pick(t, e);
        i.photoset = this.model, this._PhotosetView = t.PhotosetView || a, this._PhotoView = t.PhotoView || r, this.indexView = new this._PhotosetView(i), this.listenTo(this.model, "all", this._relayModelEvent), this.listenTo(this.model.photos, "all", this._relayModelEvent)
      },
      _relayModelEvent: function () {
        this.trigger.apply(this, arguments)
      },
      teardown: function () {
        return this.indexView.teardown(), this.stopListening(), this
      },
      remove: function () {
        return this.teardown(), this.indexView.remove(), this
      },
      render: function () {
        return this.indexView.render(), this
      },
      getElement: function () {
        return this.indexView.$el
      }
    });
    e.exports = l
  }, {
    "./collections/photos": 209,
    "./models/photo": 211,
    "./models/photoset": 212,
    "./utils": 217,
    "./views/photo": 220,
    "./views/photoset": 221,
    lodash: "MicNly",
    "prima/component": 545
  }],
  211: [function (t, e, i) {
    "use strict";
    var s = t("prima/model"), o = t("../utils/imagelayout"), n = s.extend({
      defaults: {
        width: null,
        height: null,
        x: "50%",
        y: "50%",
        url: "",
        caption: "",
        clickthroughUrl: ""
      }, getAspectRatio: function () {
        return o.aspectRatio(this.get("width"), this.get("height"))
      }, getWidthForHeight: function (t) {
        return o.widthForHeight(this.get("width"), this.get("height"), t)
      }, getHeightForWidth: function (t) {
        return o.heightForWidth(this.get("width"), this.get("height"), t)
      }
    });
    e.exports = n
  }, {"../utils/imagelayout": 216, "prima/model": 590}],
  212: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/model"), n = t("../collections/photos"), a = t("../utils/imagelayout"), r = ["", "1", "11", "12", "13", "123", "133", "1232", "1323", "12223"], l = 3, h = o.extend({
      defaults: {layout: null},
      initialize: function (t, e) {
        e = s.extend({}, e), this.layouts = e.layouts || r, this.maxPerRow = e.maxPerRow || l, (s.isArray(t) || t instanceof n) && (this.attributes = s.extend({photos: t}, this.defaults)), this.get("photos") instanceof n ? this.photos = this.get("photos") : this.photos = new n(this.get("photos")), this.unset("photos"), this.fixLayout()
      },
      fixLayout: function () {
        var t = this.get("layout");
        return t = t ? a.fix(t, this.photos.length, this.layouts, this.maxPerRow) : a.calculateDefault(this.photos.length, this.layouts, this.maxPerRow), this.set("layout", t), t
      },
      getRows: function (t) {
        return a.toArray(t || this.get("layout"), this.photos, this.layouts, this.maxPerRow)
      },
      getPhotoRow: function (t) {
        var e = {id: t};
        return s.findIndex(this.getRows(), function (t) {
          return s.some(t, e)
        })
      },
      removePhoto: function (t) {
        var e = this.getPhotoRow(t), i = this.photos.remove(t), o = s.reduce(this.get("layout").split(""), function (t, i, o) {
          return i = s.parseInt(i), o === e && i--, t + (i > 0 ? i : "")
        }, "");
        this.set("layout", o), i && this.trigger("photo:remove", i, t, o)
      },
      toJSON: function () {
        var t = o.prototype.toJSON.apply(this, arguments);
        return t.photos = this.photos.toJSON(), t.rows = this.getRows(), t
      }
    }), c = ["add", "remove", "reset", "push", "pop", "unshift", "shift", "slice", "where", "findWhere", "forEach", "each", "map", "collect", "reduce", "foldl", "inject", "reduceRight", "foldr", "find", "detect", "filter", "select", "reject", "every", "all", "some", "any", "include", "contains", "invoke", "max", "min", "toArray", "size", "first", "head", "take", "initial", "rest", "tail", "drop", "last", "without", "difference", "indexOf", "shuffle", "lastIndexOf", "isEmpty", "chain", "sample"];
    s.forEach(c, function (t) {
      var e = n.prototype[t];
      h.prototype[t] = function () {
        return e.apply(this.photos, s.toArray(arguments))
      }
    }), e.exports = h
  }, {"../collections/photos": 209, "../utils/imagelayout": 216, lodash: "MicNly", "prima/model": 590}],
  213: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-js-imagecrop style="width:' + (null == (__t = displayWidth) ? "" : _.escape(__t)) + "px;height:" + (null == (__t = displayHeight) ? "" : _.escape(__t)) + 'px" class="photoset--image-crop"><div data-js-imagewrap style="background-image:url(' + (null == (__t = url) ? "" : _.escape(__t)) + ");background-position:" + (null == (__t = x) ? "" : _.escape(__t)) + " " + (null == (__t = y) ? "" : _.escape(__t)) + '" class="photoset--image-wrap"><img data-js-image src="' + (null == (__t = url) ? "" : _.escape(__t)) + '" alt="' + (null == (__t = caption) ? "" : _.escape(__t)) + '" data-width="' + (null == (__t = width) ? "" : _.escape(__t)) + '" data-height="' + (null == (__t = height) ? "" : _.escape(__t)) + '" class="photoset--image"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  214: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {}) {
          __p += "";
          var rows = photoset.rows, cellId = 0;
          __p += '<div data-js-layout class="photoset--layout">', _.forEach(rows, function (t, e) {
            __p += "";
            var i = e > 0 ? padding : 0, s = e < rows.length - 1 ? padding : 0, o = _rowSize(t, width, padding), n = o.height;
            __p += '<div data-photoset-row="' + (null == (__t = e) ? "" : _.escape(__t)) + '" style="height:' + (null == (__t = n + i + s) ? "" : _.escape(__t)) + 'px" class="photoset--row">', _.forEach(t, function (e, a) {
              __p += "";
              var r = o.photos[a], l = r.width, h = r.height, c = n, d = a < t.length - 1 ? padding : 0, u = a > 0 ? padding : 0, p = l + u + d, m = _.map([i, d, s, u], function (t) {
                return t ? t + "px" : 0
              }).join(" ");
              __p += '<div data-photoset-position="' + (null == (__t = cellId) ? "" : _.escape(__t)) + '" data-photo-id="' + (null == (__t = e.id) ? "" : _.escape(__t)) + '" style="width:' + (null == (__t = p) ? "" : _.escape(__t)) + "px;height:" + (null == (__t = n) ? "" : _.escape(__t)) + "px;padding:" + (null == (__t = m) ? "" : _.escape(__t)) + '" class="photoset--cell">' + (null == (__t = photoTemplate(_.defaults({
                  scaledWidth: l,
                  scaledHeight: h,
                  displayWidth: r.width,
                  displayHeight: c
                }, e))) ? "" : __t) + "</div>", cellId++, __p += ""
            }), __p += "</div>"
          }), __p += "</div>"
        }
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  215: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = {}, a = function (t, e, i) {
      var n = t instanceof o ? t : o(t), a = e;
      s.isObject(e) || (a = {}, a[e] = i), n.attr(a);
      var r = s.transform(a, function (t, e, i) {
        i.match(/^data\-/i) && (t[s.camelCase(i.replace(/^data\-/, ""))] = e)
      }, {});
      return n.data(r), n
    }, r = function (t, e) {
      var i = t instanceof o ? t : o(t);
      return s.isString(e) && (e = s.rest(arguments)), s.forEach(e, function (t) {
        i.removeAttr(t), t.match(/^data\-/i) && i.removeData(s.camelCase(t.replace(/^data\-/, "")))
      }), i
    };
    n.set = a, n.remove = r, e.exports = n
  }, {jquery: "HlZQrA", lodash: "MicNly"}],
  216: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("../models/photo"), n = {}, a = function (t, e, i) {
      return t < e.length ? e[t] : s.trim(s.pad(t % i || " ", Math.floor(t / i) + 1, i + "", "right"))
    }, r = function (t, e, i, o) {
      var n = s.isNumber(e) ? e : e.length;
      t ? s.isString(t) || (t = t.toString()) : t = "";
      var r = n - s.reduce(t.split(""), function (t, e) {
          return t + s.parseInt(e)
        }, 0);
      return r > 0 ? t += a(r, i, o) : 0 > r && (t = s(t.split("")).reverse().transform(function (t, e) {
        r ? (r += s.parseInt(e), r > 0 && (t.push(r), r = 0)) : t.push(e)
      }, []).reverse().value().join("")), t
    }, l = function (t, e, i, o) {
      var n = r(t, e, i, o).split(""), a = 0;
      return s.map(n, function (t) {
        t = s.parseInt(t);
        var i = s.map(e.slice(a, a + t), function (t) {
          return s.isFunction(t.toJSON) ? t.toJSON() : t
        });
        return a += t, i
      })
    }, h = function (t, e) {
      return t && e ? t / e : 0
    }, c = function (t, e, i) {
      var s = e ? i / e : 0;
      return t * s
    }, d = function (t, e, i) {
      var s = t ? i / t : 0;
      return e * s
    }, u = function (t, e) {
      if (!t.length)return 0;
      var i = s.map(t, function (t) {
        var i, s;
        return t instanceof o ? (i = t.get("width"), s = t.get("height")) : (i = t.width, s = t.height), d(i, s, e)
      });
      return s.min(i)
    }, p = function (t, e, i) {
      return i || (i = 0), (i + e + i) / t - i - i
    };
    n.calculateDefault = a, n.fix = r, n.toArray = l, n.aspectRatio = h, n.widthForHeight = c, n.heightForWidth = d, n.rowHeightForWidth = u, n.rowImageWidth = p, e.exports = n
  }, {"../models/photo": 211, lodash: "MicNly"}],
  217: [function (t, e, i) {
    "use strict";
    var s = {ImageLoader: t("prima/utils/image/loader"), ImageLayout: t("./imagelayout")};
    e.exports = s
  }, {"./imagelayout": 216, "prima/utils/image/loader": 605}],
  218: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = function (t, e) {
      e || (e = t.originalEvent), s.extend(t, s.pick(e, "pageX", "pageY"));
      var i, o, n;
      return null == t.pageX && null != e.clientX && (i = t.target.ownerDocument || document, o = i.documentElement, n = i.body, t.pageX = e.clientX + (o && o.scrollLeft || n && n.scrollLeft || 0) - (o && o.clientLeft || n && n.clientLeft || 0), t.pageY = e.clientY + (o && o.scrollTop || n && n.scrollTop || 0) - (o && o.clientTop || n && n.clientTop || 0)), {
        x: t.pageX,
        y: t.pageY
      }
    };
    e.exports = o
  }, {lodash: "MicNly"}],
  219: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("when"), a = t("velocity-animate").animate, r = t("prima/events"), l = t("./photoset"), h = 150, c = o(window), d = t("../utils/attrdata"), u = t("../utils/page_coords"), p = 0, m = 1, g = 2, _ = l.extend({
      className: "editable-photoset photoset",
      defaults: s.extend({
        x: null,
        y: null,
        dragId: null,
        sourceCell: null,
        targetCell: null,
        dragOverCell: null,
        isLocked: !1,
        isDragging: !1,
        dragScrollVelocityY: 0,
        dragScrollUpdateMs: 50,
        dragScrollHeight: 100,
        dragSlide: 20,
        ghostWidth: 100,
        ghostMaxHeight: 120
      }, l.prototype.defaults),
      events: s.defaults({
        'mousedown [data-js-sortable][draggable="true"]': "_onMouseDownSortable",
        "dragstart .photoset--photo-dragger": "_onDragStart"
      }, l.prototype.events),
      initialize: function () {
        l.prototype.initialize.apply(this, arguments), this.__updateCursorPosition = s.throttle(s.bind(function (t) {
          this.set(u(t))
        }, this)), s.forEach(["_onDragStart", "_onDragEnter", "_onDragOver", "_onDragLeave", "_onDragEnd", "_onDrop"], function (t) {
          var e = this[t] || s.noop;
          this["_" + t] = s.bind(e, this)
        }, this)
      },
      _onMouseDownSortable: function (t) {
        if (this.get("isLocked"))return t.preventDefault(), void t.stopPropagation();
        if (1 === t.which && !t.ctrlKey) {
          if (this.get("isDragging"))return this._onDragEnd(t);
          if (this.trigger("photoset:predrag", this), !window.DataTransfer || !s.isFunction(window.DataTransfer.prototype.setDragImage)) {
            var e = o(t.target), i = e.closest(".photoset--photo"), n = this.photoset.photos.get(i.data("photoId")), a = n ? n.get("url") || "" : "";
            a && (e.css({
              backgroundColor: "#ffffff",
              backgroundImage: "url(" + a + ")"
            }), e.one("mouseout mouseup", s.bind(function () {
              e.css({backgroundColor: "", backgroundImage: ""})
            }, this)))
          }
        }
      },
      _onDragStart: function (t) {
        if (this.get("isLocked"))return t.preventDefault(), void t.stopPropagation();
        r.trigger("photoset:dragstart");
        var e = o(t.target), i = e.closest(".photoset--photo"), n = i.data("photoId"), a = t.originalEvent.dataTransfer;
        if (a) {
          a.effectAllowed = "move", a.dropEffect = "move";
          var l = this.$('[data-ghost-id="' + n + '"]');
          !s.isEmpty(l) && s.isFunction(a.setDragImage) && a.setDragImage(l.get(0), .5 * l.outerWidth(), .5 * l.outerHeight());
          try {
            var h = this.photoset.photos.get(n), d = h ? h.get("url") || "" : "";
            a.setData("text/uri-list", d), a.setData("text/plain", d)
          } catch (t) {
          }
        }
        var u = i.closest(this.$$cacheKeys.cell), p = u.closest(this.$$cacheKeys.row);
        this.set({
          sourceCell: null,
          targetCell: null,
          dragOverCell: null,
          dragId: n
        }), this.listenTo(this, "change:targetCell", this._onChangeTargetCell), this.$el.on("dragover .photoset--cell", this.__onDragOver), this.$el.on("dragend", this.__onDragEnd), this.$el.on("drop .photoset--cell", this.__onDrop), c.on("dragover", this.__updateCursorPosition), this.startDragScroll(), s.defer(s.bind(function () {
          var t = this.$$cacheKeys.cell;
          this.set("isDragging", !0), u.addClass("photoset--placeholder-cell photoset--source-cell"), p.addClass("photoset--source-row"), s.isEmpty(u.siblings(t)) && u.closest(this.$$cacheKeys.row).addClass("photoset--placeholder-row"), e.css({
            backgroundColor: "",
            backgroundImage: ""
          }), this.createPlaceholders(), this.set({
            sourceCell: u.data("placeholderCell"),
            targetCell: u.data("placeholderCell"),
            dragOverCell: u.data("dragOverCell")
          }), this.listenTo(this, "change:dragOverCell change:x change:y", this._onChangeDragTarget)
        }, this))
      },
      _onDragOver: function (t) {
        t.preventDefault(), t.stopPropagation(), this.__updateCursorPosition(t);
        var e = o(t.target), i = e.closest(this.$$cacheKeys.cell);
        this.set("dragOverCell", i.data("dragOverCell"))
      },
      _onDragEnd: function (t) {
        t.preventDefault(), t.stopPropagation(), this.stopListening(this, "change:targetCell", this._onChangeTargetCell), this.stopListening(this, "change:dragOverCell change:x change:y", this._onChangeDragTarget);
        var e = this.get("dragId");
        if (null != e) {
          var i = this.placePhotoInCell(e, this.get("targetCell"));
          this.set({
            sourceCell: null,
            targetCell: null,
            dragId: null
          }), i.removeClass("photoset--placeholder-cell"), i.closest(this.$$cacheKeys.row).removeClass("photoset--placeholder-row")
        }
        this.removePlaceholders(), this.set("isDragging", !1);
        var o = this.determineLayout();
        this.photoset.photos.setIdOrder(o.order), this.photoset.set("layout", o.layout), this.set("isLocked", !0), this.resize().then(s.bind(function () {
          this.removeTemporary(), this.set("isLocked", !1)
        }, this)), this._ensurePhotoInViewport(e), this.$el.off("dragover .photoset--cell", this.__onDragOver), this.$el.off("dragend", this.__onDragEnd), this.$el.off("drop .photoset--cell", this.__onDrop), c.off("dragover", this.__updateCursorPosition), this.stopDragScroll(), r.trigger("photoset:dragend")
      },
      _onDrop: function (t) {
        t.preventDefault(), t.stopPropagation()
      },
      _onChangeIsDragging: function (t, e) {
        this.$el.toggleClass("photoset--drag-to-sort", e)
      },
      _onChangeIsLocked: function (t, e) {
        this.$el.toggleClass("photoset--locked", e), e || this.$(".photoset--cropped-cell").removeClass("photoset--cropped-cell")
      },
      _onUpdate: function (t, e) {
        this.teardown().render(), this.photoset.photos.length > 1 && this._ensurePhotoInViewport(this.photoset.photos.last().get("id"))
      },
      startDragScroll: function () {
        this.set({
          dragScrollTop: this.get("dragScrollHeight"),
          dragScrollBottom: c.height() - this.get("dragScrollHeight")
        }), this.listenTo(this, "change:y", this._onChangeDragY)
      },
      stopDragScroll: function () {
        clearInterval(this.dragScrollInterval), delete this.dragScrollInterval, this.stopListening(this, "change:y", this._onChangeDragY)
      },
      _onChangeDragY: function (t, e) {
        var i = 0, o = e - c.scrollTop();
        i = o < this.get("dragScrollTop") ? Math.ceil(100 * (o - this.get("dragScrollTop")) / this.get("dragScrollHeight")) : o > this.get("dragScrollBottom") ? Math.ceil(100 * (o - this.get("dragScrollBottom")) / this.get("dragScrollHeight")) : 0, this.set("dragScrollVelocityY", i), i ? this.dragScrollInterval || (this.dragScrollInterval = setInterval(s.bind(function () {
          var t = this.get("dragScrollVelocityY");
          t && r.trigger("Photoset:dragScroll", t)
        }, this), this.get("dragScrollUpdateMs"))) : this.dragScrollInterval && (clearInterval(this.dragScrollInterval), delete this.dragScrollInterval)
      },
      _ensurePhotoInViewport: function (t, e) {
        s.isNumber(e) || (e = h);
        var i = this._layoutCache || this._updateLayoutCache(), o = this.$el.offset().top || 0, n = s.find(i.rows, function (e) {
          return s.find(e.cells, {photo: t}) ? !0 : void(o += e.height)
        });
        n && r.trigger("Photoset:scrollToRow", o, n.height, e)
      },
      createPhotoSubView: function (t) {
        var e = l.prototype.createPhotoSubView.apply(this, arguments);
        return this.options.post && (e.post = this.options.post), this.listenTo(e, "photoset:hover", function () {
          var t = s.toArray(arguments);
          t.unshift("photoset:unhover"), s(this.subViews).omit(e.photo.get("id")).invoke(function () {
            this.trigger.apply(this, t)
          }).value()
        }), e
      },
      createPlaceholders: function () {
        var t = this.photoset.maxPerRow, e = ".photoset--placeholder-row", i = ".photoset--placeholder-cell", n = ".photoset--source-row", a = ".photoset--source-cell", r = this.$$cacheKeys.cell, l = '<div class="photoset--row photoset--placeholder-row"></div>', h = '<div class="photoset--cell photoset--placeholder-cell"></div>';
        this._createPlaceholders(this.js$("layout"), this.$$rows(), l, e), s.forEach(this.$$rows(!0), function (e, s) {
          var a = o(e), r = a.children(this.$$cacheKeys.cell);
          (r.length < t || a.is(n)) && this._createPlaceholders(a, r, h, i)
        }, this), s.forEach(this.$$cells(!0).filter(i), function (t, e) {
          d.set(t, "data-placeholder-cell", e)
        }, this);
        var c = this.determineLayout(), u = this.get("padding"), p = 0;
        s.forEach(this.$$rows(!0), function (t, l) {
          var h = o(t), m = h.index(), g = this.get("width"), _ = m <= c.topRow || m > c.bottomRow ? 0 : u, f = m >= c.bottomRow || m < c.topRow ? 0 : u, v = h.height() || 0;
          h.height(v);
          var b = h.children(r), y = h.prev(e).not(n).find(r), w = h.next(e).not(n).find(r), x = y.data("placeholderCell"), C = w.data("placeholderCell");
          s.forEach(b, function (t, s) {
            var n = o(t);
            n.is(i) && !n.is(a) && n.css({paddingTop: _, paddingBottom: f, width: h.is(e) ? g : 0, height: v});
            var r = {
              top: x,
              left: n.prev(i).data("placeholderCell"),
              center: n.data("placeholderCell"),
              right: n.next(i).data("placeholderCell"),
              bottom: C
            };
            n.data("targetCells", r), d.set(n, "data-drag-over-cell", p++)
          }, !0)
        }, this)
      },
      _createPlaceholders: function (t, e, i, n) {
        e.first().is(n) || t.prepend(i), s.forEach(e.not(n), function (t, e) {
          var a = o(t);
          s.isEmpty(a.next(n)) && a.after(i)
        }, this)
      },
      removePlaceholders: function () {
        this.$$rows(!0).removeClass("photoset--source-row"), this.$$cells(!0).removeClass("photoset--source-cell").removeData("targetCells"), this.$$rows().filter(".photoset--placeholder-row").remove(), this.$$cells().filter(".photoset--placeholder-cell").remove(), this.renumberRowsAndCells(), d.remove(this.$$cells(), "data-drag-over-cell", "data-placeholder-cell")
      },
      removeTemporary: function () {
        this.$(".photoset--temporary").remove(), this.$$rows(!0), this.$$cells(!0), this.renumberRowsAndCells()
      },
      resize: function (t) {
        s.isNumber(t) || (t = h);
        var e = s.map(this.$$rows(), function (e, i) {
          return this.resizeRow(e, t, i)
        }, this);
        return this._updateLayoutCache(), n.all(e)
      },
      _calculateCellSize: function (t) {
        var e = o(t), i = e.find(".photoset--photo [data-js-imageCrop]"), n = {
          width: 0,
          height: 0,
          $content: i,
          $el: e
        }, a = this.photoset.photos.get(e.data("photoId"));
        return a && s.extend(n, {isCurrentCell: !0, width: a.get("width"), height: a.get("height")}), n
      },
      resizeRow: function (t, e, i) {
        s.isNumber(e) || (e = h);
        var r = t instanceof o ? t : o(t), l = this.determineLayout();
        s.isNumber(i) || (i = r.index());
        var c = this.get("width"), d = this.get("padding"), u = i <= l.topRow || i > l.bottomRow ? 0 : d, p = i >= l.bottomRow || i < l.topRow ? 0 : d, m = this.$$cacheKeys.cell, g = s.map(r.children(m), this._calculateCellSize, this), _ = [], f = 0;
        s.forEach(g, function (t, e) {
          t.index = e, t.isCurrentCell && (t.position = f++, t.id = _.length, _.push(t))
        });
        var v = this.rowSize(_, c), b = v.height, y = b ? b + u + p : 0, w = s.map(g, function (t, i) {
          var o = {width: t.width, height: b, paddingTop: u, paddingRight: 0, paddingBottom: p, paddingLeft: 0};
          null != t.id && (o.width = v.photos[t.id].width), null != t.position && (o.paddingRight = t.position < f - 1 ? d : 0, o.paddingLeft = t.position > 0 ? d : 0), s.isEmpty(t.$content) || (a(t.$content, "stop"), a(t.$content, {
            opacity: 1,
            width: o.width,
            height: o.height,
            translateX: 0,
            translateY: 0
          }, {duration: e}));
          var n = this.subViews[t.$el.data("photoId")];
          return n && n.set({
            displayWidth: o.width,
            displayHeight: o.height
          }), a(t.$el, "stop"), a(t.$el, s.defaults({
            width: o.width + o.paddingLeft + o.paddingRight,
            height: o.height + o.paddingTop + o.paddingBottom
          }, o), {duration: e})
        }, this);
        a(r, "stop"), w.push(a(r, {height: y}, {duration: e})), this.get("isDragging") && (this._rowHeightCache[r.data("photosetRow")] = y);
        var x = n.all(w);
        return x
      },
      determineLayout: function (t) {
        if (t && this._determineLayout)return this._determineLayout;
        var e = "", i = [], n = -1, a = -1, r = this.$$cacheKeys.cell;
        return s.forEach(this.$$rows(), function (t, l) {
          var h = 0;
          s.forEach(o(t).children(r), function (t) {
            var e = o(t).data("photoId");
            (e || 0 === e) && (i.push(e), h++)
          }, this), h && (e += h, 0 > n && (n = l), a = l)
        }, this), this._determineLayout = {topRow: n, bottomRow: a, order: i, layout: e}, this._determineLayout
      },
      _onChangeTargetCell: function (t, e) {
        if (null != e) {
          var i = this.$$cells().filter('[data-placeholder-cell="' + e + '"]'), n = i.closest(this.$$cacheKeys.row), r = i.data("dragOverCell"), l = p;
          l = i.is(".photoset--source-cell") ? p : n.is(".photoset--placeholder-row") ? m : g, s.forEach(this.$$cells(), function (t, e) {
            var i = o(t), c = i.find(".photoset--image-crop");
            if (!s.isEmpty(c)) {
              var d = {translateX: 0, translateY: 0};
              switch (l) {
                case m:
                  s.isEmpty(n.find(i)) && (i.data("dragOverCell") < r ? d.translateY = -this.get("dragSlide") : i.data("dragOverCell") > r && (d.translateY = this.get("dragSlide")));
                  break;
                case g:
                  s.isEmpty(n.find(i)) || (i.data("dragOverCell") < r ? d.translateX = -this.get("dragSlide") : i.data("dragOverCell") > r && (d.translateX = this.get("dragSlide")))
              }
              a(c, "stop"), a(c, d, h)
            }
          }, this)
        } else s.forEach(this.$$cells(), function (t) {
          var e = o(t).find(".photoset--image-crop");
          s.isEmpty(e) || (a(e, "stop"), a(e, {translateX: 0, translateY: 0}, h))
        }, this)
      },
      _onChangeDragTarget: function () {
        var t = this.get("dragOverCell");
        if (null != t) {
          var e = this.$$cells().filter('[data-drag-over-cell="' + t + '"]'), i = e.offset(), s = e.width(), o = e.height(), n = this.get("x") - (i.left + .5 * s), a = this.get("y") - (i.top + .5 * o), r = e.data("targetCells");
          null != r.top && -o / 3 > a ? this.set("targetCell", r.top) : null != r.bottom && a > o / 3 ? this.set("targetCell", r.bottom) : null != r.center ? null != r.left && -s / 3 > n ? this.set("targetCell", r.left) : null != r.right && n > s / 3 ? this.set("targetCell", r.right) : this.set("targetCell", r.center) : null != r.left && 0 > n ? this.set("targetCell", r.left) : null != r.right && n > 0 && this.set("targetCell", r.right)
        }
      },
      placePhotoInCell: function (t, e) {
        var i = this.subViews[t], s = i.$el.closest(this.$$cacheKeys.cell), o = s.closest(this.$$cacheKeys.row), n = this.$$cells().filter('[data-placeholder-cell="' + e + '"]');
        return d.set(n, "data-photo-id", t), n.is(s) || (s.removeClass("photoset--placeholder-cell").addClass("photoset--temporary"), d.remove(s, "data-photo-id"), o.is(".photoset--placeholder-row") && o.removeClass("photoset--placeholder-row").addClass("photoset--temporary"), i.js$("imageCrop").css({
          opacity: 0,
          width: n.width(),
          height: n.height()
        }), i.$el.detach(), n.append(i.$el), n.addClass("photoset--cropped-cell")), n
      },
      beforeRender: function () {
        this.listenTo(this, "update", this._onUpdate), this.listenTo(this, "change:isDragging", this._onChangeIsDragging), this.listenTo(this, "change:isLocked", this._onChangeIsLocked)
      },
      afterRender: function () {
        this.renderSubViews(), this.$el.prepend('<div data-js-ghosts class="photoset--ghosts"></div>'), s.forEach(this.subViews, function (t, e) {
          var i = t.thumbnailDimensions(this.get("ghostWidth"), this.get("ghostMaxHeight"));
          i["background-image"] = "url(" + t.photo.get("url") + ")";
          var s = o('<div data-js-ghost class="photoset--ghost"></div>').css(i);
          d.set(s, "data-ghost-id", e), this.js$("ghosts").append(s)
        }, this), this.js$("ghosts").append('<div class="photoset--ghost-cover"></div>').css({
          width: this.get("ghostWidth"),
          height: this.get("ghostMaxHeight")
        })
      }
    });
    e.exports = _
  }, {
    "../utils/attrdata": 215,
    "../utils/page_coords": 218,
    "./photoset": 221,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "velocity-animate": "lWl/mc",
    when: "RG2dij"
  }],
  220: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("when"), n = t("velocity-animate").animate, a = t("prima/view"), r = 150, l = t("prima/mixins/subviewable"), h = t("prima/mixins/selectorcache"), c = t("prima/mixins/accessor"), d = t("../models/photo"), u = t("../templates/photo.tpl"), p = a.extend({
      className: "photoset--photo",
      template: u,
      mixins: [l, h, c],
      defaults: {scaledWidth: null, scaledHeight: null, displayWidth: null, displayHeight: null},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), this.photo = t.photo || new d, this.photos = t.photos, this.photoset = t.photoset, this.$el.attr("data-photo-id", this.photo.get("id")), this.listenTo(this.photo, "change:id", function (t, e) {
          this.$el.attr("data-photo-id", e)
        })
      },
      thumbnailDimensions: function (t, e) {
        var i = this.photo.getHeightForWidth(100);
        return e && i > e && (i = e, t = this.photo.getWidthForHeight(100)), {width: Math.ceil(t), height: Math.ceil(i)}
      },
      resize: function (t) {
        t || (t = r);
        var e = this.get("displayWidth") || 0, i = this.get("displayHeight") || 0, s = this.get("scaledWidth") || 0, a = this.get("scaledHeight") || 0;
        return n(this.js$("crop"), "stop"), n(this.js$("positioner"), "stop"), n(this.js$("image"), "stop"), o.join(n(this.js$("crop"), {
          width: e,
          height: i
        }, {duration: t}), n(this.js$("positioner"), {
          width: Math.max(0, s - e),
          height: Math.max(0, a - i)
        }, {duration: t}), n(this.js$("image"), {width: s, height: a}, {duration: t}))
      },
      serialize: function () {
        return s.defaults(this.toJSON(), this.photo.toJSON())
      },
      beforeTeardown: function () {
        return this.stopListening(), this
      },
      render: function () {
        var t = this.serialize();
        return this.$el.html(this.template(t)), this.attachSubViews(), this
      }
    });
    e.exports = p
  }, {
    "../models/photo": 211,
    "../templates/photo.tpl": 213,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612,
    "velocity-animate": "lWl/mc",
    when: "RG2dij"
  }],
  221: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("../utils/imagelayout"), r = (t("prima/lib/logger"), t("prima/mixins/subviewable")), l = t("prima/mixins/selectorcache"), h = t("prima/mixins/accessor"), c = t("../models/photo"), d = t("../models/photoset"), u = t("../templates/photoset.tpl"), p = t("./photo"), m = t("../utils/attrdata"), g = t("prima/utils/image/types").getImageType, _ = function (t, e, i) {
      s.isNumber(i) || (i = 0);
      var o = 0, n = t.length, r = e - 2 * i * (n - 1), l = r / n, h = s.map(t, function (t, e) {
        t instanceof c && (t = t.toJSON());
        var i = e % 2 ? Math.ceil(l) : Math.floor(l);
        e >= n - 1 && (i = r), r -= i;
        var s = Math.round(a.heightForWidth(t.width, t.height, i));
        return (!o || s && o > s) && (o = s), {width: i, height: s}
      });
      return {width: e, height: o, photos: h}
    }, f = n.extend({
      className: "photoset",
      template: u,
      mixins: [r, l, h],
      defaults: {dynamic: !1, width: 500, height: 0, padding: 5, minFullWidthSize: 300},
      $$cacheKeys: {row: ".photoset--row", cell: ".photoset--cell"},
      $$rows: function (t) {
        return this.$$(this.$$cacheKeys.row, t)
      },
      $$cells: function (t) {
        return this.$$(this.$$cacheKeys.cell, t)
      },
      initialize: function (t) {
        this.options = t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), this._PhotoView = t.PhotoView || p, this.photoset = t.photoset || new d
      },
      _updateRowCache: function () {
        return this._rowCache = s.map(this.photoset.getRows(), function (t) {
          return s.pluck(t, "id")
        }), this._rowCache
      },
      _updateLayoutCache: function () {
        var t = this._updateRowCache(), e = this._layoutCache = {
          rows: [],
          photos: {}
        }, i = this.get("padding"), o = this.get("width"), n = 0;
        return s.forEach(t, function (a, r) {
          var l = this.photoset.photos.getSubset(a), h = r > 0 ? i : 0, c = r < t.length - 1 ? i : 0, d = this.rowSize(l, o, i), u = d.height + h + c;
          e.rows[r] = {
            unpaddedHeight: d.height,
            paddingTop: h,
            paddingBottom: c,
            height: u,
            cells: []
          }, n += u, s.forEach(l, function (t, s) {
            var o = s < l.length - 1 ? i : 0, n = s > 0 ? i : 0, a = d.photos[s], h = t.get("id");
            e.photos[h] = {
              scaledWidth: a.width,
              scaledHeight: a.height,
              displayWidth: a.width,
              displayHeight: d.height
            }, e.rows[r].cells[s] = {
              photo: h,
              unpaddedWidth: a.width,
              paddingLeft: n,
              paddingRight: o,
              width: a.width + n + o,
              height: u
            }
          }, this)
        }, this), e.width = o, e.height = n, this.set("height", n),
          e
      },
      rowSize: function (t, e, i) {
        return t || (t = this.photoset.photos), s.isNumber(e) || (e = this.get("width")), s.isNumber(i) || (i = this.get("padding")), _(t, e, i)
      },
      createRowElement: function () {
        return o('<div class="photoset--row"></div>')
      },
      createCellElement: function (t) {
        var e = o('<div class="photoset--cell"></div>');
        return null != t && m.set(e, "data-photo-id", t), e
      },
      createPhotoSubView: function (t) {
        var e = new this._PhotoView({photoset: this.photoset, photos: this.photoset.photos, photo: t});
        return t.get("id") && (this.subViews[t.get("id")] = e), e
      },
      createSubViews: function () {
        this.photoset.photos.forEach(this.createPhotoSubView, this)
      },
      createSinglePhotoLayout: function () {
        this._layoutCache || this._updateLayoutCache();
        var t = this.photoset.photos.at(0), e = t.get("width"), i = t.get("height"), s = g(t.get("url")) || "gif", o = this.getMinFullWidthSize(s);
        e >= o && (i = Math.round(a.heightForWidth(e, i, this.get("width"))), e = this.get("width"));
        var n = t.get("id"), r = this.subViews[n];
        r.set({scaledWidth: e, scaledHeight: i, displayWidth: e, displayHeight: i});
        var l = this.js$("layout"), h = this.createRowElement().height(i), c = this.createCellElement(n);
        c.css({
          width: e,
          height: i,
          padding: 0
        }).addClass("photoset--single-cell"), o > e && c.addClass("photoset--single-cell-margin"), c.append(r.$el), h.append(c), l.append(h), this.renumberRowsAndCells()
      },
      createPhotosetLayout: function () {
        var t = this._layoutCache || this._updateLayoutCache();
        s.forEach(t.rows, function (e, i) {
          var o = this.createRowElement();
          o.height(e.height), s.forEach(e.cells, function (i, n) {
            var a = i.photo, r = t.photos[a], l = this.subViews[a];
            l.set(r);
            var h = this.createCellElement(a);
            h.css({
              width: i.width,
              height: i.height,
              padding: s.map([e.paddingTop, i.paddingRight, e.paddingBottom, i.paddingLeft], function (t) {
                return t ? t + "px" : 0
              }).join(" ")
            }), h.append(l.$el), o.append(h)
          }, this), this.js$("layout").append(o)
        }, this), this.renumberRowsAndCells()
      },
      renumberRowsAndCells: function () {
        s.forEach(this.$$rows(!0), function (t, e) {
          m.set(t, "data-photoset-row", e)
        }, this), s.forEach(this.$$cells(!0), function (t, e) {
          m.set(t, "data-photoset-position", e)
        }, this)
      },
      getMinFullWidthSize: function (t) {
        var e = this.get("minFullWidthSize");
        return s.isNumber(e) ? e : s.has(e, t) ? e[t] : 300
      },
      serialize: function () {
        return s.extend(this.toJSON(), {
          _rowSize: s.bind(this.rowSize, this),
          photoTemplate: p.prototype.template,
          photoset: this.photoset.toJSON()
        })
      },
      afterTeardown: function () {
        return this.stopListening(), delete this._rowCache, delete this._layoutCache, this.teardownSubViews()
      },
      render: function () {
        return this.get("dynamic") ? (this.$el.html('<div class="photoset--layout" data-js-layout></div>'), this.createSubViews(), 1 === this.photoset.photos.length ? this.createSinglePhotoLayout() : this.createPhotosetLayout()) : this.$el.html(this.template(this.serialize())), this
      }
    });
    e.exports = f
  }, {
    "../models/photo": 211,
    "../models/photoset": 212,
    "../templates/photoset.tpl": 214,
    "../utils/attrdata": 215,
    "../utils/imagelayout": 216,
    "./photo": 220,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/logger": 553,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/utils/image/types": 606,
    "prima/view": 612
  }],
  222: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/component"), n = t("./templates/embed-code.tpl"), a = t("prima/lib/data"), r = o.extend({
      name: "PostEmbedCodeGenerator",
      defaults: {
        embed_host: "//embed.tumblr.com",
        secure_assets_host: "https://secure.assets.tumblr.com",
        tumblelog_mention_key: "",
        post_id: "",
        post_url: "",
        embed_key: "",
        embed_did: ""
      },
      initialize: function (t) {
        this.options = s.extend({}, this.defaults, t);
        var e = a.get("Context/hosts");
        e && (e.embed_host && (this.options.embed_host = e.embed_host), e.secure_assets_host && (this.options.secure_assets_host = e.secure_assets_host)), this.template = n
      },
      getCode: function () {
        return this.template(this.options)
      }
    });
    e.exports = r
  }, {"./templates/embed-code.tpl": 223, lodash: "MicNly", "prima/component": 545, "prima/lib/data": 548}],
  223: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", __p += "undefined" != typeof language && "undefined" != typeof width ? '<div class="tumblr-post" data-href="' + (null == (__t = embed_host) ? "" : _.escape(__t)) + "/embed/post/" + (null == (__t = embed_key) ? "" : _.escape(__t)) + "/" + (null == (__t = post_id) ? "" : _.escape(__t)) + '" data-did="' + (null == (__t = embed_did) ? "" : _.escape(__t)) + '" data-language="' + (null == (__t = language) ? "" : _.escape(__t)) + '" data-width="' + (null == (__t = width) ? "" : _.escape(__t)) + '"><a href="' + (null == (__t = post_url) ? "" : _.escape(__t)) + '">' + (null == (__t = post_url) ? "" : _.escape(__t)) + "</a></div>" : "undefined" != typeof language ? '<div class="tumblr-post" data-href="' + (null == (__t = embed_host) ? "" : _.escape(__t)) + "/embed/post/" + (null == (__t = embed_key) ? "" : _.escape(__t)) + "/" + (null == (__t = post_id) ? "" : _.escape(__t)) + '" data-did="' + (null == (__t = embed_did) ? "" : _.escape(__t)) + '" data-language="' + (null == (__t = language) ? "" : _.escape(__t)) + '"><a href="' + (null == (__t = post_url) ? "" : _.escape(__t)) + '">' + (null == (__t = post_url) ? "" : _.escape(__t)) + "</a></div>" : "undefined" != typeof width ? '<div class="tumblr-post" data-href="' + (null == (__t = embed_host) ? "" : _.escape(__t)) + "/embed/post/" + (null == (__t = embed_key) ? "" : _.escape(__t)) + "/" + (null == (__t = post_id) ? "" : _.escape(__t)) + '" data-did="' + (null == (__t = embed_did) ? "" : _.escape(__t)) + '" data-width="' + (null == (__t = width) ? "" : _.escape(__t)) + '"><a href="' + (null == (__t = post_url) ? "" : _.escape(__t)) + '">' + (null == (__t = post_url) ? "" : _.escape(__t)) + "</a></div>" : '<div class="tumblr-post" data-href="' + (null == (__t = embed_host) ? "" : _.escape(__t)) + "/embed/post/" + (null == (__t = embed_key) ? "" : _.escape(__t)) + "/" + (null == (__t = post_id) ? "" : _.escape(__t)) + '" data-did="' + (null == (__t = embed_did) ? "" : _.escape(__t)) + '"><a href="' + (null == (__t = post_url) ? "" : _.escape(__t)) + '">' + (null == (__t = post_url) ? "" : _.escape(__t)) + "</a></div>", __p += '<script async src="' + (null == (__t = secure_assets_host) ? "" : _.escape(__t)) + '/post.js"></script>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  224: [function (t, e, i) {
    "use strict";
    var s = (t("prima/utils/exposer"), t("lodash")), o = t("jquery"), n = t("when"), a = t("prima/utils/sequence-with-context"), r = t("prima/mixins/promisifyevents"), l = t("prima/component"), h = t("prima/events"), c = t("prima/lib/domeventor"), d = (t("prima/lib/logger"), t("backbone")), u = (t("./utils/transition_speed"), t("./utils/scroll_helper")), p = t("./utils/save_hook"), m = t("./utils/post_form_container_type"), g = "/dashboard", _ = t("prima/lib/translate"), f = o("body"), v = t("app/components/post-form"), b = t("app/components/dialog"), y = t("app/lib/currentuser"), w = t("app/components/post-form/models/post"), x = t("app/components/post-form/services/embed_data"), C = t("./views/glass"), k = t("./views/modal"), S = t("./views/container"), T = t("./views/post_buttons"), E = l.extend({
      name: "PostFormBuilder",
      initialize: function () {
        var t = this.data;
        if (this.user = y(), this.user) {
          var e = {
            baseRoute: void 0,
            currentChannel: void 0,
            supportImageSearch: !1,
            minFullWidthSize: {},
            redirectTo: !1,
            reblogActionContext: !1,
            updateURL: !0
          };
          s.extend(this, e, s.pick(t, s.keys(e))), this._addGlobalEventListeners(), this.user.set(t.limits), this.user.set(t.dashboardSettings), this.user.set("language", t.language || "en_US"), x.setEmbedRegexes(t.embedRegexes), this.glass = new C, this.modal = new k, this.modalContainer = new S({
            className: "post-form-modal-content",
            animateHeightWithContent: !0
          }), this.modal.setContentSubView(this.modalContainer), this.postButtons = new T({el: "#new_post"}), this.postButtonsContainer = new S({
            el: this.postButtons.$el.parent(),
            originalContent: this.postButtons,
            transitionBackground: !0,
            animateHeightWithContent: !0,
            useLoader: !1
          }), this.scrollHelper = new u, this.saveHook = new p(s.extend({$postButtonsContainer: this.postButtonsContainer.$el}, t)), this.legacyEvents(), this._updateData = s.once(this.updateData), this.render()
        }
      },
      updateData: function () {
        var t = o.ajax({url: "/svc/post/get_post_form_builder_data", type: "POST", with_form_key: !0, data: {}});
        return t.then(s.bind(function (t) {
          var e = t.response;
          return s.forEach(e.channels, function (t) {
            var e = t.name ? this.user.getChannel(t.name) : !1;
            e && e.set(s.omit(t, "name"))
          }, this), this.user.set(e.limits), e
        }, this))
      },
      legacyEvents: function () {
        var t = {
          "postForms:closed": ["post:form:hide", "keycommands:resume"],
          "postForms:saved": ["post:form:success"],
          "postForms:opened": ["post:form:show", "keycommands:suspend"]
        };
        s.forEach(t, function (t, e) {
          this.listenTo(h, e, function () {
            var e = s.toArray(arguments);
            s.each(t, function (t) {
              h.trigger.apply(h, [].concat(t, e))
            }, this)
          })
        }, this)
      },
      _addGlobalEventListeners: function () {
        this.listenTo(h, "postForms:open", this.createPostForm), this.listenTo(h, "postForms:new", this._createPostFormNew), this.listenTo(h, "postForms:edit", this._createPostFormEdit), this.listenTo(h, "postForms:reblog", this._createPostFormReblog), this.listenTo(h, "postForms:saved", this.destroyPostForm), this._registerDismissListener(), this.listenTo(h, "postForms:dismissListener:suspend", function () {
          this._toggleDismissListener(!1)
        }), this.listenTo(h, "postForms:dismissListener:resume", function () {
          this._toggleDismissListener(!0)
        })
      },
      _toggleDismissListener: function (t) {
        this.stopListening(h, "postForms:close"), t && this._registerDismissListener()
      },
      _registerDismissListener: function () {
        this.listenTo(h, "postForms:close", this.dismissPostForm)
      },
      createInlineContainer: function (t) {
        return t ? new S({el: t.parent(), originalContent: t, transitionBackground: !0}) : !1
      },
      _createPostFormNew: function (t) {
        return this.createPostForm(t)
      },
      _createPostFormEdit: function (t) {
        return t.postEl && (t.containerView = this.createInlineContainer(t.postEl), t.postFormType = m.inline), this.createPostForm(t)
      },
      _createPostFormReblog: function (t) {
        return this.createPostForm(t)
      },
      createPostForm: function (t) {
        if (this.postForm)return this.destroyPostForm(t).then(s.bind(function () {
          return this.createPostForm(t)
        }, this));
        t = s.extend({
          fastCompose: !1,
          supportImageSearch: this.supportImageSearch,
          minFullWidthSize: this.minFullWidthSize,
          updateURL: this.updateURL,
          glass: !0,
          postFormType: m.modal
        }, t), s.defaults(t, {containerView: t.postFormType === m.inline ? this.postButtonsContainer : null}), t.post || (t.post = this._createPostModel(t)), t.url || (t.url = this._postFormUrl(t.post)), t.containerView === this.postButtonsContainer && this.postButtons.setPostType(t.post.get("type")), this._updateData();
        var e = t.postFormType === m.modal, i = ["supportImageSearch", "minFullWidthSize", "post"];
        "photo" === t.post.get("type") && i.push("showPhotoBooth");
        var r = this.postForm = new v(s.extend(s.pick(t, i), {
          isModal: e,
          popoverContainer: e ? this.modal.$el : f,
          redirectTo: this.redirectTo,
          reblogActionContext: this.reblogActionContext,
          fastCompose: t.fastCompose
        })), l = this.postFormContainer = t.containerView || this.modalContainer;
        if (!l)throw new Error("No post form container!");
        this.listenTo(r, "pauseScrollHelper", this.pauseScrollHelper), this.listenTo(r, "resumeScrollHelper", this.resumeScrollHelper), l.isRendered() || l.render(), l.setPostFormComponent(r);
        var u = s.once(s.bind(function () {
          return t.glass ? this.glass.show() : n.resolve()
        }, this)), p = a([function () {
          return h.trigger("Header:hide"), n.join(l.prepare(u), r.whenRendered(!0))
        }, function () {
          return r.disable(), l.attach(u)
        }, function () {
          return t.updateURL && d.history.navigate(t.url, {replace: !0}), function () {
            var t = c.rect(), i = t.windowScrollTop, n = t.windowHeight, a = r.getRect(), d = a.offsetHeight, u = l.$el.offset().top, p = u + d, m = 20, g = o("[prima-component=header]").height() || 0, _ = n > d + 2 * m, f = this.scrollHelper.calculateScrollTop(u - m, p + m + g, n, _), v = 400, b = e ? this.modal.$el : void 0;
            l === this.postButtonsContainer && f > i && n > d && (f = i), this.previousScrollPosition = e ? !1 : i, this.scrollHelper.scrollToPosition(f, v, b), this.listenTo(h, "Photoset:dragScroll", function (t, e) {
              s.isNumber(e) || (e = 50);
              var i = c.rect().windowScrollTop + t;
              this.scrollHelper.scrollToPosition(i, e, b)
            }), this.listenTo(h, "Photoset:scrollToRow", function (t, e, i) {
              s.isNumber(i) || (i = 50), t += 0, this.scrollHelper.checkScrollBounds(!1, {
                keepInside: !0,
                contentPadding: 70,
                contentRect: {offsetTop: t, offsetHeight: e}
              })
            })
          }.call(this), l.showPostForm(u)
        }, function () {
          return u()
        }, function () {
          r.enable()
        }], this).then(s.bind(function () {
          return h.trigger("postForms:opened"), f.addClass("postforms-open"), r
        }, this), s.bind(function () {
          this.destroyPostForm()
        }, this));
        return t.postFormType === m.inline && p.then(s.bind(function () {
          this.scrollHelper.start({el: l.$el})
        }, this)), p["catch"](function (t) {
          t instanceof Error && s.defer(function () {
            throw t
          })
        }), p
      },
      _postFormStateChanged: function (t) {
        if (this.postForm) {
          var e = this.postForm.initialPostState, i = this.postForm.post;
          return i.deepHasChanged(e)
        }
        return !1
      },
      dismissPostForm: function () {
        (!this.postForm || this.postForm.isEnabled()) && (this._postFormStateChanged() ? this._buildDismissPrompt() : this.destroyPostForm())
      },
      _buildDismissPrompt: function () {
        var t = _("Discard this post?");
        this.postForm && this.postForm.post && "edit" === this.postForm.post.get("mode") && (t = _("Discard edits to this post?"));
        var e = {text: t, text_ok: _("Discard"), text_cancel: _("Nevermind"), keycommand_maintain: !0};
        b.confirm(e, s.bind(function () {
          this.destroyPostForm(), h.trigger("postForms:dismissListener:resume")
        }, this), function () {
          s.defer(function () {
            h.trigger("postForms:dismissListener:resume")
          })
        }), h.trigger("postForms:dismissListener:suspend")
      },
      destroyPostForm: function (t, e) {
        t = s.extend({updateURL: this.updateURL, url: this.baseRoute, glass: !0}, t), this.scrollHelper.stop();
        var i = this.postForm, o = this.postFormContainer, r = !!i.fastCompose;
        this.postForm = null, this.postFormContainer = null, this.stopListening(i), this.stopListening(h, "Photoset:dragScroll");
        var l = s.once(s.bind(function () {
          return t.glass ? this.glass.hide() : n.resolve()
        }, this)), c = i && !!i.postForm.get("saved"), u = a([function () {
          c && this.saveHook.preExecute(e)
        }, function () {
          i && i.disable()
        }, function () {
          return function () {
            if (this.previousScrollPosition !== !1) {
              var t = this.previousScrollPosition, e = 400;
              this.scrollHelper.scrollToPosition(t, e)
            }
          }.call(this), o ? o.hidePostForm(l).then(function () {
            o.teardown()
          }) : void 0
        }, function () {
          if (i && i.remove(), t.updateURL) {
            var e = d.history.root || "", s = t.url ? t.url.replace(new RegExp("^" + e), "") : "";
            d.history.navigate(s, {replace: !0})
          }
        }, function () {
          return l()
        }, function () {
          c && e && (this.saveHook.$inlinePostEl = o.$el, this.saveHook.execute(e, {fastCompose: r}))
        }], this).then(function () {
          return h.trigger("postForms:closed"), h.trigger("Header:show"), f.removeClass("postforms-open"), i
        });
        return u["catch"](function (t) {
          t instanceof Error && s.defer(function () {
            throw t
          })
        }), u
      },
      pauseScrollHelper: function () {
        this.scrollHelper && this.scrollHelper.pause()
      },
      resumeScrollHelper: function () {
        this.scrollHelper && this.scrollHelper.resume()
      },
      _createPostModel: function (t) {
        "string" == typeof t && (t = {postType: t});
        var e = s.extend({
          tumblelog: t.channelId || this.currentChannel,
          editorType: this.user.get("defaultEditorType"),
          contextData: {baseRoute: this.baseRoute}
        }, s.pick(t, "tags", "sourceUrl", "loggingData"));
        return t.reblogId ? s.defaults(e, {
          lookupData: {reblog_id: t.reblogId, reblog_key: t.reblogKey},
          mode: "reblog",
          pt: t.pt,
          reblogSource: t.reblogSource
        }) : t.editId ? s.defaults(e, {
          lookupData: {post_id: t.editId, channel_id: t.channelId || this.redirectChannel},
          mode: "edit"
        }) : s.defaults(e, {type: t.postType || t.type || "text", mode: "new"}), new w(e)
      },
      _postFormUrl: function (t) {
        if (t) {
          if (t.has("lookupData")) {
            var e = t.get("lookupData");
            return e.reblog_id ? this._reblogPostUrl(e.reblog_id, e.reblog_key) : e.post_id ? this._editPostUrl(e.post_id) : this._newPostUrl(t.get("type"))
          }
          return t.has("reblog_id") ? this._reblogPostUrl(t.get("reblog_id"), t.get("reblog_key")) : t.has("id") ? this._editPostUrl(t.get("id")) : this._newPostUrl(t.get("type"))
        }
        return this._newPostUrl("text")
      },
      _newPostUrl: function (t) {
        var e = this.baseRoute !== g ? this.baseRoute : "";
        return e + "/new/" + t
      },
      _editPostUrl: function (t) {
        return "/edit/" + t
      },
      _reblogPostUrl: function (t, e) {
        return "/reblog/" + t + "/" + e
      },
      render: function () {
        return this.glass.render().$el.appendTo("body"), this.modal.render().$el.appendTo("body"), this
      },
      updateBaseRoute: function (t) {
        var e;
        t ? this.baseRoute = t : (e = d && d.history ? d.history.location.pathname : g, this.baseRoute = e)
      }
    }, {
      containerType: function (t) {
        return m[t]
      }
    });
    r.applyTo(E.prototype), e.exports = E
  }, {
    "./utils/post_form_container_type": 229,
    "./utils/save_hook": 230,
    "./utils/scroll_helper": 231,
    "./utils/transition_speed": 232,
    "./views/container": 233,
    "./views/container_content": 234,
    "./views/glass": 235,
    "./views/modal": 237,
    "./views/post_buttons": 238,
    "app/components/dialog": 44,
    "app/components/post-form": 240,
    "app/components/post-form/models/post": 249,
    "app/components/post-form/services/embed_data": 256,
    "app/lib/currentuser": 459,
    backbone: "5kFNoY",
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/component": 545,
    "prima/events": 546,
    "prima/lib/domeventor": 550,
    "prima/lib/logger": 553,
    "prima/lib/translate": 575,
    "prima/mixins/promisifyevents": 584,
    "prima/utils/exposer": 602,
    "prima/utils/sequence-with-context": 609,
    when: "RG2dij"
  }],
  225: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("sprintf-js").sprintf, n = t("prima/model"), a = n.extend({
      endpoint: "/svc/post/%s/%s/%s",
      parse: function (t) {
        return {dashboardHTML: t.trim()}
      },
      sync: function (t, e, i) {
        if ("read" !== t)throw new Error("The DashboardPostFetch model may only READ from server!");
        if (i = s.defaults(i || {}, {
            pageRoot: !1,
            direction: !1,
            refPostID: !1
          }), !1 === (i.pageRoot && i.direction))throw new Error(o("These two fetch params must be passed: pageRoot [%s], direction [%s]", i.pageRoot, i.direction));
        return s.defaults(i, {
          dataType: "html",
          emulateHTTP: !0,
          url: o(this.endpoint, i.pageRoot, i.direction, i.refPostID)
        }), n.prototype.sync.call(this, t, e, i)
      }
    });
    e.exports = a
  }, {lodash: "MicNly", "prima/model": 590, "sprintf-js": "qPOUxN"}],
  226: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", transitionBackground && (__p += '<div class="post-transition-background"></div>'), __p += "", originalContent && (__p += '<div data-subview="originalContent"></div>'), __p += '<div data-subview="loader"></div><div data-subview="postForm"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  227: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="Knight-Rider-loader ', loading && (__p += "animate"), __p += '"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  228: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="v-center-outer"><div class="v-center-inner"><div class="v-center-content"><div data-subview="content"></div></div></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  229: [function (t, e, i) {
    "use strict";
    var s = {modal: 1, inline: 2};
    e.exports = s
  }, {}],
  230: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("numeral"), a = t("prima/events"), r = t("../models/dashboard_post_fetch"), l = t("app/lib/currentuser"), h = function () {
      var t = ".post_container", e = ".post:not([data-is-pinned])", i = ["dashboard", "drafts", "inbox"], h = {
        preExecute: function () {
          return "queue" === this.contextData.contextPage ? (o(window).off("beforeunload"), void window.location.replace(this.contextData.baseRoute)) : void 0
        }, execute: function (t, e) {
          if (e = s.merge({fastCompose: !1}, e || {}), this.saveResponse = t.responseJSON, -1 !== i.indexOf(this.contextData.contextPage)) {
            var a = !this.saveResponse.post.is_edit && !this.saveResponse.post.is_reblog, r = "post_dashboard_html" in this.saveResponse, h = !(!this.saveResponse.post || !this.saveResponse.post.is_edit) && this.contextData.contextPage !== this.saveResponse.post_context_page && this.$inlinePostEl.hasClass("post_container");
            if (a ? this._fetchMorePosts() : r && (h ? this._removeInline() : this._updateInline()), this._displayNotification(this.saveResponse, e), this.saveResponse.context_tumblelog) {
              var c = this.saveResponse.context_tumblelog.name_or_id, d = o('#dashboard_controls_open_blog[data-blog-name="' + c + '"]');
              s.forEach(this.saveResponse.context_tumblelog, function (t, e) {
                if (e.match(/_count$/i)) {
                  var i = d.find('[data-blog-controls-count="' + e + '"]');
                  i.toggleClass("count_0", "0" >= t), i.find(".count").text(n(t).format("0,0"))
                }
              }, this);
              var u = l().getChannel(c), p = s.pick(this.saveResponse.context_tumblelog, u.keys());
              u.set(p)
            }
          }
        }, _fetchMorePosts: function () {
          var t = this.contextData.baseRoute.replace(/^\/|\/$/g, ""), e = "drafts" === this.contextData.contextPage ? "after" : "before", i = this._findLatestPostId(), o = new r;
          o.fetch({
            pageRoot: t,
            direction: e,
            refPostID: i,
            success: s.bind(this._fetchSuccess, this),
            error: this._fetchFailure
          })
        }, _fetchSuccess: function (i) {
          var s = o(i.get("dashboardHTML")), n = this.contextData.$postButtonsContainer.nextAll(t).has(e).first();
          0 === n.length ? this.contextData.$postButtonsContainer.parent().append(s) : s.insertBefore(n), o(".no_posts_found").remove(), a.trigger("posts:load")
        }, _fetchFailure: function () {
          console.error("Failed loading dashboard HTML after successful post submission.")
        }, _findLatestPostId: function () {
          var i = this.contextData.$postButtonsContainer.find(t + " " + e).first().data("post-id");
          return i
        }, _updateInline: function () {
          var t = o(this.saveResponse.post_dashboard_html.trim());
          this.$inlinePostEl.replaceWith(t.eq(0)), a.trigger("posts:load")
        }, _removeInline: function () {
          var t = this.contextData.baseRoute.split("/");
          t.splice(-1, 1);
          var e = this.$inlinePostEl;
          return e.fadeOut(200, function () {
            e.remove()
          }), o("#posts .post").not(".new_post").length <= 1 ? void(window.location = t.join("/")) : void 0
        }, _displayNotification: function (t, e) {
          var i = this.contextData.baseRoute.split("/"), o = i[1] || "", n = t.message, r = s.parseInt(this.contextData.notificationDelay), l = {
            url: t.post_tumblelog.post_url,
            tumblelog: {name: t.post_tumblelog.name_or_id, url: t.post_tumblelog.url, avatar: t.post_tumblelog.avatar}
          };
          (!t.created_post || t.post.is_reblog || e && e.fastCompose || "tagged" === o.toLowerCase()) && s.delay(function () {
            a.trigger("postForms:saveHook:toast", n, l)
          }, r)
        }
      }, c = function (t) {
        this.contextData = s.defaults(t || {}, {notificationDelay: 250}), s.extend(this, h)
      };
      return c
    }();
    e.exports = h
  }, {
    "../models/dashboard_post_fetch": 225,
    "app/lib/currentuser": 459,
    jquery: "HlZQrA",
    lodash: "MicNly",
    numeral: "ubjloo",
    "prima/events": 546
  }],
  231: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("velocity-animate").animate, a = t("../utils/transition_speed"), r = t("prima/class"), l = t("backbone"), h = t("prima/lib/domeventor"), c = t("prima/events"), d = (t("prima/lib/logger"), o("html")), u = r.extend({
      defaults: {
        keepInside: !1,
        scrollSpeedMs: 250,
        triggerPadding: -50,
        contentPadding: 20,
        debounceMs: 200
      }, start: function (t) {
        return this._running && this.stop(), this._running = !0, t && !s.isPlainObject(t) && (t = {el: t}), this.options = t = s.extend({}, this.defaults, t), this.$el = o(t.el), this.updateContentRect(), this.listenTo(c, "DOMEventor:flatscroll", this.checkScrollBounds), this
      }, stop: function () {
        return this._running = !1, this._scrollTop = !1, this.cancelEnforceScrollBounds(), this.stopListening(), this
      }, pause: function () {
        this._running && (this._ignoreScroll = !0)
      }, resume: function () {
        this._running && this._ignoreScroll && (this._ignoreScroll = !1, this.checkScrollBounds())
      }, updateContentRect: function () {
        this.contentRect || (this.contentRect = {}), this.lastContentRect && (this.lastContentRect.offsetTop = this.contentRect.offsetTop, this.lastContentRect.offsetLeft = this.contentRect.offsetLeft, this.lastContentRect.offsetHeight = this.contentRect.offsetHeight, this.lastContentRect.offsetWidth = this.contentRect.offsetWidth);
        var t = this.$el.offset();
        return this.contentRect.offsetTop = t.top, this.contentRect.offsetLeft = t.left, this.contentRect.offsetHeight = this.$el.outerHeight(), this.contentRect.offsetWidth = this.$el.outerWidth(), this.lastContentRect || (this.lastContentRect = s.clone(this.contentRect)), this.contentRect
      }, calculateScrollTop: function (t, e, i, s) {
        return s ? t : e - i
      }, checkScrollBounds: function (t, e) {
        if (!this._ignoreScroll) {
          e = e ? s.extend({}, this.defaults, this.options, e) : this.options, t || (t = h.rect());
          var i, o, n = e.contentRect || this.updateContentRect(), a = e.triggerPadding || 0, r = e.contentPadding || 0, l = n.offsetHeight, c = n.offsetTop, d = c + l, u = t.windowHeight, p = Math.max(0, t.windowScrollTop), m = p + u;
          return e.keepInside ? (i = p - c, o = d - m) : (i = p - d, o = c - m), o > a ? (this._scrollTop = this.calculateScrollTop(c - r, d + r, u, l + 2 * r > u), this.enforceScrollBounds(e), !0) : i > a ? (this._scrollTop = this.calculateScrollTop(c - r, d + r, u, e.bottom || u > l + 2 * r), this.enforceScrollBounds(e), !0) : (this._scrollTop = !1, this.cancelEnforceScrollBounds(), !1)
        }
      }, enforceScrollBounds: function (t) {
        var e = null != t.scrollTop ? t.scrollTop : this._scrollTop, i = t.scrollSpeedMs, o = t.debounceMs, n = t.container;
        o ? this._enforceTimeout || (this._enforceTimeout = s.delay(s.bind(function () {
          null == t.scrollTop && (e = this._scrollTop), this.scrollTop !== !1 && this.scrollToPosition(e, i, n)
        }, this), o)) : this.scrollToPosition(e, i, n)
      }, cancelEnforceScrollBounds: function () {
        this._enforceTimeout, clearTimeout(this._enforceTimeout), this._enforceTimeout = !1
      }, scrollToPosition: function (t, e, i) {
        this._ignoreScroll = !0, n(d, "stop"), n(d, "scroll", {
          offset: t,
          container: i,
          duration: a(e || this.defaults.scrollSpeedMs)
        }).then(s.bind(function () {
          this._ignoreScroll = !1
        }, this))
      }
    });
    s.extend(u.prototype, l.Events), e.exports = u
  }, {
    "../utils/transition_speed": 232,
    backbone: "5kFNoY",
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/class": 543,
    "prima/events": 546,
    "prima/lib/domeventor": 550,
    "prima/lib/logger": 553,
    "velocity-animate": "lWl/mc"
  }],
  232: [function (t, e, i) {
    "use strict";
    var s = 1, o = function (t) {
      return t * s
    };
    o.get = function () {
      return s
    }, o.set = function (t) {
      s = t
    }, e.exports = o
  }, {}],
  233: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("when"), n = t("velocity-animate").animate, a = t("prima/utils/sequence-with-context"), r = t("../utils/transition_speed"), l = t("prima/mixins/promisifyevents"), h = t("prima/view"), c = (t("prima/lib/logger"), t("prima/mixins/subviewable")), d = t("prima/mixins/selectorcache"), u = t("prima/mixins/accessor"), p = t("./container_content"), m = t("./loader"), g = t("../templates/container.tpl"), _ = h.extend({
      mixins: [c, d, u, l],
      template: g,
      defaultOptions: {
        animateDuringPrepare: !0,
        animateHeightWithContent: !1,
        startHeight: null,
        useLoader: !0,
        loaderDelay: 250,
        transitionBackground: !1
      },
      defaults: {minHeight: !1, pretransition: !1, midtransition: !1},
      initialize: function (t) {
        t instanceof h && (t = {postForm: t}), this.options = t = s.extend({}, this.defaultOptions, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), t.postForm && this.setPostForm(t.postForm), this.listenTo(this, "change:minHeight", this._onChangeMinHeight), this.listenTo(this, "change:pretransition", this._onChangePretransition), this.listenTo(this, "change:midtransition", this._onChangeMidtransition)
      },
      _onChangeMinHeight: function (t, e) {
        n(this.$el, "stop"), e || s.isNumber(e) ? n(this.$el, {"min-height": e}, {duration: r(Math.min(Math.max(250, e), 750))}) : (e = s.parseInt(this.$el.css("min-height"), 10) || 0, n(this.$el, {"min-height": [0, e]}, {duration: r(Math.min(Math.max(250, e), 750))}).then(s.bind(function () {
          this.$el.css("min-height", "")
        }, this)))
      },
      _onChangePretransition: function (t, e) {
        e ? this.$el.addClass("post-form-container-pretransition") : this.$el.removeClass("post-form-container-pretransition")
      },
      _onChangeMidtransition: function (t, e) {
        e ? this.$el.addClass("post-form-container-transition") : this.$el.removeClass("post-form-container-transition")
      },
      setPostFormComponent: function (t) {
        return this._postFormComponent !== t ? (this._postFormComponent && this.stopListening(this._postFormComponent), this._postFormComponent = t, this.postForm = t.postForm, this) : void 0
      },
      prepare: function (t) {
        return this.isRendered() || this.render(), this.trigger("prepared", this), this.loadingDelay = s.delay(s.bind(function () {
          this.loader && this.options.useLoader && this.loader.set("loading", !0)
        }, this), this.options.loadingDelay), this.options.animateDuringPrepare && (this._hideOriginalContent = this.hideOriginalContent(t).then(s.bind(function () {
          return this._hideOriginalContent = !1, this
        }, this))), o.resolve(this)
      },
      attach: function (t) {
        return this.loader && (clearTimeout(this.loadingDelay), this.loader.set("loading", !1)), this.set("pretransition", !0), this.postForm.forceHidden(), this.attachSubView(this.postForm, "postForm"), o.resolve(this)
      },
      hideOriginalContent: function (t) {
        var e = this.options.startHeight || this.originalContent.measureHeight(), i = this.postForm.measureHeight();
        return e || this.options.originalContent || (e = i), a([function () {
          null != e && this.$el.css("height", e), this.set("midtransition", !0), this.originalContent.set("enabled", !1)
        }, function () {
          return o.join(t(), this.originalContent.animateHide(r(100)))
        }], this)
      },
      showPostForm: function (t) {
        var e = this.options.startHeight || this.originalContent.measureHeight(), i = this.postForm.measureHeight();
        return e || this.options.originalContent || (e = i), a([function () {
          return this.options.animateHeightWithContent || this.originalContent.get("hidden") ? void 0 : this._hideOriginalContent || this.hideOriginalContent(t)
        }, function () {
          var s = [];
          return this.options.animateHeightWithContent && !this.originalContent.get("hidden") && s.push(this._hideOriginalContent || this.hideOriginalContent(t)), null == i || null == e || (i === e ? this.$el.height(i) : s.push(n(this.$el, {height: [i, e]}, {
            duration: r(150),
            easing: [.4, 1.3, .7, 1]
          }))), o.all(s)
        }, function () {
          return this.set("placeholder", !1), this.postForm.animateShow(r(100))
        }, function () {
          this.set("pretransition", !1), this.set("midtransition", !1), this.$el.css("height", "")
        }], this)
      },
      hidePostForm: function (t) {
        var e = this.postForm.measureHeight(), i = this.originalContent.measureHeight();
        return i || this.options.originalContent || (i = e), a([function () {
          this.$el.css("height", e), this.set("midtransition", !0)
        }, function () {
          return this.postForm.animateHide(r(100))
        }, function () {
          if (this.set("pretransition", !0), null == i || null == e); else {
            if (i !== e)return n(this.$el, {height: [i, e]}, {duration: r(100), easing: [0, 0, .6, 1]});
            this.$el.height(i)
          }
        }, function () {
          return o.join(t(), this.originalContent.animateShow(r(50)))
        }, function () {
          this.set("midtransition", !1), this.set("pretransition", !1), this.$el.css("height", ""), this.originalContent.set("enabled", !0)
        }], this)
      },
      serialize: function () {
        return {
          originalContent: !!this.options.originalContent,
          transitionBackground: this.options.transitionBackground
        }
      },
      beforeRender: function () {
        this.loader || (this.loader = new m), this.originalContent || (this.options.originalContent instanceof p ? this.originalContent = this.options.originalContent : this.originalContent = new p({el: this.options.originalContent})), this.originalContent.$el.detach()
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.subViews.originalContent = this.originalContent, this.subViews.loader = this.loader, this.subViews.postForm = this.postForm, this.attachSubViews(), this
      },
      afterRender: function () {
        return this.$el.addClass("post-forms-above-glass"), this.renderSubViews()
      },
      beforeTeardown: function () {
        return this.subViews.loader = void 0, this
      },
      afterTeardown: function () {
        return this.$el.removeClass("post-forms-above-glass post-form-container-pretransition post-form-container-transition"), this.loader && (this.loader.remove(), this.loader = void 0), this.$el.children(".post-transition-background").remove(), delete this.postForm, this.trigger("torndown", this), this.teardownSubViews()
      }
    });
    e.exports = _
  }, {
    "../templates/container.tpl": 226,
    "../utils/transition_speed": 232,
    "./container_content": 234,
    "./loader": 236,
    lodash: "MicNly",
    "prima/lib/logger": 553,
    "prima/mixins/accessor": 577,
    "prima/mixins/promisifyevents": 584,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/utils/sequence-with-context": 609,
    "prima/view": 612,
    "velocity-animate": "lWl/mc",
    when: "RG2dij"
  }],
  234: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("velocity-animate").animate, n = t("prima/view"), a = t("prima/mixins/subviewable"), r = t("prima/mixins/accessor"), l = n.extend({
      defaults: {hidden: !1, enabled: !0}, mixins: [a, r], initialize: function (t) {
        this.set("hasContent", t && t.el), this.originalCSS = this._getCSS(["opacity"]), this.listenTo(this, "change:enabled", this._onChangeEnabled), this.listenTo(this, "change:hidden", this._onChangeHidden)
      }, _getCSS: function (t) {
        var e = {};
        return s.forEach(t, function (t) {
          e[t] = this.$el.css(t)
        }, this), e
      }, _onChangeEnabled: function (t, e) {
        this.$el.toggleClass("no-pointer-events", !e)
      }, _onChangeHidden: function (t, e) {
        this.$el.toggleClass("collapse", e)
      }, measureHeight: function () {
        if (!this.get("hasContent"))return void 0;
        var t = this.get("hidden");
        this.set("hidden", !1);
        var e = this.$el.outerHeight();
        return this.set("hidden", t), e
      }, animateShow: function (t, e) {
        return t || (t = 0),
        e || (e = 0), o(this.$el, {opacity: 1}, {
          duration: t, delay: e, begin: s.bind(function () {
            this.set("hidden", !1)
          }, this)
        })
      }, animateHide: function (t, e) {
        return t || (t = 0), e || (e = 0), o(this.$el, {opacity: 0}, {duration: t, delay: e}).then(s.bind(function () {
          this.set("hidden", !0)
        }, this))
      }, render: function () {
        return this
      }, teardown: function () {
        return this.$el.css(this.originalCSS), this
      }
    });
    e.exports = l
  }, {
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/subviewable": 587,
    "prima/view": 612,
    "velocity-animate": "lWl/mc"
  }],
  235: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("velocity-animate").animate, n = t("prima/view"), a = t("../utils/transition_speed"), r = t("prima/mixins/subviewable"), l = t("prima/mixins/selectorcache"), h = t("prima/mixins/accessor"), c = n.extend({
      className: "post-forms-glass",
      mixins: [r, l, h],
      initialize: function (t) {
        this.options = t = s.extend({active: !1, visible: !1}, t), this.set({
          active: !!t.active,
          visible: !!t.visible
        }), this.get("visible") ? this.$el.css({opacity: 1, display: "block"}) : this.$el.css({
          opacity: 0,
          display: this.get("active") ? "block" : "none"
        }), this.listenTo(this, {"change:active": this._changeActive, "change:visible": this._changeVisible})
      },
      show: function (t) {
        return this.set("active", !(null != t && !t)), this.attributes.visible && this._showing ? this._showing : (this.attributes.visible = !0, this._show())
      },
      hide: function (t) {
        return this.set("active", !(null == t && !t)), !this.attributes.visible && this._hiding ? this._hiding : (this.attributes.visible = !1, this._hide())
      },
      _show: function () {
        var t = this._showing = o(this.$el, {opacity: 1}, {duration: a(150), display: "block"});
        return t
      },
      _hide: function () {
        var t = this._hiding = o(this.$el, {opacity: 0}, {
          duration: a(150),
          display: this.get("active") ? "block" : "none"
        });
        return t
      },
      _changeActive: function (t, e) {
        e ? this.$el.addClass(this.className + "_active active") : (this.$el.removeClass(this.className + "_active active"), !this._changing || s.has(this.changed, "visible") || this.get("visible") || this.$el.css("display", "none"))
      },
      _changeVisible: function (t, e) {
        e ? (this.$el.addClass(this.className + "_visible visible"), this._show()) : (this.$el.removeClass(this.className + "_visible visible"), this._hide())
      },
      render: function () {
        return this
      }
    });
    e.exports = c
  }, {
    "../utils/transition_speed": 232,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612,
    "velocity-animate": "lWl/mc"
  }],
  236: [function (t, e, i) {
    "use strict";
    var s = t("prima/view"), o = t("prima/mixins/subviewable"), n = t("prima/mixins/selectorcache"), a = t("prima/mixins/accessor"), r = t("../templates/loader.tpl"), l = s.extend({
      className: "post-forms-loader",
      mixins: [o, n, a],
      template: r,
      initialize: function (t) {
        this.listenTo(this, "change:loading", this._onChangeLoading), this.set("loading", t && t.loading)
      },
      _onChangeLoading: function (t, e) {
        this.isRendered() && (e ? (this.$el.addClass("loading"), this.$$(".Knight-Rider-loader").addClass("animate")) : (this.$el.removeClass("loading"), this.$$(".Knight-Rider-loader").removeClass("animate")))
      },
      render: function () {
        return this.$el.html(this.template(this.attributes)), this
      }
    });
    e.exports = l
  }, {
    "../templates/loader.tpl": 227,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  237: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("velocity-animate").animate, n = t("prima/view"), a = t("../utils/transition_speed"), r = t("prima/mixins/subviewable"), l = t("prima/mixins/selectorcache"), h = t("prima/mixins/accessor"), c = t("../templates/modal.tpl"), d = n.extend({
      className: "post-forms-modal",
      mixins: [r, l, h],
      template: c,
      initialize: function (t) {
        this.set("visible", t && t.visible), this.get("visible") ? this.$el.css({
          opacity: 1,
          display: "block"
        }) : this.$el.css({
          opacity: 0,
          display: "none"
        }), this.$body = s("body"), this.listenTo(this, "change:visible", this._toggleVisible)
      },
      show: function () {
        return this.attributes.visible = !0, this._show()
      },
      hide: function () {
        return this.attributes.visible = !1, this._hide()
      },
      setContentSubView: function (t) {
        return this.subViews.content && (this.stopListening(this.subViews.content), this.subViews.content.remove()), this.subViews.content = t, this.listenTo(t, "prepared", this._onSubViewPrepare), this.listenTo(t, "torndown", this._onSubViewTeardown), this.isRendered() && this.attachSubView("content"), this
      },
      _onSubViewPrepare: function (t) {
        this.show()
      },
      _onSubViewTeardown: function (t) {
        this.hide()
      },
      _show: function () {
        this._disableBodyScroll(), this.$el.css("display", "block");
        var t = o(this.$el, {opacity: 1}, {duration: a(100), display: "block"});
        return t
      },
      _hide: function () {
        this._enableBodyScroll();
        var t = o(this.$el, {opacity: 0}, {duration: a(100), display: "none"});
        return t
      },
      _toggleVisible: function (t, e) {
        e ? (this.$el.addClass(this.className + "_visible visible"), this._show()) : (this.$el.removeClass(this.className + "_visible visible"), this._hide())
      },
      _disableBodyScroll: function () {
        this.$body.css("overflow", "hidden")
      },
      _enableBodyScroll: function () {
        this.$body.css("overflow", "")
      },
      render: function () {
        return this.$el.html(this.template(this.attributes)), this.attachSubViews(), this
      }
    });
    e.exports = d
  }, {
    "../templates/modal.tpl": 228,
    "../utils/transition_speed": 232,
    jquery: "HlZQrA",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612,
    "velocity-animate": "lWl/mc"
  }],
  238: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("when"), n = t("velocity-animate").animate, a = t("./container_content"), r = t("prima/mixins/selectorcache"), l = t("prima/mixins/accessor"), h = t("prima/events"), c = t("../utils/post_form_container_type"), d = a.extend({
      mixins: [r, l],
      events: {
        "click [data-js-text]": "_onClickNewPost",
        "click [data-js-photo]": "_onClickNewPost",
        "click [data-js-quote]": "_onClickNewPost",
        "click [data-js-link]": "_onClickNewPost",
        "click [data-js-chat]": "_onClickNewPost",
        "click [data-js-audio]": "_onClickNewPost",
        "click [data-js-video]": "_onClickNewPost"
      },
      setPostType: function (t) {
        this.postType = t
      },
      animateShow: function (t, e) {
        return t || (t = 0), e || (e = 0), this.$el.css({display: "block", opacity: 1}), function (i) {
          var s = this.js$(i), a = s.children("i"), r = s.children(".new_post_label_text"), l = this.$(".new_post_label").not(s), h = l.children("i"), c = l.children(".new_post_label_text"), d = [n(h, {
            scale: 1,
            translateY: [0, 10],
            opacity: 1
          }, {duration: t, delay: e}), n(c, {translateY: [0, 10], opacity: 1}, {duration: t, delay: e})];
          return s.length && a.length && d.push(n(a, {scale: [1, 1.5], translateY: [0, 0], opacity: 1}, {
            duration: t,
            delay: e
          }), n(r, {translateY: [0, 0], opacity: 1}, {duration: t, delay: e})), o.all(d)
        }.call(this, this.postType)
      },
      animateHide: function (t, e) {
        t || (t = 0), e || (e = 0), function (i) {
          var s = this.js$(i), a = s.children("i"), r = s.children(".new_post_label_text"), l = this.$(".new_post_label").not(s), h = l.children("i"), c = l.children(".new_post_label_text"), d = [n(h, {
            scale: [1, 1],
            translateY: [10, 0],
            opacity: 0
          }, {duration: t, delay: e}), n(c, {translateY: [10, 0], opacity: 0}, {duration: t, delay: e})];
          return s.length && a.length && d.push(n(a, {scale: [1.5, 1], translateY: [0, 0], opacity: 0}, {
            duration: t,
            delay: .5 * t + e
          }), n(r, {translateY: [0, 0], opacity: 0}, {duration: t, delay: e})), o.all(d)
        }.call(this, this.postType).then(s.bind(function () {
          this.$el.css({display: "none", opacity: 0})
        }, this))
      },
      _onClickNewPost: function (t) {
        if (t.stopPropagation(), t.preventDefault(), this.get("enabled")) {
          var e = t.currentTarget.getAttribute("data-post-endpoint") || t.currentTarget.getAttribute("data-post-type");
          h.trigger("postForms:open", {postType: e, postFormType: c.inline})
        }
      }
    });
    e.exports = d
  }, {
    "../utils/post_form_container_type": 229,
    "./container_content": 234,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "velocity-animate": "lWl/mc",
    when: "RG2dij"
  }],
  239: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/collection"), n = t("../models/photo"), a = o.extend({
      model: n,
      add: function (t, e) {
        return t && !s.isArray(t) && (t = [t]), s.forEach(t, function (t, e) {
          t.id || (s.isFunction(t.set) ? t.set("id", this.generateId(e)) : t.id = this.generateId(e))
        }, this), o.prototype.add.apply(this, arguments)
      },
      generateId: function (t) {
        var e = 1 + (t || 0), i = s.map(s.range(this.length + 1), function (t) {
          return "o" + (e + t)
        });
        return s.find(i, function (t) {
          return !this.get(t)
        }, this)
      },
      setIdOrder: function (t, e) {
        e || (e = {}), this.models = s.map(t, function (t) {
          return this.get(t)
        }, this), e.silent || this.trigger("sort", this, e)
      }
    });
    e.exports = a
  }, {"../models/photo": 247, lodash: "MicNly", "prima/collection": 544}],
  240: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("when"), a = t("prima/mixins/promisifyevents"), r = t("prima/events"), l = t("prima/utils/sequence-with-context"), h = t("prima/component"), c = (t("prima/lib/logger"), t("app/lib/avatar-size")), d = t("./models/post"), u = t("app/lib/currentuser"), p = t("app/components/upload/collections/uploads"), m = t("./views/post_form"), g = t("./utils/drag_eventor"), _ = new g("body"), f = t("app/components/dialog"), v = h.extend({
      name: "PostForm",
      viewOptionKeys: ["showPhotoBooth", "supportImageSearch", "minFullWidthSize", "isModal", "popoverContainer", "dragEvents", "redirectTo", "reblogActionContext", "closeLabel", "disableNavigation", "disablePhotoFromUrl"],
      initialize: function (t) {
        t = s.extend({
          dragEvents: _,
          autoFetch: !0
        }, t), this.user = t.user || u(), this.post = t.post || new d, this.uploads = new p, this._preloadAvatars(), this.postForm = new m(s.extend(s.pick(t, this.viewOptionKeys), {
          user: this.user,
          post: this.post,
          uploads: this.uploads,
          model: this.post
        })), this.fastCompose = !!t.fastCompose, t.autoFetch && (this.postFetch = this.fetchPostData(this.post))
      },
      _preloadAvatars: function (t) {
        t || (t = this.user.channels.pluck("avatar_url")), s.forEach(t, function (t) {
          var e = new Image;
          e.src = c(t)(128)
        })
      },
      fetchPostData: function (t) {
        if (this.postFetch)return this.postFetch;
        t || (t = this.post);
        var e = this.user;
        return n.promise(function (i, s) {
          t.has("lookupData") ? t.fetch(t.get("lookupData")).then(function () {
            t.unset("lookupData"), e && "html" === e.get("defaultEditorType") && "edit" === t.get("mode") && "rich" === t.get("editorType") && t.set("editorType", "html"), i(t)
          }, function (t) {
            403 === t.status ? s("blocked") : s()
          }) : i(t)
        })
      },
      addEventListeners: function () {
        this.listenTo(r, "DOMEventor:keydown:escape", function () {
          this.isEnabled() && r.trigger("postForms:close")
        }), this.listenTo(this.postForm, "all", function () {
          this.trigger.apply(this, arguments)
        }), this.listenToOnce(this.postForm, "postForms:changePostType", this.reloadPostForm)
      },
      _logInteraction: function (t) {
        var e = {
          action: t,
          tumblelog: this.post.get("tumblelog"),
          mode: this.post.get("mode"),
          postType: this.post.get("type"),
          editorType: this.post.get("editorType")
        };
        r.trigger("postform-interaction:" + t, {loggingData: e})
      },
      enable: function () {
        this.postForm.set("enabled", !0)
      },
      disable: function () {
        this.postForm.set("enabled", !1)
      },
      isEnabled: function () {
        return this.postForm.get("enabled") || !1
      },
      getRect: function () {
        return this.postForm.getRect()
      },
      isRendered: function () {
        return this.postForm.isRendered()
      },
      whenRendered: function (t) {
        return null == t && (t = !this.isRendered()), n.promise(s.bind(function (e, i) {
          t ? (this.listenToOnce(this, "ready", function () {
            e(this)
          }), this.listenToOnce(this, "reject", function () {
            i()
          }), this.render()) : e(this)
        }, this))
      },
      _render: function () {
        this._logInteraction("open-postform");
        var t = this.whenEvent(this.postForm, "media:ready");
        return this.postForm.render(), this.initialPostState = this.postForm.post.toJSON(), this.postForm.set("initialPostState", this.initialPostState), this.addEventListeners(), this.postForm.get("useMediaReady") ? t.then(s.bind(function () {
          this.trigger("ready")
        }, this)) : this.trigger("ready"), delete this.postFetch, this
      },
      _reject: function (t) {
        "blocked" === t && f.alert(o("This post cannot be reblogged.")), this.trigger("reject")
      },
      render: function () {
        return this.fetchPostData(this.post).then(s.bind(this._render, this), s.bind(this._reject, this))
      },
      teardown: function () {
        return this.stopListening(), this
      },
      remove: function () {
        this.stopListening(), this.postForm.remove()
      },
      reloadPostForm: function (t) {
        t = t || {};
        var e = l([function () {
          return this.postForm.animateHide(200)
        }, function () {
          this.postForm.teardown();
          var e = {
            lookupData: this.post.getLookupData(),
            tumblelog: this.post.get("tumblelog"),
            mode: this.post.get("mode"),
            loggingData: this.post.loggingData
          };
          s.extend(e, t.postParams || {}), this.post = this.postForm.post = this.postForm.model = new d(e), this.render()
        }, function () {
          s.isFunction(t.afterReload) && t.afterReload.call(this, this.postForm)
        }], this);
        return e
      }
    });
    a.applyTo(v.prototype), e.exports = v
  }, {
    "./models/post": 249,
    "./utils/drag_eventor": 315,
    "./views/post_form": 346,
    "app/components/dialog": 44,
    "app/components/upload/collections/uploads": 396,
    "app/lib/avatar-size": 456,
    "app/lib/currentuser": 459,
    lodash: "MicNly",
    "prima/component": 545,
    "prima/events": 546,
    "prima/lib/logger": 553,
    "prima/lib/translate": 575,
    "prima/mixins/promisifyevents": 584,
    "prima/utils/sequence-with-context": 609,
    when: "RG2dij"
  }],
  241: [function (t, e, i) {
    "use strict";
    function s() {
    }

    var o = t("lodash"), n = t("prima/lib/translate"), a = t("../utils/string_helpers").truncateLongStrings;
    s.prototype.genericFieldMap = {
      two: "caption",
      three: "url"
    }, s.prototype.editorField = "two", s.prototype.allowsTypeSwitch = function () {
      return "new" === this.get("mode")
    }, s.prototype.typeAttributes = {
      service: !1,
      preuploadUrl: "",
      trackTitle: "",
      trackArtist: "",
      trackAlbum: "",
      preuploadAlbumArt: !1,
      albumArt: "",
      caption: "",
      confirmTos: !1
    }, s.prototype.allowAnswerFields = ["caption"], s.prototype.generateTweetText = function (t, e) {
      var i = this.getHtmlStripped("caption");
      return i = i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi, ""), a(i, e)
    }, s.prototype.resetPreserveFields = ["caption", "tags"], s.prototype.resetAttributes = ["service", "url", "preuploadUrl", "trackTitle", "trackArtist", "trackAlbum", "confirmTos", "preuploadAlbumArt", "albumArt", "copyrightFallback"], s.prototype.parseForType = function (t, e, i) {
      i.service && "direct" !== i.service || (e.url = i.audio_url), delete e.audio_url, e.albumArt = i.audio_artwork, delete e.audio_artwork;
      var s = i.id3_tags || {};
      return delete e.id3_tags, e.trackTitle = s.Title || "", e.trackArtist = s.Artist || "", e.trackAlbum = s.Album || "", e
    }, s.prototype.serializeForServer = function (t) {
      var e = t.apply(this, o.rest(arguments)), i = {
        "id3_tags[title]": this.get("trackTitle") || null,
        "id3_tags[artist]": this.get("trackArtist") || null,
        "id3_tags[album]": this.get("trackAlbum") || null,
        preuploaded_url: this.get("preuploadUrl"),
        confirm_tos: this.get("confirmTos"),
        artwork_pre_upload: this.get("preuploadAlbumArt"),
        album_art: this.get("albumArt"),
        remove_album_art: "edit" === this.get("mode") && o.isEmpty(this.get("albumArt")),
        copyright_fallback: this.get("copyrightFallback")
      };
      return o.extend(e, o.pick(i, function (t) {
        return !o.isUndefined(t)
      })), o.isEmpty(e.preuploaded_url) || (e["post[three]"] = null), e
    }, s.prototype.validate = function (t, e, i) {
      var s = [];
      return o.isEmpty(e.url) ? s.push(n("Please choose an audio source before continuing.")) : e.preuploadUrl ? e.confirmTos || s.push(n("You must agree that you have permission to share this file.")) : o.isEmpty(e.url) && s.push(n("Please choose an audio source before continuing.")), t.call(this, e, {errors: s})
    }, e.exports = s
  }, {"../utils/string_helpers": 320, lodash: "MicNly", "prima/lib/translate": 575}],
  242: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/model"), n = t("prima/mixins/withformkeytrue"), a = o.extend({
      url: "/svc/post/get_preview_key",
      defaults: {name: "", key: ""},
      parse: function (t, e) {
        var i = s.get(t, "response.blog_preview_key");
        return {key: i}
      }
    }, {
      fetchForBlog: function (t) {
        var e = new a({name: t});
        return e.fetch({async: !1, type: "POST", data: {name: e.get("name")}}), e.get("key")
      }
    });
    n.applyTo(a.prototype), e.exports = a
  }, {lodash: "MicNly", "prima/mixins/withformkeytrue": 589, "prima/model": 590}],
  243: [function (t, e, i) {
    "use strict";
    function s() {
    }

    var o = t("lodash"), n = t("sprintf-js").sprintf, a = t("../utils/string_helpers").truncateLongStrings;
    s.prototype.genericFieldMap = {one: "title", two: "chat"}, s.prototype.typeAttributes = {
      title: "",
      chat: ""
    }, s.prototype.generateTweetText = function (t, e) {
      var i, s = this.getHtmlStripped("title"), o = this.getHtmlStripped("chat");
      return i = s && o ? n("%s - %s", s, o) : s || o || "", a(i, e)
    }, s.prototype.validate = function (t, e, i) {
      var s = [];
      return (!e.chat || e.chat.length < 1) && s.push("No chat."), t.call(this, e, {errors: s})
    }, s.prototype.serializeForServer = function (t) {
      var e = this, i = t.apply(this, o.rest(arguments));
      return i["post[two]"] = e.get("chat").replace(/\u00A0/gm, " "), i
    }, e.exports = s
  }, {"../utils/string_helpers": 320, lodash: "MicNly", "sprintf-js": "qPOUxN"}],
  244: [function (t, e, i) {
    "use strict";
    function s() {
    }

    var o = t("lodash"), n = t("sprintf-js").sprintf, a = t("prima/utils/url"), r = t("../utils/string_helpers").truncateLongStrings, l = t("../utils/validation");
    s.prototype.genericFieldMap = {
      one: "title",
      two: "url",
      three: "caption",
      thumbnail: "thumbnail",
      excerpt: "excerpt",
      author: "author"
    }, s.prototype.typeAttributes = {
      title: "",
      url: "",
      caption: "",
      excerpt: "",
      author: ""
    }, s.prototype.allowAnswerFields = ["caption"], s.prototype.generateTweetText = function (t, e) {
      var i = this.getHtmlStripped("title"), s = this.getHtmlStripped("url"), o = this.getHtmlStripped("caption");
      o = o.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi, "");
      var l;
      return l = i && o ? n("%s - %s", i, o) : i || o || a.parseUrl(s).host || "", r(l, e)
    }, s.prototype.editorField = "three", s.prototype.typeAttributes = {
      title: "",
      url: "",
      excerpt: "",
      author: ""
    }, s.prototype.resetPreserveFields = ["caption", "tags"], s.prototype.resetAttributes = ["title", "url", "thumbnail", "excerpt", "author"], s.prototype.softReset = function (t) {
      t.apply(this, o.rest(arguments)), o.isEmpty(this.get("thumbnail")) || "new" === this.get("mode") || this.set("remove_thumbnail", 1)
    }, s.prototype.serializeForServer = function (t) {
      var e = t.apply(this, o.rest(arguments));
      return this.get("remove_thumbnail") && (e.remove_thumbnail = this.get("remove_thumbnail")), o.extend(e, {
        author: this.getAttributeFromGeneric("author"),
        excerpt: this.getAttributeFromGeneric("excerpt")
      }), e
    }, s.prototype.validate = function (t, e, i) {
      var s = [];
      return e.loading && s.push("Loading OpenGraph data."), (!e.url || e.url.length < 1) && s.push("No url."), l.isUrl(e.url) || s.push("Not a valid URL"), t.call(this, e, {errors: s})
    }, e.exports = s
  }, {
    "../utils/string_helpers": 320,
    "../utils/validation": 321,
    lodash: "MicNly",
    "prima/utils/url": 611,
    "sprintf-js": "qPOUxN"
  }],
  245: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/model"), n = o.extend({
      defaults: {
        fetchOptions: {
          url: "/svc/mention",
          with_form_key: !0
        }, suggestCache: {}, queryHistory: [], maxCacheSize: 20, maxSuggests: 5, blogSuggestions: {}
      }, fetch: function (t) {
        "query" in t && "success" in t && s.isFunction(t.success) || console.error("Mention must be provided a query and a success callback.");
        var e = t.query;
        if (s.extend(t, this.get("fetchOptions")), e in this.get("suggestCache")) {
          var i = this.get("suggestCache")[e];
          return this.set("blogSuggestions", i), t.success.call(this, this, i, t)
        }
        return t.data = {q: e}, o.prototype.fetch.call(this, t)
      }, parse: function (t, e) {
        var i = this._processQueryResults(t, e);
        return this._cacheQueryResults(i, e), i
      }, _processQueryResults: function (t, e) {
        var i = e.query;
        return s.extend(t, {queryRegex: this._escapeRegex(i)})
      }, _cacheQueryResults: function (t, e) {
        var i = s.clone(this.get("suggestCache")), o = s.clone(this.get("queryHistory"));
        i[e.query] = t, o.push(e.query), s.size(i) > this.get("maxCacheSize") && (delete i[o[0]], o.shift()), this.set("suggestCache", i), this.set("queryHistory", o)
      }, _escapeRegex: function (t) {
        return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\~\`\!\@\#]/g, "\\$&")
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "prima/model": 590}],
  246: [function (t, e, i) {
    "use strict";
    function s() {
    }

    var o = t("lodash"), n = t("../utils/string_helpers").truncateLongStrings;
    s.prototype.genericFieldMap = {
      one: "ask",
      two: "answer",
      three: "caption"
    }, s.prototype.editorField = "three", s.prototype.typeAttributes = {
      ask: "",
      answer: "",
      caption: ""
    }, s.prototype.generateTweetText = function (t, e) {
      return n(this.getHtmlStripped("ask"), e)
    }, s.prototype.parseForType = function (t, e, i) {
      return e.ask = o.escape(e.ask), e
    }, s.prototype.validate = function (t, e, i) {
      var s = [];
      return e.ask || s.push("Post question empty."), t.call(this, e, {errors: s})
    }, e.exports = s
  }, {"../utils/string_helpers": 320, lodash: "MicNly"}],
  247: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/model"), a = t("prima/utils/image/loader"), r = t("prima/utils/image/filereader"), l = t("prima/utils/image/canvas"), h = 1080, c = n.extend({
      defaults: {
        url: "",
        preuploadUrl: "",
        externalUrl: "",
        file: null,
        photoRaw: null,
        base64: null,
        isSelfie: !1,
        isSelfieGif: !1,
        width: null,
        height: null,
        caption: "",
        id: ""
      }, initialize: function () {
        this.on("change:externalUrl", function (t, e) {
          e && this.readUrl(e), this.set({preuploadUrl: null, base64: null})
        }, this), this.get("externalUrl") && !this.get("base64") && this.trigger("change:file", this, this.get("file")), this.on("change:file", function (t, e) {
          e && this.readFile(e), this.set({externalUrl: null, base64: null})
        }, this), this.get("file") && !this.get("base64") && this.trigger("change:file", this, this.get("file"))
      }, readUrl: function (t, e) {
        e || (e = "photo:readUrl"), a.load(t).then(s.bind(function (t) {
          this.set({url: t.src, width: t.width, height: t.height}), this.trigger(e, !0, this)
        }, this), s.bind(function (i) {
          this.set({url: t, width: null, height: null}), this.trigger(e, !1, this)
        }, this))
      }, readFile: function (t) {
        return r.canReadFiles() ? void r.read(t).then(s.bind(function (t) {
          if (!t.file.type.match(/image\/(jpg|jpeg|png)/i))return this.readUrl(t.objectUrl || t.base64, "photo:readFile");
          var e = o("<img/>");
          e.attr("src", t.objectUrl || t.base64), a.load(t.objectUrl || t.base64).then(s.bind(function (i) {
            var s = l.drawScaledAndRotated(e, i.width, i.height, t.rotation, t.mirrored, h);
            return this.readUrl(s.toDataURL(t.file.type), "photo:readFile")
          }, this))
        }, this), s.bind(function () {
          this.trigger("photo:readFile", !1, this)
        }, this)) : void this.trigger("photo:readFile", !1, this)
      }, getDisplayUrl: function () {
        return this.get("preuploadUrl") ? this.get("preuploadUrl") : this.get("externalUrl") ? this.get("externalUrl") : this.get("base64") ? this.get("base64") : this.get("url")
      }, getUploadUrl: function () {
        return this.get("preuploadUrl") ? this.get("preuploadUrl") : this.get("externalUrl") ? this.get("externalUrl") : ""
      }, toJSON: function () {
        var t = n.prototype.toJSON.apply(this, arguments);
        return t.displayUrl = this.getDisplayUrl(), t.uploadUrl = this.getUploadUrl(), t
      }
    });
    e.exports = c
  }, {
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/model": 590,
    "prima/utils/image/canvas": 603,
    "prima/utils/image/filereader": 604,
    "prima/utils/image/loader": 605
  }],
  248: [function (t, e, i) {
    "use strict";
    function s() {
    }

    var o = t("lodash"), n = t("../collections/photos"), a = t("../utils/string_helpers").truncateLongStrings;
    s.prototype.genericFieldMap = {
      two: "caption",
      three: "linkthrough"
    }, s.prototype.editorField = "two", s.prototype.typeAttributes = {
      caption: "",
      layout: "",
      linkthrough: "",
      photos: []
    }, s.prototype.allowAnswerFields = ["caption"], s.prototype.generateTweetText = function (t, e) {
      var i = this.getHtmlStripped("caption");
      return i = i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi, ""), a(i, e)
    }, s.prototype.MAX_IMAGES = 10, s.prototype.resetPreserveFields = ["caption", "tags"], s.prototype.afterDelegate = function (t) {
      t.apply(this, o.rest(arguments)), this.photos = new n(this.attributes.photos, {parse: !0}), this.on("change:photos", function (t, e) {
        this.photos.reset(e, {parse: !0}), delete this.attributes.photos
      }, this), this.trigger("change:photos", this, this.get("photos")), this.listenTo(this.photos, "add remove change:preuploadUrl change:externalUrl", function () {
        this.trigger("validate")
      })
    }, s.prototype.parseForType = function (t, e, i) {
      return e.layout = i.photoset_layout, delete e.photoset_layout, e
    }, s.prototype.serializeForServer = function (t) {
      var e = this, i = t.apply(this, o.rest(arguments));
      return o.forEach(this.photos.toJSON(), function (t) {
        i["images[" + t.id + "]"] = t.uploadUrl, i["caption[" + t.id + "]"] = (t.caption || "").substr(0, 200), t.photoRaw && (i.photo_raw = t.photoRaw, i.is_selfie_gif = t.isSelfieGif, i.is_selfie = t.isSelfie)
      }), i["post[photoset_layout]"] = e.get("layout"), i["post[photoset_order]"] = this.photos.pluck("id").join(","), i
    }, s.prototype.canAddPhotos = function (t) {
      return this.photos.length < this.MAX_IMAGES
    }, s.prototype.validate = function (t, e, i) {
      var s = [];
      0 === this.photos.length && s.push("No photos specified.");
      var o = this.photos.all(function (t) {
        return t.getUploadUrl() || !t.has("upload")
      });
      return o || s.push("Uploads in progress."), t.call(this, e, {errors: s})
    }, e.exports = s
  }, {"../collections/photos": 239, "../utils/string_helpers": 320, lodash: "MicNly"}],
  249: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/model"), n = t("prima/utils/exposer"), a = t("prima/mixins/delegator"), r = t("./text_post"), l = t("./photo_post"), h = t("./quote_post"), c = t("./link_post"), d = t("./chat_post"), u = t("./audio_post"), p = t("./video_post"), m = t("./note_post"), g = t("../utils/bool_tool"), _ = t("../utils/string_helpers"), f = t("prima/utils/url"), v = t("../utils/validation"), b = o.extend({
      mixins: [a],
      typeDelegateMap: {text: r, photo: l, quote: h, link: c, chat: d, audio: u, video: p, note: m},
      _VALID_STATES: {
        published: "0",
        draft: "1",
        queued: "2",
        scheduled: "on.2",
        "private": "private",
        unapproved: "0 3",
        transcoding: "4"
      },
      _FORMAT_CODE_TO_EDITOR_TYPE: {0: "rich", 1: "html", 2: "markdown"},
      _STATE_CODE_TO_TEXT: {
        0: "published",
        "0 3": "published",
        1: "draft",
        2: "queued",
        3: "unapproved",
        4: "transcoding",
        "on.2": "scheduled",
        "private": "private"
      },
      defaults: {
        allow_photo_replies: Boolean(),
        postDate: String(),
        customUrl: String(),
        sourceUrl: String(),
        state: "published",
        editorType: "rich",
        tags: [],
        publish_on: String(),
        tumblelog: String(),
        uploading: !1,
        mode: "new",
        contentStats: {},
        loading: !1,
        hasLoadingInlineImages: !1
      },
      shortUrlLength: 29,
      typeAttributes: {},
      editorField: !1,
      resetPreserveFields: [],
      resetAttributes: [],
      allowAnswerFields: [],
      _syntheticAttributes: {
        pseudoState: function () {
          var t = this.get("state"), e = this.get("publish_on");
          return "published" === t && 1 === parseInt(this.get("is_private"), 10) && (t = "private"), "queued" === t ? s.isEmpty(e) ? "queued" : "scheduled" : t
        }, formattedSourceUrl: function () {
          var t, e = this.get("sourceUrl");
          return s.isEmpty(e) ? "" : (t = f.addProtocolIfMissing(e, "http:"), v.isUrl(t) ? t : e)
        }
      },
      initialize: function (t, e) {
        s.has(t, "tags") || this.set("tags", []), this._assignPostTypeFunctionality()
      },
      _assignPostTypeFunctionality: function () {
        var t = this.get("type"), e = s.bind(function (t) {
          return t in this.typeDelegateMap ? this.typeDelegateMap[t].prototype : !1
        }, this);
        t ? (this.delegateObject(e(t)), this.afterDelegate()) : this.listenToOnce(this, "change:type", function (t, i) {
          this.delegateObject(e(i)), this.afterDelegate()
        })
      },
      afterDelegate: function () {
        s.defaults(this.attributes, this.typeAttributes)
      },
      _normalizeType: function (t, e) {
        var i = {regular: "text", conversation: "chat"};
        return e === !1 && (i = s.invert(i)), t in i ? i[t] : t
      },
      get: function (t) {
        return (this._syntheticAttributes[t] || o.prototype.get).apply(this, arguments)
      },
      getHtmlStripped: function (t, e, i) {
        return "undefined" != typeof e || (e = !0), "undefined" != typeof i || (i = " "), s.trim(_.stripHtml(this.get(t) || "", e, i))
      },
      fetch: function (t) {
        var e = {data: t};
        return o.prototype.fetch.call(this, e)
      },
      parse: function (t, e) {
        if (e.parse === !1)return this.attributes;
        var i = t.post, o = e.data, n = {}, a = i.id ? "edit" : "reblog";
        n.type = this._normalizeType(i.type, !0), n.can_reblog_as = s.map(i.can_reblog_as, s.bind(function (t) {
          return this._normalizeType(t, !0)
        }, this)), this.set("type", n.type), s.forEach(this.genericFieldMap, function (t, e) {
          n[t] = i[e]
        });
        var r = ["one", "two", "three", "state", "publish_on", "tags", "type", "can_reblog_as"];
        return s.extend(n, s.omit(i, r), {
          createdPost: !!t.created_post,
          postTumblelog: t.post_tumblelog || {},
          postContextPage: t.post_context_page
        }), "edit" === a ? (n["post-id"] = i.id, n.tags = i.tags ? i.tags.split(",") : [], n.tumblelog = n.postTumblelog.name_or_id || !1) : "reblog" === a && s.extend(n, s.pick(o, ["reblog_id", "reblog_key"])), "state" in i && (n.state = this._extractState(i)), i.from_app && 1 === s.parseInt(i.format) || (n.editorType = this._FORMAT_CODE_TO_EDITOR_TYPE[s.parseInt(i.format || 0)]), n.editorType || (n.editorType = this.get("editorType") || this._FORMAT_CODE_TO_EDITOR_TYPE[0]), s.has(i, "custom_tweet") && (n.customTweet = i.custom_tweet), s.extend(n, {
          sourceUrl: n.source_url || "",
          htmlEdited: "rich" !== n.format && !(this.editorField && !i[this.editorField]),
          postDate: n.date || "",
          customUrl: n.slug || ""
        }, s.mapValues(s.pick(n, ["allow_answers", "allow_photo_replies", "html_mode"]), g)), "edit" !== a || "queued" !== n.state || s.isEmpty(i.publish_on) || (n.state = "scheduled", n.publish_on = i.publish_on), this.parseForType(n, i)
      },
      parseForType: function (t, e) {
        return t
      },
      sync: function (t, e, i) {
        var n = {create: "/svc/post/update", read: "/svc/post/fetch", update: "/svc/post/update"};
        return s.defaults(i || (i = {}), {
          emulateHTTP: !0,
          forServer: !0,
          url: n[t]
        }), i.parse = "read" === t, o.prototype.sync.call(this, t, e, i)
      },
      toJSON: function (t) {
        return t = s.defaults(t || {}, {forServer: !1}), t.forServer ? this.serializeForServer(t) : o.prototype.toJSON.call(this, t)
      },
      serializeForServer: function () {
        var t = this, e = t.attributes, i = {
          channel_id: e.tumblelog,
          post_id: e["post-id"],
          "post[date]": e.postDate,
          "post[one]": this.getAttributeFromGeneric("one"),
          "post[publish_on]": e.publish_on,
          "post[slug]": e.customUrl,
          "post[tags]": e.tags.join(),
          "post[two]": this.getAttributeFromGeneric("two"),
          "post[three]": this.getAttributeFromGeneric("three"),
          thumbnail: this.getAttributeFromGeneric("thumbnail"),
          editor_type: e.editorType,
          send_to_twitter: e.send_to_twitter,
          custom_tweet: e.customTweet,
          send_to_fbog: e.send_to_fbog,
          loggingData: e.loggingData,
          allow_photo_replies: e.allow_photo_replies,
          content_stats: e.contentStats
        };
        "edit" === e.mode && (i.edit_post_id = e["post-id"]), i["post[source_url]"] = t.get("formattedSourceUrl"), i["post[state]"] = t._VALID_STATES[e.state], i["post[type]"] = this._normalizeType(e.type, !1);
        var o = {
          reblog: e.is_reblog,
          reblog_key: e.reblog_key,
          reblog_post_id: e.reblog_id,
          pt: e.pt,
          remove_reblog_tree: e.remove_reblog_tree,
          reblog_source: e.reblogSource
        };
        s.extend(i, s.pick(o, function (t) {
          return !s.isUndefined(t)
        })), e.allow_answers && (i.allow_answers = "on"), this.getAttributeFromGeneric("thumbnail") && (i.thumbnail_pre_upload = "1");
        var n = this.getContextPage();
        return s.extend(i, {
          context_id: e.tumblelog,
          context_page: n,
          "is_rich_text[one]": "0",
          "is_rich_text[two]": "0",
          "is_rich_text[three]": "0"
        }), this.editorField && (i["is_rich_text[" + this.editorField + "]"] = "1"), e.reblogActionContext && (i.reblog_source = e.reblogActionContext), e.shareData && s.isObject(e.shareData) && (e.shareData.canonicalUrl = i["post[source_url]"], i.share_data = e.shareData), i
      },
      validate: function (t, e) {
        var i = "errors" in e ? e.errors : [];
        return t.state && (s.has(this._VALID_STATES, t.state) || i.push('Invalid "state" value')), t.hasLoadingInlineImages && i.push("There are still pending images."), s.each(this.defaults, function (e, s) {
          typeof e != typeof t[s] && i.push('Invalid "' + s + '" type. Expected ' + typeof e + ", got " + typeof t[s] + ".")
        }), i.length ? i : void 0
      },
      _extractState: function (t) {
        var e = this._STATE_CODE_TO_TEXT[t.state];
        return 1 === parseInt(t.is_private, 10) && (e = "private"), e
      },
      findBlogChannelByName: function (t) {
        return this.attributes.tumblelog && this.attributes.tumblelog.collection && "findWhere" in this.attributes.tumblelog.collection ? this.attributes.tumblelog.collection.findWhere({name_or_id: t}) : void 0
      },
      getPreservedData: function () {
        return this.resetPreserveFields.some(s.bind(function (t) {
          return this.get(t) && this.get(t).length > 0
        }, this))
      },
      softReset: function () {
        s.forEach(this.resetAttributes, function (t) {
          s.has(this.typeAttributes, t) ? this.set(t, this.typeAttributes[t]) : s.has(this.defaults, t) ? this.set(t, this.defaults[t]) : this.unset(t)
        }, this)
      },
      getLookupData: function () {
        return "reblog" === this.get("mode") ? {
          reblog_id: this.get("reblog_id"),
          reblog_key: this.get("reblog_key"),
          post_type: this.get("type")
        } : void 0
      },
      getContextPage: function () {
        var t = this.attributes, e = "dashboard";
        return t.contextData && "baseRoute" in t.contextData && (e = t.contextData.baseRoute.split("/").pop()), e
      },
      getAttributeFromGeneric: function (t) {
        return this.get(this.genericFieldMap[t])
      },
      getTweetText: function () {
        var t = this.get("customTweet");
        return s.isString(t) || (t = this.generateTweetText(140 - this.shortUrlLength - 1), t ? t += " [URL]" : t = "[URL]"), t
      },
      getTweetTextLength: function (t) {
        s.isString(t) || (t = this.getTweetText()), t = s.trim(t).replace(/([^\s])\[URL\]/gi, "$1 [URL]").replace(/\[URL\]([^\s])/gi, "[URL] $1");
        var e = t.length;
        return e += (this.shortUrlLength - 5) * (t.match(/\[URL\]/gi) || "").length
      },
      generateTweetText: function (t) {
        return ""
      },
      canEditMedia: function () {
        return !this.get("is_reblog")
      },
      isReblog: function () {
        return !!this.get("is_reblog")
      },
      allowsTypeSwitch: function (t) {
        return !1
      },
      canPreview: function () {
        return this.isValid()
      },
      deepHasChanged: function (t) {
        var e = this.toJSON(), i = this.get("mode"), o = s.keys(t), n = s.keys(e);
        if (s.isEqual(t, e))return !1;
        if ("new" !== i)return !0;
        var a = s.difference(n, o), r = s.reduce(a, function (t, i) {
          var o = e[i], n = s.isUndefined(o) || s.isNull(o) ? 0 : o.length;
          return t + n
        }, 0);
        return r > 0 ? !0 : (t = s.omit(t, a), e = s.omit(e, a), !s.isEqual(t, e))
      }
    });
    n({"Tumblr.Prima.PostForms.Post": b}), e.exports = b
  }, {
    "../utils/bool_tool": 313,
    "../utils/string_helpers": 320,
    "../utils/validation": 321,
    "./audio_post": 241,
    "./chat_post": 243,
    "./link_post": 244,
    "./note_post": 246,
    "./photo_post": 248,
    "./quote_post": 250,
    "./text_post": 252,
    "./video_post": 253,
    lodash: "MicNly",
    "prima/mixins/delegator": 579,
    "prima/model": 590,
    "prima/utils/exposer": 602,
    "prima/utils/url": 611
  }],
  250: [function (t, e, i) {
    "use strict";
    function s() {
    }

    var o = t("sprintf-js").sprintf, n = t("../utils/string_helpers").truncateLongStrings;
    s.prototype.genericFieldMap = {one: "quote", two: "source"}, s.prototype.typeAttributes = {
      quote: "",
      source: ""
    }, s.prototype.generateTweetText = function (t, e) {
      var i = this.getHtmlStripped("quote"), s = this.getHtmlStripped("source");
      s = s.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi, "");
      var a;
      return a = s && i.length + (s.length > 1 ? 7 : 6) <= e ? a = o("%s - %s", i, s) : i ? o("%s", n(i, e - 2)) : s, n(a, e)
    }, s.prototype.editorField = "two", s.prototype.validate = function (t, e, i) {
      var s = [];
      return (!e.quote || e.quote.length < 1) && s.push("No quote."), t.call(this, e, {errors: s})
    }, e.exports = s
  }, {"../utils/string_helpers": 320, "sprintf-js": "qPOUxN"}],
  251: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/model"), n = o.extend({
      defaults: {
        fetchOptions: {
          url: "/svc/tag_suggest",
          with_form_key: !0
        }, suggestCache: {}, queryHistory: [], maxCacheSize: 20, maxSuggests: 5, tagSuggestions: {}
      }, initialize: function (t) {
        if (!1 == ("user" in t && "post" in t))throw new Error("Tag Suggestions must be provided user and post models.")
      }, fetch: function (t) {
        return "query" in t && "success" in t && s.isFunction(t.success) || console.error("TagSuggestion must be provided a query and a success callback."), s.extend(t, this.get("fetchOptions")), t.query in this.get("suggestCache") ? (this.set("tagSuggestions", this.get("suggestCache")[t.query]), t.success.call(this, this, "suggestCache", t)) : (t.data = {q: t.query}, o.prototype.fetch.call(this, t))
      }, parse: function (t, e) {
        var i = this.get("user"), s = this.get("post").get("tumblelog"), o = {
          suggestions: "tags" in t ? t.tags : [],
          userTags: s ? i.getChannelProperty(s, "tags") : []
        };
        return o.userTags || (o.userTags = []), o = this._processQueryResults(o, e), this._cacheQueryResults(o, e), {tagSuggestions: o}
      }, _processQueryResults: function (t, e) {
        var i = new RegExp(this._escapeRegex(e.query), "i");
        return t.suggestions = s.compact(s.map(t.suggestions, function (t) {
          return t.tag
        })).slice(0, this.get("maxSuggests")), t.userTags = s.compact(s.filter(t.userTags, function (t) {
          return i.test(t)
        })).slice(0, this.get("maxSuggests")), t
      }, _cacheQueryResults: function (t, e) {
        var i = s.clone(this.get("suggestCache")), o = s.clone(this.get("queryHistory"));
        i[e.query] = t, o.push(e.query), s.size(i) > this.get("maxCacheSize") && (delete i[o[0]], o.shift()), this.set("suggestCache", i), this.set("queryHistory", o)
      }, _escapeRegex: function (t) {
        return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&")
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "prima/model": 590}],
  252: [function (t, e, i) {
    "use strict";
    function s() {
    }

    var o = t("lodash"), n = t("sprintf-js").sprintf, a = t("../utils/string_helpers").truncateLongStrings;
    s.prototype.genericFieldMap = {
      one: "title",
      two: "body"
    }, s.prototype.editorField = "two", s.prototype.typeAttributes = {
      title: "",
      body: ""
    }, s.prototype.allowAnswerFields = ["title", "body"], s.prototype.generateTweetText = function (t, e) {
      var i = this.getHtmlStripped("title"), s = this.getHtmlStripped("body");
      s = s.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi, "");
      var o;
      return o = i && s ? n("%s - %s", i, s) : i || s || "", a(o, e)
    }, s.prototype.validate = function (t, e, i) {
      var s = [], n = !o.isUndefined(e.reblog_tree) && e.reblog_tree !== !1 && "" !== e.reblog_tree;
      return (!e.body || e.body.length < 1) && (!e.title || e.title.length < 1) && (n || s.push("Post body empty.")), t.call(this, e, {errors: s})
    }, e.exports = s
  }, {"../utils/string_helpers": 320, lodash: "MicNly", "sprintf-js": "qPOUxN"}],
  253: [function (t, e, i) {
    "use strict";
    function s() {
    }

    var o = t("lodash"), n = t("prima/lib/translate"), a = t("../utils/remap_keys"), r = t("prima/utils/camelize-keys"), l = t("../utils/string_helpers").truncateLongStrings;
    s.prototype.genericFieldMap = {
      one: "embedCode",
      two: "caption"
    }, s.prototype.allowAnswerFields = ["caption"], s.prototype.editorField = "two", s.prototype.resetPreserveFields = ["caption", "tags"], s.prototype.resetAttributes = ["preuploadUrl", "preuploadKey", "embedCode", "confirmTos", "copyrightFallback"], s.prototype.typeAttributes = {
      caption: "",
      confirmTos: !1
    }, s.prototype.generateTweetText = function (t, e) {
      var i = this.getHtmlStripped("caption");
      return i = i.replace(/[\r\n\s]*\[\[MORE\]\].*$/gi, ""), l(i, e)
    }, s.prototype.validate = function (t, e, i) {
      var s = [];
      return e.embedCode ? 0 === e.embedCode.length && s.push("No embed specified.") : e.preuploadUrl ? e.confirmTos || s.push(n("You must agree that you have permission to share this file.")) : e.video ? 0 === e.video.embed_code.length && s.push("Direct embed missing.") : s.push("No video specified."), t.call(this, e, {errors: s})
    }, s.prototype.canPreview = function () {
      return !this.get("preuploadKey") && this.isValid()
    }, s.prototype.serializeForServer = function (t) {
      var e = t.apply(this, o.rest(arguments)), i = o.omit({
        preuploaded_url: this.get("preuploadUrl"),
        preuploaded_ch: this.get("preuploadKey"),
        confirm_tos: this.get("confirmTos"),
        copyright_fallback: this.get("copyrightFallback")
      }, o.isUndefined);
      return o.extend(e, i), e = a(e, "snake", ["embedCode"])
    }, s.prototype.getEmbedData = function (t) {
      var e = !1;
      return this.has("video") ? (e = r(this.get("video")), e = {
        isNativeVideo: !0,
        embedRenderContext: "inline",
        width: e.dimensions.width,
        height: e.dimensions.height,
        previewIframe: e.previewIframe,
        embedCode: e.embedCode
      }) : this.has("video_embed") && (e = r(this.get("video_embed"))), e
    }, e.exports = s
  }, {
    "../utils/remap_keys": 318,
    "../utils/string_helpers": 320,
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/utils/camelize-keys": 594
  }],
  254: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("backbone"), a = function () {
      var t = 4, e = ["spotify", "soundcloud", "bandcamp"], i = ["spotify", "soundcloud"], a = {}, r = [], l = 10, h = {
        normalizeResults: function (t, e, i) {
          var o = {service: t};
          switch (t) {
            case"spotify":
              return s.extend(o, {
                tracks: s.map(s.take(e.tracks.items, i), function (t) {
                  return {
                    primary: t.name,
                    secondary: s.first(t.artists).name,
                    info: t.album.name,
                    href: t.uri,
                    id: t.uri
                  }
                })
              });
            case"soundcloud":
              return s.extend(o, {
                tracks: s.map(s.take(e, i), function (t) {
                  return {primary: t.title, secondary: t.user.username, info: null, href: t.permalink_url, id: t.id}
                })
              });
            case"youtube":
              return s.extend(o, {
                tracks: s.map(s.take(e.items, i), function (t) {
                  return {
                    primary: t.snippet.title,
                    secondary: t.snippet.channelTitle,
                    info: null,
                    href: "https://www.youtube.com/watch?v=" + t.id.videoId,
                    id: t.id.videoId
                  }
                })
              });
            default:
              throw"Invalid service: " + t
          }
        }, getServiceByUrl: function (t) {
          var e = {
            spotify: /(open\.spotify\.com|spotify)[\/|:](track|album|artist|playlist|user)[\/|:](.*)?([\d\w]{22})$/,
            soundcloud: /(http|https):\/\/soundcloud\.com\/[^\/]+\/(sets\/)?[^\/]+\/?(\?.*)?$/,
            bandcamp: /(http|https):\/\/(?:([^\/]+\.)\.bandcamp\.com|[^\/]+\.[^\/]+)\/(track|album)\/[^\/]+$/,
            direct: /[.](mp3)$/i
          };
          for (var i in e)if (e[i].test(t))return i;
          return !1
        }, getData: function (t, i) {
          if (!s.contains(e, i))return !1;
          if (t in a) {
            var n = a[t];
            this._notifyOnDataLookup(t, i, n.data, n.isOK)
          } else {
            if ("spotify" !== i || !t.match(new RegExp(/[\/:]playlist[\/:]/))) {
              var r = o.ajax({
                url: "/svc/post/get_" + i + "_data",
                type: "POST",
                with_form_key: !0,
                data: {url: t, service: i}
              });
              return r.then(s.bind(function (e) {
                e && !e.error ? this._notifyOnDataLookup(t, i, e, !0) : this._notifyOnDataLookup(t, i, e, !1)
              }, this), s.bind(function (e) {
                this._notifyOnDataLookup(t, i, e, !1)
              }, this))
            }
            this._notifyOnDataLookup(t, i, {}, !0)
          }
        }, _notifyOnDataLookup: function (t, e, i, s) {
          var o = s ? "audioEmbedData:fetched" : "audioEmbedData:error";
          this.trigger(o, t, e, i, s)
        }, _cacheDataLookupResults: function (t, e, i, o) {
          a[t] = {data: i, isOK: o}, r.push(t), s.size(a) > l && (delete a[r[0]], r.shift())
        }, search: function (e, i, n) {
          var a = n && n.maxResults && s.isNumber(n.maxResults) ? n.maxResults : t, r = o.ajax({
            url: "/search_audio",
            type: "POST",
            with_form_key: !0,
            data: {q: i, audio_search_provider: e}
          });
          return r.then(s.bind(function (t) {
            this.trigger("searchResults:fetched", this.normalizeResults(e, t, a))
          }, this), s.bind(function (t) {
            this.trigger("searchResults:fetched", {service: e, tracks: []})
          }, this))
        }
      };
      return function () {
        this.dataServices = e, this.searchServices = i, s.extend(this, n.Events, h), this.listenTo(this, "audioEmbedData:fetched", this._cacheDataLookupResults), this.listenTo(this, "audioEmbedData:error", this._cacheDataLookupResults)
      }
    }();
    e.exports = a
  }, {backbone: "5kFNoY", jquery: "HlZQrA", lodash: "MicNly"}],
  255: [function (t, e, i) {
    "use strict";
    function s(t) {
      var e = u.parseUrl(t);
      return e && e.path ? e.path.replace(/^\/([^\/]+)\/.*/i, "$1") : ""
    }

    var o = t("lodash"), n = t("jquery"), a = t("prima/component"), r = t("../utils/dom_stats"), l = t("./embed_data"), h = t("remarkable"), c = new h({html: !0}), d = t("prima/utils/dom"), u = t("prima/utils/url"), p = a.extend({
      name: "ContentStatsSupport",
      initialize: function (t) {
        t = t || {}, this.model = t.model, this.editor = t.editor, this.dateInitialized = new Date, this.mentionStats = {}, this.gifSearchStats = {}, this.editor && this.editor.mentionSupport && this.listenTo(this.editor.mentionSupport, "mention:set", this._onSetMention), this.editor && this.editor.imageSearchSupport && (this.listenTo(this.editor.imageSearchSupport, "gifSearch:query", this._onGifSearchQuery), this.listenTo(this.editor.imageSearchSupport, "gifSearch:accept", this._onGifSearchAccept)), this.contentStats = new r({
          htmlLength: function (t) {
            return t.html().length
          },
          textLength: function (t) {
            return t.text().length
          },
          textTools: {
            hr: "hr", h2: "h2", more: function (t) {
              var e;
              return t && (e = t.text()) ? e.match(/\[\[MORE\]\]/gi) || [] : []
            }, mentions: "a.tumblelog"
          },
          embeds: {
            selector: "figure.tmblr-embed, figure.tmblr-embed-placeholder", attribute: function (t) {
              var e = t.attr("data-provider");
              return l.isValidEmbedServiceName(e) ? e : "unknown"
            }
          },
          images: {
            selector: "img", attribute: function (t) {
              var e;
              return t && t.attr("src") && (e = t.attr("src").match(/.+[.](jpg|jpeg|png|gif)([?]|$)/i), e && e.length > 1) ? e[1].toLowerCase() : "unknown"
            }
          },
          mentions: o.bind(this._getPurgedMentionStats, this),
          gifs: o.bind(this._getConsolidatedGifStats, this),
          gifSearch: o.bind(this._getGifSearchStats, this)
        })
      },
      _onSetMention: function (t, e) {
        o.has(t, "name") && o.has(e, "len") && !o.has(this.mentionStats, t.name) && (this.mentionStats[t.name] = e.len, this.mentionStats = this._getPurgedMentionStats(this._getWrappedContentDocument()))
      },
      _getPurgedMentionStats: function (t) {
        return o.pick(this.mentionStats, o.map(t.find("a.tumblelog"), n.text))
      },
      _ensureGifSearchQueryEntry: function (t) {
        return this.gifSearchStats[t] || (this.gifSearchStats[t] = {added: [], searches: 0}), this.gifSearchStats[t]
      },
      _onGifSearchQuery: function (t, e) {
        var i = this._ensureGifSearchQueryEntry(t);
        i.searches++
      },
      _onGifSearchAccept: function (t, e, i) {
        var o = this._ensureGifSearchQueryEntry(t);
        o.added.push(i + ":" + s(e))
      },
      _getAttributionImages: function (t) {
        return o.map(t.find("[data-tumblr-attribution]"), function (t) {
          var e = n(t), i = e.find("img");
          return e.attr("data-tumblr-attribution") + ":" + s(i.attr("src"))
        })
      },
      _getConsolidatedGifStats: function (t) {
        var e = this._getAttributionImages(t), i = {searches: 0, added: 0, kept: 0};
        return o.forEach(this.gifSearchStats, function (t, s) {
          i.searches += t.searches, i.added += t.added.length, i.kept += o.intersection(e, t.added).length
        }), i
      },
      _getGifSearchStats: function (t) {
        var e = this._getAttributionImages(t);
        return o.transform(this.gifSearchStats, function (t, i, s) {
          o.forEach(i.added, function (i) {
            o.contains(e, i) && (t[i] = s)
          })
        }, {})
      },
      _getContentNode: function () {
        var t = "";
        return this.model && this.model.editorField && (t = this.model.getAttributeFromGeneric(this.model.editorField), "markdown" === this.model.get("editorType") && (t = c.render(t))), d.nodeFromString(t)
      },
      _getWrappedContentDocument: function () {
        return n(this._getContentNode())
      },
      getStats: function () {
        var t = {elapsed: parseInt((new Date - this.dateInitialized) / 1e3, 10)};
        return o.extend(t, this.contentStats.parse(this._getWrappedContentDocument())), t
      }
    });
    e.exports = p
  }, {
    "../utils/dom_stats": 314,
    "./embed_data": 256,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/component": 545,
    "prima/utils/dom": 600,
    "prima/utils/url": 611,
    remarkable: "tJkXfs"
  }],
  256: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("when"), a = t("prima/utils/dom"), r = 2e3, l = t("prima/class"), r = 2e3, h = function (t, e, i) {
      this.name = "EmbedError", this.message = t, this.input = e, this.data = i, this.stack = (new Error).stack
    };
    h.prototype = new Error;
    var c = l.extend({
      constructor: function (t) {
        this.setEmbedRegexes(t || [])
      }, setEmbedRegexes: function (t) {
        this.regexes = t, this.services = s.unique(s.values(t))
      }, isValidEmbedService: function (t) {
        return s.any(this.regexes, function (e, i) {
          return new RegExp(i, "mi").test(t)
        })
      }, isValidEmbedServiceName: function (t) {
        return s.contains(this.services, t)
      }, getUrlFromEmbedCode: function (t) {
        var e = o(a.nodeFromString(t)), i = e.find("iframe[src], embed[src], script[src]").first(), s = e.find("object[data]").first();
        return i.attr("src") || s.attr("data") || !1
      }, fetchEmbedData: function (t, e, i) {
        var a = o.ajax({
          url: "/svc/post/get_video_data",
          type: "POST",
          with_form_key: !0,
          data: JSON.stringify({embed_url: t, embed_width: e})
        });
        return n(a).then(function (o) {
          if (s.isEmpty(o) || "false" === o)throw new h("Invalid embed response", t, o);
          if (o.thumbnail || i)return o;
          var a = s.bind(this.fetchEmbedData, this, t, e, !0);
          return n.promise(function (t, e) {
            s.delay(function () {
              a().then(function (t) {
                return t
              }, function () {
                return o
              })
            }, r)
          })
        })["catch"](function (t) {
          return n.reject(t)
        })
      }, parseEmbedData: function (t, e) {
        if (!s.isString(t))throw"The input is invalid. Expected a string";
        var i = s.trim(t);
        if (this.isValidEmbedService(i))return this.fetchEmbedData(i, e);
        var o = this.getUrlFromEmbedCode(i);
        return s.isEmpty(o) ? n.reject(new h("Invalid embed code", t)) : n.resolve({
          unsupported: !0,
          thumbnail: !1,
          embed_render_context: "blank",
          url: o,
          preview_iframe: "",
          embed_code: t
        })
      }
    });
    e.exports = new c
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/class": 543, "prima/utils/dom": 600, when: "RG2dij"}],
  257: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/class"), a = t("prima/mixins/accessor"), r = t("../views/gif-search-popover"), l = t("../templates/image-search-attribution.tpl"), h = t("app/components/gif-search/collections/search-image-queries"), c = n.extend({
      constructor: function (t) {
        this.initialize.apply(this, arguments)
      }, defaults: {query: "", resultLimit: 200, resultImageWidth: 250}, initialize: function (t) {
        this.options = t = s.extend({}, t), s.extend(this, s.pick(t, "editorView", "editor")), o.browser.mozilla && parseInt(o.browser.version, 10) <= 37 && (this.set("resultLimit", 20), this.set("resultImageWidth", 100)), this.searchImageQueries = new h, this.listenTo(this.searchImageQueries, "search", function (t, e) {
          this.set("query", t), this.trigger("gifSearch:query", t, e), this.set("currentQuery", t)
        }), this.listenTo(this, "insertImage", function (t) {
          this.trigger("gifSearch:accept", t.query, t.src, t.attribution)
        }), this._addToolbarButton(), s.isString(this.get("query")) && this.searchImageQueries.fetchGifs(this.get("query"), this.get("resultLimit")), this.editorView.$el.on("click.image-search-support", "[data-tumblr-attribution]", s.bind(this._onImageClick, this))
      }, teardown: function () {
        this.gifSearch && this.gifSearch.teardown(), this.editorView.$el.off(".image-search-support")
      }, _addToolbarButton: function () {
        this.$imageSearchButton = o("<div />", {
          "class": "control add-gif",
          "data-control-name": "gif",
          tabindex: "0",
          title: this.options.title,
          "data-enabled-title": this.options.title
        }), this.editor.inlineControls.addToTray(this.$imageSearchButton, this.options.trayOptions), this.$imageSearchButton.on("click", s.bind(function (t) {
          this.prompt(this.get("query"))
        }, this))
      }, addTumblrAttribution: function (t, e, i, o) {
        if (i.is("figure")) {
          var n = i.filter("[data-tumblr-attribution]"), a = n.children("img").first();
          if (!s.isEmpty(n) && !s.isEmpty(a)) {
            var r = (n.attr("data-tumblr-attribution") || "").split(":");
            if (3 !== r.length)return;
            r.push(n.attr("data-tumblr-query"), n.attr("data-tumblr-search")), r.unshift(n), this.updateTumblrAttribution.apply(this, r)
          }
        }
      }, cleanupMarkup: function (t, e) {
        e.find("figure[data-tumblr-query]").removeAttr("data-tumblr-query"), e.find("figure[data-tumblr-search]").removeAttr("data-tumblr-search"), e.find("figure[data-tumblr-attribution]").children(":not(img)").remove()
      }, insertImage: function (t, e, i, n) {
        !s.isUndefined(n) || (n = !0);
        var a = s.values(s.pick(t, "rootBlog", "rootBlogKey", "rootPostUrlHash")), r = this.editor.lastSelection ? this.editor.lastSelection.anchorNode : null, l = function (r) {
          var l = o(this.editor.getAsyncImage(r)), h = l.parent("figure");
          l.attr("src", t.mediaUrl), a.unshift(h), s.isString(e) || (e = h.attr("data-tumblr-query")), s.isString(i) || (i = e), a.push(e, i), this.updateTumblrAttribution.apply(this, a), n && h.addClass("tmblr-full"), this.editorView.updateModelFromEditor(), this.trigger("insertImage", {
            query: i,
            src: t.mediaUrl,
            attribution: h.attr("data-tumblr-attribution")
          })
        };
        this.get("replaceKey") ? (l.call(this, this.get("replaceKey")), this.unset("replaceKey"), this.editorView.focus()) : this.editorView.insertImageFromUrl(t.mediaUrl, "", {targetNode: r}).then(s.bind(l, this))
      }, _onImageClick: function (t) {
        var e, i, s, n, a, r, l, h = o(t.target);
        this.gifSearch && this.gifSearch.isOrWasRecentlyRendered(250) || h.is(".tmblr-attribution") || h.parents(".tmblr-attribution").length > 0 || (e = o(t.currentTarget), i = e.find("[data-img-key]"), i.is("[data-img-key]") && e.is("[data-tumblr-query]") && (s = i.attr("data-img-key"), n = e.attr("data-tumblr-query"), r = t.pageY - e.offset().top, l = e.height(), a = r > l - 200 ? -97 : -l + r, this.prompt(n, {
          pinnedTarget: e,
          shift: {x: 0, y: a},
          selectedImageUrl: i.attr("src")
        }), this.set("replaceKey", s)))
      }, updateTumblrAttribution: function (t, e, i, o, n, a) {
        var r = t.children("img").first();
        t.attr("data-tumblr-attribution", e + ":" + i + ":" + o), s.isString(n) ? t.attr("data-tumblr-query", n) : t.removeAttr("data-tumblr-query"), s.isString(a) ? t.attr("data-tumblr-search", a) : t.removeAttr("data-tumblr-search"), t.closest(".media-holder").toggleClass("media-holder--gif-search", s.isString(n)), t.children().not(r).remove(), t.append(l({
          attributionUrl: "http://tmblr.co/" + o,
          attributionName: e
        }))
      }, getButton: function () {
        return this.$imageSearchButton
      }, prompt: function (t, e) {
        e = s.extend({
          collection: this.searchImageQueries,
          query: t,
          resultLimit: this.get("resultLimit"),
          imageWidth: this.get("resultImageWidth"),
          autoTeardown: !0,
          teardownOnEscape: !1,
          pinnedTarget: this.getButton()
        }, e);
        var i = function () {
          this.unset("replaceKey"), this.stopListening(this.gifSearch), this.gifSearch.teardown(), this.gifSearch = null
        };
        this.gifSearch && i.call(this), this.gifSearch = new r(e), this.gifSearch.render(), this.listenToOnce(this.gifSearch, "selectImage", function (t) {
          this.insertImage(t, this.get("query"), t.popularSearchTag), s.delay(s.bind(i, this), 250)
        }), this.listenToOnce(this.gifSearch, "dismiss", s.bind(i, this)), this.listenToOnce(this.gifSearch, "close", function () {
          this.gifSearch = null
        }), this.trigger("prompt")
      }, calculateWidth: function () {
        var t = o(this.editor.element), e = t.width(), i = t.offset(), s = this.editor.inlineControls.tray, n = s.offset();
        return e - (n.left - i.left)
      }, returnFocus: function () {
        if (this.editorView.inlineControlNode) {
          var t = document.createRange(), e = window.getSelection();
          t.setStart(this.editorView.inlineControlNode, 0), t.collapse(!0), e.removeAllRanges(), e.addRange(t)
        }
        this.getButton().focus()
      }, isOpen: function () {
        return !s.isEmpty(this.gifSearch)
      }
    });
    a.applyTo(c.prototype), e.exports = c
  }, {
    "../templates/image-search-attribution.tpl": 271,
    "../views/gif-search-popover": 330,
    "app/components/gif-search/collections/search-image-queries": 57,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/class": 543,
    "prima/mixins/accessor": 577
  }],
  258: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = function () {
      return {
        uploadImageUrl: function (t, e, i, o) {
          var n = s.ajax({url: "/svc/post/upload_image_url", type: "POST", with_form_key: !0, data: {url: t}});
          return "function" == typeof e && n.done(function (i) {
            e.call(null, i, t)
          }), "function" == typeof i && n.fail(i), "function" == typeof o && n.always(o), n
        }
      }
    }();
    e.exports = o
  }, {jquery: "HlZQrA"}],
  259: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("backbone"), a = t("../views/inline_embed_field"), r = t("../services/embed_data"), l = (t("prima/lib/logger"), t("prima/lib/translate")), h = t("prima/utils/camelize-keys"), c = "tmblr-embed", d = "tmblr-embed-placeholder", u = "embed_iframe", p = t("prima/utils/dom"), m = t("../templates/thumbnail_preview.tpl"), g = function () {
      var t = {
        template: m, trayOpened: function (t) {
          this.checkLimit(), this.inlineEmbedField.hide()
        }, trayClosed: function (t) {
          this.inlineEmbedField.hide()
        }, disable: function () {
          var t = this.$inlineEmbedButton.attr("data-disabled-title");
          this.isDisabled = !0, this.$inlineEmbedButton.addClass("disabled").attr("title", t).attr("tabindex", "-1")
        }, enable: function () {
          var t = this.$inlineEmbedButton.attr("data-enabled-title");
          this.isDisabled = !1, this.$inlineEmbedButton.removeClass("disabled").attr("title", t).attr("tabindex", "0")
        }, checkLimit: function () {
          this.isAtLimit() ? this.disable() : this.enable()
        }, isAtLimit: function () {
          var t = o(this.editor.element).find("figure." + c + ", figure." + d);
          return t.length >= this.inlineEmbedsPerPost
        }, calculateWidth: function () {
          var t = o(this.editor.element), e = t.width(), i = t.offset(), s = this.editor.inlineControls.tray, n = s.offset();
          return e - (n.left - i.left)
        }, returnFocus: function () {
          if (this.editorView.inlineControlNode) {
            var t = document.createRange(), e = window.getSelection();
            t.setStart(this.editorView.inlineControlNode, 0), t.collapse(!0), e.removeAllRanges(), e.addRange(t)
          }
          this.getButton().focus()
        }, insertEmbed: function (t) {
          if (this.editor.inlineControls.isTrayOpen || this.editorView.get("hasGifSearchVariation")) {
            var e = {
              "class": d,
              "data-provider": encodeURIComponent(t.service),
              "data-orig-width": encodeURIComponent(t.widthOrig),
              "data-orig-height": encodeURIComponent(t.heightOrig),
              "data-embed-code": encodeURIComponent(t.embedCode)
            };
            s.isEmpty(t.url) || (e["data-url"] = encodeURIComponent(t.url));
            var i = this._buildEmbedThumbnailPreview(e, t.thumbnail, t.previewIframe), o = i.get(0);
            this.editor.insertMedia(o, !1, this.editorView.inlineControlNode, 0), this.editor.inlineControls.close(), this.checkLimit()
          }
        }, submitEmbedCode: function () {
          var t = s.trim(this.inlineEmbedField.getCurrentValue() || "");
          if ("" === t)return void this.inlineEmbedField._set_field_state_default();
          var e = this.embedCodeParser(t, this.inlineMediaWidthFull);
          return e ? void e.then(s.bind(function (e) {
            return this.inlineEmbedField.set("embedCode", t), e && e.embed_render_context && "inline" === e.embed_render_context ? (this.inlineEmbedField._set_field_state_default(), e = h(e), void this.insertEmbed(e)) : void this.inlineEmbedField._set_field_state_invalid()
          }, this), function (e) {
            this.inlineEmbedField.set("embedCode", t), this.inlineEmbedField._set_field_state_invalid()
          }) : (this.inlineEmbedField._set_field_state_invalid(), void this.inlineEmbedField.set("embedCode", t))
        }, embedCodeParser: function (t, e) {
          if (this._embedCodeParsing && this._embedCodeParsing.abortEmbedCodeParse(), !s.isEmpty(s.trim(t))) {
            var i = !1, o = this._parseEmbedCode = r.parseEmbedData(t, e).then(s.bind(function (t) {
              return t
            }, this), function (t) {
              return !1
            });
            return o.abortEmbedCodeParse = function () {
              i = !0
            }, o
          }
        }, removeEmbedPlaceholders: function (t) {
          var e = p.nodeFromString(t), i = function (t) {
            return s.isEmpty(t) ? !1 : decodeURIComponent(t)
          };
          return o(e).find("figure." + d).each(s.bind(function (t, e) {
            var s = o(e), n = i(s.attr("data-embed-code")), a = s.attr("data-url"), r = {
              "class": c,
              "data-provider": s.attr("data-provider"),
              "data-orig-width": s.attr("data-orig-width"),
              "data-orig-height": s.attr("data-orig-height")
            };
            if (a && (r["data-url"] = a), i(r["data-provider"]) && i(r["data-orig-width"]) && i(r["data-orig-height"]) && n) {
              var l = this._buildEmbedFigure(r, n);
              s.replaceWith(l)
            } else s.remove()
          }, this)), e.innerHTML
        }, addEmbedPlaceholders: function (t) {
          var e = this.editorView.hosts.safe_host + "/svc/embed/inline/", i = p.nodeFromString(t), n = function (t) {
            return s.isEmpty(t) ? !1 : decodeURIComponent(t)
          };
          return o(i).find("figure." + c).each(s.bind(function (t, i) {
            var a = o(i), r = a.parents(), l = r && o(r).filter("blockquote").length > 0;
            if (t < this.inlineEmbedsPerPost) {
              var c = {
                code: a.html(),
                provider: n(a.attr("data-provider")),
                url: n(a.attr("data-url")),
                width: n(a.attr("data-orig-width")),
                height: n(a.attr("data-orig-height"))
              }, m = l ? this.inlineMediaWidthReblog : this.inlineMediaWidthFull, g = Math.ceil(c.height * m / c.width), _ = e + encodeURIComponent(c.url ? c.url : c.code);
              _ += "?w=" + m + "&h=" + g;
              var f = {
                "class": u,
                src: _,
                scrolling: "no",
                frameBorder: "0",
                allowfullscreen: !0,
                mozallowfullscreen: !0,
                webkitallowfullscreen: !0
              }, v = o("<iframe/>", f);
              v.attr("width", m), v.attr("height", g);
              var b = p.outerHTML(v.get(0)), y = {
                "class": d,
                "data-provider": a.attr("data-provider"),
                "data-orig-width": a.attr("data-orig-width"),
                "data-orig-height": a.attr("data-orig-height"),
                "data-embed-code": encodeURIComponent(c.code),
                "data-url": a.attr("data-url") || _
              }, w = this._buildEmbedFigure(y, b);
              w.find("iframe").attr("src", ""), a.replaceWith(w), this.embedCodeParser(decodeURIComponent(y["data-url"]), this.inlineMediaWidthFull).then(s.bind(function (t) {
                if ("inline" === s.get(t, "embed_render_context")) {
                  t = h(t);
                  var e = this._buildEmbedThumbnailPreview(y, t.thumbnail, b);
                  o(this.editor.element).find('figure[data-url="' + y["data-url"] + '"]').replaceWith(e)
                }
              }, this), function (t) {
              })
            } else a.remove()
          }, this)), this.checkLimit(), i.innerHTML
        }, _buildEmbedThumbnailPreview: function (t, e, i) {
          var s = o(i);
          s.addClass("hidden").attr("data-src", s.attr("src")).attr("src", "");
          var n = o(this.template({
            width: s.attr("width") ? s.attr("width") + "px" : s.css("width"),
            height: s.attr("height") ? s.attr("height") + "px" : s.css("height"),
            imageUrl: e.url,
            message: l("Load video")
          }));
          return this._buildEmbedFigure(t, n).append(s).addClass("embed-thumbnail-preview")
        }, _buildEmbedFigure: function (t, e) {
          var i = o("<figure/>", t);
          return e && i.html(e), this.fullWidthInlineMedia && i.addClass(this.fullWidthClass), i
        }, getButton: function () {
          return this.$inlineEmbedButton
        }, prompt: function () {
          this.checkLimit(), this.isDisabled || (this.inlineEmbedField.show(), this.trigger("prompt"))
        }
      }, e = function (e) {
        var i;
        e = e || {}, s.extend(this, n.Events, t), this.editorView = e.editorView, this.editor = e.editor, this.inlineEmbedsPerPost = e.inlineEmbedsPerPost, this.inlineMediaWidthReblog = e.inlineMediaWidthReblog, this.inlineMediaWidthFull = e.inlineMediaWidthFull, this.fullWidthInlineMedia = e.fullWidthInlineMedia, this.fullWidthClass = e.fullWidthClass, this.editorView && this.editor && (this.$inlineEmbedButton = o("<div />", {
          "class": "control add-inline-embed",
          "data-control-name": "inline-embed",
          tabindex: "0",
          title: e.title,
          "data-enabled-title": e.title,
          "data-disabled-title": e.disabledTitle
        }), this.inlineEmbedField = this.editorView.subViews.inlineEmbedField = new a({
          placeholder: l("Paste a URL or embed code"),
          submitEmbedCode: s.bind(this.submitEmbedCode, this),
          calculateWidth: s.bind(this.calculateWidth, this),
          returnFocus: s.bind(this.returnFocus, this)
        }), this.inlineEmbedsPerPost > 0 && (i = o("<div/>", {"data-subview": "inlineEmbedField"}), this.editor.inlineControls.addToTray(this.$inlineEmbedButton, e.trayOptions), this.editor.inlineControls.addToTray(i.get(0))), this.$inlineEmbedButton.on("click", this.prompt.bind(this)), o(this.editor.element).on("click", ".embed-thumbnail-preview", s.bind(function (t) {
          var e = o(t.currentTarget), i = e.find("iframe"), s = e.find(".thumbnail-preview");
          s.addClass("loading"), s.find(".Knight-Rider-loader").addClass("animate"), e.addClass("loading"), i.on("load", function () {
            s.removeClass("loading"), s.addClass("hidden"), e.removeClass("loading")
          }), i.removeClass("hidden"), i.attr("src", i.attr("data-src"))
        }, this)), this.isDisabled = this.isAtLimit())
      };
      return e
    }();
    e.exports = g
  }, {
    "../services/embed_data": 256,
    "../templates/thumbnail_preview.tpl": 305,
    "../views/inline_embed_field": 334,
    backbone: "5kFNoY",
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/logger": 553,
    "prima/lib/translate": 575,
    "prima/utils/camelize-keys": 594,
    "prima/utils/dom": 600
  }],
  260: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/events"), a = t("ligature").SelectionContext, r = t("backbone"), l = function () {
      var t = function () {
      }, e = {rangeDebounce: 10}, i = {
        enterMention: function (e) {
          this.currentMention = e, this.inMention = !0, this.renderGhost(e), this.dropdown.setPinnedTarget(this.editor.element), this.updatePopoverPosition(e), this.trigger("mention:enter"), t("MentionSupport:enterMention - querying server for [%s]", e.string), this.queryServer(e.string)
        }, updateMention: function (e) {
          if (this.inMention && e.string !== this.currentMention.string) {
            if (!this.isSameMention(e))return this.exitMention(e), void this.enterMention(e);
            this.currentMention = e, this.inMention = !0, this.renderGhost(e), this.trigger("mention:update"), t("MentionSupport:updateMention - querying server for [%s]", e.string), this.queryServer(e.string)
          }
        }, exitMention: function () {
          this.currentMention = !1, this.inMention = !1, this.lastTypeahead = "", this.teardownGhost(), this.editor.onChange(), this.trigger("mention:exit")
        }, softConfirm: function (t) {
          var e = h();
          e.caretPosition === e.offsetEnd && this.confirmMention(t)
        }, spaceConfirm: function (t) {
          var e = h(), i = this.dropdown.getCurrentBlogChoice();
          i && i.name === e.string && this.confirmMention(t, i)
        }, confirmMention: function (t, e) {
          e = e || this.dropdown.getCurrentBlogChoice(), e && this.setMention(e)
        }, setMention: function (t) {
          var e = this.lastInfo, i = t.name, s = document.createTextNode(""), o = document.createElement("a"), n = this.lastSelection;
          o.setAttribute("class", "tumblelog"), o.spellcheck = !1, o.innerHTML = "@" + i, e.mentionRange.deleteContents(), e.mentionRange.insertNode(s), e.mentionRange.insertNode(o), e.mentionRange.setStartAfter(s), e.mentionRange.setEndAfter(s), n.removeAllRanges(), n.addRange(e.mentionRange), this.exitMention(e), this.trigger("mention:set", t, e)
        }, linkToMention: function (e) {
          var i, s, n, r = a.getSelection(), l = e.range.commonAncestorContainer.parentElement || o(e.range.commonAncestorContainer).parent().get(0);
          return this.currentMention !== !1 && this.exitMention(e), l.classList.contains("tumblelog") ? (i = document.createRange(), i.selectNode(l), i.deleteContents(), s = document.createTextNode("@" + e.string), i.insertNode(s), n = document.createRange(), r.removeAllRanges(), n.setStart(s, e.caretPosition), n.setEnd(s, e.caretPosition), r.addRange(n), this.cleanupRangeArea(r, n), t("MentionSupport:linkToMention", e.string), void this.onSelection(r)) : !1
        }, abortMention: function () {
          this.escapeMention = h(), this.inMention && this.exitMention(this.escapeMention)
        }, isSameMention: function (t) {
          return this.currentMention && this.currentMention.offsetStart === t.offsetStart
        }, isMentionLink: function (t) {
          var e, i = document.createElement("div"), s = this.adjustRange(t);
          return s ? (i.appendChild(s.cloneContents()), e = o(i).find("a:first"), e.length ? e.hasClass("tumblelog") : !1) : !1
        }, cleanupRangeArea: function (t, e) {
          var i, s, n = document.createElement("span");
          n.setAttribute("id", "mention_cleanup_placeholder"), n.innerHTML = "", e.insertNode(n), this.normalize(t, e), i = e.commonAncestorContainer.parentElement, i || (i = o(e.commonAncestorContainer).parent().get(0)), i.normalize(), 1 === o(i).length && (s = o(i).html(), s = s.replace(/[\u200B]/g, ""), o(i).html(s));
          var a = o(document).find("#mention_cleanup_placeholder");
          a.length > 0 && (t.removeAllRanges(), e.selectNode(a.get(0)), e.deleteContents(), t.addRange(e), i.normalize())
        }, adjustRange: function (t) {
          var e, i;
          return s.isUndefined(t) ? !1 : (t = t.cloneRange(), e = t.commonAncestorContainer, i = 3 === e.nodeType ? e.parentNode : e, i.textContent === "@" + t.toString() && t.selectNode(i), t)
        }, normalize: function (t, e) {
          this.editor.element.normalize(), null === t || s.isUndefined(e) || (t.removeAllRanges(), t.addRange(e))
        }, renderGhost: function (t) {
          if (this.$ghost = o(document).find("#ui_mention_util_ghost"), !(this.$ghost.length > 0)) {
            var e = document.createElement("q");
            e.setAttribute("id", "ui_mention_util_ghost"), e.innerHTML = "&#8203;", e.className = "mention-ghost", t.suffixRange.surroundContents(e), this.$ghost = o(document).find("#ui_mention_util_ghost"), this.trigger("ghost:render", this.$ghost)
          }
        }, updatePopoverPosition: function (t) {
          if (s.has(t, "range")) {
            var e = this.getMentionRect(t), i = o(this.editor.element).offset(), n = o(window).scrollTop();
            this.dropdown.setShift({x: e.left - i.left - 10, y: -(e.bottom - i.top + n + 10)})
          }
        }, teardownGhost: function (t) {
          if (t && t.range || (t = this.lastInfo), this.$ghost = o(document).find("#ui_mention_util_ghost"), 0 !== this.$ghost.length) {
            var e = this.$ghost.parent().get(0), i = t.caretRange.commonAncestorContainer, s = a.getSelection(0), n = s ? s.getRangeAt(0) : !1;
            s && "ui_mention_util_ghost" === o(i).attr("id") && (n.selectNode(i), n.deleteContents(), n.collapse(!1)), this.$ghost = o(document).find("#ui_mention_util_ghost"), 1 === this.$ghost.length && (this.$ghost.remove(), this.trigger("ghost:teardown")), e && e.normalize(), s && n && (s.removeAllRanges(), s.addRange(n))
          }
        }, insertGhost: function (t) {
          var e = a.getSelection(0), i = e.getRangeAt(0);
          this.$ghost = o(document).find("#ui_mention_util_ghost"), 0 !== this.$ghost.length && (this.$ghost.html(t), null === e || s.isUndefined(i) || (e.removeAllRanges(), e.addRange(i)))
        }, maintainTypeaheadGhost: function (e, i) {
          var s = this.dropdown.getBlogChoice(0), o = s ? s.name : this.lastTypeahead;
          if (t("MentionSupport:maintainGhost - topSuggestion = %s, typeahead = %s, lastChar = %s", s, o, i), i && this.lastTypeahead.length && i === this.$ghost.text().substr(0, 1))this.$ghost.text(this.$ghost.text().substr(1)); else if (e && 8 === e.keyCode) {
            var n = o.substr(this.lastTypeahead.length - this.$ghost.text().length - 1);
            t("MentionSupport:maintainGhost BACKSPACE"), this.$ghost.text(n)
          } else this.updateTypeahead(o);
          this.updatePopoverPosition(h())
        }, stripGhost: function (t) {
          if (!t)return t;
          var e = o("<span>" + t + "</span>");
          return e.find("#ui_mention_util_ghost").remove(), e.html()
        }, updateTypeahead: function (e) {
          var i = this.currentMention;
          if (t("MentionSupport:updateTypeahead - typeahead = [%s]", e), this.lastTypeahead = e, !i || !this.inMention || !e)return void this.teardownGhost();
          var s = "";
          i = i.string;
          var o = i.toUpperCase(), n = e.toUpperCase();
          e.length > i.length && o === n.substr(0, o.length) && (s = e.substr(i.length, e.length - i.length)), this.insertGhost(s)
        }, updateForInteractive: function (t) {
          var e = this.dropdown.getCurrentBlogChoice();
          t && e && this.updateTypeahead(e.name)
        }, bindEditorCallbacks: function () {
          this.editor.config.onSelection = s.bind(this.onSelection, this);
          var t = this.editor.config.onClientEvent || s.noop;
          this.editor.config.onClientEvent = s.bind(function (e) {
            t(e), this.onClientEvent(e)
          }, this)
        }, setupListeners: function () {
          this.dropdown.listenTo(this, "editor:cycleUp", this.dropdown.cycleUp), this.dropdown.listenTo(this, "editor:cycleDown", this.dropdown.cycleDown), this.listenTo(this, "editor:abortMention", this.abortMention), this.listenTo(this, "editor:softConfirm", this.softConfirm), this.listenTo(this, "editor:spaceConfirm", this.spaceConfirm), this.listenTo(this, "editor:confirm", this.confirmMention), this.listenTo(this.dropdown, "dropdown:confirm", this.confirmMention), this.dropdown.listenTo(this, "ghost:render", this.dropdown.setPinnedTarget), this.dropdown.listenTo(this, "mention:exit", this.dropdown.teardown), this.listenTo(this.dropdown, "dropdown:render", this.maintainTypeaheadGhost), this.listenTo(this.dropdown, "dropdown:empty", this.exitMention), this.listenTo(this.dropdown, "dropdown:menuInteraction", this.updateForInteractive)
        }, queryServer: function (t) {
          var e = {query: t, success: s.bind(this.dropdown.updateMentionDropdown, this.dropdown)};
          this.mentionModel.fetch(e)
        }, getMentionRect: function (t) {
          if (!(t && t.range && "getClientRects" in t.range))return !1;
          var e = t.range.getClientRects();
          return s.isUndefined(e[0]) ? !1 : e[0]
        }
      }, l = function (e, o) {
        s.extend(this, r.Events, i), this.editor = e, this.dropdown = o, this.mentionModel = o.model, this.inMention = !1, this.currentMention = !1, this.escapeMention = !1, this.lastInfo = !1, this.lastSelection = !1, this.$ghost = !1, this.lastTypeahead = "", this.debugMode = !1, this.bindEditorCallbacks(), this.setupListeners(), t = s.bind(t, this)
      }, h = function (t) {
        t = t || a.getSelection();
        var e = function (t) {
          return /[^\-a-z0-9]/i.test(t)
        }, i = {
          isMention: !1,
          len: 0,
          string: "",
          stringBefore: "",
          stringAfter: "",
          range: !1,
          mentionRange: !1,
          suffixRange: !1,
          caretRange: !1,
          offsetStart: !1,
          offsetEnd: !1,
          caretPosition: !1,
          caretNode: !1
        };
        if (i.caretRange = t && t.rangeCount > 0 ? t.getRangeAt(0) : !1, i.caretRange === !1 || i.caretRange.startOffset !== i.caretRange.endOffset)return !1;
        var o = i.caretRange.commonAncestorContainer;
        o.normalize(), i.caretNode = 1 === o.nodeType ? o.firstChild : o;
        var n = null == i.caretNode ? "" : i.caretNode.nodeValue;
        if (i.caretPosition = i.caretRange.startOffset, null == n || 0 === n.length)return !1;
        for (var r = 0, l = 0; l < i.caretPosition; l++)e(n.charAt(l)) ? r = 0 : r++;
        i.stringBefore = n.substr(i.caretPosition - r, r);
        var h = !1;
        if (i.caretPosition - (r + 2) >= 0) {
          h = n.substr(i.caretPosition - r - 1, 1);
          var c = n.substr(i.caretPosition - r - 2, 1);
          s.contains([32, 160], c.charCodeAt(0)) || (h = !1)
        } else i.caretPosition - (r + 1) >= 0 && (h = n.substr(i.caretPosition - r - 1, 1));
        for (i.isMention = "@" === h, r = 0, l = i.caretPosition; l < n.length && !e(n.charAt(l)); l++)r++;
        return i.stringAfter = n.substr(i.caretPosition, r), i.string = i.stringBefore + i.stringAfter, i.len = i.string.length, i.isMention || 0 !== i.len && "" !== i.string ? (i.range = document.createRange(), i.offsetStart = i.caretRange.startOffset - i.stringBefore.length, i.offsetEnd = i.caretRange.startOffset + i.stringAfter.length, i.range.setStart(i.caretNode, i.offsetStart), i.range.setEnd(i.caretNode, i.offsetEnd), i.isMention ? (i.mentionRange = document.createRange(), i.mentionRange.setStart(i.caretNode, i.offsetStart - 1), i.mentionRange.setEnd(i.caretNode, i.offsetEnd), i.suffixRange = document.createRange(), i.suffixRange.setStart(i.caretNode, i.caretRange.startOffset + i.stringAfter.length), i.suffixRange.setEnd(i.caretNode, i.caretRange.startOffset + i.stringAfter.length), i) : i) : !1
      }, c = {
        keydown: {
          27: "editor:abortMention",
          38: "editor:cycleUp",
          40: "editor:cycleDown",
          39: "editor:softConfirm",
          32: "editor:spaceConfirm",
          9: "editor:confirm",
          13: "editor:confirm"
        }
      };
      return l.prototype.onClientEvent = function (t) {
        n.trigger("richTextEditor:onClientEvent", t, this.editor);
        var e, i = ["keyup", "keydown", "keypress"];
        if (this.inMention && -1 !== i.indexOf(t.type)) {
          if (t = t || window.event, e = t.which || t.keyCode, "keydown" === t.type)e in c[t.type] ? (this.trigger(c[t.type][e], t), 39 !== e && 32 !== e && (t.preventDefault(), t.stopImmediatePropagation())) : 8 === e && this.maintainTypeaheadGhost(t); else if ("keyup" === t.type) {
            if (e in c.keydown)return !1
          } else this.maintainTypeaheadGhost(t, String.fromCharCode(e));
          var s = h();
          s && (this.lastInfo = s)
        }
      }, l.prototype.onSelection = s.debounce(function (t) {
        var e = h(t);
        e ? (this.escapeMention && (this.escapeMention.string === e.string ? e.isMention = !1 : this.escapeMention = !1), this.lastInfo = e, this.lastSelection = t) : this.escapeMention = !1;
        var i = e && this.isMentionLink(e.range);
        e && e.isMention === !0 && !i ? this.inMention && this.isSameMention(e) ? this.updateMention(e) : this.enterMention(e) : this.inMention ? this.exitMention(e) : e && i && this.linkToMention(e)
      }, e.rangeDebounce), l
    }();
    e.exports = l
  }, {backbone: "5kFNoY", jquery: "HlZQrA", ligature: 652, lodash: "MicNly", "prima/events": 546}],
  261: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/class"), a = n.extend({
      fetchOpenGraphData: function (t) {
        var e = o.ajax({url: "/svc/post/fetch_og", type: "POST", with_form_key: !0, data: {url: t}});
        return this.xhr = e, e.then(function (t) {
          var e = o.parseJSON(t) || {};
          return e.response
        }).always(s.bind(function () {
          this.xhr = null
        }, this))
      }, abort: function () {
        this.xhr && this.xhr.abort()
      }
    });
    e.exports = a
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/class": 543}],
  262: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = function () {
      var t = function (t) {
        if (!s.trim(t.html || ""))return s.isFunction(t.done) && t.done(""), void(s.isFunction(t.always) && t.always(""));
        var e = o.ajax({
          url: "/svc/filter_html_for_dash_preview",
          type: "POST",
          with_form_key: !0,
          data: {html: t.html || "", markdown: t.isMarkdown ? 1 : 0}
        });
        return s.isFunction(t.done) && e.done(t.done), s.isFunction(t.fail) && e.fail(t.fail), s.isFunction(t.always) && e.always(t.always), e
      };
      return {
        filterForDash: function (e, i, s, o, n) {
          return t({html: e, isMarkdown: i, done: s, fail: o, always: n})
        }, filterHtmlForDash: function (e, i, s, o) {
          return t({html: e, isMarkdown: !1, done: i, fail: s, always: o})
        }, filterMarkdownForDash: function (e, i, s, o) {
          return t({html: e, isMarkdown: !0, done: i, fail: s, always: o})
        }
      }
    };
    e.exports = n
  }, {jquery: "HlZQrA", lodash: "MicNly"}],
  263: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="album-art--container"><div data-js-albumart class="album-art" style="' + (null == (__t = url ? "background-image:url(" + url + ");" : "") ? "" : _.escape(__t)) + '"></div><div data-js-removebutton class="album-art--remove-button"><div class="v-center-outer"><div class="v-center-inner"><span data-js-removebuttontext>' + (null == (__t = __("Remove image")) ? "" : _.escape(__t)) + '</span></div></div></div></div><div data-js-dropzone class="media-dropzone"><div data-js-mediaupload class="media-upload-button"><div class="v-center-outer"><div class="v-center-inner"><div class="dropzone-title"><span data-js-mediauploadtext class="dropzone-text">' + (null == (__t = dropzoneText) ? "" : _.escape(__t)) + '</span></div></div></div><div class="media-upload"><div data-subview="upload"></div></div></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  264: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<label class="binary_switch"><input type="checkbox" id="allowAnswers" type="checkbox" data-js-allowanswerscheckbox> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label class="allow-answers-label" for="allowAnswers">' + (null == (__t = __("Let people answer this")) ? "" : _.escape(__t)) + "</label>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  265: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="note_wrapper" data-name="askField"><div class="note_item"><div class="text"><p class="asker"><span class="name">' + (null == (__t = post.asking_tumblelog.name.toLowerCase()) ? "" : _.escape(__t)) + "</span> <span>" + (null == (__t = __("asked")) ? "" : _.escape(__t)) + ':</span></p><p class="note_text">' + (null == (__t = post.ask) ? "" : __t) + '</p></div><div class="nipple"></div></div><div class="avatar"><img src="' + (null == (__t = post.asking_tumblelog.avatar) ? "" : _.escape(__t)) + '" alt="" width="40" height="40"></div></div>', showAnswerField && (__p += '<div class="note_wrapper" data-name="answerField"><div class="note_item"><div class="text"><p class="answerer"><span class="name">' + (null == (__t = post.answering_tumblelog.name.toLowerCase()) ? "" : _.escape(__t)) + "</span> <span>" + (null == (__t = __("answered")) ? "" : _.escape(__t)) + ":</span></p>" + (null == (__t = post.answer) ? "" : __t) + '</div><div class="nipple"></div></div><div class="avatar"><img src="' + (null == (__t = post.answering_tumblelog.avatar) ? "" : _.escape(__t)) + '" alt="" width="40" height="40"></div></div>'), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  266: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="media-dropzone" data-js-dropzone><div class="media-upload-button" data-js-mediaupload><div class="v-center-outer"><div class="v-center-inner"><div class="dropzone-icon ' + (null == (__t = uploadIcon) ? "" : _.escape(__t)) + '"></div></div></div><div class="media-upload"><div data-subview="upload"></div></div></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  267: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="channel-avatar avatar-container"><a class="avatar-link" href="' + (null == (__t = channel.url) ? "" : _.escape(__t)) + '" target="_blank" title="' + (null == (__t = channel.directory_safe_title) ? "" : __t) + '" style="background-image: url(\'' + (null == (__t = avatarUrl) ? "" : _.escape(__t)) + '\')"><img class="avatar-image" src="' + (null == (__t = avatarUrl) ? "" : _.escape(__t)) + '" alt="' + (null == (__t = channel.name) ? "" : _.escape(__t)) + '"></a></div><div class="primary-avatar avatar-container"><a class="avatar-link" href="' + (null == (__t = primary.url) ? "" : _.escape(__t)) + '" target="_blank" title="' + (null == (__t = primary.directory_safe_title) ? "" : __t) + '" style="background-image: url(\'' + (null == (__t = subavatarUrl) ? "" : _.escape(__t)) + '\')"><img class="avatar-image" src="' + (null == (__t = subavatarUrl) ? "" : _.escape(__t)) + '" alt="' + (null == (__t = primary.name) ? "" : _.escape(__t)) + '"></a></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  268: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<label class="confirm-tos--label" data-name="confirm-tos"><div class="binary_switch"><input class="confirm-tos--checkbox" type="checkbox" name="confirm_tos" data-js-confirmtos> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></div><span class="confirm-tos--text">' + (null == (__t = __("This is my original work, or I %1$shave permission%2$s to post this.", '<a href="/terms-of-service" target="_blank">', "</a>")) ? "" : __t) + "</span></label>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  269: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="html-mode"><div class="tabs clearfix"><div class="tab src-button" data-js-srcbutton><span class="icon ' + (null == (__t = isMarkdown ? "markdown" : "html") ? "" : _.escape(__t)) + '" data-js-srcicon></span> <span class="tab-label" data-js-srclabel>' + (null == (__t = srcLabel) ? "" : _.escape(__t)) + '</span></div><div class="tab preview-button" data-js-previewbutton><span class="icon"></span> <span class="tab-label" data-js-previewlabel>' + (null == (__t = previewLabel) ? "" : _.escape(__t)) + '</span></div><div class="tab tooltip-container"><span class="icon" data-js-editorhelp></span></div></div><div class="views"><div class="view src-view" data-js-srcview><div data-js-ace></div></div><div class="view preview-view" data-js-previewview><div class="html-preview editor" data-js-htmlpreview></div></div></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  270: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", _.forEach(id3Fields, function (t, e) {
          __p += '<div class="id3-editor--container ' + (null == (__t = id3FieldLabel[e] ? "id3-editor--" + id3FieldLabel[e].toLowerCase() : "") ? "" : _.escape(__t)) + '"><input name="' + (null == (__t = e) ? "" : _.escape(__t)) + '" value="' + (null == (__t = t) ? "" : _.escape(__t)) + '" class="id3-editor--input" type="text"><label class="id3-editor--label">' + (null == (__t = id3FieldLabel[e] || __(_.capitalize(e))) ? "" : _.escape(__t)) + "</label></div>"
        }), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  271: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<p class="tmblr-attribution"><a href="' + (null == (__t = attributionUrl) ? "" : _.escape(__t)) + '" target="_blank">' + (null == (__t = __("Originally posted by %1$s", attributionName)) ? "" : _.escape(__t)) + "</a></p>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  272: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="inline-embed-field" data-name="inlineEmbedField"><div data-subview="inlineEmbedInput"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  273: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", "spotify" === service && (__p += '<iframe data-js-audioembed src="https://embed.spotify.com/?uri=' + (null == (__t = encodeURIComponent(url)) ? "" : _.escape(__t)) + '&amp;view=coverart" width="500" height="580" frameborder="0" allowtransparency="true" scrolling="no" class="audio-embed--spotify"></iframe>'), __p += "", "soundcloud" === service && (__p += '<iframe data-js-audioembed src="https://w.soundcloud.com/player/?url=' + (null == (__t = encodeURIComponent(url)) ? "" : _.escape(__t)) + '&amp;visual=true&amp;liking=false&amp;sharing=false&amp;auto_play=false&amp;show_comments=false&amp;continuous_play=false&amp;origin=tumblr" frameborder="0" allowtransparency="true" scrolling="no" width="500" height="500" class="audio-embed--soundcloud"></iframe>'), __p += "", "bandcamp" === service && (__p += '<iframe data-js-audioembed src="https://bandcamp.com/EmbeddedPlayer/size=medium/bgcol=ffffff/linkcol=0687f5/notracklist=true/transparent=true/' + (null == (__t = type) ? "" : _.escape(__t)) + "=" + (null == (__t = id) ? "" : _.escape(__t)) + '/" frameborder="0" allowtransparency="true" scrolling="no" width="500" height="120" class="audio-embed--bandcamp"></iframe>'), __p += "", "direct" === service && (__p += '<div data-js-audioembed class="audio-embed--direct ' + (null == (__t = canEditMedia ? "audio-embed--direct-editable" : "") ? "" : _.escape(__t)) + '"><div data-subview="audioPlayer"></div><div data-subview="id3Editor"></div><div data-subview="albumArtUploader"></div></div>'), __p += "", canEditMedia && (__p += '<div data-subview="removeButton"></div>'), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  274: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-js-sortable class="photoset--photo-dragger"></div><div data-js-mediaoverlay class="media-overlay"><div data-js-clickthroughurlbutton class="overlay-button ' + (null == (__t = hasClickthroughUrl ? "active" : "") ? "" : _.escape(__t)) + '"><div class="icon icon_editor_link"></div></div><div data-js-captionbutton class="overlay-button ' + (null == (__t = hasCaption ? "active" : "") ? "" : _.escape(__t)) + '"><div class="icon icon_editor_more"></div></div></div><div data-subview="removeButton"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  275: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="photobooth-container" data-js-photobooth></div><div class="photoset-container" data-js-photoset></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  276: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="video-container" data-js-video></div>', canEditMedia && (__p += '<div data-subview="removeButton"></div>'), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  277: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", "inline" === embedRenderContext ? __p += '<div class="video-preview">' + (null == (__t = previewIframe) ? "" : __t) + "</div>" : (__p += '<div class="video-preview video_preview ' + (null == (__t = thumbnail && thumbnail.url ? "has_thumbnail" : "no_thumbnail") ? "" : _.escape(__t)) + '">', thumbnail && thumbnail.url && (__p += '<img src="' + (null == (__t = thumbnail.url) ? "" : _.escape(__t)) + '" alt="" width="' + (null == (__t = thumbnail.width || "") ? "" : _.escape(__t)) + '" height="' + (null == (__t = thumbnail.height || "") ? "" : _.escape(__t)) + '">'), __p += '<div class="video_info_wrapper"><i class="icon_post_video"></i><div class="video_text"><span class="clippable">' + (null == (__t = __("Watch on %s", tumblelogHostname)) ? "" : _.escape(__t)) + '</span> <i class="icon_arrow_carrot_right"></i></div></div></div>'), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  278: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="video-error"><div class="v-center-outer"><div class="v-center-inner"><span class="icon"></span> <span class="error-message">' + (null == (__t = __("This video embed stopped working. Try another?")) ? "" : _.escape(__t)) + "</span></div></div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  279: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="media-preview"><div class="v-center-outer"><div class="v-center-inner"><div class="icon ' + (null == (__t = icon) ? "" : _.escape(__t)) + '" data-js-previewicon></div><p class="media-preview-text" data-js-previewmessage>' + (null == (__t = message) ? "" : _.escape(__t)) + "</p></div></div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  280: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {}) {
          __p += "";
          var dropzoneClasses = [];
          showInput && dropzoneClasses.push("show-input"), splitDropzone && dropzoneClasses.push("split-dropzone"), toggleDropzone && dropzoneClasses.push("toggle-dropzone"), defaultBehavior && dropzoneClasses.push("toggle-dropzone-" + defaultBehavior), __p += '<div class="media-dropzone ' + (null == (__t = dropzoneClasses.join(" ")) ? "" : _.escape(__t)) + '" data-js-dropzone><div class="split-cells">', enableUpload && (__p += '<div class="split-cell media-upload-button" data-js-mediaupload><div class="split-cell-inner"><div class="v-center-outer"><div class="v-center-inner">', uploadIcon && (__p += '<div class="dropzone-icon ' + (null == (__t = uploadIcon) ? "" : _.escape(__t)) + '"></div>'), __p += "", uploadText && (__p += '<div class="dropzone-title"><span class="dropzone-text" data-js-mediauploadtext>' + (null == (__t = toggleDropzone ? dropzoneText : uploadText) ? "" : _.escape(__t)) + "</span>", uploadTooltip && (__p += '<div class="dropzone-tooltip" data-js-uploadtooltip><span class="icon icon_help" data-show-tooltip="uploadTooltip"></span></div>'), __p += "</div>"), __p += '</div></div></div><div class="media-upload"><div data-subview="upload"></div></div></div>'), __p += "", enableUrl && (__p += '<div class="split-cell media-url-button" data-js-mediaurl><div class="split-cell-inner"><div class="v-center-outer"><div class="v-center-inner">', urlIcon && (__p += '<div class="dropzone-icon ' + (null == (__t = urlIcon) ? "" : _.escape(__t)) + '"></div>'), __p += "", urlText && (__p += '<div class="dropzone-title"><span class="dropzone-text" data-js-mediaurltext>' + (null == (__t = toggleDropzone ? dropzoneText : urlText) ? "" : _.escape(__t)) + "</span>", urlTooltip && (__p += '<div class="dropzone-tooltip" data-js-urltooltip><span class="icon icon_help" data-show-tooltip="urlTooltip"></span></div>'), __p += "</div>"), __p += '</div></div></div><div class="media-url-cropper media-dropzone-cropper"><div class="media-url"><div class="v-center-outer"><div class="v-center-inner"><div data-subview="urlInput"></div></div></div></div></div><div data-subview="removeButton"></div></div>'), __p += "</div></div>"
        }
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  281: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="pop-menu"><div class="inner">', _.each(blogs, function (t, e) {
          __p += "";
          var i = t.name.replace(queryRegex, "<u>$&</u>");
          __p += '<div id="mention_' + (null == (__t = e) ? "" : _.escape(__t)) + '" class="item-option" data-tumblelog="' + (null == (__t = t.name) ? "" : _.escape(__t)) + '"><div class="blog-info"><span class="blog-name">' + (null == (__t = i) ? "" : __t) + '</span> <span class="blog-title">' + (null == (__t = t.title) ? "" : _.escape(__t)) + '</span></div><span class="blog-thumb" style="background-image:url(\'' + (null == (__t = t.avatar_url) ? "" : _.escape(__t)) + "')\"></span></div>"
        }), __p += "</div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  282: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="overlay-button-popover" data-js-popover><input data-js-input type="text" value="' + (null == (__t = value) ? "" : _.escape(__t)) + '" placeholder="' + (null == (__t = placeholder) ? "" : _.escape(__t)) + '" aria-label="' + (null == (__t = ariaLabel) ? "" : _.escape(__t)) + '" maxlength="' + (null == (__t = maxLength) ? "" : _.escape(__t)) + '" class="input-field"><div data-js-confirm class="input-confirm">' + (null == (__t = confirmText) ? "" : _.escape(__t)) + "</div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  283: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="editor editor-plaintext" aria-label="' + (null == (__t = ariaLabel) ? "" : _.escape(__t)) + '" contenteditable="true" data-js-plaintexteditor></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  284: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="post-margin" data-js-margin><div data-subview="avatar"></div></div><div class="post-container" data-js-container-outer><div class="post-container-inner post" data-js-container-inner><div class="post-form--header post-header clearfix" data-js-header><div class="controls-container"><div class="control left"><div data-subview="tumblelogSelect"></div></div><div class="control right"><div data-subview="uploadingIndicator"></div><div data-subview="postSettings"></div></div></div></div><div class="post-form--form post-content"><div data-subview="postTypeForm"></div></div><div class="post-form--footer post-footer" data-js-footer><div data-subview="tagEditor"></div><div data-subview="editorButtons"></div></div><div class="post-form--guard"></div><div class="post-form--bottom" data-js-bottom><div class="post-form--controls" data-js-postformcontrols><div class="controls-container"><div class="control left"><button class="flat-button post-form--close" data-js-clickableclose="">' + (null == (__t = closeLabel) ? "" : _.escape(__t)) + '</button></div><div class="control right"><div data-subview="socialButtons"></div></div><div class="control right"><div data-subview="savePostButton"></div></div></div></div><div data-subview="errorBar"></div></div><div data-subview="allowAnswers"></div><div data-subview="richTextEditorTutorial"></div></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  285: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<form method="POST" target="_blank" action="' + (null == (__t = action) ? "" : _.escape(__t)) + '">', _.each(inputs, function (t, e) {
          __p += '<input type="hidden" name="' + (null == (__t = e) ? "" : _.escape(__t)) + '" value="' + (null == (__t = t) ? "" : _.escape(__t)) + '">'
        }), __p += "</form>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  286: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<button class="post-settings" data-js-clickablepostsettingscog><span class="dropdown icon_settings" data-js-postsettingscog></span></button>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  287: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="pop-menu"><div class="inner"><div class="form-horizontal"><div class="form-group"><div class="group-label"><label for="customUrl_input">' + (null == (__t = __("Custom URL")) ? "" : _.escape(__t)) + '</label></div><div class="group-content"><div class="adjacent-content"><label for="customUrl_input" class="prefix" data-js-customurllabel>/post/123/</label><input name="customUrl" id="customUrl_input" class="field crystal" type="text" autocomplete="off" data-js-customurl value="' + (null == (__t = customUrl) ? "" : _.escape(__t)) + '"></div></div></div><div class="form-group"><div class="group-label"><label for="sourceUrl_input">' + (null == (__t = __("Content source")) ? "" : _.escape(__t)) + '</label></div><div class="group-content"><input id="sourceUrl_input" name="sourceUrl" class="field crystal" type="text" placeholder="http://..." autocomplete="off" data-js-sourceurl value="' + (null == (__t = sourceUrl) ? "" : _.escape(__t)) + '"></div></div><div class="form-group"><div class="group-label"><label for="postDate_input">' + (null == (__t = __("Post date")) ? "" : _.escape(__t)) + '</label></div><div class="group-content"><input id="postDate_input" name="postDate" class="field crystal" type="text" placeholder="' + (null == (__t = __("Now")) ? "" : _.escape(__t)) + '" autocomplete="off" data-js-postdate value="' + (null == (__t = postDate) ? "" : _.escape(__t)) + '"></div></div>', showPhotoRepliesOption && (__p += '<div class="form-group"><div class="group-label">' + (null == (__t = __("Replies")) ? "" : _.escape(__t)) + '</div><div class="group-content"><div class="checkbox field row"><label class="binary_switch"><input name="allow_photo_replies" type="checkbox" id="allowPhotoReplies" type="checkbox" data-js-allowphotoreplies> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label><label for="allowPhotoReplies">' + (null == (__t = __("Let people photo reply")) ? "" : _.escape(__t)) + "</label></div></div></div>"), __p += "", showEditorSelection && (__p += '<div class="form-group"><div class="group-label">' + (null == (__t = __("Text editor")) ? "" : _.escape(__t)) + '</div><div class="group-content"><div class="flat_select field row"><select name="editorType" id="editorType" data-js-editortype><option value="rich">' + (null == (__t = __("Rich text")) ? "" : _.escape(__t)) + '</option><option value="html">' + (null == (__t = __("HTML")) ? "" : _.escape(__t)) + '</option><option value="markdown">' + (null == (__t = __("Markdown")) ? "" : _.escape(__t)) + '</option></select><label for="editorType" class="current_selection">' + (null == (__t = __("Rich text")) ? "" : _.escape(__t)) + '</label><i class="icon"></i></div></div></div>'), __p += "</div></div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  288: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="clear-results icon_close ' + (null == (__t = 0 === resultCount ? "inactive" : "") ? "" : _.escape(__t)) + '"></div><div class="copyright-warning ' + (null == (__t = showCopyrightWarning === !1 ? "inactive" : "") ? "" : _.escape(__t)) + '">' + (null == (__t = copyrightWarningMessage) ? "" : __t) + "</div>", _.each(serviceResults, function (t, e) {
          __p += '<div class="audio-result-set" data-service="' + (null == (__t = e) ? "" : __t) + '">', _.each(t, function (t) {
            __p += '<div class="result ' + (null == (__t = "youtube" === e ? "video-result" : "audio-result") ? "" : _.escape(__t)) + '" data-href="' + (null == (__t = t.href) ? "" : __t) + '"><span class="primary">' + (null == (__t = t.primary) ? "" : __t) + '</span><span class="secondary">' + (null == (__t = t.secondary) ? "" : __t) + '</span> <span class="info">' + (null == (__t = t.info) ? "" : __t) + "</span></div>"
          }), __p += "</div>"
        }), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  289: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="media-wrapper" data-js-media><div data-subview="mediaPreview"></div><div data-js-mediacomposer class="audio-search-container"><div data-subview="searchField"></div><div data-subview="audioUploader"></div><div data-subview="searchResultList"></div></div></div><div class="caption-wrapper" data-js-tos><div data-subview="confirmTos"></div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  290: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="title"></div><div data-subview="chat"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  291: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="media-wrapper"><div class="media-container link-media-container"><div class="link-editor"><div data-subview="url"></div><section class="link-media-body" data-js-media><div class="thumbnail" data-js-image data-js-removable="false"></div><article data-js-article data-js-removable="true"><div class="publisher-container"><a href="#" data-js-publisher target="_blank" rel="bookmark" class="publisher"></a></div><div data-subview="title"></div><div data-subview="excerpt"></div><div data-js-author class="author"></div></article></section></div>', canEditMedia && (__p += '<div data-subview="removeButton"></div>'), __p += '</div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  292: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="askField"></div><div data-subview="answerField"></div><div data-subview="reblogTree"></div><div data-subview="caption"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  293: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="media-wrapper" data-js-media><div data-subview="mediaPreview"></div><div data-subview="mediaComposer"></div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  294: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="quote"></div><div data-subview="source"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  295: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="title"></div><div data-subview="reblogTree"></div><div data-subview="body"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  296: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="media-wrapper" data-js-media><div data-subview="mediaPreview"></div><div data-subview="mediaComposer"></div></div><div class="caption-wrapper" data-js-tos><div data-subview="confirmTos"></div></div><div class="caption-wrapper" data-js-caption><div data-subview="reblogTree"></div><div data-subview="caption"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  297: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", showReblogTree && (__p += '<div class="control-reblog-tree post"><div class="reblog-tree post_content">' + (null == (__t = post.get("reblog_tree")) ? "" : __t) + '</div><div data-subview="removeButton"></div><div class="btn-show-tree btn-toggle-reblog">' + (null == (__t = __("Put reblogs back")) ? "" : _.escape(__t)) + "</div></div>"), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  298: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="editor editor-richtext" aria-label="' + (null == (__t = ariaLabel) ? "" : _.escape(__t)) + '" contenteditable="true" data-js-richtexteditor></div><div data-subview="htmlField"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  299: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<h3 class="title">' + (null == (__t = __("Want to style your text?")) ? "" : _.escape(__t)) + '</h3><p class="content">' + (null == (__t = __("Just select it. You'll see.")) ? "" : _.escape(__t)) + '</p><button class="blue ok_button flat-button" type="button">' + (null == (__t = __("I see")) ? "" : _.escape(__t)) + "</button>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  300: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="split chrome blue"><div data-subview="loader"></div><button class="flat-button blue caption create_post_button" data-js-clickablesave></button><div class="flat-button blue dropdown options icon_arrow_carrot_down" data-js-clickablesavedropdown></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  301: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="pop-menu"><ul class="inner select-left" data-js-options><li class="item-option ' + (null == (__t = "published" === state ? "icon_checkmark" : "") ? "" : __t) + '" data-js-publish><span class="">' + (null == (__t = __("Post now")) ? "" : _.escape(__t)) + '</span></li><li class="item-option ' + (null == (__t = "queued" === state ? "icon_checkmark" : "") ? "" : __t) + " " + (null == (__t = -1 === activeOptions.indexOf("queued") ? "hidden" : "") ? "" : __t) + '" data-js-queue><span class="">' + (null == (__t = __("Add to queue")) ? "" : _.escape(__t)) + '</span></li><li class="item-option ' + (null == (__t = "draft" === state ? "icon_checkmark" : "") ? "" : __t) + " " + (null == (__t = -1 === activeOptions.indexOf("draft") ? "hidden" : "") ? "" : __t) + '" data-js-draft><span class="">' + (null == (__t = __("Save as draft")) ? "" : _.escape(__t)) + '</span></li><li class="item-option ' + (null == (__t = "private" === state ? "icon_checkmark" : "") ? "" : __t) + '" data-js-private><span class="">' + (null == (__t = __("Post privately")) ? "" : _.escape(__t)) + '</span></li><li class="item-option ' + (null == (__t = "scheduled" === state ? "icon_checkmark" : "") ? "" : __t) + " " + (null == (__t = -1 === activeOptions.indexOf("scheduled") ? "hidden" : "") ? "" : __t) + '" data-js-schedule><span class="">' + (null == (__t = __("Schedule")) ? "" : _.escape(__t)) + '</span><br><input class="field square solid" type="text" autocomplete="off" placeholder="Next Tuesday, 10am" data-js-scheduletext></li>', showPreview && (__p += '<li class="item-option full" data-js-preview><button class="button flat-button">' + (null == (__t = __("Preview on blog")) ? "" : _.escape(__t)) + "</button></li>"), __p += "</ul></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  302: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<ul class="social-buttons"><li data-js-twitter data-service="twitter" data-js-tweetdropdownpin class="social-button twitter ' + (null == (__t = twitter ? "" : "hidden") ? "" : _.escape(__t)) + " " + (null == (__t = twitterOn ? "checked" : "") ? "" : _.escape(__t)) + '"><label class="social-button--label social-button--twitter" data-js-shareicon data-js-twittericon></label></li><li data-js-facebook data-service="facebook" class="social-button facebook ' + (null == (__t = facebook ? "" : "hidden") ? "" : _.escape(__t)) + " " + (null == (__t = facebookOn ? "checked" : "") ? "" : _.escape(__t)) + '"><label class="social-button--label social-button--facebook" data-js-shareicon data-js-facebookicon></label></li></ul>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  303: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="tag-input-wrapper" data-js-taginputfieldwrapper><div data-subview="tagInputField"></div><div class="ghost" data-js-taginputghost></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  304: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="pop-menu"><div class="inner select-center"><div class="item-option-wrapper" data-js-tagsuggestwrapper>', _.each(results.userTags, function (t) {
          __p += "";
          var e = _.escape(t).replace(queryRegex, "<u>$&</u>");
          __p += '<div class="item-option user-tags" data-tag="' + (null == (__t = _.escape(t)) ? "" : __t) + '"><span class="tag-suggest-tag">' + (null == (__t = e) ? "" : __t) + "</span></div>"
        }), __p += '<div class="header-item">' + (null == (__t = __("Popular")) ? "" : _.escape(__t)) + "</div>", _.each(results.suggestions, function (t) {
          __p += "";
          var e = _.escape(t).replace(queryRegex, "<u>$&</u>");
          __p += '<div class="item-option suggest-tags" data-tag="' + (null == (__t = _.escape(t)) ? "" : __t) + '"><span class="tag-suggest-tag">' + (null == (__t = e) ? "" : __t) + "</span></div>"
        }), __p += "</div></div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  305: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="thumbnail-preview" style="background-image: url(' + (null == (__t = imageUrl) ? "" : _.escape(__t)) + "); width: " + (null == (__t = width) ? "" : _.escape(__t)) + "; height: " + (null == (__t = height) ? "" : _.escape(__t)) + '"><i class="icon_play"></i><div class="thumbnail-preview-message">' + (null == (__t = message) ? "" : _.escape(__t)) + '</div><span class="Knight-Rider-loader"><span class="Knight-Rider-bar"></span> <span class="Knight-Rider-bar"></span> <span class="Knight-Rider-bar"></span></span></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  306: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="tooltip-inner">', __p += sanitize ? "" + (null == (__t = text) ? "" : _.escape(__t)) : "" + (null == (__t = text) ? "" : __t), __p += "</div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  307: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<button class="tumblelog-select ' + (null == (__t = "edit" === post.get("mode") ? "inactive" : "") ? "" : _.escape(__t)) + '" data-js-clickabletumbleloglabel><span class="caption" data-js-tumbleloglabel></span>', "edit" !== post.get("mode") && (__p += ' <span class="dropdown icon_arrow_carrot_down" data-js-tumblelogselectpin></span>'), __p += "", "reblog" === post.get("mode") && (__p += ' <span class="reblog_source"><i class="icon icon_reblog"></i> <span class="reblog_name">' + (null == (__t = post.get("reblog_name")) ? "" : _.escape(__t)) + "</span></span>"), __p += "</button>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  308: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="pop-menu"><ul class="inner select-right">', _.forEach(channels, function (t) {
          __p += '<li class="item-option ' + (null == (__t = t.name === tumblelog ? "select" : "") ? "" : _.escape(__t)) + '" data-js-tumblelogchoice><img class="ts-avatar" src="' + (null == (__t = t.avatarUrl) ? "" : _.escape(__t)) + '" alt="' + (null == (__t = t.name) ? "" : _.escape(__t)) + '"><div class="ts-info"><p class="ts-name">' + (null == (__t = t.displayName) ? "" : _.escape(__t)) + '</p><p class="ts-title">' + (null == (__t = t.directory_safe_title) ? "" : __t) + "</p></div></li>"
        }), __p += "</ul></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  309: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-js-tweetpopover><div class="tweet-container"><textarea aria-label="' + (null == (__t = __("Custom tweet")) ? "" : _.escape(__t)) + '" data-js-customtweet class="tweet-textarea">' + (null == (__t = tweetText) ? "" : _.escape(__t)) + '</textarea><div data-js-tweetremaining class="tweet-remaining">' + (null == (__t = tweetRemaining) ? "" : _.escape(__t)) + '</div></div><button data-js-dismisstweet type="button" class="chrome small dismiss">' + (null == (__t = __("Done")) ? "" : _.escape(__t)) + "</button></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  310: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="loader"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  311: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-js-webcambutton class="webcam-button"><span data-js-smiley class="icon icon_postforms_selfie"></span> <span data-js-text class="dropzone-text">' + (null == (__t = __("Take a selfie")) ? "" : _.escape(__t)) + "</span></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  312: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = function (t, e) {
      return e || (e = this), function () {
        var i = s.toArray(arguments);
        return s.map(t, function (t) {
          return t.apply(e, i)
        }, e)
      }
    };
    e.exports = o
  }, {lodash: "MicNly"}],
  313: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = function (t) {
      if (s.isString(t)) {
        if (t = t.toLowerCase(), "true" === t || "1" === t || "on" === t)return !0;
        if ("false" === t || "" === t || "off" === t)return !1;
        if (t = s.parseInt(t), s.isNaN(t))return !0
      }
      return !!t
    };
    e.exports = o
  }, {lodash: "MicNly"}],
  314: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      return "function" == typeof e ? e(t) : t.find(e)
    }

    function o(t, e) {
      return "function" == typeof e ? e(t) : t.attr(e)
    }

    function n(t, e) {
      var i = s(t, e);
      return !l.isNumber(i) && l.has(i, "length") ? i.length : i
    }

    function a(t, e) {
      var i = s(t, e.selector);
      return l.countBy(i, function (t) {
        return o(h(t), e.attribute)
      })
    }

    function r(t, e) {
      return l.isFunction(e) || l.isString(e) ? n(t, e) : l.has(e, "attribute") ? a(t, e) : null
    }

    var l = t("lodash"), h = t("jquery"), c = function (t) {
      this.lookups = t || {}
    };
    c.prototype.parse = function (t) {
      var e = {}, i = h(t), s = function (t, e) {
        l.each(t, function (t, o) {
          var n = r(i, t);
          null !== n ? e[o] = n : l.isObject(t) ? (e[o] = {}, s(t, e[o])) : e[o] = t
        })
      };
      return s(this.lookups, e), e
    }, e.exports = c
  }, {jquery: "HlZQrA", lodash: "MicNly"}],
  315: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("backbone"), a = t("prima/class"), r = 0, l = function (t) {
      t = null == t || s.isPlainObject(t) ? s.extend({target: "body", autostart: !1}, t) : {target: t, autostart: !1};
      var e = ".drag_eventor_" + r++, i = o(t.target), l = !1, h = 0, c = new a;
      s.extend(c, n.Events);
      var d = ["dragenter", "dragover", "dragleave", "dragend", "drop"], u = function (t) {
        c.trigger(t.type, t)
      };
      return c.start = function () {
        h++, l || (l = !0, s.forEach(d, function (t) {
          i.on(t + e, u)
        }))
      }, c.stop = function () {
        h--, 0 >= h && (l = !1, s.forEach(d, function (t) {
          i.off(t + e, u)
        }))
      }, t.autostart && c.start(), c
    };
    e.exports = l
  }, {backbone: "5kFNoY", jquery: "HlZQrA", lodash: "MicNly", "prima/class": 543}],
  316: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      var i = a.nodeFromString(t), s = n(i);
      return o.isFunction(e) && (e = o.rest(arguments)), o.each(e, function (t) {
        t(i, s)
      }), s.html()
    }

    var o = t("lodash"), n = t("jquery"), a = t("prima/utils/dom");
    e.exports = s
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/utils/dom": 600}],
  317: [function (t, e, i) {
    "use strict";
    function s(t) {
      var e, i = [];
      for (var s in t)e = t[s], i.push([new RegExp("(</?)(" + s + ")([>\\s])", "gi"), "$1" + e + "$3"]);
      return i
    }

    function o(t, e) {
      for (var i = 0; i < e.length; i++)t = t.replace.apply(t, e[i]);
      return t
    }

    function n(t, e) {
      for (var i, n = s(e || d), a = t.split(c), r = !1, u = "", p = 0; p < a.length; p++)i = a[p], u ? i === u && (u = "") : r && (">" === i ? r = !1 : i.match(h) && (u = i)), !u && i.match(l) && (">" !== i.slice(-1) && (r = !0), a[p] = o(i, n));
      return a.join("")
    }

    var a = "<\\/?\\w+[\\s>]", r = "['\"]", l = new RegExp(a, "g"), h = new RegExp(r, "g"), c = new RegExp("(" + a + "|" + r + "|>)", "g"), d = {
      strong: "b",
      em: "i"
    };
    e.exports = n
  }, {}],
  318: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = {camel: s.camelCase, snake: s.snakeCase, kebab: s.kebabCase}, n = function (t, e) {
      return s.isString(e) && (e = s.result(o, e)), s.isFunction(e) ? s.map(t, e) : t
    }, a = function (t, e, i) {
      return s.isString(e) && (e = n(i || s.keys(t), e)), s.transform(t, function (t, i, o) {
        t[s.result(e, o) || o] = i
      }, {})
    };
    e.exports = a
  }, {lodash: "MicNly"}],
  319: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = function (t, e, i) {
      var o = {};
      s.isPlainObject(t) && (i = e, s.extend(o, t), t = o.width, e = o.height);
      var n = Math.round(e / t * i);
      return o.width = i, o.height = n, o
    };
    e.exports = o
  }, {lodash: "MicNly"}],
  320: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = {
      normalizeSpace: function (t) {
        return t.trim().replace("", " ").replace(/\s\s+/, " ")
      }, stripScripts: function (t) {
        return t.replace(new RegExp("<script[^>]*>([\\S\\s]*?)</script\\s*>", "img"), "")
      }, stripTags: function (t) {
        return t.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi, "")
      }, truncateLongStrings: function (t, e, i) {
        return s.isString(t) || (t = ""), i || (i = ""), t.length <= e ? t : s.trunc(t, e - i.length, i)
      }, stripHtml: function (t, e, i) {
        if (!t)return "";
        "undefined" == typeof e && (e = !0);
        var o = t;
        "string" == typeof i && (o = s.trim(o.replace(/(<br\s*\/?>)/gi, "$1" + i).replace(/(<\/(?:p|figure|h[1-6])\s*>)/gi, "$1" + i)));
        try {
          var n = document.implementation.createHTMLDocument("");
          n.body.innerHTML = this.stripScripts(o), o = n.body.textContent || n.body.innerText || "", o = o.trim()
        } catch (a) {
          o = this.stripScripts(this.stripTags(o)).trim()
        }
        return e && (o = this.normalizeSpace(o)), o
      }
    };
    e.exports = o
  }, {lodash: "MicNly"}],
  321: [function (t, e, i) {
    "use strict";
    var s = {
      isUrl: function (t) {
        var e = "%[0-9a-fA-F]{2}", i = "(http|https):\\/\\/", s = '([a-zA-Z0-9$\\-_.+!*"(),;:&=]|' + e + ")+@", o = "(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])", n = "(" + o + "(\\." + o + "){3})", a = "a-zA-Z0-9\\-\\_\\~", r = "\\u00C0-\\u017F", l = "([" + a + r + "]+\\.)+([a-zA-Z]{2,})", h = "[0-9]+", c = "(" + n + "|localhost|" + l + ")(:" + h + ")?", d = "a-zA-Z0-9-._\\~:\\[\\]@!$&'()*+,;=", u = "([" + d + "]|" + e + ")*", p = u + "(\\/" + u + ")*", m = "\\?([" + d + "/?]|" + e + ")*", g = "\\#([" + d + "/?]|" + e + ")*", _ = new RegExp("^" + i + "(" + s + ")?" + c + "(\\/?(" + p + ")?(" + m + ")?(" + g + ")?)?$");
        return _.test(t) === !0
      }, isImageUrl: function (t) {
        var e = s.isUrl(t), i = /.+[.](jpg|jpeg|png|gif)([?]|$)/.test(t) === !0;
        return e && i
      }
    };
    e.exports = s
  }, {}],
  322: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("../templates/album_art_uploader.tpl"), a = t("./media_dropzone"), r = a.extend({
      className: "media-dropzone-container album-art-uploader",
      defaultOptions: s.defaults({
        enableUrl: !1,
        uploadOptions: {
          name: "album_art",
          maxUploadSize: 10485760,
          uploadPattern: /^image\/(?:.*)$/i,
          accept: "image/*",
          url: "/svc/post/upload_album_art"
        }
      }, a.prototype.defaultOptions),
      initialize: function (t) {
        return s.defaults(this.defaultOptions, {
          dropzoneText: o("Select album art"),
          uploadText: o("Select album art")
        }), a.prototype.initialize.apply(this, arguments)
      },
      template: n,
      events: s.extend({"click [data-js-removeButton]": "_onClickRemoveButton"}, a.prototype.events),
      _onClickRemoveButton: function () {
        this.set("url", "")
      },
      _onUploadUrlChange: function (t, e) {
        this.set("url", e)
      },
      _onUrlChange: function (t, e) {
        this.model.set({
          preuploadAlbumArt: !s.isEmpty(e),
          albumArt: e
        }), this.js$("albumArt").css("background-image", e ? "url(" + e + ")" : ""), this.$el.toggleClass("can-upload-album-art", s.isEmpty(e))
      },
      afterRender: function () {
        this.listenTo(this.upload, "change:url", this._onUploadUrlChange), this.listenTo(this, "change:url", this._onUrlChange), this.$el.toggleClass("can-upload-album-art", s.isEmpty(this.get("url"))), a.prototype.afterRender.apply(this, arguments)
      }
    });
    e.exports = r
  }, {
    "../templates/album_art_uploader.tpl": 263,
    "./media_dropzone": 341,
    lodash: "MicNly",
    "prima/lib/translate": 575
  }],
  323: [function (t, e, i) {
    "use strict";
    var s = t("prima/view"), o = t("lodash"), n = t("../utils/string_helpers"), a = t("prima/mixins/selectorcache"), r = t("../templates/allow_answers.tpl"), l = s.extend({
      mixins: [a],
      template: r,
      className: "post-form--allow-answers",
      events: {"click [data-js-allowAnswersCheckbox]": "updateModel"},
      initialize: function (t) {
        this.model = t.model
      },
      _onModelChange: function () {
        var t = !1;
        o.each(this.model.allowAnswerFields, function (e) {
          return this.endsWithQuestionMark(this.model.get(e)) ? (t = !0, !1) : void 0
        }, this), t ? this.$el.slideDown() : (this.js$("allowAnswersCheckbox").removeAttr("checked"), this.updateModel(), this.$el.slideUp())
      },
      endsWithQuestionMark: function (t) {
        return t = n.stripHtml(t, !1), -1 !== t.indexOf("?", t.length - 1)
      },
      updateModel: function () {
        this.model.set("allow_answers", this.js$("allowAnswersCheckbox").is(":checked"))
      },
      render: function () {
        return this.addStateListeners(), this.$el.html(this.template()), this
      },
      addStateListeners: function () {
        "new" === this.model.get("mode") && this.listenTo(this.model, "change", this._onModelChange)
      },
      teardown: function () {
        return this.stopListening(), this
      }
    });
    e.exports = l
  }, {
    "../templates/allow_answers.tpl": 264,
    "../utils/string_helpers": 320,
    lodash: "MicNly",
    "prima/mixins/selectorcache": 586,
    "prima/view": 612
  }],
  324: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("prima/mixins/subviewable"), r = t("../templates/ask_field.tpl"), l = o.extend({
      template: r,
      mixins: [n, a],
      serialize: function () {
        return s.extend({post: this.model.toJSON(), showAnswerField: this.model.isReblog()}, this.toJSON())
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this
      }
    });
    e.exports = l
  }, {
    "../templates/ask_field.tpl": 265,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  325: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("../templates/audio_uploader.tpl"), a = t("./media_dropzone"), r = a.extend({
      className: "audio-direct-upload-button",
      defaultOptions: s.defaults({
        enableUrl: !1,
        dropzoneText: "",
        uploadIcon: "dropzone-add-audio-icon",
        uploadText: "",
        uploadOptions: {
          name: "audio",
          mediaType: "audio",
          maxUploadSize: 10485760,
          uploadPattern: o.browser.mozilla ? /^audio\/(?:.*)$/i : /^(?:audio\/mp3|audio\/mpeg)$/i,
          accept: "audio/mp3",
          url: "/svc/post/upload_audio"
        }
      }, a.prototype.defaultOptions),
      template: n
    });
    e.exports = r
  }, {"../templates/audio_uploader.tpl": 266, "./media_dropzone": 341, jquery: "HlZQrA", lodash: "MicNly"}],
  326: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("when"), n = t("velocity-animate").animate, a = t("prima/utils/sequence-with-context"), r = t("app/components/post-form-builder/utils/transition_speed"), l = t("prima/view"), h = t("app/lib/avatar-size"), c = t("prima/mixins/subviewable"), d = t("prima/mixins/selectorcache"), u = t("prima/mixins/accessor"), p = t("app/lib/currentuser"), m = t("../templates/avatar.tpl"), g = l.extend({
      className: "post-form--avatar",
      mixins: [c, d, u],
      template: m,
      defaultOptions: {size: 128, determineViewState: !0},
      defaults: {flipQueued: !1, showSubavatar: !1, avatarUrl: ""},
      initialize: function (t) {
        if (this.options = t = s.extend({}, this.defaultOptions, t), this.user = t.user || p(), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), t.post && (this.post = t.post, this.tumblelog = t.tumblelog || this.user.getChannel(this.post.get("tumblelog")), this.listenTo(this.post, "change:tumblelog", this._onChangePostTumblelog)), !this.tumblelog)throw new Error("AvatarView requires a Tumblelog model!");
        this.options.determineViewState ? this.updateViewState() : this.get("avatarUrl") || this.set("avatarUrl", this.tumblelog.get("avatar_url")), this.listenTo(this, "change:showSubavatar", this._onChangeShowSubavatar), this.listenTo(this, "change:avatarUrl", this._onChangeAvatarUrl)
      },
      _onChangeShowSubavatar: function (t, e) {
        e ? this.showSubavatar() : this.hideSubavatar()
      },
      _onChangeAvatarUrl: function (t, e) {
        return this.queueFlipAvatar()
      },
      updateViewState: function () {
        this.set({showSubavatar: this.tumblelog.get("show_author_avatar"), avatarUrl: this.tumblelog.get("avatar_url")})
      },
      _onChangePostTumblelog: function (t, e) {
        this.tumblelog = this.user.getChannel(e), this.updateViewState()
      },
      showSubavatar: function (t, e) {
        return null != t || (t = r(150)), null != e || (e = r(300)), n(this.$$(".primary-avatar"), {scale: 1}, {
          display: "block",
          duration: t,
          delay: e,
          easing: [.25, 1.5, .75, 1]
        })
      },
      hideSubavatar: function (t, e) {
        return null != t || (t = r(100)), null != e || (e = 0), n(this.$$(".primary-avatar"), {scale: 0}, {
          display: "none",
          duration: t,
          delay: e,
          easing: [0, 0, .6, 1]
        })
      },
      queueFlipAvatar: function (t, e) {
        if (this._avatarFlipping)return void this.set("flipQueued", !0);
        var i = this.flipAvatar();
        i.then(s.bind(function () {
          this.get("flipQueued") && (this.set("flipQueued", !1), this.flipAvatar())
        }, this))
      },
      flipAvatar: function (t, e) {
        null != t || (t = r(300)), null != e || (e = r(50));
        var i = h(this.get("avatarUrl"), this.options.size), s = this.tumblelog.get("name"), l = this.$$(".channel-avatar"), c = l.clone();
        return this._avatarFlipping = !0, a([function () {
          return c.children(".avatar-link").css("background-image", "url('" + i + "')"), c.children(".avatar-image").attr({
            src: i,
            alt: s
          }), n(c, {rotateY: [180, 180]}, {duration: 0}).then(function () {
            c.insertAfter(l)
          })
        }, function () {
          return o.join(n(l, {rotateY: [180, 0]}, {duration: t}), n(c, {rotateY: [360, 180]}, {duration: t}))
        }, function () {
          return l.remove(), this.$$.remove(".channel-avatar"), n(c, {rotateY: [0, 0]}, {duration: 0})
        }, function () {
          this._avatarFlipping = !1
        }], this)
      },
      resetAvatar: function () {
        return this.set(s.defaults(s.pick(this.options, ["showSubavatar", "avatarUrl"]), s.pick(this.attributes, ["showSubavatar", "avatarUrl"]))), this
      },
      serialize: function () {
        return s.extend(this.toJSON(), {
          avatarUrl: h(this.get("avatarUrl"), this.options.size),
          subavatarUrl: h(this.user.getChannel().get("avatar_url"), this.options.size),
          primary: this.user.getChannel().toJSON(),
          channel: this.tumblelog.toJSON()
        })
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.get("showSubavatar") || (this.$$(".primary-avatar").css("display", "none"), this.hideSubavatar(0)), this
      }
    });
    e.exports = g
  }, {
    "../templates/avatar.tpl": 267,
    "app/components/post-form-builder/utils/transition_speed": 232,
    "app/lib/avatar-size": 456,
    "app/lib/currentuser": 459,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/utils/sequence-with-context": 609,
    "prima/view": 612,
    "velocity-animate": "lWl/mc",
    when: "RG2dij"
  }],
  327: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("prima/lib/translate"), r = t("prima/mixins/subviewable"), l = t("prima/mixins/selectorcache"), h = t("prima/mixins/accessor"), c = t("../templates/confirm_tos.tpl"), d = n.extend({
      className: "confirm-tos",
      events: {"change [data-js-confirmTos]": "_onChangeConfirmTos"},
      mixins: [r, l, h],
      template: c,
      initialize: function (t) {
        this.options = t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), this.user = t.user, this.post = t.post
      },
      _onChangeConfirmTos: function (t) {
        this.post.set("confirmTos", o(t.currentTarget).is(":checked"))
      },
      serialize: function () {
        return {__: a, confirmTos: this.post.get("confirmTos")}
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.js$("confirmTos").attr("checked", !!this.post.get("confirmTos")), this
      },
      teardown: function () {
        return this.$el.empty(), this
      }
    });
    e.exports = d
  }, {
    "../templates/confirm_tos.tpl": 268,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  328: [function (t, e, i) {
    "use strict";
    var s = t("prima/view"), o = t("prima/mixins/subviewable"), n = t("prima/mixins/selectorcache"), a = s.extend({
      mixins: [o, n],
      initialize: function () {
      },
      render: function () {
        return this
      }
    });
    e.exports = a
  }, {"prima/mixins/selectorcache": 586, "prima/mixins/subviewable": 587, "prima/view": 612}],
  329: [function (t, e, i) {
    "use strict";
    var s = t("prima/view"), o = s.extend({
      className: "post-form--error-bar", showErrorBar: function (t) {
        this.$el.html(t).slideDown()
      }, hideErrorBar: function () {
        this.$el.hide()
      }
    });
    e.exports = o
  }, {"prima/view": 612}],
  330: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("prima/mixins/popoverbase"), a = t("app/components/gif-search"), r = o.extend({
      className: "popover--gif-search",
      mixins: [n],
      defaults: {query: null},
      initialize: function (t) {
        this.gifSearch = new a(s.pick(t, "collection", "query", "imageWidth", "selectedImageUrl", "resultLimit")), this.listenTo(this, "change:query", function (t, e) {
          this.gifSearch.setQuery(e)
        }), this.listenTo(this.gifSearch, "all", this.trigger)
      },
      render: function () {
        this.gifSearch.render().$el.appendTo(this.$el)
      },
      teardown: function () {
        return s.result(this.gifSearch, "remove"), this.$el.remove(), this
      }
    });
    e.exports = r
  }, {"app/components/gif-search": 59, lodash: "MicNly", "prima/mixins/popoverbase": 583, "prima/views/base": 613}],
  331: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/view"), a = t("prima/lib/translate"), r = t("../services/preview_service"), l = t("./tooltip"), h = t("prima/mixins/subviewable"), c = t("prima/mixins/selectorcache"), d = t("prima/mixins/accessor"), u = t("../templates/html_field.tpl"), p = t("app/vendor/ace"), m = p.require("ace/mode/html").Mode, g = p.require("ace/mode/markdown").Mode, _ = t("app/components/code-editor/theme/post_form"), f = n.extend({
      mixins: [d, h, c],
      className: "html-field",
      events: {
        "click [data-js-editorHelp]": "_onClickEditorHelp",
        "click [data-js-srcButton]": "_onClickSrcButton",
        "click [data-js-previewButton]": "_onClickPreviewButton"
      },
      template: u,
      defaults: {
        name: "",
        editedSincePreview: !1,
        currentValue: "",
        htmlPreviewValue: null,
        markdownPreviewValue: null,
        isResizable: !1,
        isMarkdown: !1,
        wasFocused: !1,
        textareaClass: ""
      },
      initialize: function (t) {
        this.set(t), this.updateValueFromModel(), this.previewService = new r, this.tooltip = new l({
          className: "dropzone-tooltip-popover",
          text: a("Note that the dashboard doesn't display all HTML elements, but you're free to put them in your posts anyway.")
        }), this._renderPreview = o.bind(this.renderPreview, this)
      },
      _onClickEditorHelp: function (t) {
        this.tooltip.isRendered() ? this.tooltip.remove() : this.tooltip.render()
      },
      _onClickSrcButton: function (t) {
        this.showSource(!0)
      },
      _onClickPreviewButton: function (t) {
        this.showPreview()
      },
      renderPreview: function (t, e) {
        !o.isUndefined(t) || (t = this.get("currentValue")), !o.isUndefined(e) || (e = this.get("isMarkdown"));
        var i = this.get("htmlPreviewValue");
        this.get("editedSincePreview") || null == i ? (this.js$("htmlPreview").html('<p style="text-align:center;"><b>' + a("Loading preview...") + "</b></p>"), this.previewService.filterForDash(t, e, o.bind(function (t) {
          this.set(e ? "markdownPreviewValue" : "htmlPreviewValue", t), this.set("editedSincePreview", !1), this.js$("htmlPreview").html(t)
        }, this), o.bind(function () {
          this.js$("htmlPreview").html('<p style="text-align:center;"><i>' + a("Failed to load preview :(") + "</i></p>")
        }, this))) : this.js$("htmlPreview").html(i)
      },
      teardown: function () {
        return this.stopListening(), this.$el.empty(), this.tooltip && this.tooltip.remove(), this
      },
      serialize: function () {
        return {
          isMarkdown: this.get("isMarkdown"),
          srcLabel: a(this.get("isMarkdown") ? "Markdown" : "HTML"),
          previewLabel: a("Preview")
        }
      },
      beforeRender: function () {
        this.listenTo(this, "change:isMarkdown", function (t, e) {
          this.js$("srcIcon").toggleClass("markdown", e).toggleClass("html", !e), this.js$("srcLabel").text(a(e ? "Markdown" : "HTML"));
          var i = e ? g : m;
          this.editor.getSession().setMode(new i), this.setAriaLabel()
        })
      },
      setAriaLabel: function () {
        var t;
        this.editor && this.editor.textInput && (t = this.editor.textInput.getElement(), t && s(t).attr("aria-label", a(this.get("isMarkdown") ? "Markdown content" : "HTML content")))
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.$el.attr("data-name", this.get("name")), this.tooltip.setPinnedTarget(this.js$("editorHelp")), this._initAce(this.js$("ace").get(0)), this.showSource(), this.updateEditor(), this.setAriaLabel(), this
      },
      hide: function () {
        this.$el.hide()
      },
      show: function () {
        this.$el.show(), this.updateEditor(), this.updatePreview()
      },
      focus: function () {
        this.editor && s(this.editor.container).is(":visible") && (this.get("wasFocused") || !function (t) {
          o.defer(function () {
            t.blur(), o.defer(function () {
              t.focus()
            })
          }), t.blur()
        }(this.editor), this.editor.focus())
      },
      blur: function () {
        this.editor && this.editor.blur()
      },
      updateValueFromModel: function () {
        this.set("currentValue", this.model.get(this.get("name")) || "")
      },
      showSource: function (t) {
        this.js$("previewButton").removeClass("active"), this.js$("srcButton").addClass("active"), this.js$("previewView").hide(), this.js$("srcView").show(), t && o.defer(o.bind(function () {
          this.focus()
        }, this))
      },
      showPreview: function () {
        this.js$("srcButton").removeClass("active"), this.js$("previewButton").addClass("active"), this.updatePreview(), this.js$("srcView").hide(), this.js$("previewView").show()
      },
      updateEditor: function () {
        this.editor && (this._ignoreAceChange = !0, this.editor.setValue(this.get("currentValue"), 1), this._ignoreAceChange = !1)
      },
      updatePreview: function () {
        var t = this.get("currentValue");
        this._renderPreview(t)
      },
      _updateValueFromAce: function (t) {
        var e = this.get("name"), i = this.model.get(e);
        this.set("editedSincePreview", !0), this.set("currentValue", t), this.model.set(e, t), this.model.set("htmlEdited", t && i !== t)
      },
      _initAce: function (t) {
        var e = this.editor = p.edit(t), i = e.getSession();
        i.setUseWorker(!1), i.setUseWrapMode(!0), i.setFoldStyle("manual"), i.on("change", o.bind(function () {
          this._ignoreAceChange || this._updateValueFromAce(i.getValue())
        }, this)), i.setUseSoftTabs(!0), i.setTabSize(2);
        var s = this.get("isMarkdown") ? g : m;
        i.setMode(new s), e.setTheme(_), e.setShowPrintMargin(!1), e.renderer.setShowGutter(!1), e.renderer.setPadding(20), e.renderer.setScrollMargin(20, 20), e.setHighlightActiveLine(!1), e.setHighlightSelectedWord(!1), e.setBehavioursEnabled(!1), e.commands.removeCommands(["showSettingsMenu", "goToNextError", "goToPreviousError", "centerselection", "gotoline", "fold", "unfold", "toggleFoldWidget", "toggleParentFoldWidget", "foldall", "foldOther", "unfoldall", "findnext", " findprevious", "selectOrFindNext", "selectOrFindPrevious", "find", "overwrite", "togglerecording", "replaymacro", "jumptomatching", "selecttomatching", "removeline", "duplicateSelection", "sortlines", "togglecomment", "toggleBlockComment", "modifyNumberUp", "modifyNumberDown", "replace", "copylinesup", "movelinesup", "copylinesdown", "movelinesdown", "cut_or_delete", "blockoutdent", "blockindent", "splitline", "transposeletters", "touppercase", "tolowercase", "expandtoline", "joinlines", "inverSelection"]), e.commands.addCommand({
          name: "uncommand",
          bindKey: {win: "", mac: "Ctrl-A|Ctrl-B|Ctrl-D|Ctrl-E|Ctrl-F|Ctrl-H|Ctrl-K|Ctrl-N|Ctrl-P|Ctrl-V"},
          exec: function (t, e) {
            return !0
          },
          readOnly: !0
        });
        var n = o.bind(function () {
          this.set("wasFocused", !0), e.off("focus", n)
        }, this);
        e.on("focus", n), e.setOptions({autoScrollEditorIntoView: !0, maxLines: 300})
      }
    });
    e.exports = f
  }, {
    "../services/preview_service": 262,
    "../templates/html_field.tpl": 269,
    "./tooltip": 370,
    "app/components/code-editor/theme/post_form": 41,
    "app/vendor/ace": "4e8++S",
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  332: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("prima/lib/translate"), r = t("../templates/id3_editor.tpl"), l = n.extend({
      className: "id3-editor",
      events: {"input .id3-editor--input": "_onChangeInput", "change .id3-editor--input": "_onChangeInput"},
      template: r,
      initialize: function (t) {
        this.options = t = s.extend({}, t), s.extend(this, s.pick(t, ["post", "user"]))
      },
      _onChangeInput: function (t) {
        var e = o(t.currentTarget);
        this.post.set(e.attr("name"), e.val())
      },
      serialize: function () {
        var t = {
          id3Fields: s.pick(this.post.toJSON(), "trackTitle", "trackArtist", "trackAlbum"),
          id3FieldLabel: {trackTitle: a("Track"), trackArtist: a("Artist"), trackAlbum: a("Album")}
        };
        return t
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this
      }
    });
    e.exports = l
  }, {
    "../templates/id3_editor.tpl": 270,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/view": 612
  }],
  333: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/component"), a = t("components/popover").FeatureHelpPopoverView, r = n.extend({
      name: "InlineControlsTutorial",
      initialize: function (t) {
        this.options = t = o.extend({}, t), this.editor = this.options.richTextEditor, this.popover = new a, this.animationShowDelay = o.isNumber(this.options.animationShowDelay) ? this.options.animationShowDelay : 500, this.animationHideDelay = o.isNumber(this.options.animationHideDelay) ? this.options.animationHideDelay : 500, this.animationClass = this.options.animationClass, this.config = {
          name: "inline-controls",
          template: "standard",
          glass: !1,
          title: this.options.title,
          content: this.options.content,
          ok_text: this.options.buttonLabel,
          position: a.POSITION.BOTTOM | a.POSITION.LEFT
        }, this.listenTo(this.editor, "controls:show", this._onInlineControlsShow)
      },
      show: function () {
        this.editor.toggleInlineControlsTray(!0), this.listenToOnce(this.editor, "controls:hide controls:embed:prompt controls:gif:prompt", this._onInlineControlsHide), this.listenToOnce(this.editor, "controls:close", this._onInlineControlsClose), this.listenToOnce(this.popover, "dismiss", this._onPopoverDismiss), this.popover.setHighlighted(s(".post-form .inline-controls .opener")), this.popover.show(this.config), this.animationClass && setTimeout(o.bind(function () {
          s("body").addClass(this.animationClass)
        }, this), this.animationShowDelay), this.editor.addElementToControlsCloseWhitelist(this.popover.getPopoverElement())
      },
      showWithDelay: function () {
        setTimeout(this.show.bind(this), this.animationShowDelay)
      },
      hide: function () {
        this.animationClass && s("body").removeClass(this.animationClass), this.editor.removeElementFromControlsCloseWhitelist(this.popover.getPopoverElement()), this.stopListening(this.editor, "controls:hide controls:close controls:embed:prompt controls:gif:prompt"), this.stopListening(this.popover), this.popover.hide(), this.trigger("hide", this)
      },
      hideWithDelay: function () {
        setTimeout(this.hide.bind(this), this.animationHideDelay)
      },
      _onInlineControlsShow: function () {
        this.showWithDelay()
      },
      _onInlineControlsClose: function () {
        this.hideWithDelay()
      },
      _onInlineControlsHide: function () {
        this.hide()
      },
      _onPopoverDismiss: function () {
        this.trigger("dismiss")
      },
      remove: function () {
        this.hide(), n.prototype.remove.apply(this, arguments)
      }
    });
    e.exports = r
  }, {"components/popover": 504, jquery: "HlZQrA", lodash: "MicNly", "prima/component": 545}],
  334: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("prima/mixins/accessor"), r = t("prima/mixins/subviewable"), l = t("prima/mixins/selectorcache"), h = t("./plaintext_editor"), c = t("../templates/inline_embed_field.tpl"), d = n.extend({
      className: "post-form--inline-embed-field",
      template: c,
      mixins: [a, r, l],
      initialize: function (t) {
        this.options = s.extend({}, this.defaults, t)
      },
      show: function () {
        this.inlineEmbedInput.setEditorValue(""), s.defer(s.bind(function () {
          this.inlineEmbedInput.focus()
        }, this));
        var t = this.options.calculateWidth();
        t = "100%", this.$el.add(this.inlineEmbedInput.element).width(t), this.$el.addClass("open"), this.$el.closest(".tray").addClass("inline-embed-open")
      },
      hide: function () {
        this.$el.removeClass("open"), this.$el.closest(".tray").removeClass("inline-embed-open")
      },
      getCurrentValue: function () {
        return this.inlineEmbedInput ? this.inlineEmbedInput.getEditorValue() : ""
      },
      createSubViews: function () {
        var t = s.extend({
          placeholder: this.options.placeholder,
          ariaLabel: this.options.placeholder,
          name: "inlineEmbedInput",
          forceSingleLine: !0,
          syncWithModel: !1,
          pasteHook: s.bind(this._onInputPaste, this),
          onChange: s.bind(this._onInputChange, this),
          onClientEvent: s.bind(this._onInputClientEvent, this)
        });
        this.inlineEmbedInput = this.subViews.inlineEmbedInput = new h(t)
      },
      _set_field_state_default: function () {
        o(this.inlineEmbedInput.editor.element).removeClass("invalid")
      },
      _set_field_state_invalid: function () {
        o(this.inlineEmbedInput.editor.element).addClass("invalid")
      },
      _onInputChange: function (t) {
        this.getCurrentValue() !== this.get("embedCode") && this._set_field_state_default()
      },
      _onInputPaste: function () {
        s.defer(s.bind(this.options.submitEmbedCode, this))
      },
      _onInputClientEvent: function (t) {
        if ("keydown" === t.type)switch (t.which || t.keyCode) {
          case 27:
            t.preventDefault(), t.stopImmediatePropagation(), this.options.returnFocus(), this.hide();
            break;
          case 13:
            t.preventDefault(), t.stopImmediatePropagation(), this.options.submitEmbedCode()
        }
      },
      beforeRender: function () {
        this.$el.html(this.template()), this.createSubViews()
      },
      render: function () {
        return this.attachSubViews(), this
      }
    });
    e.exports = d
  }, {
    "../templates/inline_embed_field.tpl": 272,
    "./plaintext_editor": 345,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  335: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("./base"), n = t("../id3_editor"), a = t("../album_art_uploader"), r = t("app/components/remove-button"), l = t("./audio_player_shim"), h = t("../../templates/media/audio.tpl"), c = o.extend({
      className: "audio-media-container media-container",
      defaults: s.defaults({url: "", service: "", albumArt: "", type: "", id: ""}, o.prototype.defaults),
      events: {mouseenter: "_onHoverRemoveButton", mouseleave: "_onHoverRemoveButton"},
      template: h,
      beforeTeardown: function () {
        return delete this.audioPlayer, this.$el.removeClass(this.post.get("service")), this.$el.empty(), this
      },
      _onHoverRemoveButton: function (t) {
        var e = "mouseover" === t.type || "mouseenter" === t.type;
        this.js$("removeButton").toggleClass("active", e)
      },
      beforeRender: function () {
        this.removeButton = this.subViews.removeButton = new r({
          onClick: s.bind(function () {
            this.trigger("media:remove", this)
          }, this), buttonClass: "top-right"
        }), this.$el.addClass(this.post.get("service")), "direct" === this.post.get("service") && (this.post.canEditMedia() && (this.id3Editor = this.subViews.id3Editor = new n(this.options), this.albumArtUploader = this.subViews.albumArtUploader = new a(s.defaults({url: this.post.get("albumArt") || ""}, this.options))), this.audioPlayer = this.subViews.audioPlayer = new l({
          extra_classes: null,
          post_id: "",
          service: "upload",
          lightbox: !1,
          preview: this.post.canEditMedia(),
          cover: this.post.get("albumArt"),
          tracks: [{
            stream_url: this.post.get("url"),
            cover: this.post.get("albumArt"),
            track: this.post.get("trackTitle"),
            artist: this.post.get("trackArtist"),
            album: this.post.get("trackAlbum")
          }]
        }))
      },
      afterRender: function () {
        this.listenTo(this.post, "change:url change:service", function (t) {
          this.$el.removeClass(t.previous("service")), this.teardown().render()
        }), this.renderSubViews(), this.trigger("media:ready", this)
      }
    });
    e.exports = c
  }, {
    "../../templates/media/audio.tpl": 273,
    "../album_art_uploader": 322,
    "../id3_editor": 332,
    "./audio_player_shim": 336,
    "./base": 337,
    "app/components/remove-button": 385,
    lodash: "MicNly"
  }],
  336: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/subviewable"), a = s.get(window, "Tumblr.AudioPlayer"), r = o.extend({
      mixins: [n],
      initialize: function (t) {
        this.options = s.extend({}, t)
      },
      teardown: function () {
        return this.audioPlayer.unbind_events(), this.$el.empty(), delete this.audioPlayer, this
      },
      render: function () {
        a || (a = s.get(window, "Tumblr.AudioPlayer"));
        var t = s.defaults({replace: null, append_to: null, prepend_to: this.$el}, this.options);
        return this.audioPlayer = new a(t), this.options.preview && this.audioPlayer.$container.addClass("has_art"), this.$el.toggleClass("audio-player--preview-player", this.options.preview), this
      }
    });
    e.exports = r
  }, {lodash: "MicNly", "prima/mixins/subviewable": 587, "prima/view": 612}],
  337: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("prima/mixins/subviewable"), r = t("prima/mixins/selectorcache"), l = s.template(""), h = o.extend({
      className: "media-container",
      template: l,
      mixins: [n, a, r],
      defaults: {canEditMedia: !0},
      defaultOptions: {},
      initialize: function (t) {
        this.options = t = s.extend({}, this.defaultOptions, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, ["post", "user", "uploads", "dragEvents"])), s.isFunction(this.afterInitialize) && this.afterInitialize.apply(this, arguments)
      },
      serialize: function () {
        return this.toJSON()
      },
      teardown: function () {
        return this.stopListening(), this
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.attachSubViews(), this
      }
    });
    e.exports = h
  }, {
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  338: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("app/components/photoset/views/photo"), n = t("app/components/remove-button"), a = o.prototype.template, r = t("../../templates/media/edit_photo.tpl"), l = o.extend({
      className: "photoset--photo media-container",
      events: s.extend({
        mouseenter: "_onHoverMediaContainer",
        mouseleave: "_onHoverMediaContainer",
        "click [data-js-clickthroughUrlButton]": "_onClickClickthroughUrlButton",
        "click [data-js-captionButton]": "_onClickCaptionButton"
      }, o.prototype.events),
      defaults: s.extend({
        enableClickthroughUrl: !1,
        hasClickthroughUrl: !1,
        enableCaption: !1,
        hasCaption: !1,
        isActive: !1
      }, o.prototype.defaults),
      template: function (t) {
        return a(t) + r(t)
      },
      _onHoverMediaContainer: function (t) {
        clearTimeout(this._removeButtonActive);
        var e = "mouseover" === t.type || "mouseenter" === t.type;
        e ? (this.set("isActive", !0), this.trigger("photoset:hover", this, this.photo)) : this._removeButtonActive = s.delay(s.bind(function () {
          this.set("isActive", !1)
        }, this), 500)
      },
      _onClickClickthroughUrlButton: function (t) {
        this.photo.trigger("photo:editClickthroughUrl", this.photo, t.currentTarget)
      },
      _onClickCaptionButton: function (t) {
        this.photo.trigger("photo:editCaption", this.photo, t.currentTarget)
      },
      _updateOverlayButtons: function () {
        this.js$("clickthroughUrlButton").css("display", this.get("enableClickthroughUrl") ? "block" : "none"), this.js$("captionButton").css("display", this.get("enableCaption") ? "block" : "none"), this.js$("clickthroughUrlButton").toggleClass("active", this.get("hasClickthroughUrl")), this.js$("captionButton").toggleClass("active", this.get("hasCaption"))
      },
      addStateListeners: function () {
        this.listenTo(this, "change:isActive", function (t, e) {
          this.js$("removeButton").toggleClass("active", e), this.js$("mediaOverlay").toggleClass("active", e)
        }), this.listenTo(this, "photoset:unhover", function (t, e) {
          this.set("isActive", !1)
        }), this.listenTo(this, "change:enableClickthroughUrl change:enableCaption", this._updateOverlayButtons), this.listenTo(this, "change:hasClickthroughUrl change:hasCaption", this._updateOverlayButtons), this.listenTo(this.photos, "add remove", function () {
          this.photos.length > 1 ? this.js$("sortable").attr("draggable", !0) : this.js$("sortable").removeAttr("draggable")
        }), this.post && this.listenTo(this.post, "change:linkthrough", function (t, e) {
          this.set("hasClickthroughUrl", !!e)
        }), this.listenTo(this.photo, "change:caption", function (t, e) {
          this.set("hasCaption", !!e)
        })
      },
      beforeRender: function () {
        var t = this.photos.length > 1;
        this.set("enableClickthroughUrl", !t), this.set("enableCaption", t), this.set("hasClickthroughUrl", this.post ? !!this.post.get("linkthrough") : !1), this.set("hasCaption", !!this.photo.get("caption")), this.removeButton = this.subViews.removeButton = new n({
          onClick: s.bind(function () {
            this.photoset.removePhoto(this.photo.id)
          }, this), buttonClass: "top-right"
        }), this.addStateListeners()
      },
      afterRender: function () {
        o.prototype.afterRender.apply(this, arguments), this.photos.length > 1 && this.js$("sortable").attr("draggable", !0), this._updateOverlayButtons()
      }
    });
    e.exports = l
  }, {
    "../../templates/media/edit_photo.tpl": 274,
    "app/components/photoset/views/photo": 220,
    "app/components/remove-button": 385,
    lodash: "MicNly"
  }],
  339: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("./base"), n = t("prima/lib/translate"), a = t("app/components/photoset"), r = t("app/components/photoset/models/photo"), l = t("app/components/photoset/views/editable_photoset"), h = t("app/components/webcam"), c = t("./edit_photo"), d = t("prima/mixins/promisifyevents"), u = t("../overlay_input"), p = t("../../templates/media/photo.tpl"), m = o.extend({
      className: "media-container photo-media-container",
      template: p,
      mixins: [d],
      defaults: s.defaults({canPreview: !0, showPhotoBooth: !1, minFullWidthSize: {}}, o.prototype.defaults),
      afterInitialize: function () {
        this.addStateListeners(), this._updatePhotosetView = s.debounce(this.updatePhotosetView, 50)
      },
      addStateListeners: function () {
        this.listenTo(this.post.photos, "add", this._onPhotosAdd), this.listenTo(this.post.photos, "remove", this._onPhotosRemove), this.listenTo(this, "change:showPhotoBooth", function (t, e) {
          e ? (this._createPhotoBooth(), s.isString(e) && this.photobooth.indexView.set("watermarkUrl", e), this.js$("photoset").css("display", "none")) : (this.stopListening(this.photobooth), this.photobooth.remove(), this.js$("photoset").css("display", ""))
        })
      },
      updatePhotosetView: function () {
        this.photoset.model.fixLayout(), this.photoset.indexView.trigger("update", this.photoset.model.photos, this.photoset.model.get("layout"))
      },
      _onPhotosAdd: function (t, e) {
        this.post.set("linkthrough", ""), t = this._preparePhotosetPhotoModel(t), this.photoset.model.add(t), this._updatePhotosetView()
      },
      _onPhotosRemove: function (t, e) {
        this.post.set("linkthrough", ""), this.photoset.model.remove(t.id), this.updatePhotosetView()
      },
      _preparePhotosetPhotoModel: function (t) {
        s.isFunction(t.toJSON) && (t = t.toJSON()), t.url = t.displayUrl;
        var e = s.keys(r.prototype.defaults);
        return e.unshift("id"), s.pick(t, e)
      },
      _syncPostToPhotoset: function (t) {
        t || (t = this.photoset.model);
        var e = this.post.photos.map(this._preparePhotosetPhotoModel, this);
        t.photos.reset(e), t.set("layout", this.post.get("layout"))
      },
      _createPhotoBooth: function () {
        var t = this.photobooth = new h;
        t.render(), this.listenTo(t, "webcam:image", function (t) {
          t && t.base64 && this.post.photos.unshift({
            photoRaw: t.base64.split("base64,")[1],
            base64: t.base64,
            isSelfie: !0,
            isSelfieGif: t.isGif || !1,
            height: t.height,
            width: t.width
          })
        }), this.listenTo(t, "webcam:error", function (t) {
          this.trigger("webcam:error", t)
        }), this.listenTo(t, "webcam:reset", function () {
          this.post.photos.shift()
        }), this.listenTo(t, "webcam:close", function () {
          this.post.photos.shift(), this.trigger("webcam:close")
        }), this.js$("photobooth").append(t.getElement())
      },
      _createPhotoset: function () {
        var t = {
          dynamic: !0,
          padding: 2,
          width: 540,
          minFullWidthSize: this.get("minFullWidthSize"),
          addMargin: this.options.fullWidthInlineMedia
        };
        this.get("canEditMedia") && (t.PhotosetView = l, t.PhotoView = c, t.post = this.post);
        var e = this.photoset = new a(t);
        return this._syncPostToPhotoset(e.model), this.get("canEditMedia") && (this.listenTo(this.photoset, "change:layout", function (t, e) {
          this.post.set("layout", e)
        }), this.listenTo(this.photoset, "sort", function (t) {
          this.post.photos.setIdOrder(t.pluck("id"))
        }), this.listenTo(this.photoset, "photo:remove", function (t, e, i) {
          this.set("layout", i), this.post.photos.remove(e)
        }), this.listenTo(this.photoset.indexView, "photoset:predrag", function () {
          this.overlayPopover && this.overlayPopover.teardown()
        }), this.listenTo(this.photoset, "photo:editClickthroughUrl", this._createClickthroughUrlPopover), this.listenTo(this.photoset, "photo:editCaption", this._createCaptionPopover), this.listenTo(this.photoset, "change:caption", function (t, e) {
          var i = this.post.photos.get(t.id);
          i && i.set("caption", e)
        })), this.photoset.model.fixLayout(), e.render(), this.js$("photoset").append(e.getElement()), this.get("canEditMedia") && this.listenTo(this.dragEvents, "drop", this._onDrop), e
      },
      _createClickthroughUrlPopover: function (t, e) {
        this.overlayPopover && (this.overlayPopover = this.overlayPopover.remove());
        var i = this.overlayPopover = new u({
          pinnedTarget: e,
          pinnedTargetContainer: this.photoset.getElement(),
          value: this.post.get("linkthrough"),
          ariaLabel: n("Clickthrough URL"),
          placeholder: "http://"
        });
        i.render(), this.listenTo(i, "change:value", function (t, e) {
          e = s.trim(e || ""), this.post.set("linkthrough", e)
        }), this.listenToOnce(i, "close", function () {
          this.stopListening(i), delete this.overlayPopover
        })
      },
      _createCaptionPopover: function (t, e) {
        this.overlayPopover && (this.overlayPopover = this.overlayPopover.remove());
        var i = this.overlayPopover = new u({
          pinnedTarget: e,
          pinnedTargetContainer: this.photoset.getElement(),
          maxLength: 200,
          value: t.get("caption"),
          placeholder: n("Caption this photo"),
          updateShift: !1
        });
        i.render(), this.listenTo(i, "change:value", function (e, i) {
          t.set("caption", s.trim(i || ""))
        }), this.listenToOnce(i, "close", function () {
          this.stopListening(i), delete this.overlayPopover
        })
      },
      _onDrop: function (t) {
        if (!s.isEmpty(this.$el.find(t.target))) {
          t.preventDefault();
          var e = s.result(t.originalEvent.dataTransfer, "files");
          e && this.trigger("media:addFiles", e)
        }
      },
      beforeTeardown: function () {
        this.photobooth && (this.stopListening(this.photobooth), this.photobooth.remove()), delete this.photobooth, this.photoset && (this.stopListening(this.photoset), this.photoset.remove()), delete this.photoset, this.overlayPopover && (this.overlayPopover.remove(), this.stopListening(this.overlayPopover)), delete this.overlayPopover
      },
      afterRender: function () {
        this.js$("photobooth", !0), this.js$("photoset", !0), this._createPhotoset(), this.photobooth = !1, this.trigger("media:ready", this), this.renderSubViews()
      }
    });
    e.exports = m
  }, {
    "../../templates/media/photo.tpl": 275,
    "../overlay_input": 343,
    "./base": 337,
    "./edit_photo": 338,
    "app/components/photoset": 210,
    "app/components/photoset/models/photo": 211,
    "app/components/photoset/views/editable_photoset": 219,
    "app/components/webcam": 400,
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/promisifyevents": 584
  }],
  340: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("when"), a = t("prima/utils/delayed"), r = t("./base"), l = t("prima/mixins/promisifyevents"), h = t("components/crt/player"), c = t("prima/lib/translate"), d = t("../../utils/scale_to_width"), u = t("app/components/remove-button"), p = t("../../templates/media/video.tpl"), m = t("../../templates/media/video_upload.tpl"), g = t("../../templates/media/video_embed.tpl"), _ = t("../../templates/media/video_error.tpl"), f = r.extend({
      className: "media-container video-media-container",
      events: {mouseenter: "_onHoverRemoveButton", mouseleave: "_onHoverRemoveButton"},
      template: p,
      mixins: [l],
      defaults: s.defaults({canPreview: !0, file: !1, embed: !1, width: !1, height: !1}, r.prototype.defaults),
      afterInitialize: function () {
        this.addStateListeners()
      },
      addStateListeners: function () {
        this.listenTo(this, "change", this._onChangeVideo), this.listenTo(this.post, "change:preuploadUrl", this._onChangePreuploadUrl)
      },
      _onHoverRemoveButton: function (t) {
        var e = "mouseover" === t.type || "mouseenter" === t.type;
        this.js$("removeButton").toggleClass("active", e)
      },
      _onChangeVideo: function () {
        (this.hasChanged("file") || this.hasChanged("embed") || this.hasChanged("canPreview")) && (this.hasChanged("file") ? this.attributes.embed = !1 : this.hasChanged("embed") && (this.attributes.file = !1), this.hasChanged("canPreview") || this.set("canPreview", !0), this.isRendered() && (this.teardown(), this.render(), this.addStateListeners()))
      },
      _onChangePreuploadUrl: function (t, e) {
        this._updateUploadPreview(e, this.get("file"))
      },
      _updateUploadPreview: function (t, e) {
        var i = e && e.name ? '"' + e.name + '"' : "";
        t ? (this.js$("previewIcon").removeClass("video-uploading").addClass("video-check"), this.js$("previewMessage").html(c("Your video %1$s has been uploaded", i))) : (this.js$("previewIcon").removeClass("video-check").addClass("video-uploading"), this.js$("previewMessage").html(c("Uploading your video %1$s", i)))
      },
      _createVideoPlayer: function (t) {
        if (!this.get("canPreview"))return this.js$("video").html(m({
          icon: "",
          message: ""
        })), void this._updateUploadPreview(this.post.get("preuploadUrl"), t);
        var e = 540, i = this.get("width"), o = this.get("height"), a = i && o ? d(i, o, e) : {width: e};
        s.extend(a, {file: t, techOrder: ["html5"]});
        var r = this.player = new h(document.createElement("video"), {
          attributes: {watch: !1},
          vjsOptions: a
        }), l = !1, c = this.whenEvent(r, "ready");
        return c.then(function () {
          r.player.on("error", function () {
            l = !0, s.defer(function () {
              this.set("canPreview", !1), this.trigger("media:ready", this)
            }.bind(this))
          }.bind(this))
        }.bind(this)), n.join(this.whenEvent(r, "change:loaded"), c).then(function () {
          if (!l) {
            this.js$("video").append(r.$el);
            var t = {width: "auto", height: "auto"}, i = r.$video.prop("videoWidth"), s = r.$video.prop("videoHeight");
            i && s && (t = d(i, s, e)), r.$el.css(t), this.trigger("media:ready", this)
          }
        }.bind(this)), r.render(), r
      },
      _createVideoEmbed: function () {
        var t = function (t) {
          return o('<a href="' + t.get("blog_url") + '"></a>').prop("hostname")
        }(this.user.getChannel(this.post.get("tumblelog"))), e = this.get("embed"), i = s.extend({tumblelogHostname: t}, e);
        this.js$("video").html(g(i)), "inline" === e.embedRenderContext ? a(function () {
          this.trigger("media:ready", this)
        }, 250, this)() : this.trigger("media:ready", this)
      },
      beforeTeardown: function () {
        this.player && this.player.teardown(), delete this.player
      },
      beforeRender: function () {
        this.removeButton = this.subViews.removeButton = new u({
          onClick: function () {
            this.trigger("media:remove", this)
          }.bind(this), buttonClass: "top-right"
        })
      },
      afterRender: function () {
        this.js$("video", !0), this.renderSubViews(), this.player = !1, this.get("file") ? this._createVideoPlayer(this.get("file")) : this.get("embed") ? s.isEmpty(this.get("embed")) ? (this.js$("video").html(_()), this.trigger("media:ready", this)) : this._createVideoEmbed(this.get("embed")) : this.trigger("media:ready", this)
      }
    });
    e.exports = f
  }, {
    "../../templates/media/video.tpl": 276,
    "../../templates/media/video_embed.tpl": 277,
    "../../templates/media/video_error.tpl": 278,
    "../../templates/media/video_upload.tpl": 279,
    "../../utils/scale_to_width": 319,
    "./base": 337,
    "app/components/remove-button": 385,
    "components/crt/player": 469,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/promisifyevents": 584,
    "prima/utils/delayed": 599,
    when: "RG2dij"
  }],
  341: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = (t("prima/lib/logger"), t("app/components/upload")), r = t("./plaintext_editor"), l = t("app/components/remove-button"), h = t("./tooltip"), c = t("prima/mixins/accessor"), d = t("prima/mixins/subviewable"), u = t("prima/mixins/selectorcache"), p = t("../templates/media_dropzone.tpl"), m = o(document), g = n.extend({
      className: "media-dropzone-container media-container",
      template: p,
      mixins: [c, d, u],
      defaults: {
        droppable: !1,
        showInput: !1,
        toggleDropzone: !1,
        dropzoneText: "",
        enableUpload: !0,
        enableUrl: !0,
        uploadIcon: "",
        uploadText: "",
        uploadTooltip: "",
        urlIcon: !1,
        urlText: "",
        urlTooltip: "",
        url: "",
        urlPlaceholder: "http://",
        urlAriaLabel: "http://"
      },
      defaultOptions: {
        uploadOptions: {},
        modelKey: !1,
        urlParser: !1,
        documentDrag: !0,
        parseOnUpload: !1,
        parseOnInput: !1,
        parseOnEnter: !0,
        parseOnPaste: !0,
        inputDebounceTime: 250
      },
      events: {
        mouseenter: "_onHoverMediaContainer",
        mouseleave: "_onHoverMediaContainer",
        "click [data-show-tooltip]": "_onClickShowTooltip",
        "click [data-js-mediaUrl]": "_focusUrlInput"
      },
      initialize: function (t) {
        this.options = t = s.extend({}, this.defaultOptions, t), s.isString(t.dropzoneFineprint) && (t.dropzoneFineprint = [t.dropzoneFineprint]), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.defaults(this.attributes, {
          defaultBehavior: this.get("enableUpload") ? "upload" : "url",
          dropzoneBehavior: this.get("enableUpload") ? "upload" : "url",
          splitDropzone: this.get("enableUpload") && this.get("enableUrl")
        }), this.upload = new a(t.uploadOptions), t.modelKey && this.listenTo(this.upload, "change:url", this._onUploadUrlChange), this.listenTo(this.upload, "add", function (t) {
          this.trigger("upload:start", t)
        }), this.listenTo(this.upload, "complete", function (t, e) {
          this.trigger("upload:complete", e)
        }), this.listenTo(this.upload, "error", function (t, e) {
          this.trigger("upload:error", e)
        }), this.listenTo(this.upload, "invalid", function (t, e) {
          this.trigger("upload:invalid", e)
        }), this.listenTo(this.upload, "allComplete", function (t, e) {
          this.trigger("uploads:allComplete", t)
        }), this.listenTo(this, "change:droppable", function (t, e) {
          this.js$("dropzone").toggleClass("droppable", e)
        }), this.listenTo(this, "change:showInput", function (t, e) {
          e ? (this.js$("dropzone").addClass("show-input"), this._onUrlInputChange()) : (this.js$("dropzone").removeClass("show-input"), this.js$("dropzone").height(""), this.get("defaultBehavior") !== this.get("dropzoneBehavior") && this.set("dropzoneBehavior", this.get("defaultBehavior")))
        }), this.listenTo(this, "url:complete", this._onUrlComplete), this.listenTo(this, "url:error", this._onUrlError), this.listenTo(this, "change:toggleDropzone", function (t, e) {
          e ? (this.js$("dropzone").addClass("toggle-dropzone"), this.js$("mediaUploadText").text(this.get("dropzoneText")), this.js$("mediaUrlText").text(this.get("dropzoneText"))) : (this.js$("dropzone").removeClass("toggle-dropzone"), this.js$("mediaUploadText").text(this.get("uploadText")), this.js$("mediaUrlText").text(this.get("urlText")))
        }), this.listenTo(this, "change:dropzoneBehavior", function (t, e) {
          this.js$("dropzone").removeClass("toggle-dropzone-upload toggle-dropzone-url").addClass("toggle-dropzone-" + e)
        }), this.__updateUrlFromInput = s.debounce(this._updateUrlFromInput, this.options.inputDebounceTime), this.__onDragOver = s.bind(this._onDragOver, this), this.__onDragLeave = s.bind(this._onDragLeave, this)
      },
      urlParser: function (t, e) {
        return s.isFunction(this.options.urlParser) ? this.options.urlParser(t, this, e) : void 0
      },
      addFiles: function (t) {
        return this.upload.addFiles(t)
      },
      _addDragStartListener: function (t) {
        o(document).on("dragover.dropzone dragenter.dropzone", this.__onDragOver)
      },
      _removeDragStartListener: function (t) {
        o(document).off("dragover.dropzone dragenter.dropzone", this.__onDragOver)
      },
      _addDragEndListener: function (t) {
        o(document).on("mouseout.dropzone", this.__onDragLeave)
      },
      _removeDragEndListener: function (t) {
        o(document).off("mouseout.dropzone", this.__onDragLeave)
      },
      _onDragOver: function (t) {
        this._dragging = !0, this.set("droppable", !0), this._removeDragStartListener(), this._addDragEndListener()
      },
      _onDragLeave: function (t) {
        this._dragging = !1, this.set("droppable", !1), this._addDragStartListener(), this._removeDragEndListener()
      },
      _onClickShowTooltip: function (t) {
        var e = this.$(t.currentTarget).data("showTooltip"), i = s.result(this, e);
        i && i instanceof h && !i.isOrWasRecentlyRendered() && i.render()
      },
      _focusUrlInput: function (t) {
        return this.js$("removeButton").is(t.target) || this.js$("removeButton").find(t.target).length ? !0 : (this.set("showInput", !0), void(this.urlInput && this.urlInput.focus()))
      },
      _onUploadUrlChange: function (t, e) {
        this.model && (this.model.set(this.options.modelKey, e), this.options.parseOnUpload && this.urlParser(e, "upload"))
      },
      _updateUrlFromInput: function () {
        var t = this.urlInput ? s.trim(this.urlInput.getEditorValue() || "") : "";
        this.set("url", t)
      },
      _onUrlInputChange: function () {
        this.urlInput && this.get("showInput") && (this.js$("dropzone").height(this.urlInput.$el.height()), this.__updateUrlFromInput())
      },
      _onUrlInputClientEvent: function (t) {
        if ("keydown" === t.type)switch (t.which || t.keyCode) {
          case 27:
            t.preventDefault(), t.stopImmediatePropagation(), this.set("showInput", !1), this.urlInput.setEditorValue(""), this.js$("dropzone").removeClass("has-error"), this.urlInput.blur();
            break;
          case 13:
            this.options.parseOnEnter && !t.shiftKey ? (t.preventDefault(), t.stopImmediatePropagation(), this._updateUrlFromInput(), this.urlParser(this.get("url"), "enter")) : this.options.parseOnInput && (this.urlParser(this.get("url")), this.listenToOnce(this, "change:url", function (t, e) {
              this.urlParser(e, "input")
            }));
            break;
          default:
            this.js$("dropzone").removeClass("has-error"), this.options.parseOnInput && (this.urlParser(this.get("url")), this.listenToOnce(this, "change:url", function (t, e) {
              this.urlParser(e, "input")
            }))
        }
      },
      _onUrlInputPasteEvent: function (t, e) {
        s.delay(s.bind(function () {
          this.options.parseOnPaste && (this._updateUrlFromInput(), this.urlParser(this.get("url"), "paste"))
        }, this), 0)
      },
      _onUrlComplete: function () {
        this.js$("dropzone").removeClass("has-error")
      },
      _onUrlError: function () {
        this.js$("dropzone").addClass("has-error")
      },
      _onHoverMediaContainer: function (t) {
        clearTimeout(this._removeButtonActive);
        var e = "mouseover" === t.type || "mouseenter" === t.type;
        e ? this.js$("removeButton").addClass("active") : this._removeButtonActive = s.delay(s.bind(function () {
          this.js$("removeButton").removeClass("active");
        }, this), 500)
      },
      serialize: function () {
        return s.mapValues(this.toJSON(), function (t, e) {
          return s.isFunction(t) && e.match(/^(upload|url)(Icon|Text|Tooltip)$/) ? t() : t
        }, this)
      },
      beforeTeardown: function () {
        this.upload.getElement().detach(), this.subViews.upload = void 0, m.off("keydown.postForm.dropzone keyup.postForm.dropzone")
      },
      afterTeardown: function () {
        this.uploadTooltip && this.uploadTooltip.remove(), this.urlTooltip && this.urlTooltip.remove(), delete this.uploadTooltip, delete this.urlTooltip, delete this.urlInput, delete this.urlInput, delete this.removeButton, this._removeDragStartListener(), this._removeDragEndListener()
      },
      beforeRender: function () {
        if (this.subViews.upload = this.upload.indexView, this.get("enableUrl")) {
          var t = {
            placeholder: this.get("urlPlaceholder"),
            name: "url",
            ariaLabel: this.get("urlAriaLabel"),
            syncWithModel: !1,
            onChange: s.bind(this._onUrlInputChange, this),
            onClientEvent: s.bind(this._onUrlInputClientEvent, this),
            pasteHook: s.bind(this._onUrlInputPasteEvent, this)
          };
          s.defaults(t, s.pick(this.options, s.keys(t))), this.urlInput = this.subViews.urlInput = new r(t), this.removeButton = this.subViews.removeButton = new l({
            onClick: s.bind(function () {
              this.set("showInput", !1), this.urlInput.setEditorValue(""), this.js$("dropzone").removeClass("has-error")
            }, this), buttonClass: "top-right"
          })
        }
        m.on("keydown.postForm.dropzone keyup.postForm.dropzone", s.bind(function (t) {
          switch (t.which || t.keyCode) {
            case 18:
              var e = this.get("defaultBehavior"), i = "url" === e ? "upload" : "url";
              "keydown" === t.type ? this.set("dropzoneBehavior", i) : this.get("showInput") || this.set("dropzoneBehavior", e)
          }
        }, this)), this.options.documentDrag && this._addDragStartListener()
      },
      afterRender: function () {
        this.get("enableUrl") && this.urlInput.setEditorValue(this.get("url") || ""), this.get("enableUpload") && this.get("uploadTooltip") && (this.uploadTooltip = new h({
          className: "dropzone-tooltip-popover",
          sanitize: !1,
          text: s.result(this.attributes, "uploadTooltip")
        }), this.uploadTooltip.setPinnedTarget(this.js$("uploadTooltip"))), this.get("enableUrl") && this.get("urlTooltip") && (this.urlTooltip = new h({
          className: "dropzone-tooltip-popover",
          sanitize: !1,
          text: s.result(this.attributes, "urlTooltip")
        }), this.urlTooltip.setPinnedTarget(this.js$("urlTooltip"))), this.renderSubViews()
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.attachSubViews(), this
      }
    });
    e.exports = g
  }, {
    "../templates/media_dropzone.tpl": 280,
    "./plaintext_editor": 345,
    "./tooltip": 370,
    "app/components/remove-button": 385,
    "app/components/upload": 397,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/logger": 553,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  342: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("prima/events"), r = t("../models/mention"), l = t("prima/mixins/accessor"), h = t("prima/mixins/popoverbase"), c = t("prima/mixins/selectorcache"), d = t("../templates/mention_dropdown.tpl"), u = function () {
    }, p = n.extend({
      className: "popover--mention-dropdown",
      defaults: {currentKeyedChoice: -1, currentMousedChoice: -1, interactive: !1, lastResults: {}, debugMode: !1},
      mixins: [l, c, h],
      template: d,
      initialize: function () {
        this.model = new r, this.listenTo(this, "change:lastResults", this.preRender), u = s.bind(u, this)
      },
      preRender: function (t, e) {
        var i = (e.blogs || []).length;
        u("MentionDropdown - PreRender with %d results.", i), this.set({
          currentKeyedChoice: -1,
          currentMousedChoice: -1,
          interactive: !1
        }), i ? (this._rendered && this.teardown(!0), this.set("numSuggestions", i), this.render(e)) : this.trigger("dropdown:empty")
      },
      render: function (t) {
        return u("MentionDropdown - Render"), this.$el.html(this.template(t)), this.trigger("dropdown:render"), a.trigger("postForms:dismissListener:suspend"), this
      },
      afterRender: function () {
        o(".item-option", this.$el).on("mousedown", s.bind(this.handleMouseClick, this)), o(".item-option", this.$el).on("mouseover", s.bind(this.handleMouseOver, this)), this.$el.on("mouseout", s.bind(this.handleMouseOut, this))
      },
      teardown: function (t) {
        return this.$el.remove(), t || this.set({
          interactive: !1,
          lastResults: {}
        }), a.trigger("postForms:dismissListener:resume"), this
      },
      updateMentionDropdown: function (t, e, i) {
        u("MentionDropdown - fetch callback", e), this.set("lastResults", e)
      },
      cycleUp: function () {
        this._cycle(-1)
      },
      cycleDown: function () {
        this._cycle(1)
      },
      _cycle: function (t) {
        var e = this.get("currentKeyedChoice"), i = this.get("currentMousedChoice"), o = s.isNumber(i) && -1 !== i, n = o ? i : e, a = this.get("numSuggestions"), r = (n + t) % a;
        a && (this.set({
          currentKeyedChoice: 0 > r ? a - 1 : r,
          currentMousedChoice: -1
        }), this.styleMenuItems(), this.set("interactive", this.get("currentKeyedChoice") >= 0), this.trigger("dropdown:menuInteraction", !0))
      },
      styleMenuItems: function (t) {
        var e, i = t && "mouseout" !== t.type, n = this.get("currentKeyedChoice");
        s.each(o(".item-option", this.$el), function (s, a) {
          i ? o(s).toggleClass("cycled", t.currentTarget === s) : (o(s).toggleClass("cycled", a === n), a === n && (e = o(s)))
        }, this)
      },
      handleMouseOver: function (t) {
        var e = o(t.currentTarget).index(".item-option");
        this.styleMenuItems(t), this.set({
          interactive: !0,
          currentMousedChoice: e
        }), this.trigger("dropdown:menuInteraction", !0)
      },
      handleMouseOut: function (t) {
        var e = -1 !== this.get("currentKeyedChoice");
        this.styleMenuItems(t), this.set({
          interactive: e,
          currentMousedChoice: -1
        }), this.trigger("dropdown:menuInteraction", e)
      },
      handleMouseClick: function (t) {
        this.set("interactive", !0), o(t.currentTarget).addClass("cycled"), this.trigger("dropdown:confirm")
      },
      getCurrentBlogChoice: function () {
        var t = this.get("lastResults");
        if (!this._rendered || s.isEmpty(t) || !("blogs" in t))return !1;
        var e = this.get("currentMousedChoice"), i = this.get("currentKeyedChoice"), o = 0;
        return e >= 0 ? o = e : i >= 0 && (o = i), t.blogs[o]
      },
      getBlogChoice: function (t) {
        var e = this.get("lastResults");
        return !1 === s.isEmpty(e) && "blogs" in e && e.blogs[t] ? e.blogs[t] : !1
      }
    });
    e.exports = p
  }, {
    "../models/mention": 245,
    "../templates/mention_dropdown.tpl": 281,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/accessor": 577,
    "prima/mixins/popoverbase": 583,
    "prima/mixins/selectorcache": 586,
    "prima/view": 612
  }],
  343: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("when"), a = t("velocity-animate").animate, r = t("app/components/post-form-builder/utils/transition_speed"), l = t("prima/lib/translate"), h = t("prima/view"), c = t("prima/mixins/selectorcache"), d = t("prima/mixins/accessor"), u = t("prima/mixins/popoverbase"), p = t("../templates/overlay_input.tpl"), m = h.extend({
      className: "overlay-input-popover",
      mixins: [c, d, u],
      template: p,
      events: {
        "keydown [data-js-input]": "_onKeyDown",
        "input [data-js-input]": "_onInput",
        "keyup [data-js-input]": "_onInput",
        "change [data-js-input]": "_onInput",
        "click [data-js-confirm]": "_onClickConfirm"
      },
      defaultOptions: {updateValueOnInput: !1, updateValueOnClose: !0, updateShift: !0},
      defaults: {value: "", placeholder: "", ariaLabel: "", maxLength: 2048, confirmText: l("Done")},
      initialize: function (t) {
        this.options = t = s.extend({}, this.defaultOptions, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), this.$pinnedContainer = o(t.pinnedTargetContainer)
      },
      _onKeyDown: function (t) {
        switch (t.which || t.keyCode) {
          case 13:
            this._onClickConfirm();
            break;
          case 27:
            t.stopPropagation(), this.teardown()
        }
      },
      _onInput: function () {
        this.options.updateValueOnInput && this._updateValueFromInput()
      },
      _onClickConfirm: function () {
        this._updateValueFromInput(), this.teardown()
      },
      _updateValueFromInput: function () {
        var t = this.js$("input").val();
        this.set("value", t)
      },
      openAnimation: function (t) {
        s.isNumber(t) || (t = r(100)), this._startWidth = this.$pinned.outerWidth(), this.js$("popover").width(this._startWidth);
        var e = this.$pinned.position().left;
        return s.isEmpty(this.$pinnedContainer) ? this._offsetLeft = 0 : this._offsetLeft = this.$pinnedContainer.offset().left - this.$pinned.offset().left + e || 0, this.options.updateShift && this.setShift(s.defaults({x: this._offsetLeft}, this.getShift())), n.all([a(this.$pinned, {opacity: 0}, {
          display: "none",
          duration: t
        }), a(this.js$("confirm"), {opacity: 1}, {duration: t}), a(this.js$("popover"), {
          marginLeft: this._offsetLeft,
          width: this._targetWidth
        }, {duration: t})])
      },
      pinnedRect: function () {
        var t = this.$pinned.css("display");
        this.$pinned.css("display", "block");
        var e = u.properties.defaults.pinnedRect.apply(this, arguments);
        return this.$pinned.css("display", t), e
      },
      closeAnimation: function (t) {
        return s.isNumber(t) || (t = r(100)), n.all([a(this.$pinned, {opacity: 1}, {
          display: "block",
          duration: t
        }), a(this.js$("confirm"), {opacity: 0}, {duration: t}), a(this.js$("popover"), {
          marginLeft: 0,
          width: this._startWidth
        }, {duration: t})])
      },
      serialize: function (t) {
        return this.toJSON()
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), s.isEmpty(this.$pinnedContainer) ? this._targetWidth = 520 : this._targetWidth = this.$pinnedContainer.outerWidth() - 20, this.setPinnedSide(!1), s.defer(s.bind(function () {
          this.openAnimation().then(s.bind(function () {
            this.js$("input").focus()
          }, this))
        }, this)), this
      },
      teardown: function () {
        return this.options.updateValueOnClose && this._updateValueFromInput(), this.stopListening(), this.closeAnimation().then(s.bind(function () {
          this.remove()
        }, this)), this
      }
    });
    e.exports = m
  }, {
    "../templates/overlay_input.tpl": 282,
    "app/components/post-form-builder/utils/transition_speed": 232,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/mixins/popoverbase": 583,
    "prima/mixins/selectorcache": 586,
    "prima/view": 612,
    "velocity-animate": "lWl/mc",
    when: "RG2dij"
  }],
  344: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("./media_dropzone"), n = t("./webcam_button"), a = t("app/components/webcam/utils/get_user_media"), r = o.extend({
      defaults: s.extend({enableSelfie: a}, o.prototype.defaults),
      events: s.extend({"click [data-js-webcamButton]": "_onClickWebcamButton"}, o.prototype.events),
      _onClickWebcamButton: function () {
        this.trigger("webcam:show")
      },
      afterRender: function () {
        if (o.prototype.afterRender.apply(this, arguments), this.get("enableSelfie")) {
          var t = this.subViews.webcamButton = new n;
          t.render().$el.appendTo(this.js$("mediaUpload").children(".split-cell-inner")), this.listenTo(this, "change:enableSelfie", function (e, i) {
            i || (t.teardown().remove(), this.subViews.webcamButton = null, this.stopListening(this, "change:enableSelfie"))
          })
        }
      }
    });
    e.exports = r
  }, {
    "./media_dropzone": 341,
    "./webcam_button": 375,
    "app/components/webcam/utils/get_user_media": 405,
    lodash: "MicNly"
  }],
  345: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("prima/events"), r = t("ligature"), l = t("prima/mixins/subviewable"), h = t("prima/mixins/selectorcache"), c = t("prima/mixins/accessor"), d = t("../templates/plaintext_editor.tpl"), u = n.extend({
      defaults: {
        placeholder: "",
        name: "",
        syncWithModel: !0,
        forceSingleLine: !1,
        smartQuotesEnabled: !1
      }, events: {}, mixins: [c, l, h], template: d, initialize: function (t) {
        this.set(t), this.onChange = t.onChange || s.noop, this.onClientEvent = t.onClientEvent || s.noop, this.pasteHook = t.pasteHook || s.noop, this.smartQuotesEnabled = t.smartQuotesEnabled, this.disableEdit = t.disableEdit || !1;
        var e = this.get("name");
        e && this.get("syncWithModel") && this.$el.attr("data-name", e)
      }, _initializeEditor: function (t, e) {
        var i = {
          placeholder: e,
          onChange: this._composeOnChange(),
          onClientEvent: this._composeOnClientEvent(),
          pasteHook: this.pasteHook,
          runIFrameSanitization: !0,
          forceSingleLine: this.get("forceSingleLine"),
          filterRules: {
            elements: ["p", "br"],
            attributes: {},
            remove_contents: ["style", "noscript", "script", "meta"],
            protocols: {}
          },
          smartQuotes: {enabled: this.smartQuotesEnabled}
        };
        this.editor = new r.PlainTextEditor(t, i), this.disableEdit && this.disable()
      }, _composeOnChange: function () {
        var t = [this.onChange], e = this;
        return this.get("syncWithModel") && t.unshift(this.updateModelFromEditor), function (i) {
          s.each(t, function (t) {
            t.call(e, i)
          })
        }
      }, _composeOnClientEvent: function () {
        var t = this.onClientEvent, e = this;
        return function (i) {
          a.trigger("plainTextEditor:onClientEvent", i, e.editor), t.call(this, i)
        }
      }, render: function () {
        this.$el.html(this.template({ariaLabel: this.get("ariaLabel")}));
        var t = this.js$("plainTextEditor").get(0);
        if (this._initializeEditor(t, this.get("placeholder")), this.get("syncWithModel")) {
          var e = this._modelValue().length > 0;
          e && this.set("placeholder", !1), this.updateEditorFromModel()
        }
        return this
      }, teardown: function () {
        return this.$el.empty(), delete this.editor, this
      }, serialize: function () {
        return this.toJSON()
      }, getEditorValue: function (t) {
        return "undefined" != typeof t || (t = !0), this.editor ? this.editor.getData(t) : null
      }, setEditorValue: function (t) {
        this.editor && this.editor.setData(t)
      }, updateModelFromEditor: function () {
        if (!this.editor)return !1;
        var t = this.get("name"), e = this.getEditorValue();
        "" !== e ? o(this.editor.element).addClass("has-text") : o(this.editor.element).removeClass("has-text"), this.model.get(t) !== e && this.model.set(t, e)
      }, updateEditorFromModel: function () {
        var t = this.getEditorValue(), e = this._modelValue();
        e.trim() && e.trim() !== t.trim() && this.setEditorValue(e)
      }, _modelValue: function () {
        return this.model.get(this.get("name")) || ""
      }, focus: function (t) {
        this.editor && this.editor.focus(t)
      }, blur: function () {
        this.editor && this.editor.element.blur()
      }, setCursorToEnd: function () {
        this.editor && s.isFunction(this.editor.setCursorToEnd) && this.editor.setCursorToEnd()
      }, enable: function () {
        o(this.editor.element).attr("contenteditable", !0)
      }, disable: function () {
        o(this.editor.element).removeAttr("contenteditable")
      }
    });
    e.exports = u
  }, {
    "../templates/plaintext_editor.tpl": 283,
    jquery: "HlZQrA",
    ligature: 652,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  346: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("when"), a = t("velocity-animate").animate, r = t("prima/utils/sequence-with-context"), l = t("prima/utils/bindendevent"), h = t("prima/lib/translate"), c = t("prima/view"), d = t("prima/events"), u = t("prima/mixins/subviewable"), p = t("prima/mixins/selectorcache"), m = t("prima/mixins/accessor"), g = t("./avatar"), _ = t("./tumblelog_select"), f = t("./post_settings"), v = t("./tag_editor"), b = t("./editor_buttons"), y = t("./social_buttons"), w = t("./save_post_button"), x = t("./allow_answers"), C = t("./error_bar"), k = t("./uploading_indicator"), S = t("./richtext_editor_tutorial"), T = t("./inline-controls-tutorial"), E = t("../services/content_stats_support"), $ = t("./post_type_form/_create"), M = t("../templates/post_form.tpl"), P = c.extend({
      className: "post-form",
      defaults: {
        useMediaReady: !1,
        showFooter: !0,
        hideControlsLine: !1,
        enabled: !0,
        locked: !1,
        saving: !1,
        hasRichTextTutorial: !1,
        hasInlineControlsTutorial: !1,
        hasImageSearchTutorial: !1,
        showRichTextTutorial: !1,
        showInlineControlsTutorial: !1,
        showImageSearchTutorial: !1,
        disablePhotoFromUrl: !1,
        closeLabel: null
      },
      events: {
        "click [data-js-clickableClose]": "_onClickClose",
        "click [data-js-clickableSave]": "_onClickSave",
        "mousedown [data-js-clickableClose]": "cancelEditorBlur",
        "mousedown [data-js-clickableSave]": "cancelEditorBlur",
        keydown: "_onKeyDown"
      },
      mixins: [u, p, m],
      template: M,
      _setup: function () {
        this.defaults.closeLabel = h("Close")
      },
      initialize: function (t) {
        this.options = t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), s.extend(this, s.pick(t, "post", "user", "uploads", "dragEvents")), s.extend(this.attributes, s.pick(this.post.attributes, ["mode"])), this.__onBeforeUnload = s.bind(this._onBeforeUnload, this)
      },
      _targetHandlesDrag: function (t) {
        var e = o(t);
        return s.isEmpty(e.closest(".editable-photoset")) && s.isEmpty(e.closest(".media-dropzone")) && s.isEmpty(e.closest("input")) && s.isEmpty(e.closest('[contenteditable="true"]')) ? !1 : !0
      },
      _onDragOver: function (t) {
        this._targetHandlesDrag(t.target) && !s.isEmpty(t.originalEvent.dataTransfer.files) && (t.originalEvent.dataTransfer.dropEffect = "copy"), t.preventDefault()
      },
      _onDrop: function (t) {
        this._targetHandlesDrag(t.target) || t.preventDefault()
      },
      _onModelChange: function () {
        this.subViews.errorBar.hideErrorBar()
      },
      _onChangeHideControlsLine: function (t, e) {
        this.$el.toggleClass("no-controls-line", e)
      },
      _onChangeShowFooter: function (t, e) {
        this.isRendered() && (e ? this.js$("footer").css({
          display: "block",
          opacity: 1
        }) : this.js$("footer").css({display: "none", opacity: 0}))
      },
      _onChangeEnabled: function (t, e) {
        e ? this.$el.removeClass("no-pointer-events") : this.$el.addClass("no-pointer-events")
      },
      _onChangeLocked: function (t, e) {
        e ? this.$$(".post-form--guard").addClass("visible") : this.$$(".post-form--guard").removeClass("visible")
      },
      _onClickClose: function (t) {
        this.options.redirectTo ? (o(window).off("beforeunload", this.__onBeforeUnload), window.location = this.options.redirectTo) : (this.resumeEditorBlur(), d.trigger("postForms:close"))
      },
      _onClickSave: function (t) {
        this.resumeEditorBlur(s.bind(this.save, this))
      },
      _onTypeSwitch: function (t, e) {
        this.post.set("type", t), this.trigger("postForms:changePostType", e)
      },
      _getCurrentRichTextEditor: function () {
        return this.postTypeForm ? this.postTypeForm.getRichTextEditor() : void 0
      },
      _getEditorType: function () {
        return this.model.get("editorType") || "rich"
      },
      _sendTutorialReadFlag: function () {
        o.ajax({url: "/svc/post/set_seen_rte", type: "POST", with_form_key: !0})
      },
      _setHasTutorialStates: function () {
        var t = s.contains(["text", "photo", "audio", "video", "link"], this.post.get("type"));
        this.set("hasRichTextTutorial", t && this.user.get("hasRichTextTutorial")), this.set("hasInlineControlsTutorial", t && this.user.get("hasInlineControlsTutorial")), this.set("hasImageSearchTutorial", t && this.user.get("hasImageSearchTutorial"))
      },
      _setShowRichTextTutorialState: function () {
        this.set("showRichTextTutorial", this.get("hasRichTextTutorial") && "rich" === this._getEditorType() && this.get("showFooter"))
      },
      _setShowInlineControlsTutorialState: function () {
        this.set("showInlineControlsTutorial", this.get("hasInlineControlsTutorial") && "rich" === this._getEditorType() && !this.get("hasRichTextTutorial"))
      },
      _setShowImageSearchTutorialState: function () {
        this.set("showImageSearchTutorial", this.get("hasImageSearchTutorial") && "rich" === this._getEditorType() && this.get("showFooter"))
      },
      _onChangeHasRichTextTutorial: function (t, e) {
        this.$el.toggleClass("has-richtext-tutorial", e)
      },
      _onChangeShowRichTextTutorial: function (t, e) {
        this.$el.toggleClass("show-richtext-tutorial", e), e && this.user.get("hasRichTextTutorial") && (this._sendTutorialReadFlag(), this.user.set("hasRichTextTutorial", !1))
      },
      _onRichTextTutorialRemoved: function (t) {
        var e, i = function (t) {
          this.set("hasRichTextTutorial", !1), this.$el.removeClass("closing-richtext-tutorial")
        };
        this.stopListening(t), this.stopListening(this, "change:showFooter", this._setShowRichTextTutorialState), this.stopListening(this.model, "change:editorType", this._setShowRichTextTutorialState), this.options.isModal ? s.defer(function () {
          l.animation(this.$el, i.bind(this)), this.$el.addClass("closing-richtext-tutorial")
        }.bind(this)) : i.call(this), e = this._getCurrentRichTextEditor(), e && e.focus(), this.set("showRichTextTutorial", !1)
      },
      _onInlineControlsTutorialHide: function (t) {
        this.stopListening(t), this.stopListening(this, "change:hasRichTextTutorial", this._setShowInlineControlsTutorialState), this.stopListening(this.model, "change:editorType", this._setShowInlineControlsTutorialState), this.user.set("hasInlineControlsTutorial", !1), t.remove()
      },
      _onImageSearchTutorialHide: function (t) {
        this.stopListening(t), this.stopListening(this.model, "change:editorType", this._setShowImageSearchTutorialState), this.user.set("hasImageSearchTutorial", !1), this._sendTutorialReadFlag(), t.remove()
      },
      _onChangeShowInlineControlsTutorial: function (t, e) {
        var i = this._getCurrentRichTextEditor(), s = this.options.supportImageSearch, o = s ? "animate-inline-controls-tutorial" : "animate-inline-controls-tutorial-original", n = h(s ? "Click the plus sign to insert photos, videos, reaction GIFs, horizontal lines, or read-more links." : "Click the plus sign to insert photos, videos, horizontal lines, or read-more links.");
        e && i ? (this.inlineControlsTutorial = new T({
          richTextEditor: i,
          animationClass: o,
          animationShowDelay: "text" === this.post.get("type") ? 500 : 750,
          title: h("But wait, there's more"),
          content: n
        }), this.listenToOnce(this.inlineControlsTutorial, "hide", this._onInlineControlsTutorialHide)) : this.inlineControlsTutorial && (this.inlineControlsTutorial.remove(), this.inlineControlsTutorial = null)
      },
      _onChangeShowImageSearchTutorial: function (t, e) {
        var i = this._getCurrentRichTextEditor();
        e && i ? (this.imageSearchTutorial = new T({
          richTextEditor: i,
          animationClass: "animate-image-search-tutorial",
          animationShowDelay: "text" === this.post.get("type") ? 500 : 750,
          title: h("GIF your words"),
          content: h("Hit this button. Type a word. Pick a GIF. Express thyself."),
          buttonLabel: h("Dare thee try it?")
        }), this.listenToOnce(this.imageSearchTutorial, {
          hide: this._onImageSearchTutorialHide, dismiss: function () {
            i.openImageSearch()
          }
        })) : this.imageSearchTutorial && (this.imageSearchTutorial.remove(), this.imageSearchTutorial = null)
      },
      _createContentStatsSupport: function () {
        this.contentStatsSupport && this.contentStatsSupport.remove(), this.contentStatsSupport = new E({
          model: this.model,
          editor: this._getCurrentRichTextEditor()
        })
      },
      getRect: function () {
        var t = this.$el.css("display");
        this.$el.css("display", "block");
        var e = this.$el.offset(), i = {};
        return i.offsetTop = e.top, i.offsetLeft = e.left, i.offsetHeight = this.$el.outerHeight(), i.offsetWidth = this.$el.outerWidth(), this.$el.css("display", t), i
      },
      measureHeight: function () {
        if (!this.isRendered())return void 0;
        var t = this.$el.css("display");
        this.$el.css("display", "block");
        var e = this.$el.outerHeight();
        return this.$el.css("display", t), e
      },
      animateShow: function (t, e) {
        t || (t = 0), e || (e = 0), t || this.js$("container-outer").css("opacity", 1);
        var i = [a(this.js$("container-outer"), {opacity: [1, 0]}, {duration: t}), a(this.js$("container-inner"), {translateY: [0, 10]}, {
          duration: t,
          delay: e,
          complete: function (t) {
            o(t).removeAttr("style")
          }
        })];
        return this.options.isModal && i.push(a(this.js$("margin"), {opacity: [1, 0]}, {duration: t})), this.avatar && this.avatar.updateViewState(), n.all(i)
      },
      animateHide: function (t, e) {
        t || (t = 0), e || (e = 0), t || this.js$("container-outer").css("opacity", 0), this.options.isModal || this.avatar.resetAvatar();
        var i = [];
        return this.js$("container-outer").length && this.js$("container-inner").length && (i.push(a(this.js$("container-outer"), {opacity: [0, 1]}, {duration: t})), i.push(a(this.js$("container-inner"), {translateY: [10, 0]}, {
          duration: t,
          delay: e
        }))), this.options.isModal && this.js$("margin").length && i.push(a(this.js$("margin"), {opacity: [0, 1]}, {duration: t})), n.all(i)
      },
      forceHidden: function () {
        return this.js$("container-outer").css("opacity", 0), this.options.isModal && this.js$("margin").css("opacity", 0), a(this.js$("container-inner"), {translateY: [10, 10]}, {duration: 0}), this
      },
      save: function (t) {
        if (!this.get("saving") || t) {
          var e;
          d.trigger("postForms:saving"), this.subViews.errorBar.hideErrorBar();
          var i = r([function () {
            !1 === this.model.isValid()
          }, function () {
            this.set({enabled: !1, locked: !0, saving: !0})
          }, function () {
          }, function () {
            try {
              this.model.set("contentStats", this.contentStatsSupport.getStats())
            } catch (t) {
            }
            return e = this.model.save(this.options)
          }, function () {
            this.set({enabled: !1, locked: !0, saving: !1, saved: !0})
          }], this).then(s.bind(function (t) {
            if (t = t.filter(function (t) {
                return t
              }), t.length && (t = t[0]), s.isEmpty(t.errors)) {
              if (this.options.redirectTo)o(window).off("beforeunload", this.__onBeforeUnload), window.location = this.options.redirectTo; else if (d.trigger("postForms:saved", {}, e), "reblog" === this.model.get("mode")) {
                var i = this.model.get("reblog_id"), n = window.Tumblr.Posts.find({id: i});
                n && (n.updateReblogControl(), d.trigger("post:reblog:set", {model: n}))
              }
            } else {
              var a = [];
              for (var r in t.errors)a.push(s.escape(t.errors[r]));
              this.set({enabled: !0, locked: !1, saving: !1, saved: !1});
              var l = a.join("<br>");
              this.subViews.errorBar.showErrorBar(l), d.trigger("postForms:error")
            }
          }, this));
          return i["catch"](s.bind(function (t) {
            this.set({enabled: !0, locked: !1, saving: !1, saved: !1}), d.trigger("postForms:error")
          }, this)), i
        }
      },
      createSubViews: function () {
        var t, e = ["showPhotoBooth", "supportImageSearch", "minFullWidthSize", "popoverContainer", "dragEvents"], i = s.extend({
          user: this.user,
          post: this.post,
          uploads: this.uploads,
          model: this.model
        }, s.pick(this.options, e), this.attributes), o = this.post.get("tumblelog");
        this.avatar = this.subViews.avatar = new g(s.extend(this.options.isModal ? {} : {
          determineViewState: !1,
          showSubavatar: this.user.getChannel(o).get("show_author_avatar"),
          avatarUrl: this.user.getChannel(o).get("avatar_url")
        }, i)), this.tumblelogSelect = this.subViews.tumblelogSelect = new _(i), this.postSettings = this.subViews.postSettings = new f(i), this.tagEditor = this.subViews.tagEditor = new v(i), this.editorButtons = this.subViews.editorButtons = new b(i), this.socialButtons = this.subViews.socialButtons = new y(i), this.savePostButton = this.subViews.savePostButton = new w(i), this.uploadIndicator = this.subViews.uploadingIndicator = new k(i), t = s.extend({}, i, {tagEditor: this.tagEditor}), this.postTypeForm = this.subViews.postTypeForm = $(t), this.set("useMediaReady", this.postTypeForm.get("hasMediaView")), this.listenTo(this.postTypeForm, "media:ready", function () {
          var t = s.toArray(arguments);
          t.unshift("media:ready"), this.trigger.apply(this, t)
        }), this.set("hideControlsLine", this.postTypeForm.get("hideControlsLine")), this.listenTo(this.postTypeForm, "change:hideControlsLine", function (t, e) {
          this.set("hideControlsLine", e)
        }), this.postTypeForm.has("showCaption") && (this.set("showFooter", this.postTypeForm.get("showCaption")), this.listenTo(this.postTypeForm, "change:showCaption", function (t, e) {
          this.set("showFooter", e)
        })), this.listenTo(d, "postForms:tumblelogSelectDropdown:open", function () {
          this.trigger("checkScrollSize"), this.trigger("pauseScrollHelper")
        }), this.listenTo(d, "postForms:tumblelogSelectDropdown:close", function () {
          this.trigger("checkScrollSize", !0), this.trigger("resumeScrollHelper")
        }), this.listenTo(this.savePostButton, "dropdown:intent", this.cancelEditorBlur), this.post.allowsTypeSwitch() && this.listenTo(this.postTypeForm, "switchPostType", this._onTypeSwitch), this.subViews.allowAnswers = new x(i), this.subViews.errorBar = new C, this._setHasTutorialStates(), this._setShowRichTextTutorialState(), this._setShowInlineControlsTutorialState(), this._setShowImageSearchTutorialState(), this.get("hasRichTextTutorial") && (this.richTextEditorTutorial = this.subViews.richTextEditorTutorial = new S, this.listenToOnce(this.richTextEditorTutorial, "removed", this._onRichTextTutorialRemoved), this.listenTo(this, "change:showFooter", this._setShowRichTextTutorialState), this.listenTo(this.model, "change:editorType", this._setShowRichTextTutorialState)), this.get("hasInlineControlsTutorial") && (this.listenTo(this, "change:hasRichTextTutorial", this._setShowInlineControlsTutorialState), this.listenTo(this.model, "change:editorType", this._setShowInlineControlsTutorialState)), this.get("hasImageSearchTutorial") && (this.listenTo(this, "change:showFooter", this._setShowImageSearchTutorialState), this.listenTo(this.model, "change:editorType", this._setShowImageSearchTutorialState))
      },
      addStateListeners: function () {
        this.listenTo(this, "change:hideControlsLine", this._onChangeHideControlsLine), this.listenTo(this, "change:showFooter", this._onChangeShowFooter), this.listenTo(this, "change:enabled", this._onChangeEnabled), this.listenTo(this, "change:locked", this._onChangeLocked), this.listenTo(this.model, "change", this._onModelChange), this.listenTo(this.dragEvents, "dragover", this._onDragOver), this.listenTo(this.dragEvents, "drop", this._onDrop), this.listenTo(this.tagEditor, "postForms:focusOnNextEditor", this.focusOnNextEditor), this.listenTo(this, "change:showRichTextTutorial", this._onChangeShowRichTextTutorial), this.listenTo(this, "change:hasRichTextTutorial", this._onChangeHasRichTextTutorial), this.listenTo(this, "change:showInlineControlsTutorial", this._onChangeShowInlineControlsTutorial), this.listenTo(this, "change:showImageSearchTutorial", this._onChangeShowImageSearchTutorial)
      },
      serialize: function () {
        return this.toJSON()
      },
      beforeRender: function () {
        this.dragEvents.start(), this.createSubViews(), this.addStateListeners(), o(window).on("beforeunload", this.__onBeforeUnload)
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.attachSubViews(), this.post.get("type") && this.$el.addClass("post-form--" + this.post.get("type")), this.user.get("hasGifSearchVariation") && this.$el.addClass("gif-search-variation"), this
      },
      afterRender: function () {
        this.$el.toggleClass("no-controls-line", this.get("hideControlsLine")), this.get("showFooter") || this.js$("footer").css({
          display: "none",
          opacity: 0
        }), this.renderSubViews(), this._onChangeHasRichTextTutorial(this, this.get("hasRichTextTutorial")), this._onChangeShowRichTextTutorial(this, this.get("showRichTextTutorial")), this._onChangeShowInlineControlsTutorial(this, this.get("showInlineControlsTutorial")), this._onChangeShowImageSearchTutorial(this, this.get("showImageSearchTutorial")), this._createContentStatsSupport()
      },
      teardown: function () {
        return this.dragEvents.stop(), this.stopListening(), this.contentStatsSupport && this.contentStatsSupport.remove(), this.inlineControlsTutorial && this.inlineControlsTutorial.remove(), o(window).off("beforeunload", this.__onBeforeUnload), this
      },
      remove: function () {
        return this.teardown(), c.prototype.remove.apply(this, arguments)
      },
      _onKeyDown: function (t) {
        this.focusOnNextEditor(t), this.keyboardSave(t)
      },
      focusOnNextEditor: function (t) {
        if (9 === t.keyCode) {
          var e = this.$el.find(".editor[contenteditable]:visible, .post-form--close, .post-form--save-button .create_post_button:enabled"), i = o.inArray(t.target, e);
          if (-1 !== i) {
            t.preventDefault();
            var s = (i + (t.shiftKey ? -1 : 1)) % e.length;
            0 > s && (s += e.length), o(e[s]).focus()
          }
        }
      },
      keyboardSave: function (t) {
        var e = /Mac/.test(navigator.platform) ? t.metaKey : t.ctrlKey;
        13 === t.keyCode && e && this.post.isValid() && (t.preventDefault(), t.stopPropagation(), this.save())
      },
      _onBeforeUnload: function () {
        if (this.model.deepHasChanged(this.get("initialPostState"))) {
          var t = h("Sure you want to leave this page without saving? Your post will be discarded.");
          return "edit" === this.model.get("mode") && (t = h("Sure you want to leave this page without saving? All your edits will be lost.")), t
        }
      },
      cancelEditorBlur: function () {
        var t = this._getCurrentRichTextEditor();
        t && t.cancelBlur()
      },
      resumeEditorBlur: function (t) {
        var e = this._getCurrentRichTextEditor();
        e && s.isFunction(e.resumeBlur) ? e.resumeBlur(t) : s.isFunction(t) && t()
      }
    });
    e.exports = P
  }, {
    "../services/content_stats_support": 255,
    "../templates/post_form.tpl": 284,
    "./allow_answers": 323,
    "./avatar": 326,
    "./editor_buttons": 328,
    "./error_bar": 329,
    "./inline-controls-tutorial": 333,
    "./post_settings": 348,
    "./post_type_form/_create": 351,
    "./richtext_editor_tutorial": 363,
    "./save_post_button": 364,
    "./social_buttons": 366,
    "./tag_editor": 367,
    "./tumblelog_select": 371,
    "./uploading_indicator": 374,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/utils/bindendevent": 593,
    "prima/utils/sequence-with-context": 609,
    "prima/view": 612,
    "velocity-animate": "lWl/mc",
    when: "RG2dij"
  }],
  347: [function (t, e, i) {
    "use strict";
    var s = t("prima/view"), o = t("../templates/post_preview.tpl"), n = s.extend({
      template: o,
      initialize: function (t) {
        this.options = t
      },
      render: function () {
        return this.$el.html(this.template(this.options)), this
      }
    });
    e.exports = n
  }, {"../templates/post_preview.tpl": 285, "prima/view": 612}],
  348: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/subviewable"), a = t("prima/mixins/selectorcache"), r = t("../templates/post_settings.tpl"), l = t("./post_settings_dropdown"), h = o.extend({
      className: "post-form--post-settings-button",
      events: {"click [data-js-clickablePostSettingsCog]": "togglePostSettingsDropdown"},
      mixins: [n, a],
      template: r,
      initialize: function (t) {
        t = s.extend({}, t, {
          shift: {x: 0, y: 10},
          identifier: "postForms:postSettingsDropdown"
        }), this.postSettingsDropdown = new l(t)
      },
      render: function () {
        return this.$el.html(this.template()), this.postSettingsDropdown.setPinnedTarget(this.js$("postSettingsCog")), this
      },
      togglePostSettingsDropdown: function (t) {
        this.postSettingsDropdown.isOrWasRecentlyRendered() || this.postSettingsDropdown.render()
      }
    });
    e.exports = h
  }, {
    "../templates/post_settings.tpl": 286,
    "./post_settings_dropdown": 349,
    lodash: "MicNly",
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  349: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/lib/translate"), a = t("prima/events"), r = t("prima/lib/flags"), l = t("app/components/dialog"), h = t("prima/mixins/accessor"), c = t("prima/mixins/selectorcache"), d = t("prima/mixins/popoverbase"), u = t("app/mixins/tumblrselect"), p = t("../templates/post_settings_dropdown.tpl"), m = o.extend({
      className: "popover--post-settings-dropdown",
      defaults: {
        textFields: ["customUrl", "sourceUrl", "postDate"],
        checkboxFields: ["allowPhotoReplies"],
        selectFields: ["editorType"]
      },
      mixins: [h, c, d, u],
      template: p,
      initialize: function (t) {
        this.options = t = s.extend({}, t),
          s.extend(this, s.pick(t, ["post", "user", "uploads"]))
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.setupTextInputFields(), this.setupCheckboxInputFields(), this.setupSelectFields(), this.delegateEvents(), a.trigger("postForms:dismissListener:suspend"), this
      },
      teardown: function () {
        return this.$el.remove(), a.trigger("postForms:dismissListener:resume"), this
      },
      serialize: function () {
        return s.extend({
          showEditorSelection: "chat" !== this.post.get("type"),
          showPhotoRepliesOption: !r.bool("disable_public_replies")
        }, this.model.toJSON())
      },
      setupTextInputFields: function () {
        s.each(this.get("textFields"), function (t) {
          var e = this["$" + t] = this.js$(t);
          return "sourceUrl" === t && this.model.isReblog() ? void e.attr("readonly", !0) : (e.on("input", s.bind(function (t) {
            this.model.set(e.attr("name"), e.val())
          }, this)), void e.on("keydown", s.bind(function (t) {
            var e = t.which || t.keyCode;
            13 === e && this.teardown()
          }, this)))
        }, this)
      },
      setupCheckboxInputFields: function () {
        s.each(this.get("checkboxFields"), function (t) {
          var e = this["$" + t] = this.js$(t), i = e.attr("name");
          e.prop("checked", !!this.model.get(i)), e.on("change", s.bind(function (o) {
            var n = "_onChange" + s.camelCase("-" + t);
            s.isFunction(this[n]) ? this[n]() : this.model.set(i, e.prop("checked"))
          }, this))
        }, this)
      },
      setupSelectFields: function () {
        s.each(this.get("selectFields"), function (t) {
          var e = this["$" + t] = this.js$(t), i = e.attr("name");
          this.setUpSelector(e), e.children('[value="' + this.model.get(i) + '"]').attr("selected", !0), e.trigger("change"), e.on("change", s.bind(function (o) {
            var n = "_onChange" + s.camelCase("-" + t);
            s.isFunction(this[n]) ? this[n]() : this.model.set(i, e.val())
          }, this))
        }, this)
      },
      setupInputListeners: function () {
        var t = this.get("checkboxFields");
        s.each(this.get("inputSelectorNames"), function (e) {
          var i = this["$" + e];
          i.on("change", s.bind(function (s) {
            var o = -1 !== t.indexOf(e) ? i.prop("checked") : i.val();
            this.model.set(i.attr("name"), o)
          }, this))
        }, this)
      },
      _onChangeEditorType: function (t) {
        var e = this.model.get("editorType"), i = this.js$("editorType").val();
        if (!e)return void this.model.set("editorType", this.user.get("defaultEditorType") || "rich");
        if (e !== i)if ("rich" !== e && "rich" === i && this.model.get("htmlEdited")) {
          var o = {
            text: n("%1$sGoing back to normal?%2$sYou might lose any code that doesn't get along with our text editor.%3$s", "<h3>", "</h3><small>", "</small>"),
            keycommand_maintain: !0
          };
          l.confirm(o, s.bind(function () {
            this.js$("editorType").blur(), this.model.set({htmlEdited: !1, editorType: i}), this._delayedClose()
          }, this))
        } else s.defer(s.bind(function () {
          this.model.set("editorType", i)
        }, this)), this._delayedClose()
      },
      _delayedClose: function (t) {
        s.isNumber(t) || (t = 50), s.delay(s.bind(function () {
          this.teardown()
        }, this), t)
      }
    });
    e.exports = m
  }, {
    "../templates/post_settings_dropdown.tpl": 287,
    "app/components/dialog": 44,
    "app/mixins/tumblrselect": 461,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/flags": "f/LVtH",
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/mixins/popoverbase": 583,
    "prima/mixins/selectorcache": 586,
    "prima/view": 612
  }],
  350: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("prima/mixins/accessor"), r = t("prima/mixins/subviewable"), l = t("../../templates/post_type_form/_audio_search_results.tpl"), h = n.extend({
      defaults: {
        currentChoice: -1,
        serviceResults: {},
        showCopyrightWarning: !1
      },
      events: {
        "click .clear-results": "clearResults",
        "click .result": "_clickedChoice",
        "mouseover .result": "resetCurrentChoice"
      },
      mixins: [a, r],
      template: l,
      initialize: function () {
        this.listenTo(this, "change:serviceResults", function (t) {
          t.trigger("searchResults:updated", t._getResultCount())
        }), this.listenTo(this, "change:currentChoice", this._styleResults)
      },
      updateResultsForService: function (t) {
        var e = this.get("serviceResults"), i = s.clone(e);
        i[t.service] = t.tracks, this.set("serviceResults", i), !1 === s.isEqual(e, t) && (this.resetCurrentChoice(), this.teardown(), this.render())
      },
      handleMenuCommand: function (t) {
        var e = o(".result", this.$el), i = this.get("currentChoice");
        if ("confirm" === t) {
          if (-1 !== i) {
            var s = o(e[this.get("currentChoice")]), n = s.attr("data-href"), a = s.hasClass("audio-result") ? "searchResults:selectAudio" : "searchResults:selectVideo";
            this.trigger(a, n)
          }
        } else {
          var r = "cycleUp" === t ? -1 : 1, l = (this.get("currentChoice") + r + e.length) % e.length;
          this.set("currentChoice", l)
        }
      },
      render: function () {
        var t = s.extend(s.pick(this.attributes, "serviceResults"), {
          resultCount: this._getResultCount(),
          copyrightWarningMessage: this.get("copyrightWarningMessage") || "",
          showCopyrightWarning: !!this.get("showCopyrightWarning")
        });
        return this.$el.html(this.template(t)), this
      },
      teardown: function () {
        return this.$el.empty(), this
      },
      reset: function () {
        this.set("serviceResults", {})
      },
      resetCurrentChoice: function () {
        this.set("currentChoice", -1)
      },
      clearResults: function () {
        this.trigger("searchResults:clear")
      },
      hasResults: function () {
        return this._getResultCount() > 0
      },
      setCopyrightWarningMessage: function (t) {
        this.set("copyrightWarningMessage", t)
      },
      _clickedChoice: function (t) {
        var e = o(t.currentTarget).attr("data-href"), i = t.currentTarget.classList.contains("audio-result") ? "searchResults:selectAudio" : "searchResults:selectVideo";
        this.trigger(i, e)
      },
      _getResultCount: function () {
        return s.reduce(this.get("serviceResults"), function (t, e) {
          return t + (s.isArray(e) ? e.length : 0)
        }, 0)
      },
      _styleResults: function (t, e) {
        s.each(o(".result", t.$el), function (t, i) {
          o(t).toggleClass("cycled", i === e)
        })
      }
    });
    e.exports = h
  }, {
    "../../templates/post_type_form/_audio_search_results.tpl": 288,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  351: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = {
      text: t("./text"),
      photo: t("./photo"),
      link: t("./link"),
      quote: t("./quote"),
      chat: t("./chat"),
      audio: t("./audio"),
      video: t("./video"),
      note: t("./note")
    }, n = t("./text"), a = function (t) {
      var e, i;
      return s.isPlainObject(t) ? e = t.model : (e = t, t = {model: e}), new (i = o[e.get("type")] || n)(t)
    };
    e.exports = a
  }, {
    "./audio": 352,
    "./chat": 354,
    "./link": 355,
    "./note": 356,
    "./photo": 357,
    "./quote": 358,
    "./text": 359,
    "./video": 360,
    lodash: "MicNly"
  }],
  352: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("./base"), n = t("prima/lib/translate"), a = (t("prima/lib/logger"), t("../../templates/post_type_form/audio.tpl")), r = t("../plaintext_editor"), l = t("./_audio_search_results"), h = t("../audio_uploader"), c = t("../media/audio"), d = t("../confirm_tos"), u = t("../richtext_editor"), p = t("../reblog_tree"), m = t("../../services/audio_search_service"), g = t("app/components/dialog"), _ = o.extend({
      defaults: s.defaults({
        maxSearchResults: 4,
        showSearchField: !0,
        showAudioUploader: !0,
        showSearchResultList: !1,
        showCopyrightWarning: !1,
        hasMediaView: !0,
        hasMedia: !1,
        showTos: !1,
        showCaption: !1
      }, o.prototype.defaults), template: a, afterInitialize: function () {
        this.searchService = new m, (this.post.get("url") || "new" !== this.post.get("mode")) && this.set({
          hasMedia: !0,
          showCaption: !0,
          showSearchField: !1,
          showAudioUploader: !1,
          showSearchResultList: !1,
          showCopyrightWarning: !1
        })
      }, createSubViews: function () {
        var t = this.subViewOptions(), e = s.extend({
          className: "audio-search-field",
          placeholder: n("Search for a song or paste a URL"),
          ariaLabel: n("Search for a song or paste a URL"),
          name: "search",
          forceSingleLine: !0,
          onClientEvent: s.bind(this.handleSearchMenuKeys, this)
        }, t), i = s.extend({}, t), o = {className: "audio-search-results-field"}, a = s.extend({
          url: this.post.get("url"),
          service: this.post.get("service"),
          albumArt: this.post.get("albumArt"),
          canEditMedia: this.post.canEditMedia()
        }, t);
        this.post.get("bandcamp") && s.extend(a, this.post.get("bandcamp"));
        var m = s.extend({}, t), g = s.extend({
          className: "caption-field",
          name: "caption",
          placeholder: n("Add a description, if you like"),
          ariaLabel: n("Description")
        }, t), _ = s.extend({isRemovable: !0}, t);
        this.searchField = this.subViews.searchField = new r(e), this.audioUploader = this.subViews.audioUploader = new h(i), this.searchResultList = this.subViews.searchResultList = new l(o), this.mediaPreview = this.subViews.mediaPreview = new c(a), this.confirmTos = this.subViews.confirmTos = new d(m), this.caption = this.subViews.caption = new u(g), this.post.isReblog() && (this.reblogTree = this.subViews.reblogTree = new p(_))
      }, addStateListeners: function () {
        this.listenTo(this.audioUploader, "upload:start", this._onFileUploadStart), this.listenTo(this.audioUploader, "upload:complete", this._onFileUploadComplete), this.listenTo(this.audioUploader, "upload:error upload:invalid", this._onFileUploadError), this.searchResultList.listenTo(this.searchService, "searchResults:fetched", this.searchResultList.updateResultsForService), this.listenTo(this.searchService, "audioEmbedData:fetched", this._onAudioEmbedDataFetched), this.searchResultList.listenTo(this.searchField, "searchField:menuKey", this.searchResultList.handleMenuCommand), this.listenTo(this.searchResultList, "searchResults:updated", function (t) {
          var e = s.isEmpty(this.post.get("url")) && t > 0;
          this.set("showSearchResultList", e)
        }), this.listenTo(this.searchResultList, "searchResults:selectAudio", this.setAudioContentFromUrl), this.listenTo(this.searchResultList, "searchResults:selectVideo", this.switchToVideoPost), this.listenTo(this.searchResultList, "searchResults:clear", function () {
          this.set("showCopyrightWarning", !1), this.post.unset("copyrightFallback")
        }), this.searchField.listenTo(this.searchResultList, "searchResults:clear", function () {
          this.setEditorValue(""), this.focus()
        }), this.listenTo(this.mediaPreview, "media:ready", function () {
          var t = s.toArray(arguments);
          t.unshift("media:ready"), this.trigger.apply(this, t)
        }), this.post.canEditMedia() && this.listenTo(this.mediaPreview, "media:remove", this.removeMedia), this.listenTo(this.post, "change:search", s.debounce(this._onChangeSearchInput, 200)), this.listenTo(this, "change:showSearchField", this._onChangeShowSearchField), this.listenTo(this, "change:showAudioUploader", this._onChangeShowAudioUploader), this.listenTo(this, "change:showSearchResultList", this._onChangeShowSearchResultList), this.listenTo(this, "change:hasMedia", this._onChangeHasMedia), this.listenTo(this, "change:showTos", this._onChangeShowTos), this.listenTo(this, "change:showCaption", this._onChangeShowCaption), this.listenTo(this, "change:showCopyrightWarning", this._onChangeShowCopyrightWarning)
      }, removeMedia: function () {
        this.searchResultList.hasResults() || this.searchField.setEditorValue(""), this.post.softReset();
        var t = s.isEmpty(this.post.get("search"));
        this.set({
          hasMedia: !1,
          showSearchField: !0,
          showSearchResultList: !t,
          showAudioUploader: t,
          showTos: !1
        }), this.mediaPreview.set({
          url: "",
          service: ""
        }), this.js$("confirmTos").attr("checked", !!this.post.get("confirmTos")), s.isEmpty(this.post.get("caption")) && s.isEmpty(this.post.get("tags")) && this.set("showCaption", !1), this.searchField.focus()
      }, _onChangeShowSearchField: function (t, e) {
        this.searchField.$el.css({display: e ? "block" : "none", opacity: e ? 1 : 0})
      }, _onChangeShowAudioUploader: function (t, e) {
        this.audioUploader.$el.css({display: e ? "block" : "none", opacity: e ? 1 : 0})
      }, _onChangeShowSearchResultList: function (t, e) {
        this.searchResultList.$el.css({display: e ? "block" : "none", opacity: e ? 1 : 0})
      }, _onChangeShowCopyrightWarning: function (t, e) {
        this.searchResultList.set("showCopyrightWarning", e)
      }, _onChangeHasMedia: function (t, e) {
        this.isRendered() && (e ? this.mediaPreview.$el.css({
          display: "block",
          opacity: 1
        }) : this.mediaPreview.$el.css({display: "none", opacity: 0}))
      }, _onChangeShowTos: function (t, e) {
        this.isRendered() && (e ? this.js$("tos").css({
          display: "block",
          opacity: 1
        }) : this.js$("tos").css({display: "none", opacity: 0}))
      }, _onChangeShowCaption: function (t, e) {
        this.isRendered() && (e ? this.js$("caption").css({
          display: "block",
          opacity: 1
        }) : this.js$("caption").css({display: "none", opacity: 0}))
      }, setAudioContent: function (t, e, i) {
        s.isObject(t) && (i = t, t = ""), i = s.extend({
          preuploadUrl: "",
          url: (t || "").replace(/\u200B/g, ""),
          service: e
        }, i), ("bandcamp" !== e || i.id && i.type) && (this.mediaPreview.set(i), this.post.set(s.pick(i, ["url", "preuploadUrl", "service", "albumArt", "preuploadAlbumArt", "trackTitle", "trackArtist", "trackAlbum"])))
      }, setAudioContentFromUrl: function (t, e, i) {
        e || (e = this.searchService.getServiceByUrl(t)), i || (i = {}), this.setAudioContent(t, e, i), this.set({
          hasMedia: !0,
          showCaption: !0,
          showSearchField: !1,
          showSearchResultList: !1,
          showAudioUploader: !1,
          showTos: !s.isEmpty(i.preuploadUrl)
        }), this.caption.focus()
      }, _onChangeSearchInput: function (t, e) {
        e || (e = "");
        var i = s.isEmpty(e) ? !1 : this.searchService.getServiceByUrl(e);
        if (i)"direct" === i ? this.setAudioContentFromUrl(e, i) : this.searchService.getData(e, i), this.post.unset("search"); else if (s.isEmpty(e))this.searchResultList.reset(), this.set("showAudioUploader", this.get("showSearchField")); else {
          if (this.set("showAudioUploader", !1), this.get("showCopyrightWarning")) {
            if (e === this.post.get("copyrightFallback"))return;
            this.set("showCopyrightWarning", !1), this.post.unset("copyrightFallback"), this.searchResultList.reset()
          }
          this._executeAudioSearches(e)
        }
      }, _executeAudioSearches: function (t, e, i) {
        e = s.isArray(e) ? e : this.searchService.searchServices, s.forEach(e, function (e) {
          this.searchService.search(e, t, i)
        }, this)
      }, _onAudioEmbedDataFetched: function (t, e, i) {
        s.isObject(t) && (i = t, t = i.url), this.setAudioContentFromUrl(t, e, i)
      }, handleSearchMenuKeys: function (t) {
        var e, i = ["keyup", "keydown"], s = {13: "confirm", 38: "cycleUp", 40: "cycleDown"};
        return t = t || window.event, -1 !== i.indexOf(t.type) && (e = t.which || t.keyCode, e in s) ? ("keydown" === t.type && 13 === e && t.stopImmediatePropagation(), this.searchResultList.isRendered() && "keyup" !== t.type && (this.searchField.trigger("searchField:menuKey", s[e]), t.preventDefault()), !1) : void 0
      }, _onFileUploadStart: function (t) {
        this.uploads.add(t)
      }, _onFileUploadComplete: function (t) {
        var e = {preuploadUrl: t.get("url")}, i = t.get("album_art_url");
        i && (e.preuploadAlbumArt = !0, e.albumArt = i);
        var o = t.get("id3");
        s.isObject(o) && (e.trackTitle = o.Title, e.trackArtist = o.Artist, e.trackAlbum = o.Album), this.setAudioContentFromUrl(e.preuploadUrl, "direct", e)
      }, _onFileUploadError: function (t) {
        var e = t.get("responseJSON");
        if (e) {
          var i = parseInt(s.get(e, "meta.status"), 10), o = s.get(e, "response.is_copyright");
          if (403 === i && o)return void this.uploadFailedCopyright(s.get(e, "response"))
        }
        var a = t.get("error") || n("Error uploading audio");
        s.isArray(a) && (a = a.join("</p><p>")), g.alert("<p>" + a + "</p>")
      }, afterRender: function () {
        this.renderSubViews(), s.forEach({
          showSearchField: this.searchField,
          showAudioUploader: this.audioUploader,
          showSearchResultList: this.searchResultList,
          hasMedia: this.mediaPreview
        }, function (t, e) {
          this.get(e) || t.$el.css({display: "none", opacity: 0})
        }, this), this.get("showTos") || this.js$("tos").css({
          display: "none",
          opacity: 0
        }), this.get("showCaption") ? this.delayedFocus(this.caption) : (this.delayedFocus(this.searchField), this.js$("caption").css({
          display: "none",
          opacity: 0
        }))
      }, uploadFailedCopyright: function (t) {
        var e = "new" === this.post.get("mode") ? ["spotify", "soundcloud", "youtube"] : ["spotify", "soundcloud"], i = {maxResults: 3};
        this.searchResultList.setCopyrightWarningMessage(t.message), this.set({
          showCopyrightWarning: !0,
          showAudioUploader: !1
        }), this.subViews.searchField.setEditorValue(t.search_string), this.post.set("copyrightFallback", t.search_string), this._executeAudioSearches(t.search_string, e, i), this.searchField.focus()
      }, switchToVideoPost: function (t) {
        var e = {
          postParams: {type: "video", copyrightFallback: this.post.get("copyrightFallback")},
          afterReload: function (e) {
            e.postTypeForm.executeUrlParser(t)
          }
        };
        this.trigger("switchPostType", "video", e)
      }, getRichTextEditor: function () {
        return this.caption
      }
    });
    e.exports = _
  }, {
    "../../services/audio_search_service": 254,
    "../../templates/post_type_form/audio.tpl": 289,
    "../audio_uploader": 325,
    "../confirm_tos": 327,
    "../media/audio": 335,
    "../plaintext_editor": 345,
    "../reblog_tree": 361,
    "../richtext_editor": 362,
    "./_audio_search_results": 350,
    "./base": 353,
    "app/components/dialog": 44,
    lodash: "MicNly",
    "prima/lib/logger": 553,
    "prima/lib/translate": 575
  }],
  353: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("prima/mixins/subviewable"), r = t("prima/mixins/selectorcache"), l = t("prima/events"), h = t("prima/utils/image/types"), c = s.template(""), d = o.extend({
      template: c,
      mixins: [n, a, r],
      defaults: {hasMediaView: !1, hideControlsLine: !1},
      defaultOptions: {supportImageSearch: !1, minFullWidthSize: {}},
      initialize: function (t) {
        if (this.options = t = s.extend({}, this.defaultOptions, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), !t.post)throw new Error("PostFormView requires a Post model!");
        if (!t.user)throw new Error("PostFormView requires a User model");
        s.extend(this, s.pick(t, ["post", "user", "uploads"])), s.isFunction(this.afterInitialize) && this.afterInitialize.apply(this, arguments)
      },
      createSubViews: function () {
      },
      subViewOptions: function () {
        return s.extend({}, s.pick(this.options, "supportImageSearch", "minFullWidthSize", "dragEvents"), s.pick(this, "model", "uploads", "user", "post"))
      },
      addStateListeners: function () {
      },
      getRichTextEditor: function () {
      },
      serialize: function () {
        return s.extend({canEditMedia: this.post.canEditMedia()}, this.post.toJSON(), this.toJSON())
      },
      teardown: function () {
        return this.stopListening(), this.$el.empty(), this
      },
      beforeRender: function () {
        this.createSubViews(), this.addStateListeners()
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.attachSubViews(), this
      },
      registerTitleKeyboardShortcut: function (t) {
        var e = /Mac/.test(navigator.platform) ? "meta" : "ctrl";
        return this.listenTo(l, "DOMEventor:keydown:" + e + "+shift+1", function () {
          t.focus()
        }), t
      },
      delayedFocus: function (t, e, i) {
        "undefined" != typeof i || (i = !0), "number" == typeof e || (e = 200), s.delay(s.bind(function () {
          t.focus(i), i && t.setCursorToEnd()
        }, this), e || 0)
      },
      getMinFullWidthSize: function (t) {
        var e = this.options.minFullWidthSize || {};
        return s.isEmpty(e) ? null : s.isNumber(e) ? e : (t = h.convertToNormalizedType(t), s.has(e, t) ? e[t] : null)
      }
    });
    e.exports = d
  }, {
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/utils/image/types": 606,
    "prima/view": 612
  }],
  354: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/lib/translate"), a = t("./base"), r = t("ligature").SelectionPersistence, l = t("../plaintext_editor"), h = t("../../templates/post_type_form/chat.tpl"), c = /^([^(:|\n)]+:)/, d = a.extend({
      template: h,
      placeholders: ["%1$sFirefighter:%2$s That's the way the cookie crumbles.%3$s%1$sButler:%2$s It falls on me to reassemble the cookie.", "%1$sStockbroker:%2$s I need a vacation.%3$s%1$sTourist:%2$s I'm already on one.%3$s%1$sStockbroker:%2$s Get out of my office.", "%1$sAbbott:%2$s Who is the man on first base?%3$s%1$sCostello:%2$s That's what I'm telling you!%3$s%1$sAbbott:%2$s I'm unqualified to manage a baseball team.", "%1$sRick:%2$s Our problems don't amount to a hill of beans in this crazy world.%3$s%1$sIlsa:%2$s Great, now I'm hungry for beans.", "%1$sAlbert Einstein:%2$s Energy equals mass times the speed of light squared.%3$s%1$sCop:%2$s Tell it to the judge.", "%1$sAxl:%2$s Welcome to the jungle.%3$s%1$sCustomer:%2$s We'd like a table for two, please.%3$s%1$sAxl:%2$s Your table is right this way.", "%1$sTourist:%2$s Could you give us directions to Olive Garden?%3$s%1$sNew Yorker:%2$s No, but I could give you directions to an actual Italian restaurant.", "%1$sPangloss:%2$s Could you give me directions to the Olive Garden?%3$s%1$sCandide:%2$s No, but we can cultivate our own garden.%3$s%1$sPangloss:%2$s That sounds rational to me.", "%1$sCharles Dickens:%2$s It was the best of mimes, it was the worst of mimes.%3$s%1$sMime:%2$s ...", "%1$sJuliet:%2$s Romeo, Romeo, wherefore art thou, Romeo?%3$s%1$sRomeo:%2$s I'm right here, Juliet.?%3$s%1$sJuliet:%2$s Wherefore means why not where.%3$s%1$sRomeo:%2$s Misunderstandings like these are what define our relationship.", "%1$sSeal:%2$s Did you know that when it snows my eyes become larger?%3$s%1$sOptometrist:%2$s That's highly abnormal. I'm going to refer you to a specialist.%3$s%1$sSeal:%2$s BABAAAAAAAYYYY!", "%1$sSeal:%2$s There's so much a man can tell you, so much he can say.%3$s%1$sMan:%2$s I've just been waiting for someone to ask!", "%1$sUsher:%2$s These are my confessions.%3$s%1$sTheater-goer:%2$s These are my tickets.%3$s%1$sUsher:%2$s Right this way."],
      afterInitialize: function () {
        this.user.get("language") && "en_US" !== this.user.get("language") ? (this._placeholders = s.filter(this.placeholders, function (t) {
          return n(t) !== t
        }), s.isEmpty(this._placeholders) && (this._placeholders = this.placeholders)) : this._placeholders = this.placeholders
      },
      randomPlaceholder: function () {
        var t = s.sample(this._placeholders || this.placeholders);
        return n(t, "<b>", "</b>", "<br>")
      },
      createSubViews: function () {
        var t = this.subViewOptions(), e = s.extend({
          className: "title-field",
          name: "title",
          isResizable: !0,
          placeholder: n("Title"),
          ariaLabel: n("Post title"),
          allowLinebreaks: !1
        }, t), i = s.extend({
          className: "chat-field normal",
          name: "chat",
          placeholder: this.randomPlaceholder(),
          onChange: s.bind(function (t) {
            this.formatText()
          }, this),
          ariaLabel: n("Post body"),
          convertNewlinesToLinebreaks: !0
        }, t);
        this.title = this.subViews.title = new l(e), this.chat = this.subViews.chat = new l(i), this.registerTitleKeyboardShortcut(this.title)
      },
      afterRender: function () {
        this.renderSubViews(), this.model.get("chat") && this.formatText(), this.delayedFocus(this.chat)
      },
      formatText: function () {
        this.chat.getEditorValue() && this.formatTextNode(this.chat.editor.element)
      },
      formatTextNode: function (t) {
        if (t) {
          if (t.nodeType !== Node.TEXT_NODE)return void s.each(t.childNodes, s.bind(function (t) {
            this.formatTextNode(t)
          }, this));
          if (this.stripZeroWidthSpaceFromNode(t), "B" === t.parentNode.tagName)return void this.cleanBoldNode(t.parentNode);
          if (!(o(t).prev().length > 0 && "BR" !== o(t).prev()[0].tagName)) {
            var e = t.nodeValue.match(c);
            if (e) {
              var i = r.saveSelection(this.chat.editor.element), n = t.parentNode;
              if (s.isObject(n)) {
                var a = e[0];
                t.nodeValue = t.nodeValue.replace(c, "");
                var l = document.createElement("b");
                l.innerHTML = a, n.insertBefore(l, t)
              }
              r.restoreSelection(i)
            }
          }
        }
      },
      cleanBoldNode: function (t) {
        if ("B" === t.tagName)if (t.childNodes.length > 1)for (; t.childNodes.length > 1 && t.innerHTML.match(/<br\s*[\/]?>/);)t.parentNode.insertBefore(t.firstChild, t); else {
          var e = t.firstChild;
          if (-1 === e.nodeValue.indexOf(":"))return void this.unwrapNode(t);
          var i = /:(.+)$/, s = e.nodeValue.match(i);
          if (s) {
            var o = r.saveSelection(this.chat.editor.element), n = s[1], a = document.createTextNode(n);
            e.nodeValue = e.nodeValue.replace(/:(.+)$/, ":"), t.parentNode.insertBefore(a, t.nextSibling), r.restoreSelection(o)
          }
        }
      },
      unwrapNode: function (t) {
        var e = r.saveSelection(this.chat.editor.element), i = t.parentNode, s = t.firstChild, o = s.nodeValue;
        o && (i.insertBefore(s, t.nextSibling), i.normalize()), t.remove(), this.formatTextNode(i), r.restoreSelection(e)
      },
      stripZeroWidthSpaceFromNode: function (t) {
        var e = /\u200B/g;
        if (t && t.nodeType === Node.TEXT_NODE && t.nodeValue.match(e)) {
          var i = r.saveSelection(this.chat.editor.element);
          t.nodeValue = t.nodeValue.replace(e, ""), Math.max(i.start, i.end) > t.nodeValue.length && (i.start = i.end = t.nodeValue.length), r.restoreSelection(i)
        }
      }
    });
    e.exports = d
  }, {
    "../../templates/post_type_form/chat.tpl": 290,
    "../plaintext_editor": 345,
    "./base": 353,
    jquery: "HlZQrA",
    ligature: 652,
    lodash: "MicNly",
    "prima/lib/translate": 575
  }],
  355: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/lib/translate"), a = t("./base"), r = t("../../templates/post_type_form/link.tpl"), l = t("../plaintext_editor"), h = t("../richtext_editor"), c = t("../reblog_tree"), d = t("app/components/remove-button"), u = t("../../services/open_graph_service"), p = t("../../utils/validation"), m = t("prima/utils/url"), g = t("prima/utils/image/loader"), _ = a.extend({
      className: "link-post",
      events: {
        "mouseenter [data-js-removable=true]": "_onHoverRemoveButton",
        "mouseleave [data-js-removable=true]": "_onHoverRemoveButton",
        "mouseleave .media-container": "_onHoverRemoveButton"
      },
      template: r,
      defaults: o.defaults({
        hasMedia: !1,
        showCaption: !1,
        ogFetchPending: !1,
        tagEditor: null,
        hasCustomTags: !1,
        numOgTags: 5
      }, a.prototype.defaults),
      afterInitialize: function () {
        this._ogService = new u, "new" !== this.model.get("mode") && this.set({
          hasMedia: !0,
          hasCustomTags: !0
        }), this.model.has("caption") && this.set("showCaption", !0), this.set("hideControlsLine", !this.get("showCaption")), this.tagEditor = this.get("tagEditor")
      },
      afterRender: function () {
        this.renderSubViews(), this.model.canEditMedia() || (this.title.disable(), this.excerpt.disable(), this.url.disable(), this._hideEmptyFields()), this._onChangeThumbnail(this.model, this.model.get("thumbnail")), this._onChangeAuthor(this.model, this.model.get("author")), this._onChangeHasMedia(this, this.get("hasMedia")), this._onChangeShowCaption(this, this.get("showCaption")), this._onChangeShortUrl(this.model, this.model.get("url")), "new" !== this.model.get("mode") || o.isEmpty(this.model.get("url")) || (this.url.setEditorValue(this.model.get("url")), this._onChangeUrl(this.model, this.model.get("url"))), this.trigger("media:ready"), this.get("showCaption") ? this.delayedFocus(this.caption) : this.delayedFocus(this.url)
      },
      createSubViews: function () {
        var t = this.subViewOptions(), e = o.extend({
          className: "title",
          name: "title",
          isResizable: !1,
          placeholder: n("Enter a title"),
          ariaLabel: n("Link title"),
          forceSingleLine: !0
        }, t), i = o.extend({
          className: "summary",
          name: "excerpt",
          isResizable: !1,
          placeholder: n("Enter a summary"),
          ariaLabel: n("Link summary"),
          forceSingleLine: !1
        }, t), s = o.extend({
          className: "url",
          isResizable: !1,
          placeholder: n("Type or paste a URL"),
          ariaLabel: n("Type or paste a URL"),
          forceSingleLine: !0,
          pasteHook: o.bind(this._onPaste, this),
          onClientEvent: o.bind(this._onUrlClientEvent, this),
          onChange: o.bind(o.debounce(this._onUrlEditorChange, 500), this)
        }, t), a = o.extend({
          className: "caption",
          name: "caption",
          placeholder: n("Add a description, if you like"),
          ariaLabel: n("Description")
        }, t), r = o.extend({isRemovable: !0}, t);
        this.url = this.subViews.url = new l(s), this.title = this.subViews.title = new l(e), this.excerpt = this.subViews.excerpt = new l(i), this.caption = this.subViews.caption = new h(a), this.removeButton = this.subViews.removeButton = new d({buttonClass: "top-right"}), this.model.isReblog() && (this.reblogTree = this.subViews.reblogTree = new c(r))
      },
      addStateListeners: function () {
        "reblog" !== this.model.get("mode") && this.listenTo(this.model, "change:url", this._onChangeUrl), this.listenTo(this, "change:ogFetchPending", this._onChangeFetchPending), this.listenTo(this, "change:hasMedia", this._onChangeHasMedia), this.listenTo(this, "change:showCaption", this._onChangeShowCaption), this.listenTo(this.model, "change:thumbnail", this._onChangeThumbnail), this.listenTo(this.model, "change:url", this._onChangeShortUrl), this.listenTo(this.model, "change:author", this._onChangeAuthor), this.listenTo(this.model, "change:tagInput", this._onTagInputChange), this.listenTo(this.removeButton, "remove", this._onRemoveClick)
      },
      removeThumbnail: function () {
        this.model.unset("thumbnail")
      },
      removeMedia: function () {
        this.model.softReset(), this.title.setEditorValue(""), this.excerpt.setEditorValue(""), this.url.setEditorValue(""), this.tagEditor && !this.get("hasCustomTags") && this.tagEditor.removeTags(), o.isEmpty(this.model.get("caption")) && (this.caption.setEditorValue(""), o.isEmpty(this.model.get("tags")) && this.set("showCaption", !1)), this.set("hasMedia", !1), this.url.focus()
      },
      getRichTextEditor: function () {
        return this.caption
      },
      _onHoverRemoveButton: function (t) {
        var e = s(t.relatedTarget || t.toElement), i = "mouseover" === t.type || "mouseenter" === t.type;
        (i || 0 === e.parents('[data-subview="removeButton"]').length && 0 === e.parents("[data-js-removable=true]").length) && this.js$("removeButton").toggleClass("active", i)
      },
      _onChangeThumbnail: function (t, e) {
        var i = this.js$("image"), n = !o.isEmpty(e);
        this.js$("media").toggleClass("has-thumbnail", n), this.js$("article").attr("data-js-removable", !n), this.$(".publisher-container").attr("data-js-removable", n), i.attr("data-js-removable", n), i.empty(), n && i.append(s("<img />").attr("src", e)), "reblog" !== this.model.get("mode") && (n ? this.model.unset("remove_thumbnail") : this.model.set("remove_thumbnail", !0))
      },
      _onUrlClientEvent: function (t) {
        this.get("ogFetchPending") && "keydown" === t.type && 27 === t.keyCode && (this._cancelOpenGraphFetch(), t.stopPropagation(), t.preventDefault())
      },
      _onUrlEditorChange: function () {
        var t = this.url.getEditorValue(), e = this._normalizeUrl(t);
        o.isEmpty(e) || e === this.model.get("url") || this.model.set("url", e)
      },
      _onPaste: function (t) {
        var e, i;
        o.isEmpty(this.url.getEditorValue()) && (e = t.getData("text/plain"), i = this._normalizeUrl(e), o.isEmpty(i) || this.model.set("url", i))
      },
      _shouldShowThumbnail: function (t) {
        var e = this.getMinFullWidthSize(m.getExtension(t.src));
        return o.isNumber(e) && o.has(t, "width") && t.width >= e
      },
      _onChangeFetchPending: function (t, e) {
        this.model.set("loading", e)
      },
      setPostData: function (t) {
        t = t || {}, o.has(t, "title") && this.title.setEditorValue(t.title), o.has(t, "excerpt") && this.excerpt.setEditorValue(t.excerpt), o.has(t, "thumbnail") && this.model.set("thumbnail", t.thumbnail), o.has(t, "author") && this.model.set("author", t.author), o.has(t, "tags") && (o.each(t.tags, function (t) {
          this.tagEditor.addTag(t.toLowerCase())
        }, this), o.isEmpty(t.tags) || this.tagEditor.removePlaceholder())
      },
      _normalizeUrl: function (t) {
        return o.isString(t) ? (t = t.trim(), t = m.addProtocolIfMissing(t, "http:"), p.isUrl(t) ? t : null) : null
      },
      _onChangeUrl: function (t, e) {
        this.get("ogFetchPending") || p.isUrl(e) && (this.set("ogFetchPending", !0), this._ogService.fetchOpenGraphData(e).then(o.bind(this._updateWithGraphInfo, this), o.bind(this._onOpenGraphFail, this)))
      },
      _onChangeShortUrl: function (t, e) {
        if (p.isUrl(e))try {
          var i, s = m.parseUrl(e);
          s && o.has(s, "host") && (i = s.host.replace(/^www\./i, ""), this.js$("publisher").attr("href", e).text(i))
        } catch (n) {
        }
      },
      _onChangeAuthor: function (t, e) {
        var i = o.isEmpty(e) ? "" : n("By %1$s", e);
        this.js$("author").text(i).toggle(!o.isEmpty(e))
      },
      _onTagInputChange: function (t, e) {
        e && this.set("hasCustomTags", !0)
      },
      _updateWithGraphInfo: function (t) {
        var e = t.image, i = function (e) {
          var i, s = {title: t.title, excerpt: t.description, author: t.author, thumbnail: e ? "" : t.image};
          !this.get("hasCustomTags") && o.has(t, "tags") && (i = this._parseOpenGraphTags(t.tags), o.extend(s, {tags: i.slice(0, this.get("numOgTags"))})), this.setPostData(s), this.set({
            hasMedia: !0,
            showCaption: !0,
            ogFetchPending: !1
          }), this.delayedFocus(this.caption)
        };
        o.isEmpty(e) ? i.call(this, !1) : g.load(e).then(o.bind(function (t) {
          i.call(this, !this._shouldShowThumbnail(t))
        }, this), o.bind(function () {
          i.call(this, !0)
        }, this))
      },
      _onOpenGraphFail: function () {
        this.set({hasMedia: !0, showCaption: !0, ogFetchPending: !1}), this.delayedFocus(this.caption)
      },
      _cancelOpenGraphFetch: function () {
        this._ogService.abort()
      },
      _parseOpenGraphTags: function (t) {
        return t = o.isString(t) ? t.split(",") : t, o.isArray(t) ? t : []
      },
      _onRemoveClick: function () {
        this.model.get("thumbnail") ? this.removeThumbnail() : this.removeMedia()
      },
      _onChangeHasMedia: function (t, e) {
        this.$el.toggleClass("has-media", e), this.js$("media").toggle(e), this.url.$el.toggle(!e), this.removeButton.$el.toggle(e && this.model.canEditMedia())
      },
      _onChangeShowCaption: function (t, e) {
        this.set("hideControlsLine", !e), this.js$("caption").toggle(e)
      },
      _hideEmptyFields: function () {
        this.title.$el.toggle(!o.isEmpty(this.model.get("title"))), this.excerpt.$el.toggle(!o.isEmpty(this.model.get("excerpt")))
      }
    });
    e.exports = _
  }, {
    "../../services/open_graph_service": 261,
    "../../templates/post_type_form/link.tpl": 291,
    "../../utils/validation": 321,
    "../plaintext_editor": 345,
    "../reblog_tree": 361,
    "../richtext_editor": 362,
    "./base": 353,
    "app/components/remove-button": 385,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/utils/image/loader": 605,
    "prima/utils/url": 611
  }],
  356: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("./base"), a = t("../ask_field"), r = t("../richtext_editor"), l = t("../reblog_tree"), h = t("../../templates/post_type_form/note.tpl"), c = n.extend({
      template: h,
      className: "post-composer_note-post",
      createSubViews: function () {
        var t = this.subViewOptions(), e = s.extend({
          className: "answer-field",
          name: "answer",
          placeholder: o("Your answer here"),
          ariaLabel: o("Answer")
        }, t), i = s.extend({
          className: "caption-field",
          name: "caption",
          placeholder: o("Add your own text, if you like"),
          ariaLabel: o("Caption")
        }, t), n = s.extend({isRemovable: !0}, t);
        this.askField = this.subViews.askField = new a(t), this.post.isReblog() ? (this.reblogTree = this.subViews.reblogTree = new l(n), this.caption = this.subViews.caption = new r(i)) : this.answerField = this.subViews.answerField = new r(e)
      },
      afterRender: function () {
        this.renderSubViews(), this.post.isReblog() ? this.delayedFocus(this.caption) : this.delayedFocus(this.answerField)
      },
      getRichTextEditor: function () {
        return this.model.get("is_reblog") ? this.caption : this.answerField
      }
    });
    e.exports = c
  }, {
    "../../templates/post_type_form/note.tpl": 292,
    "../ask_field": 324,
    "../reblog_tree": 361,
    "../richtext_editor": 362,
    "./base": 353,
    lodash: "MicNly",
    "prima/lib/translate": 575
  }],
  357: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("./base"), n = t("app/components/dialog"), a = (t("prima/lib/logger"),
      t("prima/lib/translate")), r = t("prima/utils/url"), l = t("prima/lib/data"), h = "FileReader" in window && "readAsDataURL" in FileReader.prototype, c = t("../../utils/validation"), d = t("../../models/photo"), u = t("../media/photo"), p = t("../photo_media_dropzone"), m = t("../richtext_editor"), g = t("../reblog_tree"), _ = t("../../templates/post_type_form/photo.tpl"), f = 2048, v = o.extend({
      template: _,
      defaults: s.defaults({
        hasMediaView: !0,
        hasMedia: !1,
        canAddMedia: !0,
        showPhotoBooth: !1,
        showCaption: !1,
        disablePhotoFromUrl: !1
      }, o.prototype.defaults),
      afterInitialize: function () {
        this._urlParser = s.debounce(s.bind(this._photoUrlParser, this), 100), !this.post.photos.isEmpty() || this.post.isReblog() ? this.set({
          hasMedia: !0,
          showCaption: !0
        }) : (this.post.get("caption") || !s.isEmpty(this.post.get("tags"))) && this.set("showCaption", !0), this.set("canAddMedia", this.post.canEditMedia() && this.post.canAddPhotos()), this.set("hideControlsLine", !this.get("showCaption"))
      },
      _photoUrlParser: function (t, e, i) {
        if (t = s.trim(t), t && t.length < f && c.isUrl(t)) {
          var o = new d;
          this.listenTo(o, "photo:readUrl", function (t, i) {
            t && this.post.canAddPhotos() && (this.post.photos.push(i), e.urlInput.setEditorValue(""), e.urlInput.blur(), e.set({
              showInput: !1,
              dropzoneBehavior: "url",
              defaultBehavior: "url"
            }))
          }), o.set("externalUrl", t)
        }
      },
      createSubViews: function () {
        var t = this.subViewOptions(), e = s.extend({canEditMedia: this.post.canEditMedia()}, t), i = s.extend({
          toggleDropzone: this.get("hasMedia"),
          dropzoneText: a("Add another"),
          uploadIcon: "dropzone-add-photo-icon",
          uploadText: a("Upload photos"),
          urlIcon: "dropzone-add-url-icon",
          urlText: a("Add photo from web"),
          urlPlaceholder: a("Paste a URL"),
          urlAriaLabel: a("Paste a URL"),
          urlParser: this._urlParser,
          uploadOptions: {}
        }, t);
        s.extend(i.uploadOptions, {
          name: "photo",
          maxUploadSize: 10485760,
          uploadPattern: /^image\/(?:.*)$/i,
          accept: "image/*",
          url: "/svc/post/upload_photo",
          fileUpload: {multiple: !0}
        });
        var o = s.extend({
          className: "caption-field",
          name: "caption",
          placeholder: a("Add a caption, if you like"),
          ariaLabel: a("Caption")
        }, t), n = s.extend({isRemovable: !0}, t);
        this.mediaPreview = this.subViews.mediaPreview = new u(e), this.mediaComposer = this.subViews.mediaComposer = new p(i), this.caption = this.subViews.caption = new m(o), this.post.isReblog() && (this.reblogTree = this.subViews.reblogTree = new g(n))
      },
      addStateListeners: function () {
        this.listenTo(this.mediaComposer, "upload:start", this._onFileUploadStart), this.listenTo(this.mediaComposer, "upload:complete", this._onFileUploadComplete), this.listenTo(this.mediaComposer, "upload:error upload:invalid", this._onFileUploadError), this.listenTo(this.mediaComposer, "webcam:show", function () {
          this.set("showPhotoBooth", !0)
        }), this.listenTo(this.post.photos, "add", this._onAddPhotos), this.listenTo(this.post.photos, "remove", this._onRemovePhotos), this.listenTo(this.mediaPreview, "media:ready", function () {
          var t = s.toArray(arguments);
          t.unshift("media:ready"), this.trigger.apply(this, t)
        }), this.listenTo(this.mediaPreview, "media:addFiles", function (t) {
          this.mediaComposer.addFiles(t)
        }), this.listenTo(this.mediaPreview, "webcam:close", function () {
          this.set("showPhotoBooth", !1)
        }), this.listenTo(this.mediaPreview, "webcam:error", function (t) {
          "NO_DEVICES_FOUND" === t && (n.alert({
            text_ok: a("Aw, alright"),
            text: "<p>" + a("Sorry, beautiful. If you wanna take a selfie, you're gonna need a webcam.") + "</p>"
          }), this.mediaComposer.set("enableSelfie", !1))
        }), this.listenTo(this, "change:hasMedia", this._onChangeHasMedia), this.listenTo(this, "change:canAddMedia", this._onChangeCanAddMedia), this.listenTo(this, "change:showPhotoBooth", this._onChangeShowPhotoBooth), this.listenTo(this, "change:showCaption", this._onChangeShowCaption)
      },
      _onAddPhotos: function (t, e) {
        this.set({
          hasMedia: !this.post.photos.isEmpty(),
          canAddMedia: this.post.canAddPhotos()
        }), s.isEmpty(this.post.get("caption")) && s.isEmpty(this.post.get("tags")) ? this.set("showCaption", this.get("hasMedia")) : this.set("showCaption", !0), this.get("showCaption") && this.caption.focus(), this.mediaComposer.set({toggleDropzone: !this.post.photos.isEmpty()})
      },
      _onRemovePhotos: function (t, e) {
        this.set({
          hasMedia: !this.post.photos.isEmpty() || this.get("showPhotoBooth"),
          canAddMedia: this.post.canAddPhotos()
        }), this.mediaComposer.set({toggleDropzone: !this.post.photos.isEmpty()})
      },
      _onChangeHasMedia: function (t, e) {
        this.isRendered() && (e ? this.mediaPreview.$el.css({
          display: "block",
          opacity: 1
        }) : this.mediaPreview.$el.css({display: "none", opacity: 0}))
      },
      _onChangeCanAddMedia: function (t, e) {
        this.isRendered() && (this.mediaPreview.$el.toggleClass("photo-media-container--can-add", e), e ? this.mediaComposer.$el.css({
          display: "block",
          opacity: 1
        }) : this.mediaComposer.$el.css({display: "none", opacity: 0}))
      },
      _onChangeShowPhotoBooth: function (t, e) {
        this.isRendered() && (this.mediaPreview.set("showPhotoBooth", e), this.mediaPreview.$el.toggleClass("photo-media-container--show-photobooth", e), e ? (this.mediaPreview.$el.css({
          display: "block",
          opacity: 1
        }), this.mediaComposer.$el.css({
          display: "none",
          opacity: 0
        })) : (this._onChangeHasMedia(this, this.get("hasMedia")), this._onChangeCanAddMedia(this, this.get("canAddMedia"))))
      },
      _onChangeShowCaption: function (t, e) {
        this.set("hideControlsLine", !e), this.isRendered() && (e ? this.js$("caption").css({
          display: "block",
          opacity: 1
        }) : this.js$("caption").css({display: "none", opacity: 0}))
      },
      _onFileUploadStart: function (t) {
        if (!s.isEmpty(t.get("error")))return this._onFileUploadError(t);
        this.uploads.add(t);
        var e = t.get("file");
        this.mediaPreview.set({file: e, canEditMedia: !0});
        var i = new d;
        h ? this.listenTo(i, "photo:readFile", function (t, e) {
          t && this.post.canAddPhotos() && (this.post.photos.push(e), this.mediaComposer.set({
            dropzoneBehavior: "upload",
            defaultBehavior: "upload"
          }))
        }) : this.listenTo(i, "change:preuploadUrl", function (t, e) {
          e && (this.stopListening(t, "change:preuploadUrl"), this.post.canAddPhotos() && (this.post.photos.push(t), this.mediaComposer.set({
            dropzoneBehavior: "upload",
            defaultBehavior: "upload"
          })))
        }), t.set("postPhoto", i), i.set("upload", t), i.set("file", e)
      },
      _onFileUploadComplete: function (t) {
        var e = t.get("postPhoto");
        e && (t.get("url") ? e.set("preuploadUrl", t.get("url")) : (n.alert("<p>" + [t.get("original_filename"), a(t.get("error"))].join("</p><p>") + "</p>"), this.post.photos.remove(e)))
      },
      _onFileUploadError: function (t) {
        var e = t.get("error");
        s.isString(e) && (e = [e]), s.isArray(e) || (e = [a("Woops :(")]), t.get("file") && t.get("file").name && e.unshift(t.get("file").name), n.alert("<p>" + e.join("</p><p>") + "</p>");
        var i = t.get("postPhoto");
        this.post.photos.remove(i), this.uploads.remove(t)
      },
      afterRender: function () {
        this.get("disablePhotoFromUrl") || this.checkUrl(), this.renderSubViews(), this.get("canAddMedia") ? this.mediaPreview.$el.addClass("photo-media-container--can-add") : this.mediaComposer.$el.css({
          display: "none",
          opacity: 0
        }), this.get("hasMedia") || this.mediaPreview.$el.css({
          display: "none",
          opacity: 0
        }), this.get("showCaption") ? this.delayedFocus(this.caption) : this.js$("caption").css({
          display: "none",
          opacity: 0
        }), this.get("showPhotoBooth") && s.defer(s.bind(function () {
          this._onChangeShowPhotoBooth(this, this.get("showPhotoBooth"))
        }, this))
      },
      checkUrl: function () {
        var t = r.getParameter("src"), e = r.getParameter("caption"), i = r.getParameter("tags");
        r.isAbsoluteUrl(t) || (t = l.get("Context.hosts.assets_host") + t), "edit" !== this.model.get("mode") && t && e && i && (this._photoUrlParser(t, this.mediaComposer), this.model.set("caption", e), this.model.set("tags", i.split(",")), this.get("disablePhotoFromUrl") || window.Backbone.history.navigate("/new/photo", {replace: !0}))
      },
      getRichTextEditor: function () {
        return this.caption
      }
    });
    e.exports = v
  }, {
    "../../models/photo": 247,
    "../../templates/post_type_form/photo.tpl": 293,
    "../../utils/validation": 321,
    "../media/photo": 339,
    "../photo_media_dropzone": 344,
    "../reblog_tree": 361,
    "../richtext_editor": 362,
    "./base": 353,
    "app/components/dialog": 44,
    lodash: "MicNly",
    "prima/lib/data": 548,
    "prima/lib/logger": 553,
    "prima/lib/translate": 575,
    "prima/utils/url": 611
  }],
  358: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("../../utils/string_helpers"), a = t("./base"), r = t("../plaintext_editor"), l = t("../richtext_editor"), h = t("../../templates/post_type_form/quote.tpl"), c = a.extend({
      defaults: s.defaults({fontSizes: ["extra_large", "large", "medium", "small"]}, a.prototype.defaults),
      template: h,
      afterInitialize: function () {
        this.listenTo(this.model, "change:quote", this.updateQuoteSize), this.wrapSource()
      },
      createSubViews: function () {
        var t = this.subViewOptions(), e = s.extend({
          className: "quote-field",
          name: "quote",
          placeholder: "&ldquo;" + o("Quote") + "&rdquo;",
          ariaLabel: o("Quote")
        }, t), i = s.extend({
          className: "source-field",
          name: "source",
          placeholder: o("Source"),
          ariaLabel: o("Source")
        }, t);
        s.extend(i, {fullWidthInlineMedia: !1}), this.quote = this.subViews.quote = new r(e), this.source = this.subViews.source = new l(i)
      },
      afterRender: function () {
        return this.renderSubViews(), this.updateQuoteSize(this.model, this.model.get("quote") || ""), s.isEmpty(this.model.get("source")) ? this.delayedFocus(this.quote) : this.delayedFocus(this.source), this.quote.editor.isEmpty() && this.quote.editor.setData(""), this.cleanQuote(), this
      },
      teardown: function () {
        return this.$el.empty(), this
      },
      updateQuoteSize: function (t, e) {
        if ("string" == typeof e) {
          var i = e.length;
          20 > i ? this._setQuoteSize("extra_large") : 81 > i ? this._setQuoteSize("large") : 300 > i ? this._setQuoteSize("medium") : this._setQuoteSize("small")
        }
      },
      _setQuoteSize: function (t) {
        var e = this.quote.$el;
        e.hasClass(t) || (e.removeClass(this.get("fontSizes").join(" ")), e.addClass(t))
      },
      cleanQuote: function () {
        var t = this.model.get("quote");
        t && this.model.set("quote", n.stripHtml(t, !1))
      },
      getRichTextEditor: function () {
        return this.source
      },
      wrapSource: function () {
        var t = this.model.get("source");
        !t || t.indexOf("<p>") > -1 || this.model.set("source", "<p>" + t + "</p>")
      }
    });
    e.exports = c
  }, {
    "../../templates/post_type_form/quote.tpl": 294,
    "../../utils/string_helpers": 320,
    "../plaintext_editor": 345,
    "../richtext_editor": 362,
    "./base": 353,
    lodash: "MicNly",
    "prima/lib/translate": 575
  }],
  359: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/translate"), n = t("prima/lib/flags"), a = t("./base"), r = t("../plaintext_editor"), l = t("../reblog_tree"), h = t("../richtext_editor"), n = t("prima/lib/flags"), c = t("../../templates/post_type_form/text.tpl"), d = a.extend({
      events: {},
      template: c,
      createSubViews: function () {
        var t = this.subViewOptions(), e = this.post.isReblog(), i = e && n.bool("reblog_ui_refresh"), a = s.extend({
          className: "title-field",
          name: "title",
          placeholder: o("Title"),
          ariaLabel: o("Post title"),
          smartQuotesEnabled: !0,
          disableEdit: i
        }, t), c = s.extend({
          className: "caption-field",
          name: "body",
          placeholder: o("Your text here"),
          ariaLabel: o("Post body")
        }, t), d = s.extend({isRemovable: !0, origType: this.post.get("type")}, t);
        i && "text" === this.post.get("type") ? this.title = this.subViews.title = null : this.title = this.subViews.title = new r(a), this.body = this.subViews.body = new h(c), e && (this.reblogTree = this.subViews.reblogTree = new l(d)), this.registerTitleKeyboardShortcut(this.title)
      },
      afterRender: function () {
        this.renderSubViews(), this.delayedFocus(this.body)
      },
      getRichTextEditor: function () {
        return this.body
      }
    });
    e.exports = d
  }, {
    "../../templates/post_type_form/text.tpl": 295,
    "../plaintext_editor": 345,
    "../reblog_tree": 361,
    "../richtext_editor": 362,
    "./base": 353,
    lodash: "MicNly",
    "prima/lib/flags": "f/LVtH",
    "prima/lib/translate": 575
  }],
  360: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("moment"), a = t("./base"), r = t("app/components/dialog"), l = (t("prima/lib/logger"), t("prima/lib/flags")), h = t("prima/lib/translate"), c = t("../../services/embed_data"), d = t("prima/utils/camelize-keys"), u = function () {
      return o.browser.chrome ? ".mp4,.mov,.wmv,video/*" : o.browser.mozilla ? "video/*" : ""
    }(), p = t("../media/video"), m = t("../media_dropzone"), g = t("../confirm_tos"), _ = t("../richtext_editor"), f = t("../reblog_tree"), v = t("../../templates/post_type_form/video.tpl"), b = a.extend({
      template: v,
      maxVideoFileSize: 104857600,
      defaults: s.defaults({hasMediaView: !0, hasMedia: !1, showTos: !1, showCaption: !1}, a.prototype.defaults),
      afterInitialize: function () {
        this._urlParser = s.debounce(s.bind(this._embedCodeParser, this), 100), this.post.getEmbedData() && this.set({
          hasMedia: !0,
          showCaption: !0
        }), this.post.get("copyrightFallback") && this.set({hasMedia: !0}), this.set("hideControlsLine", !this.get("showCaption"))
      },
      createSubViews: function () {
        var t = this.subViewOptions(), e = s.extend({
          embed: this.post.getEmbedData(),
          canEditMedia: this.post.canEditMedia()
        }, t), i = s.extend({
          url: this.post.get("embedCode"),
          showInput: !s.isEmpty(this.post.get("embedCode")),
          embed: this.post.getEmbedData(),
          uploadIcon: "dropzone-add-video-icon",
          uploadText: h("Upload a video"),
          uploadTooltip: function () {
            var e = 1e3 * t.user.get("videoSecondsRemaining");
            return "<p>" + ["<strong>" + h("Upload a video") + "</strong>", h("%1$s minutes of video remaining today.", n.utc(e).format("m:ss")), h("%1$s max per file.", "100MB")].join("</p><p>") + "</p>"
          },
          urlIcon: "dropzone-add-url-icon",
          urlText: h("Add video from web"),
          urlPlaceholder: h("Paste a URL or embed code"),
          urlParser: this._urlParser,
          uploadOptions: {}
        }, t);
        s.extend(i.uploadOptions, {
          name: "video",
          maxUploadSize: l.bool("ignore_video_upload_limits") ? !1 : this.maxVideoFileSize,
          uploadPattern: /^video\/(?:.*)$/i,
          accept: u,
          url: "/svc/post/upload_video"
        });
        var o = s.extend({}, t), a = s.extend({
          className: "caption-field",
          name: "caption",
          placeholder: h("Add a caption, if you like"),
          ariaLabel: h("Caption")
        }, t), r = s.extend({isRemovable: !0}, t);
        this.mediaPreview = this.subViews.mediaPreview = new p(e), this.mediaComposer = this.subViews.mediaComposer = new m(i), this.confirmTos = this.subViews.confirmTos = new g(o), this.caption = this.subViews.caption = new _(a), this.post.isReblog() && (this.reblogTree = this.subViews.reblogTree = new f(r))
      },
      addStateListeners: function () {
        this.listenTo(this.mediaComposer, "upload:start", this._onFileUploadStart), this.listenTo(this.mediaComposer, "upload:complete", this._onFileUploadComplete), this.listenTo(this.mediaComposer, "upload:error upload:invalid", this._onFileUploadError), this.listenTo(this.mediaPreview, "media:ready", function () {
          var t = s.toArray(arguments);
          t.unshift("media:ready"), this.trigger.apply(this, t)
        }), this.post.canEditMedia() && this.listenTo(this.mediaPreview, "media:remove", this.removeMedia), this.listenTo(this, "change:hasMedia", this._onChangeHasMedia), this.listenTo(this, "change:showTos", this._onChangeShowTos), this.listenTo(this, "change:showCaption", this._onChangeShowCaption)
      },
      removeMedia: function () {
        this.post.softReset(), this.set({hasMedia: !1, showTos: !1}), this.mediaPreview.set({
          file: !1,
          embed: !1
        }), this.js$("confirmTos").attr("checked", !!this.post.get("confirmTos")), s.isEmpty(this.post.get("caption")) && s.isEmpty(this.post.get("tags")) && this.set("showCaption", !1)
      },
      _onChangeHasMedia: function (t, e) {
        this.isRendered() && (e ? (this.mediaComposer.$el.css({
          display: "none",
          opacity: 0
        }), this.mediaPreview.$el.css({display: "block", opacity: 1})) : (this.mediaPreview.$el.css({
          display: "none",
          opacity: 0
        }), this.mediaComposer.$el.css({display: "block", opacity: 1})))
      },
      _onChangeShowTos: function (t, e) {
        this.isRendered() && (e ? this.js$("tos").css({
          display: "block",
          opacity: 1
        }) : this.js$("tos").css({display: "none", opacity: 0}))
      },
      _onChangeShowCaption: function (t, e) {
        this.set("hideControlsLine", !e), this.isRendered() && (e ? this.js$("caption").css({
          display: "block",
          opacity: 1
        }) : this.js$("caption").css({display: "none", opacity: 0}))
      },
      _onFileUploadStart: function (t) {
        this.uploads.add(t);
        var e = t.get("file");
        this.mediaPreview.set({
          file: e,
          canEditMedia: !0
        }), this.listenToOnce(this.mediaPreview, "media:ready", function () {
          this.set({hasMedia: !0, showTos: !0, showCaption: !0}), this.caption.focus()
        })
      },
      _onFileUploadComplete: function (t) {
        var e = t.get("file"), i = "portrait" === t.get("orientation");
        this.mediaPreview.set({
          file: e,
          canEditMedia: !0,
          width: i ? t.get("height") : t.get("width"),
          height: i ? t.get("width") : t.get("height")
        }), this.post.set({preuploadUrl: t.get("key"), preuploadKey: t.get("ch")})
      },
      _onFileUploadError: function (t) {
        var e = t.get("error") || h("Error uploading video");
        s.isArray(e) && (e = e.join("</p><p>")), l.bool("upload_to_vimeo") && t.get("file").size > this.maxVideoFileSize || "Video file is too large" === e ? this.launchVimeoDialog() : r.alert("<p>" + e + "</p>"), this.removeMedia()
      },
      launchVimeoDialog: function () {
        var t = {
          text: h("That's an impressively big video. Unfortunately, Tumblr can only handle 100MB at a time. If you're looking to post huuuuuge stuff, just use Vimeo."),
          type: "video-vimeo-error",
          visible_glass: !0,
          buttons: {
            0: {
              text: "Nevermind", callback: function () {
              }
            }, 1: {
              text: "Upload to Vimeo", selected: !0, btn_class: "blue upload-to-vimeo-btn", callback: function () {
                window.open("https://vimeo.com/upload?utm_source=tumblr&utm_medium=partner&utm_campaign=28742", "_blank")
              }
            }
          },
          scroll_lock: !0
        };
        r.dialog(t)
      },
      _embedCodeParser: function (t, e, i) {
        if (this._embedCodeParsing && this._embedCodeParsing.abortEmbedCodeParse(), !s.isEmpty(s.trim(t))) {
          var o = !1, n = this._parseEmbedCode = c.parseEmbedData(t, 540).then(s.bind(function (i) {
            o || (this._embedCodeParsing = !1), this.listenToOnce(this.mediaPreview, "media:ready", function () {
              this.set({hasMedia: !0, showCaption: !0}), this.caption.focus()
            }), this.mediaPreview.set(s.extend({
              embed: d(i),
              canEditMedia: !0
            }, s.pick(i, ["width", "height"]))), e.trigger("url:complete"), this.post.set({embedCode: t})
          }, this), function (t) {
            e.trigger("url:error")
          });
          return n.abortEmbedCodeParse = function () {
            o = !0
          }, n
        }
      },
      afterRender: function () {
        this.renderSubViews(), this.get("hasMedia") ? this.mediaComposer.$el.css({
          display: "none",
          opacity: 0
        }) : this.mediaPreview.$el.css({
          display: "none",
          opacity: 0
        }), this.get("showTos") || this.js$("tos").css({
          display: "none",
          opacity: 0
        }), this.get("showCaption") ? this.delayedFocus(this.caption) : this.js$("caption").css({
          display: "none",
          opacity: 0
        })
      },
      executeUrlParser: function (t) {
        this.subViews.mediaComposer.urlParser(t)
      },
      getRichTextEditor: function () {
        return this.caption
      }
    });
    e.exports = b
  }, {
    "../../services/embed_data": 256,
    "../../templates/post_type_form/video.tpl": 296,
    "../confirm_tos": 327,
    "../media/video": 340,
    "../media_dropzone": 341,
    "../reblog_tree": 361,
    "../richtext_editor": 362,
    "./base": 353,
    "app/components/dialog": 44,
    jquery: "HlZQrA",
    lodash: "MicNly",
    moment: "iROhDJ",
    "prima/lib/flags": "f/LVtH",
    "prima/lib/logger": 553,
    "prima/lib/translate": 575,
    "prima/utils/camelize-keys": 594
  }],
  361: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/lib/translate"), a = t("prima/lib/flags"), r = t("prima/mixins/subviewable"), l = t("prima/mixins/selectorcache"), h = t("prima/mixins/accessor"), c = t("../templates/reblog_tree.tpl"), d = t("app/components/remove-button"), u = o.extend({
      className: "post-reblog-tree",
      events: {"click .btn-toggle-reblog": "toggleRemoveReblogTree"},
      mixins: [r, l, h],
      template: c,
      render: function () {
        return this.removeButton = this.subViews.removeButton = new d({
          tooltip: n("Remove reblogs"),
          buttonClass: "btn-remove-tree btn-toggle-reblog"
        }), this.$el.html(this.template(this.serialize())), this.attachSubViews(), this
      },
      teardown: function () {
        return this.$el.empty(), this
      },
      serialize: function () {
        return {
          showReblogTree: !s.isUndefined(this.model.get("reblog_tree")) && this.model.get("reblog_tree"),
          post: this.model
        }
      },
      toggleRemoveReblogTree: function (t) {
        var e = this.$(t.currentTarget), i = e.closest(".control-reblog-tree"), s = this.model.has("remove_reblog_tree") && this.model.get("remove_reblog_tree") === !0;
        this.model.set("remove_reblog_tree", !s), i.toggleClass("removed", !s)
      }
    });
    a.bool("reblog_ui_refresh") ? e.exports = t("app/components/reblog-trail/views/reblog-trail") : e.exports = u
  }, {
    "../templates/reblog_tree.tpl": 297,
    "app/components/reblog-trail/views/reblog-trail": 384,
    "app/components/remove-button": 385,
    lodash: "MicNly",
    "prima/lib/flags": "f/LVtH",
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  362: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      e.find(".velocity-animating").each(function (t, e) {
        c(e).removeClass("velocity-animating").removeAttr("style")
      }), e.find('[class=""]').removeAttr("class"), e.find('img[src^="data:"]').attr("src", "")
    }

    function o(t, e, i, s) {
      h.each(t, function (t, i) {
        s.find("[" + e + '="' + i + '"]').attr("data-uploading-key", i).removeAttr("src")
      })
    }

    function n(t, e, i, s) {
      h.each(t, function (t, i) {
        s.find("[" + e + '="' + i + '"]').remove()
      })
    }

    function a(t, e, i, s) {
      h.each(t, function (t, i) {
        s.find("[" + e + '="' + i + '"]').attr("src", t)
      })
    }

    function r(t, e, i, s) {
      s.find("[" + t + "]").filter(e ? ":not([ " + e + "])" : "*").removeAttr(t)
    }

    function l(t, e, i, s, o, n) {
      n.find("[" + s + '="' + t + '"]').removeAttr("data-uploading-key").removeAttr(s).attr("src", e)
    }

    var h = t("lodash"), c = t("jquery"), d = t("when"), u = t("prima/view"), p = t("velocity-animate").animate, m = t("velocity-animate").hook, g = t("prima/utils/exposer"), _ = t("app/components/dialog"), f = (t("prima/lib/logger"), t("prima/lib/translate")), v = t("prima/events"), b = t("remarkable"), y = new b({html: !0}), w = t("to-markdown").toMarkdown, x = t("ligature"), C = t("ligature").HumanKeys, k = t("../services/mention_support"), S = t("../services/inline_embed_support"), T = t("../services/image-search-support"), E = t("./mention_dropdown"), $ = t("./html_field"), M = t("app/components/upload"), P = t("prima/mixins/subviewable"), j = t("prima/mixins/selectorcache"), F = t("prima/mixins/accessor"), N = t("prima/mixins/tablimiter"), I = t("../templates/richtext_editor.tpl"), R = t("prima/lib/data"), A = t("../utils/validation"), L = t("prima/utils/url"), O = t("prima/utils/image/loader"), D = t("prima/utils/image/filereader"), B = t("prima/utils/image/canvas"), q = t("../services/image_url_upload"), V = t("../utils/remap-html-tags"), U = t("../utils/filter-html-by-dom"), H = t("prima/utils/dom"), z = t("../utils/apply-all"), W = t("prima/utils/image/types").convertToNormalizedType, G = 1080, K = 1, Q = 2, J = u.extend({
      defaults: {
        placeholder: "",
        ariaLabel: "",
        name: "",
        syncWithModel: !0,
        supportImages: !0,
        supportImageSearch: !1,
        supportInlineEmbeds: !0,
        supportMentions: !0,
        fullWidthInlineMedia: !0,
        inlineMediaWidthReblog: 250,
        inlineEmbedsPerPost: 5,
        minFullWidthSize: {jpg: 300, png: 300, gif: 300},
        fullWidthClass: "tmblr-full",
        animateInlineControls: !0
      },
      events: {},
      mixins: [F, P, j, N],
      template: I,
      pendingMedia: {},
      filtersToModel: [],
      filtersToEditor: [],
      initialize: function (t) {
        t || (t = h.extend({}, t)), h.extend(this.attributes, h.pick(t, h.keys(this.defaults))), h.extend(this, h.pick(t, "post")), h.has(t, "user") && t.user.has("inlineEmbedsPerPost") ? this.set("inlineEmbedsPerPost", t.user.get("inlineEmbedsPerPost")) : this.set("inlineEmbedsPerPost", R.get("Components/PostFormBuilder/limits/inlineEmbedsPerPost")), this.hosts = R.get("Context/hosts"), this.editor = null, this.humanKeys = new C, this.keyCommands = J.KEYCOMMANDS, h.forEach(["onChange", "onClientEvent", "onImageAdded", "pasteHook"], function (e) {
          var i = t[e] || this[e];
          h.isFunction(i) ? this[e] = h.bind(i, this) : this[e] = h.noop
        }, this);
        var e = this.get("name");
        e && this.get("syncWithModel") && (this.$el.attr("data-name", e), this.listenTo(this.model, "change:editorType", this._onChangeEditorType)), h.has(t, "user") && t.user.has("inlineEmbedsPerPost") && this.set("inlineEmbedsPerPost", t.user.get("inlineEmbedsPerPost")), h.has(t, "user") && t.user.has("hasGifSearchVariation") && this.set("hasGifSearchVariation", t.user.get("hasGifSearchVariation"))
      },
      _onChangeEditorType: function (t, e) {
        var i = t.previous("editorType");
        "rich" === i ? this.updateModelFromEditor("markdown" !== e ? Q : K) : "markdown" === i && this.convertModelFromMarkdown(), "markdown" === e && this.convertModelToMarkdown(), this.updateEditorType(e, !0), this.focus()
      },
      _initializeEditor: function (t, e) {
        var i = h.bind(this.humanKeys.pretty, this.humanKeys), s = {
          placeholder: e,
          flattenBlocks: !0,
          onChange: this._composeOnChange(),
          onAsyncImageAdded: h.bind(this.onAsyncImageAdded, this),
          onFileAdded: h.bind(this.insertImageFromFile, this),
          inlineControlsConfig: {
            openTray: h.bind(this.openInlineControlsTray, this),
            closeTray: h.bind(this.closeInlineControlsTray, this),
            onTrayOpened: h.bind(this.onInlineControlsTrayOpened, this),
            onTrayClosed: h.bind(this.onInlineControlsTrayClosed, this),
            onShow: h.bind(this.onInlineControlsShow, this),
            onHide: h.bind(this.onInlineControlsHide, this),
            customOffset: {x: 0, y: 0}
          },
          addImgAttrs: {toImg: !0, toImgParent: !0},
          formattingControlsConfig: {
            controls: {
              bold: {
                el: "b",
                className: "bold",
                command: "bold",
                type: "inline",
                title: f("Bold (%1$s)", i(this.keyCommands.BOLD)),
                keyboard: this.keyCommands.BOLD
              },
              italic: {
                el: "i",
                className: "italic",
                command: "italic",
                type: "inline",
                title: f("Italic (%1$s)", i(this.keyCommands.ITALIC)),
                keyboard: this.keyCommands.ITALIC
              },
              headline: {
                el: "h2",
                className: "headline",
                command: "formatBlock",
                type: "block",
                title: f("Headline (%1$s)", i(this.keyCommands.HEADLINE)),
                keyboard: this.keyCommands.HEADLINE
              },
              link: {
                el: "a",
                className: "link",
                command: "createLink",
                type: "inline",
                title: f("Link (%1$s)", i(this.keyCommands.LINK)),
                keyboard: this.keyCommands.LINK
              },
              strikethrough: {
                el: "strike",
                className: "strikethrough",
                command: "strikethrough",
                type: "inline",
                title: f("Strikethrough (%1$s)", i(this.keyCommands.STRIKETHROUGH)),
                keyboard: this.keyCommands.STRIKETHROUGH
              },
              orderedList: {
                el: "ol",
                className: "ordered-list",
                command: "insertOrderedList",
                type: "list",
                title: f("Ordered list (%1$s)", i(this.keyCommands.ORDEREDLIST)),
                keyboard: this.keyCommands.ORDEREDLIST
              },
              unorderedList: {
                el: "ul",
                className: "unordered-list",
                command: "insertUnorderedList",
                type: "list",
                title: f("Unordered list (%1$s)", i(this.keyCommands.UNORDEREDLIST)),
                keyboard: this.keyCommands.UNORDEREDLIST
              },
              blockquote: {
                el: "blockquote",
                className: "quote",
                command: "formatBlock",
                type: "block",
                title: f("Blockquote (%1$s)", i(this.keyCommands.BLOCKQUOTE)),
                keyboard: this.keyCommands.BLOCKQUOTE
              },
              clear: {el: "", command: "removeFormat", type: "inline", keyboard: this.keyCommands.REMOVEFORMAT},
              pre: {el: "pre", command: "formatBlock", type: "block", keyboard: this.keyCommands.PRE},
              superscript: {el: "sup", command: "superscript", type: "inline", keyboard: this.keyCommands.SUPERSCRIPT},
              subscript: {el: "sub", command: "subscript", type: "inline", keyboard: this.keyCommands.SUBSCRIPT},
              small: {
                el: "small",
                command: "insertHTML",
                type: "inline",
                keyboard: this.keyCommands.SMALL,
                keyboardInverse: this.keyCommands.SMALLINVERSE
              }
            },
            controlsOrder: ["bold", "italic", "headline", "link", "strikethrough", "orderedList", "unorderedList", "blockquote"]
          },
          pasteHook: this.pasteHook,
          blurHook: h.bind(this.blurHook, this),
          documentMousedownHook: h.bind(this.documentMousedownHook, this),
          runIFrameSanitization: !1,
          mediaHolderCallback: h.bind(this._mediaHolderCallback, this),
          filterRules: {
            elements: ["a", "b", "i", "strike", "h2", "blockquote", "p", "ul", "ol", "li", "iframe", "figure", "img", "br", "hr", "pre", "code", "small", "sup", "sub"],
            attributes: {
              a: ["href", "title"],
              img: ["src", "alt", "data-img-key", "data-orig-width", "data-orig-height", "data-orig-src"],
              iframe: ["src", "width", "height", "allowfullscreen", "mozallowfullscreen", "webkitallowfullscreen", "frameborder"],
              figure: ["data-provider", "data-url", "data-orig-width", "data-orig-height", "data-orig-src", "data-embed-code", "data-tumblr-attribution"],
              hr: ["data-label"]
            },
            classnames: {
              a: ["tumblr_blog", "tmblr-truncated-link"],
              hr: ["tmblr-truncated"],
              blockquote: ["link_og_blockquote"],
              figure: ["tmblr-embed", "tmblr-embed-placeholder", "tmblr-full"]
            },
            remove_contents: ["style", "noscript", "script", "meta"],
            protocols: {a: !1, iframe: {src: ["https://", "http://", "//"]}}
          },
          labels: {Edit: f("Edit"), Remove: f("Remove"), Open: f("Open"), Done: f("Done")},
          animateShowControls: function (t) {
            t.element.show();
            var e = 60, i = 8;
            h.forEach(t.buttons, function (t, s) {
              var o = c(t);
              p(o, "stop"), m(o, "translateY", i), o.css("opacity", 0), p(o, {
                translateY: [0, i],
                opacity: [1, 0]
              }, {
                delay: .25 * s * e, duration: e, complete: function () {
                  o.attr("style", "")
                }
              })
            }, this)
          },
          animateHideControls: function (t) {
            var e = 100, i = 8;
            h.forEach(t.buttons, function (s, o) {
              var n = c(s);
              p(n, "stop");
              var a = p(n, {translateY: i, opacity: 0}, {duration: e});
              o === t.buttons.length - 1 && a.then(function () {
                t.element.hide()
              })
            }, this)
          },
          mediaKillerMarkup: '<div class="media-button icon_close"></div>',
          mediaMoverMarkup: '<div class="media-button icon_drag"></div>',
          showStaticControls: !1,
          smartQuotes: {enabled: !0}
        };
        this._setupEditorFilters(), this.editor = new x.RichTextEditor(t, s), this.inlineControlNode = !1, this.get("supportImages") && this._initializeImageSupport(), this.inlineEmbedSupport = !1, this.get("supportInlineEmbeds") && this._initializeInlineEmbedSupport(), this.imageSearchSupport = !1, this.get("supportImageSearch") && this._initializeImageSearchSupport(), this.mentionSupport = !1, this.get("supportMentions") && this._initializeMentionSupport(), this._initializeReadMoreSupport(), this.editor.config.filterForSetData = h.compose.apply(this, this.editorFilters.preSet), this.editor.config.filterForGetData = h.compose.apply(this, this.editorFilters.preGet), this.updateEditorType(), "markdown" === this.getEditorType() && (this.model.set(this.get("name"), this._modelValue().replace(/^\s*<p>([\S\s]*)<\/p>\s*$/i, "$1")), this.htmlField.updateValueFromModel(), this.htmlField.updateEditor())
      },
      _setupEditorFilters: function () {
        this.editorFilters = {preSet: [], preGet: []}, this.editorFilters.preSet.push(this._tagTranslator)
      },
      _tagTranslator: function (t, e) {
        return e || (e = {h1: "h2", h3: "b", h4: "b", h5: "b", h6: "b", strong: "b", em: "i"}), V(t, e)
      },
      updateInlineImages: function () {
        var t = !1, e = c(this.editor.element).find("img[" + this.editor.config.imgKeyAttr + "]");
        e.each(h.bind(function (e, i) {
          h.get(this.editor.mediaTracker[c(i).attr(this.editor.config.imgKeyAttr)], "updatedSource") || (t = !0)
        }, this)), this.post.set("hasLoadingInlineImages", t)
      },
      _composeOnChange: function () {
        var t = [this.onChange], e = this;
        return this.get("syncWithModel") && t.unshift(this.updateModelFromEditor), t.unshift(this.updateInlineImages), function () {
          h.each(t, function (t) {
            t.call(e)
          })
        }
      },
      pasteHook: function (t, e) {
        var i = t.getData("text/plain"), s = i.trim();
        return A.isImageUrl(s) && !e ? (this.insertImageFromUrl(s, i), !0) : A.isUrl(s) && !e ? (this.editor.insertData('<a href="' + s + '">' + s + "</a>"), !0) : void 0
      },
      cancelBlur: function () {
        this.cancelNextBlur = !0
      },
      resumeBlur: function (t) {
        this.defaultBlur ? this.defaultBlur(t) : h.isFunction(t) && t()
      },
      blurHook: function (t, e) {
        return this.cancelNextBlur ? (this.cancelNextBlur = !1, this.defaultBlur = e, !0) : void 0
      },
      addElementToControlsCloseWhitelist: function (t) {
        this.controlsCloseWhitelist || (this.controlsCloseWhitelist = []), this.controlsCloseWhitelist.push(t)
      },
      removeElementFromControlsCloseWhitelist: function (t) {
        h.isEmpty(this.controlsCloseWhitelist) || (this.controlsCloseWhitelist = h.without(this.controlsCloseWhitelist, t))
      },
      documentMousedownHook: function (t, e) {
        return this.imageSearchSupport && this.imageSearchSupport.isOpen() ? !0 : h.isEmpty(this.controlsCloseWhitelist) ? void 0 : h.find(this.controlsCloseWhitelist, function (e) {
          return e === t.target || c.contains(e, t.target)
        })
      },
      _mediaHolderCallback: function () {
        this.mediaHolderCallback.apply(this, arguments)
      },
      mediaHolderCallback: function (t, e, i, s) {
        i.is("hr, img, figure") && h.isEmpty(i.find("iframe")) && (s.addClass("media-holder-draggable"), h.isEmpty(i.find("[data-tumblr-query]")) || s.addClass("media-holder--gif-search")), s.addClass("media-holder-" + i.prop("tagName").toLowerCase())
      },
      _initializeImageSupport: function () {
        this.imageUploader = new M({
          name: "image",
          maxUploadSize: 10485760,
          uploadPattern: /^image\/(?:.*)$/i,
          accept: "image/*",
          url: "/svc/post/upload_text_image"
        });
        var t = c("<div />", {
          "class": "control add-image",
          "data-control-name": "inline-image",
          tabindex: "0",
          title: f("Insert photo (%1$s)", this.humanKeys.pretty(this.keyCommands.PHOTO))
        });
        t.on("click", h.bind(function (t) {
          this.editor.staticControls.hide()
        }, this)), t.append('<input type="file" accept="image/*" tabindex="-1" multiple="true">'), t.on('change input[type="file"]', h.bind(function (e) {
          var i = c(e.target), s = h.toArray(i.prop("files"));
          h.forEach(s, function (t) {
            this.insertImageFromFile(t)
          }, this), i.remove(), t.append('<input type="file" accept="image/*" multiple="true">'), this.editor.inlineControls.close()
        }, this)), this.editor.inlineControls.addToTray(t, {
          keyboard: {
            shortcut: this.keyCommands.PHOTO,
            callback: h.bind(function () {
              this._inlineControlKeyboardFocus(t)
            }, this)
          }
        }), this.listenTo(this.imageUploader, "error", this._onFileUploadError)
      },
      _initializeImageSearchSupport: function () {
        var t = function () {
          this._inlineControlKeyboardFocus(this.imageSearchSupport.getButton(), function () {
            this.openImageSearch()
          }, this)
        };
        this.imageSearchSupport = new T({
          editorView: this,
          editor: this.editor,
          title: f("Insert GIF (%1$s)", this.humanKeys.pretty(this.keyCommands.GIF)),
          trayOptions: {keyboard: {shortcut: this.keyCommands.GIF, callback: t, context: this}}
        }), this.mediaHolderCallback = z([this.mediaHolderCallback, h.bind(this.imageSearchSupport.addTumblrAttribution, this.imageSearchSupport)], this), this.filtersToModel.push(h.bind(this.imageSearchSupport.cleanupMarkup, this)), this.listenTo(this.imageSearchSupport, "prompt", function () {
          this.trigger("controls:gif:prompt")
        })
      },
      _onFileUploadError: function (t, e) {
        var i = e.get("error") || f("Error uploading photo");
        _.alert("<p>" + i + "</p>")
      },
      insertImageFromUrl: function (t, e, i) {
        e === !1 || e || (e = t), i || (i = {});
        var s = d.defer(), o = h.bind(function () {
          s.reject()
        }, this);
        return O.load(t).then(h.bind(function (t) {
          this.listenToOnce(this, "asyncImageAdded", function (t, e, i) {
            s.resolve(t, e)
          }), this.editor.insertAsyncImage(t.src, null, i.targetNode, i.direction, i.skipSelectionUpdate)
        }, this), h.bind(function () {
          e && this.editor.insertData(e), o()
        }, this)), s.promise
      },
      insertImageFromFile: function (t, e) {
        e || (e = {});
        var i = d.defer(), s = h.bind(function () {
          i.reject()
        }, this);
        return t.type.match(/image\/(jpg|jpeg|png)/i) ? D.read(t).then(h.bind(function (o) {
          O.load(o.objectUrl || o.base64).then(h.bind(function (s) {
            var n = new Image;
            n.src = s.src;
            var a = B.drawScaledAndRotated(n, s.width, s.height, o.rotation, o.mirrored, G);
            this.listenToOnce(this, "asyncImageAdded", function (t, e, s) {
              i.resolve(t, e)
            }), this.editor.insertAsyncImage(a.toDataURL(o.file.type), t, e.targetNode, e.direction, e.skipSelectionUpdate)
          }, this), s)
        }, this), s) : t.type.match(/image\/*/i) && this.editor.insertAsyncImage(null, t, e.targetNode, e.direction, e.skipSelectionUpdate), i.promise
      },
      getMinFullWidthSize: function (t) {
        var e = this.get("minFullWidthSize");
        return h.isNumber(e) ? e : (t = W(t), h.has(e, t) ? e[t] : null)
      },
      shouldBeFullWidth: function (t, e) {
        var i;
        return this.get("fullWidthInlineMedia") && (e = h.isNumber(e) ? e : parseInt(e, 10)) ? (i = this.getMinFullWidthSize(t), h.isNumber(i) ? e >= i : !1) : !1
      },
      addASyncImageFullWidthAttributes: function (t, e, i) {
        var s;
        return e && i && this.shouldBeFullWidth(e, i) && (s = this.editor.getAsyncImage(t)) ? (c(s).parent("figure").addClass(this.get("fullWidthClass")), !0) : !1
      },
      onAsyncImageAdded: function (t, e, i, s) {
        var o = h.has(s, "width") ? s.width : null;
        if (i instanceof Blob)this.uploadInlineImage(t, i), this.pendingMedia[t] = e, this.addASyncImageFullWidthAttributes(t, i.type, o); else {
          if (!e || 0 !== e.lastIndexOf("http", 0))return;
          L.isTumblrMediaUrl(e) ? this.editor.updateAsyncImage(t, e) : (this.uploadInlineImageUrl(t, e), this.pendingMedia[t] = e), this.addASyncImageFullWidthAttributes(t, L.getExtension(e), o)
        }
        this.trigger("asyncImageAdded", t, e, i)
      },
      updateImageAttributes: function (t, e, i) {
        var s = this.model.get("editorType");
        "html" === s || "markdown" === s ? ("markdown" === s && this.convertModelFromMarkdown(), this.model.set(this.get("name"), U(this._modelValue(), h.partial(l, t, e, i, this.editor.config.imgKeyAttr))), "markdown" === s && this.convertModelToMarkdown(), this.htmlField.updateValueFromModel(), this.htmlField.updateEditor()) : (this.editor.updateAsyncImage(t, e, i), this.updateModelFromEditor()), delete this.pendingMedia[t]
      },
      uploadInlineImageUrl: function (t, e) {
        q.uploadImageUrl(e, h.bind(function (e) {
          this.updateImageAttributes(t, e.response.url)
        }, this), h.bind(function () {
          this.updateImageAttributes(t, e)
        }, this), h.bind(function () {
          this.updateInlineImages()
        }, this))
      },
      uploadInlineImage: function (t, e) {
        var i = h.bind(function (t, e) {
          this.listenTo(e, "change:complete change:error", h.bind(function (e) {
            var i, s = e.get("url");
            e.get("raw_width") && e.get("raw_height") && (i = {
              width: e.get("raw_width"),
              height: e.get("raw_height")
            }), h.has(e.changed, "error"), O.load(s).then(h.bind(function (e) {
              this.updateImageAttributes(t, s, i)
            }, this)).done(h.bind(function () {
              this.updateInlineImages()
            }, this)), this.stopListening(e, "change:complete change:error")
          }, this))
        }, this), s = function (o) {
          o.get("file") === e && (i.call(this, t, o), this.stopListening(this.imageUploader, "add", s))
        }, o = function (i, s) {
          if (s.get("file") === e) {
            var o = c(this.editor.getAsyncImage(t)), a = o.closest(".media-holder");
            a.length ? a.remove() : o.remove(), this.updateModelFromEditor();
            var r;
            r = s.get("error") || f("Error uploading photo"), h.isArray(r) && (r = r.join("</p><p>")), _.alert("<p>" + r + "</p>", h.bind(this.editor.focus, this.editor)), n.call(this, i, s)
          }
        }, n = function (t, i) {
          var a = i.files ? i.files[0] : i.file;
          a = a || i.get("file"), a === e && (this.stopListening(this.imageUploader, "add", s), this.stopListening(this.imageUploader, "invalid", o), this.stopListening(this.imageUploader, "send", n))
        };
        this.listenTo(this.imageUploader, "add", s), this.listenTo(this.imageUploader, "invalid", o), this.listenTo(this.imageUploader, "send", n), this.imageUploader.addFiles([e])
      },
      toggleInlineControlsTray: function (t) {
        h.has(this.editor, "inlineControls") && (t = t || !1, this.editor.inlineControls.toggleTrayWithIntent(t))
      },
      openInlineControlsTray: function (t) {
        t = t || this.editor.inlineControls.tray || c(), this.editor.inlineControls.isShown || this.editor.inlineControls.show(), p(t, "stop", !0), t.css({
          opacity: "",
          left: "",
          right: ""
        }), this._logInteraction("open-inline-controls"), this.editor.setPlaceholder(!1), this.get("hasGifSearchVariation") || this.editor.blur(!0), this.$el.addClass("tray-open"), this.catchTabs(t), this.get("hasGifSearchVariation") || t.attr("tabindex", 0).focus(), this.catchEsc(t, this.toggleInlineControlsTray), h.forEach(t.find("[data-control-name]"), function (t, e) {
          var i = c(t);
          i.on("click.inline-control-logging", h.bind(function (t) {
            var e = c(t.currentTarget);
            this._logInteraction("click-inline-control", {controlName: e.attr("data-control-name")})
          }, this))
        }, this);
        var e = function () {
          this.$el.closest(".gif-search-variation").addClass("gs-variation-ran-once"), this.set("gsVariationRanOnce", !0)
        };
        this.get("animateInlineControls") && !this.get("gsVariationRanOnce") && h.forEach(t.find(".control"), function (t, i, s) {
          var o = c(t), n = {opacity: 0}, a = {opacity: 1};
          this.get("hasGifSearchVariation") ? (n.right = "-25px", a.right = 0) : (n.left = "-25px", a.left = 0), p(t, "stop", !0), o.css(n), p(t, a, {
            delay: 30 * i,
            duration: 300,
            easing: [.175, .885, .32, 1.275],
            complete: t === h.last(s) ? h.bind(e, this) : null
          })
        }, this)
      },
      closeInlineControlsTray: function (t) {
        if (t = t || c(), this.releaseTabs(), this.releaseEsc(t), !this.get("hasGifSearchVariation")) {
          t.find(".control").off("click.inline-control-logging");
          var e = function () {
            t.css({
              opacity: "",
              left: ""
            }), t.length && t.is(":visible") && this.editor.focus(!0), this.editor.setPlaceholder(this.get("placeholder")), this.$el.removeClass("tray-open")
          };
          p(t, {opacity: 0, left: "-=20px"}, {duration: 150, complete: h.bind(e, this)})
        }
      },
      onInlineControlsTrayOpened: function (t) {
        this.inlineControlNode = this.editor.getCurrentElement(), this.inlineEmbedSupport && (this.inlineEmbedSupport.trayOpened(t), this.trigger("controls:open", t))
      },
      onInlineControlsTrayClosed: function (t) {
        this.get("delayGifSearchVariationUponEditMode") && this.get("gsVariationRanOnce") && (this.set("delayGifSearchVariationUponEditMode", !1), this.$(".inline-controls").removeClass("edit-mode-init-hide")), this.inlineControlNode = !1, this.inlineEmbedSupport && (this.inlineEmbedSupport.trayClosed(t), this.trigger("controls:close", t))
      },
      onInlineControlsShow: function (t) {
        this.get("delayGifSearchVariationUponEditMode") && this.$(".inline-controls").addClass("edit-mode-init-hide"), t.element.show(), this.$el.addClass("inline-controls-show"), this.trigger("controls:show")
      },
      onInlineControlsHide: function (t) {
        t.element.hide(), this.$el.removeClass("inline-controls-show"), this.trigger("controls:hide")
      },
      _initializeMentionSupport: function () {
        var t = ["tumblelog"];
        h.isArray(this.editor.config.linkConfig.bypassClasses || !1) && (t = h.union(this.editor.config.linkConfig.bypassClasses, t)), this.editor.linkControl.bypassClasses = t, this.mentionPopover = new E({
          pinnedSide: "none",
          teardownOnEscape: !1,
          identifier: "postForms:mentionDropdown"
        }), this.mentionSupport = new k(this.editor, this.mentionPopover), this.getEditorValue = h.compose(this.mentionSupport.stripGhost, this.getEditorValue)
      },
      _getReadMoreMarkup: function () {
        return '<hr class="tmblr-truncated" data-label="' + f("Keep reading") + '">'
      },
      convertReadMoreMagicKey: function (t) {
        var e = t.replace(/\[\[MORE\]\]/g, this._getReadMoreMarkup());
        return e
      },
      convertReadMoreHtml: function (t) {
        var e = c(H.nodeFromString(t));
        return e.find(".tmblr-truncated").replaceWith("[[MORE]]"), e.html()
      },
      _createEmptyParagraph: function () {
        return this.editor.isCursorAtStart() ? this.editor.insertNewParagraphBefore() : this.editor.insertNewParagraphAfter()
      },
      _inlineControlKeyboardFocus: function (t, e, i) {
        var s;
        this.editor.hasSelection() || (s = function () {
          var s = this.get("animateInlineControls");
          this.set("animateInlineControls", !1), this.toggleInlineControlsTray(!0), t && c(t).focus(), "function" == typeof e && e.call(i || this, t), this.set("animateInlineControls", s)
        }, this.editor.isEmptyElement() ? s.call(this) : (this.listenToOnce(this, "controls:show", function () {
          setTimeout(h.bind(s, this), 50)
        }), this._createEmptyParagraph()))
      },
      _initializeReadMoreSupport: function () {
        var t = function (t) {
          return t.stopPropagation(), t.preventDefault(), !1
        }, e = h.bind(function () {
          this.editor.hasSelection() || this.editor.insertMedia("<hr>")
        }, this), i = h.bind(function () {
          if (!this.editor.hasSelection()) {
            var t = this.$(".media-holder .tmblr-truncated");
            t.length && t.closest(".media-holder").remove(), this.editor.insertMedia(this._getReadMoreMarkup())
          }
        }, this), s = c("<div />", {
          "class": "control add-hr",
          "data-control-name": "hr",
          tabindex: "0",
          title: f("Insert horizontal line (%1$s)", this.humanKeys.pretty(this.keyCommands.HR))
        });
        s.on("click", e), s.on("mousedown", t);
        var o = c("<div />", {
          "class": "control add-read-more",
          "data-control-name": "read-more",
          tabindex: "0",
          title: f("Insert read-more link (%1$s)", this.humanKeys.pretty(this.keyCommands.MORE))
        });
        o.on("click", i), o.on("mousedown", t), this.editor.inlineControls.addToTray(s, {
          keyboard: {
            shortcut: this.keyCommands.HR,
            callback: e
          }
        }), this.editor.inlineControls.addToTray(o, {
          keyboard: {
            shortcut: this.keyCommands.MORE,
            callback: i
          }
        }), this.editorFilters.preSet.push(h.bind(function (t) {
          var e = t;
          return e = this.convertReadMoreMagicKey(e)
        }, this)), this.editorFilters.preGet.push(h.bind(function (t) {
          var e = t;
          return e = this.convertReadMoreHtml(e)
        }, this))
      },
      _initializeInlineEmbedSupport: function () {
        var t = function () {
          this.inlineEmbedSupport && !this.inlineEmbedSupport.isDisabled && this._inlineControlKeyboardFocus(this.inlineEmbedSupport.getButton(), function () {
            this.inlineEmbedSupport.prompt()
          }, this)
        };
        this.inlineEmbedSupport = new S({
          editorView: this,
          editor: this.editor,
          inlineEmbedsPerPost: this.get("inlineEmbedsPerPost"),
          inlineMediaWidthReblog: this.get("inlineMediaWidthReblog"),
          inlineMediaWidthFull: this.get("fullWidthInlineMedia") ? 540 : 500,
          fullWidthInlineMedia: this.get("fullWidthInlineMedia"),
          fullWidthClass: this.get("fullWidthClass"),
          title: f("Insert video (%1$s)", this.humanKeys.pretty(this.keyCommands.EMBED)),
          disabledTitle: f("Sorry, you can't add more than %1$s videos", this.get("inlineEmbedsPerPost")),
          trayOptions: {keyboard: {shortcut: this.keyCommands.EMBED, callback: t, context: this}}
        }), this.editorFilters.preSet.push(h.bind(function (t) {
          return this.inlineEmbedSupport ? this.inlineEmbedSupport.addEmbedPlaceholders(t) : t
        }, this)), this.editorFilters.preGet.push(h.bind(function (t) {
          return this.inlineEmbedSupport ? this.inlineEmbedSupport.removeEmbedPlaceholders(t) : t
        }, this)), this.listenTo(this.inlineEmbedSupport, "prompt", function () {
          this.trigger("controls:embed:prompt")
        })
      },
      beforeRender: function () {
        this.htmlField = this.subViews.htmlField = new $({model: this.model, name: this.get("name")})
      },
      afterRender: function () {
        if (this.renderSubViews(), this.get("hasGifSearchVariation")) {
          this.getEditorValue() && this.set("delayGifSearchVariationUponEditMode", !0);
          var t = setTimeout(h.bind(function () {
            this.openInlineControlsTray(), this.editor.setPlaceholder(this.get("placeholder"))
          }, this), 400);
          this.set("openTrayTimeout", t)
        }
      },
      remove: function () {
        this._removed = !0, this.subViews = null, clearTimeout(this.get("openTrayTimeout"))
      },
      render: function () {
        var t = this._modelValue().length > 0;
        t && this.set("placeholder", !1), this.$el.html(this.template({ariaLabel: this.get("ariaLabel")}));
        var e = this.js$("richTextEditor").get(0);
        return this._initializeEditor(e, this.get("placeholder")), t && ("rich" !== this.getEditorType() || this.editorValueMatchesModel() || this.updateEditorFromModel()), this.attachSubViews(), this
      },
      teardown: function () {
        return this.$el.empty(), this.editor.teardown(), this.imageUploader && (this.stopListening(this.imageUploader), this.imageUploader.teardown(), delete this.imageUploader), this.imageSearchSupport && this.imageSearchSupport.teardown(), delete this.mentionSupport, delete this.inlineEmbedSupport, delete this.imageSearchSupport, this.editorFilters && delete this.editorFilters, this
      },
      serialize: function () {
        return this.toJSON()
      },
      getEditorType: function () {
        return this.model.get("editorType")
      },
      getEditorValue: function (t, e) {
        return "undefined" != typeof t || (t = !0), "undefined" != typeof e || (e = !0), this.editor ? this.editor.getData(t, e) : null
      },
      setEditorValue: function (t, e, i) {
        this.editor && this.editor.setData(t, e, i)
      },
      convertModelFromMarkdown: function () {
        var t = y.render(this._modelValue());
        return this.model.set(this.get("name"), t), t
      },
      convertModelToMarkdown: function () {
        var t = w(this._modelValue());
        return t = t.replace(new RegExp(/<figure\b([^>]*)>([\s\S]*?)<\/figure>/gi), "$2"), this.model.set(this.get("name"), t), t
      },
      updateModelFromEditor: function (t, e) {
        if (!this.editor)return !1;
        var i = this.get("name"), a = this.getEditorValue(), l = [s];
        h.isEmpty(this.pendingMedia) || (t === Q ? l.push(h.partial(o, this.pendingMedia, this.editor.config.imgKeyAttr)) : t === K && l.push(h.partial(n, this.pendingMedia, this.editor.config.imgKeyAttr))), e || l.push(h.partial(r, this.editor.config.imgKeyAttr, "data-uploading-key")), h.isEmpty(this.filtersToModel) || (l = l.concat(this.filtersToModel)), a = U(a, l), this.model.set(i, a)
      },
      updateEditorFromModel: function () {
        var t = this.getEditorValue(), e = this._modelValue();
        t = U(t, s), h.isEmpty(this.filtersToEditor) || (e = U(e, this.filtersToEditor)), this.setEditorValue(e, !0)
      },
      editorValueMatchesModel: function () {
        var t = this.getEditorValue(), e = this._modelValue(), i = [s];
        return h.isEmpty(this.pendingMedia) || i.push(h.partial(o, this.pendingMedia, this.editor.config.imgKeyAttr)), i.push(h.partial(r, this.editor.config.imgKeyAttr, "data-uploading-key")), h.isEmpty(this.filtersToModel) || (i = i.concat(this.filtersToModel)), t = U(t, i), e.trim() === t.trim()
      },
      updateEditorType: function (t, e) {
        t || (t = this.model.get("editorType"));
        var i = c(this.editor.wrapper), s = !!this.model.get("hasSeenHtml");
        if ("rich" === t) {
          this.htmlField.hide();
          var o = this._modelValue(!0), n = [];
          h.isEmpty(this.pendingMedia) || n.push(h.partial(a, this.pendingMedia, this.editor.config.imgKeyAttr)), n.push(h.partial(r, this.editor.config.imgKeyAttr, "data-uploading-key")), o = U(o, n), this.setEditorValue(o, !0, s), i.show()
        } else i.hide(), this.htmlField.updateValueFromModel(), this.htmlField.set("isMarkdown", "markdown" === t), e && this.htmlField.set("editedSincePreview", !0), this.htmlField.show(), this.htmlField.showSource(s), this.model.set("hasSeenHtml", !0)
      },
      _modelValue: function (t) {
        var e = this.model.get(this.get("name")) || "";
        return e = e.replace(/<!-- +more +-->/gi, "[[MORE]]"), t && h.result(this.model, "isReblog") && (e = e.replace(/<p>\s*<br\s*\/?>\s<\/p>$/i, "") + "<p><br></p>"), e
      },
      focus: function (t) {
        this.editor && "rich" === this.getEditorType() ? this.editor.focus(t) : this.htmlField && this.htmlField.focus()
      },
      blur: function (t) {
        this.editor && "rich" === this.getEditorType() ? this.editor.blur(t) : this.htmlField && this.htmlField.blur()
      },
      catchEsc: function (t, e) {
        c(t).on("keydown.rteCatchEsc", h.bind(function (t) {
          27 === t.keyCode && (e.call(this), t.stopPropagation())
        }, this))
      },
      releaseEsc: function (t) {
        c(t).off("keydown.rteCatchEsc")
      },
      setCursorToEnd: function () {
        this.editor && h.isFunction(this.editor.setCursorToEnd) && this.editor.setCursorToEnd()
      },
      _logInteraction: function (t, e) {
        var i = {
          action: t,
          tumblelog: this.model.get("tumblelog"),
          mode: this.model.get("mode"),
          postType: this.model.get("type"),
          editorType: this.model.get("editorType")
        };
        i.inputLength = this.getEditorValue().length, e && (i = h.extend(i, e)), v.trigger("postform-interaction:" + t, {loggingData: i})
      },
      openImageSearch: function () {
        this.imageSearchSupport && this.imageSearchSupport.prompt(this.imageSearchSupport.get("query", !1))
      }
    }, {
      KEYCOMMANDS: {
        BOLD: "meta+b",
        ITALIC: "meta+i",
        HEADLINE: "meta+shift+2",
        LINK: "meta+k",
        STRIKETHROUGH: "meta+shift+6",
        ORDEREDLIST: "meta+shift+7",
        UNORDEREDLIST: "meta+shift+8",
        BLOCKQUOTE: "meta+shift+9",
        REMOVEFORMAT: "meta+shift+0",
        PRE: "meta+shift+x",
        SUPERSCRIPT: "meta+dot",
        SUBSCRIPT: "meta+comma",
        SMALL: "meta+shift+minus",
        SMALLINVERSE: "meta+shift+plus",
        PHOTO: "meta+shift+p",
        GIF: "meta+shift+g",
        EMBED: "meta+shift+m",
        HR: "meta+shift+l",
        MORE: "meta+shift+k"
      }
    });
    g({"Tumblr.Prima.RichTextEditorView": J}), e.exports = J
  }, {
    "../services/image-search-support": 257,
    "../services/image_url_upload": 258,
    "../services/inline_embed_support": 259,
    "../services/mention_support": 260,
    "../templates/richtext_editor.tpl": 298,
    "../utils/apply-all": 312,
    "../utils/filter-html-by-dom": 316,
    "../utils/remap-html-tags": 317,
    "../utils/validation": 321,
    "./html_field": 331,
    "./mention_dropdown": 342,
    "app/components/dialog": 44,
    "app/components/upload": 397,
    jquery: "HlZQrA",
    ligature: 652,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/data": 548,
    "prima/lib/logger": 553,
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/mixins/tablimiter": 588,
    "prima/utils/dom": 600,
    "prima/utils/exposer": 602,
    "prima/utils/image/canvas": 603,
    "prima/utils/image/filereader": 604,
    "prima/utils/image/loader": 605,
    "prima/utils/image/types": 606,
    "prima/utils/url": 611,
    "prima/view": 612,
    remarkable: "tJkXfs",
    "to-markdown": "ArhiFs",
    "velocity-animate": "lWl/mc",
    when: "RG2dij"
  }],
  363: [function (t, e, i) {
    "use strict";
    var s = t("prima/view"), o = t("prima/utils/bindendevent").animation, n = t("../templates/richtext_editor_tutorial.tpl"), a = s.extend({
      className: "post-form--richtext-editor-tutorial popover tutorial",
      template: n,
      events: {"click > button": "close"},
      remove: function () {
        return this.trigger("removed", this), s.prototype.remove.apply(this, arguments)
      },
      close: function () {
        o(this.$el, this.remove.bind(this)), this.trigger("closing", this), this.$el.addClass("closing")
      },
      render: function () {
        return this.$el.html(this.template(this.attributes)), this
      }
    });
    e.exports = a
  }, {"../templates/richtext_editor_tutorial.tpl": 299, "prima/utils/bindendevent": 593, "prima/view": 612}],
  364: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/lib/translate"), a = t("prima/events"), r = t("prima/mixins/accessor"), l = t("prima/mixins/subviewable"), h = t("prima/mixins/selectorcache"), c = t("../templates/save_post_button.tpl"), d = t("./save_post_dropdown"), u = t("components/knight-rider-loader"), p = o.extend({
      className: "post-form--save-button",
      events: {
        "click [data-js-clickableSaveDropdown]": "toggleSavePostDropdown",
        "mousedown [data-js-clickableSaveDropdown]": "savePostDropdownIntent"
      },
      mixins: [r, l, h],
      template: c,
      initialize: function (t) {
        this.options = t = s.extend({
          shift: {x: 0, y: 10},
          identifier: "postForms:savePostDropdown"
        }, t), s.extend(this, s.pick(t, "post", "user", "uploads")), this.savePostDropdown = new d(t), this.set("initialPostPseudoState", this.post.get("pseudoState"))
      },
      checkCanPost: function () {
        this.set("canPost", this.post.isValid() && !this.uploads.anyUploading())
      },
      checkIsActive: function () {
        this.set("isActive", this.get("canPost") && !this.savePostDropdown.isRendered())
      },
      setStateForContext: function () {
        if ("new" === this.post.get("mode")) {
          var t = this.post.getContextPage();
          "drafts" === t ? this.savePostDropdown.setOptionDraft() : "queue" === t && this.savePostDropdown.setOptionQueue()
        }
      },
      render: function () {
        return this.$el.html(this.template()), this.loader = this.subViews.loader = new u({variation: "centered small"}), this.savePostDropdown.setPinnedTarget(this.js$("clickableSaveDropdown")), this.attachSubViews(), this.loader.render(), this.setStateForContext(), this.checkCanPost(), this.checkIsActive(), this.set("buttonLabel", this.buttonLabelForPseudoState()), this.updateButtonLabel(), this.updateButtonEnabledState(), this
      },
      afterRender: function () {
        this.listenTo(this.post, "change validate", this.checkCanPost), this.listenTo(this.uploads, "change:uploading", this.checkCanPost), this.listenTo(this.savePostDropdown, "open close", this.checkIsActive), this.listenTo(this.post, "change:state", function (t, e) {
          this.set("buttonLabel", this.buttonLabelForPseudoState(t.get("pseudoState")))
        }), this.listenTo(a, "postForms:saving", this.showLoader), this.listenTo(a, "postForms:error", this.hideLoader), this.listenTo(this, "change:canPost", this.checkIsActive), this.listenTo(this, "change:isActive", this.updateButtonEnabledState), this.listenTo(this, "change:buttonLabel", this.updateButtonLabel)
      },
      updateButtonEnabledState: function (t, e) {
        !s.isUndefined(e) || (e = this.get("isActive")), this.js$("clickableSave").toggleClass("disabled", !e).prop("disabled", !e)
      },
      updateButtonLabel: function (t, e) {
        e || (e = this.get("buttonLabel")), this.js$("clickableSave").text(e)
      },
      showLoader: function () {
        this.toggleLoader(!0)
      },
      hideLoader: function () {
        this.toggleLoader(!1)
      },
      toggleLoader: function (t) {
        var e = !!t;
        this.$el.css({
          width: e ? this.$el.width() : "",
          height: e ? this.$el.height() : ""
        }), this.loader.set("loading", e), this.js$("clickableSaveDropdown").toggle(!e), this.js$("clickableSave").toggle(!e)
      },
      buttonLabelForPseudoState: function (t, e, i) {
        switch (t || (t = this.post.get("pseudoState")), e || (e = this.get("initialPostPseudoState")), i || (i = this.post.get("mode")), t) {
          case"published":
            return n("reblog" === i ? "Reblog" : "edit" === i && "published" === e ? "Save" : "Post");
          case"queued":
            return n("Queue");
          case"scheduled":
            return n("Schedule");
          case"draft":
            return n("Save draft");
          case"private":
            return n("edit" === i && "private" === e ? "Save" : "Post privately");
          default:
            return n("Post")
        }
      },
      toggleSavePostDropdown: function (t) {
        s.isBoolean(t) || (t = !this.savePostDropdown.isOrWasRecentlyRendered()), t ? this.savePostDropdown.render() : this.savePostDropdown.remove()
      },
      savePostDropdownIntent: function () {
        this.trigger("dropdown:intent")
      }
    });
    e.exports = p
  }, {
    "../templates/save_post_button.tpl": 300,
    "./save_post_dropdown": 365,
    "components/knight-rider-loader": 496,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  365: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/view"), a = t("prima/lib/translate"), r = t("prima/events"), l = t("prima/mixins/accessor"), h = t("prima/mixins/subviewable"), c = t("prima/mixins/selectorcache"), d = t("prima/mixins/popoverbase"), u = t("./post_preview"), p = t("../models/blog_preview_key"), m = t("../templates/save_post_dropdown.tpl"), g = n.extend({
      className: "popover--save-post-dropdown",
      events: {
        "click [data-js-preview]": "triggerPostPreview",
        "click [data-js-publish]": "setOptionPublish",
        "click [data-js-draft]": "setOptionDraft",
        "click [data-js-private]": "setOptionPrivate",
        "click [data-js-queue]": "setOptionQueue",
        "click [data-js-schedule]": "setOptionSchedule",
        "input [data-js-scheduleText]": "scheduleInputUpdated",
        "keypress [data-js-scheduleText]": "checkScheduleComplete"
      },
      mixins: [l, h, c, d],
      postStateOptions: ["published", "queued", "scheduled", "draft", "private"],
      template: m,
      initialize: function (t) {
        this.user = t.user
      },
      render: function () {
        return this.delegateEvents(), this._updateViewAttributes(), this.$el.html(this.template(this.serialize())), this._updateViewElements(), r.trigger("postForms:dismissListener:suspend"), this
      },
      teardown: function () {
        return this.$el.remove(), r.trigger("postForms:dismissListener:resume"), this
      },
      serialize: function () {
        var t = o.extend({__: a}, this.attributes);
        return t
      },
      _updateViewAttributes: function () {
        this.set({
          showPreview: this.model.canPreview(),
          state: this.model.get("pseudoState"),
          activeOptions: "edit" === this.model.get("mode") && this.model.get("createdPost") ? ["published", "private"] : this.postStateOptions
        })
      },
      _updateViewElements: function () {
        "scheduled" === this.model.get("state") ? this.js$("scheduleText").val(this.model.get("publish_on")) : s("[data-js-scheduleText]", this.$el).hide(), this.js$("preview").toggleClass("disabled", !this.model.isValid())
      },
      triggerPostPreview: function () {
        if (this.model.isValid()) {
          var t = this._previewPost();
          t && this.teardown()
        }
      },
      setOptionPublish: function () {
        this._unSchedule(), this.model.set({state: "published", is_private: !1}), this.teardown()
      },
      setOptionDraft: function () {
        this._unSchedule(), this.model.set("state", "draft"), this.teardown()
      },
      setOptionPrivate: function () {
        this._unSchedule(), this.model.set({state: "private", is_private: !0}), this.teardown()
      },
      setOptionQueue: function () {
        this._unSchedule(), this.model.set("state", "queued"), this.teardown()
      },
      setOptionSchedule: function () {
        if (!this.scheduling) {
          this.scheduling = !0, this._selectOption(this.js$("schedule")), this.model.set("state", "scheduled");
          var t = this.js$("scheduleText");
          if (!t.value) {
            var e = t.attr("placeholder");
            t.val(e), this.model.set("publish_on", e)
          }
          this.js$("scheduleText").show()
        }
      },
      scheduleInputUpdated: function (t) {
        this.model.set("publish_on", t.target.value)
      },
      checkScheduleComplete: function (t) {
        13 === t.which && this.teardown()
      },
      _selectOption: function (t) {
        this.js$("options").children().removeClass("icon_checkmark"), t.addClass("icon_checkmark")
      },
      _unSchedule: function () {
        this.scheduling = !1, this.model.set("publish_on", "")
      },
      _previewPost: function () {
        var t = this.model.get("tumblelog"), e = this.user.getChannel(t).get("blog_url") + "post/preview", i = this.model.toJSON({
          url: "/svc/post/update",
          forServer: !0
        });
        if (i.preview_key = p.fetchForBlog(t), o.isEmpty(i.preview_key))return !1;
        var s = new u({action: e, inputs: i});
        return s.render().$("form").css({
          "pointer-events": "none",
          overflow: "hidden",
          position: "absolute",
          bottom: 0,
          right: 0,
          width: 1,
          height: 1,
          opacity: 0
        }).appendTo("body").submit().remove(), !0
      }
    });
    e.exports = g
  }, {
    "../models/blog_preview_key": 242,
    "../templates/save_post_dropdown.tpl": 301,
    "./post_preview": 347,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/mixins/popoverbase": 583,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  366: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/subviewable"), a = t("prima/mixins/selectorcache"), r = t("prima/mixins/accessor"), l = t("../templates/social_buttons.tpl"), h = t("./tweet_dropdown"), c = o.extend({
      className: "post-forms--social-buttons",
      events: {
        "click [data-js-shareIcon]": "_onClickShareIcon",
        "mouseenter [data-js-twitterIcon]": "_onMouseEnterTwitterIcon"
      },
      mixins: [n, a, r],
      services: ["facebook", "twitter"],
      template: l,
      defaults: {facebook: !1, twitter: !1, facebookOn: !1, twitterOn: !1},
      initialize: function (t) {
        this.options = t = s.extend({}, t, {
          shift: {x: 90, y: 10},
          identifier: "postForms:tweetDropdown"
        }), s.extend(this, s.pick(t, "post", "user", "uploads", "dragEvents")), this.updateStateFromPost(), this.shouldShowSocialIcons() || this.set({
          twitter: !1,
          facebook: !1
        }), this.updatePostFromState()
      },
      _onClickShareIcon: function (t) {
        t.preventDefault();
        var e = this.$(t.currentTarget), i = e.parent(), s = i.data("service");
        switch (s) {
          case"twitter":
            this.post.set("send_to_twitter", !this.get("twitterOn")), this.toggleTweetDropdown(this.post.get("send_to_twitter"));
            break;
          case"facebook":
            this.post.set("send_to_fbog", !this.get("facebookOn"))
        }
      },
      _onMouseEnterTwitterIcon: function (t) {
        this.get("twitterOn") && (t.preventDefault(), this.toggleTweetDropdown(!0))
      },
      _onChangeTumblelog: function () {
        this.teardown(), this.updateStateFromPost(), this.updatePostFromState(), this.render()
      },
      _onChangePostState: function () {
        "private" === this.post.get("pseudoState") && this.post.changed.is_private ? (this.lastSettings = s.pick(this.attributes, "twitter", "facebook"), this.set({
          twitter: !1,
          facebook: !1
        })) : this.set(this.lastSettings)
      },
      shouldShowSocialIcons: function () {
        return "new" === this.post.get("mode") || "reblog" === this.post.get("mode") || "published" !== this.post.get("state") && "private" !== this.post.get("state")
      },
      updateStateFromPost: function () {
        var t = this.post.get("tumblelog"), e = this.user.getChannel(t), i = e.get("can_send_to_twitter"), o = e.get("can_send_to_facebook");
        this.shouldShowSocialIcons() || (i = o = !1);
        var n = this.post.get("send_to_twitter"), a = this.post.get("send_to_fbog");
        "edit" !== this.post.get("mode") && (n = e.get("twitter_send_posts"), a = e.get("facebook_opengraph_send_posts")), this.set({
          twitter: i,
          facebook: o,
          twitterOn: !!n,
          facebookOn: !!a
        }), this.lastSettings = s.pick(this.attributes, "twitter", "facebook")
      },
      updatePostFromState: function () {
        this.post.set({send_to_twitter: this.get("twitterOn"), send_to_fbog: this.get("facebookOn")})
      },
      toggleTweetDropdown: function (t) {
        t ? !1 === this.tweetDropdown.isRendered() && this.tweetDropdown.render() : this.tweetDropdown.teardown()
      },
      serialize: function () {
        return this.toJSON()
      },
      beforeRender: function () {
        this.tweetDropdown = new h(this.options), this.listenTo(this.post, "change:send_to_fbog", function (t, e) {
          this.set("facebookOn", !!e)
        }), this.listenTo(this.post, "change:send_to_twitter", function (t, e) {
          this.set("twitterOn", !!e)
        }), this.listenTo(this, "change:twitterOn", function (t, e) {
          this.js$("twitter").toggleClass("hidden", !this.get("twitter")).toggleClass("checked", e)
        }), this.listenTo(this, "change:facebookOn", function (t, e) {
          this.js$("facebook").toggleClass("hidden", !this.get("facebook")).toggleClass("checked", e)
        })
      },
      render: function () {
        return this.$el.html(this.template(this.toJSON())), this.tweetDropdown.setPinnedTarget(this.js$("tweetDropdownPin")), this
      },
      afterRender: function () {
        this.listenTo(this.post, "change:state", this._onChangePostState), this.listenTo(this.post, "change:tumblelog", this._onChangeTumblelog), this.listenTo(this.post, "change:send_to_twitter", function (t, e) {
          e || this.post.unset("customTweet")
        })
      },
      teardown: function () {
        return this.stopListening(), this.tweetDropdown.teardown(), this
      }
    });
    e.exports = c
  }, {
    "../templates/social_buttons.tpl": 302,
    "./tweet_dropdown": 373,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  367: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("prima/lib/translate"), r = t("prima/mixins/accessor"), l = t("prima/mixins/subviewable"), h = t("prima/mixins/selectorcache"), c = t("./plaintext_editor"), d = t("./tag_suggest"), u = t("app/components/sortable/sortable"), p = t("../templates/tag_editor.tpl"), m = t("./tag_label"), g = n.extend({
      className: "post-form--tag-editor",
      defaults: {
        maxTagLength: 140,
        suggestMinLength: 2,
        showSuggestPopover: !1,
        editorHistory: [],
        sortableTags: null,
        currentlySelectedTags: [],
        tagEntryPlaceholder: ".tag-input-wrapper .editor-plaintext",
        currentTag: null
      },
      mixins: [r, l, h],
      template: p,
      events: {click: "focusOnTagEditor"},
      initialize: function (t) {
        this.options = t = s.pick(t, "post", "user", "model"), s.extend(this, s.pick(t, "post", "user")), this.placeholder = a("#tags")
      },
      addTagProperties: function (t, e) {
        this.listenTo(t, "toggleTagSelection", this.toggleTagSelection), this.listenTo(t, "addHoverStyle", this.addHoverStyle), this.listenTo(t, "removeHoverStyle", this.removeHoverStyle), t.el.draggable = !0, this.subViews["tagLabel_" + e] = t, this.tagLabelViews.push(t)
      },
      createSubViews: function () {
        var t = s.extend({
          placeholder: this.model.get("tags").length > 0 ? !1 : this.placeholder,
          name: "tagInput",
          forceSingleLine: !0,
          onClientEvent: s.bind(this.handleInputKeys, this),
          ariaLabel: a("Post tags")
        }, this.options), e = {
          post: this.post,
          user: this.user,
          shift: {x: 0, y: 15},
          identifier: "postForms:tagSuggest"
        };
        this.tagInput = this.subViews.tagInputField = new c(t), this.tagSuggest = new d(e), this.tagLabelViews = [], s.forEach(this.post.get("tags"), function (t) {
          var e = new m({label: t});
          this.addTagProperties(e, t)
        }, this), this.makeTagsSortable()
      },
      attachSubViews: function (t) {
        return this.attachSubView(this.tagInput, "tagInputField"), s.forEach(this.tagLabelViews, function (t) {
          this.js$("tagInputFieldWrapper").before(t.$el)
        }, this), this
      },
      beforeRender: function () {
        this.createSubViews(), this.addTagEditorListeners()
      },
      render: function () {
        return this.$el.html(this.template()), this.attachSubViews(), this
      },
      afterRender: function () {
        this.renderSubViews(), this.tagSuggest.setPinnedTarget(this.js$("tagInputGhost")), o(this.tagInput.editor.element).on("blur", s.bind(this.submitTag, this))
      },
      teardown: function () {
        return this.stopListening(), this.tagLabelViews = [], this.set("sortableTags", null), this.set("currentlySelectedTags", []), this
      },
      makeTagsSortable: function () {
        this.set("sortableTags", new u({
          el: this.el,
          itemClassName: ".tag-label",
          dropInParent: !0,
          afterDragEnd: s.bind(this.saveTagOrder, this),
          transparentPlaceholder: !0,
          scrollable: !1
        })).on("dragstart", this.selectCurrentTag, this)
      },
      selectCurrentTag: function (t) {
        this.set("currentlySelectedTags", []), this.$(".tag-label").removeClass("selected"), this.set("currentTag", this.$(".sortable-dragging").text())
      },
      getTagOrder: function () {
        return s.map(this.$(".tag-label"), function (t) {
          return o(t).text()
        })
      },
      setTagOrder: function (t) {
        t || (t = this.getTagOrder()), s.forEach(this.tagLabelViews, function (t) {
          this.stopListening(t)
        }, this), this.removeTags(), this.removePlaceholder();
        for (var e = 0; e < t.length; e++)this.addTag(t[e]);
        this.post.set("tags", t)
      },
      saveTagOrder: function () {
        if (this.post.get("tags").length <= 1)return !1;
        var t = this.getTagOrder();
        return s.isEqual(t, this.post.get("tags")) || this.setTagOrder(t), !0
      },
      addTagEditorListeners: function () {
        this.listenTo(this.model, "change:tagInput", this.handleTagInput), this.listenTo(this.tagInput, "tagInput:submitTag", this.submitTag), this.listenTo(this.tagSuggest, "tagSuggest:submitTag", this.submitTag), this.listenTo(this.tagInput, "tagInput:backspace", this.handleBackspace),
          this.tagSuggest.listenTo(this, "tagEditor:fetchSuggestions", this.tagSuggest.fetchSuggestions), this.tagSuggest.listenTo(this.tagInput, "tagInput:cycleUp", this.tagSuggest.cycleUp), this.tagSuggest.listenTo(this.tagInput, "tagInput:cycleDown", this.tagSuggest.cycleDown), this.tagSuggest.listenTo(this.tagInput, "tagInput:dismissSuggestions", this.tagSuggest.dismiss)
      },
      handleInputKeys: function (t) {
        var e, i = ["keyup", "keydown", "keypress"], s = {
          keydown: {
            38: "tagInput:cycleUp",
            40: "tagInput:cycleDown",
            8: "tagInput:backspace",
            9: "tagInput:submitTag",
            13: "tagInput:submitTag"
          }, keypress: {44: "tagInput:submitTag"}
        };
        if (-1 !== i.indexOf(t.type))if (t = t || window.event, e = t.which || t.keyCode, "keydown" === t.type || "keypress" === t.type)if (e in s[t.type]) {
          this.tagInput.trigger(s[t.type][e], t);
          var o = /Mac/.test(navigator.platform) ? t.metaKey : t.ctrlKey;
          8 === e || 13 === e && o || (t.preventDefault(), t.stopImmediatePropagation())
        } else this.tagInput.getEditorValue().length >= this.get("maxTagLength") && (t.preventDefault(), t.stopImmediatePropagation()); else if (e in s.keypress || e in s.keydown && 8 !== e)return !1
      },
      handleTagInput: function (t, e) {
        var i = e && e.length >= this.get("suggestMinLength");
        i ? this.trigger("tagEditor:fetchSuggestions", e, this._postTags()) : this.tagInput.trigger("tagInput:dismissSuggestions"), this.js$("tagInputGhost").text(e)
      },
      handleBackspace: function () {
        if (0 === this.tagInput.getEditorValue().length) {
          var t = this.get("currentlySelectedTags");
          t.length > 0 ? (s.forEach(t, function (t) {
            this.removeTag(t)
          }, this), this.set("currentlySelectedTags", []), this.$(this.get("tagEntryPlaceholder")).removeClass("tiny-width")) : this._postTags().length && this.removeTag()
        }
      },
      submitTag: function (t) {
        if (t && "blur" === t.type) {
          if (this._postTags().length || this.tagInput.editor.setPlaceholder(this.placeholder), this.tagSuggest.get("interactive"))return
        } else this.tagInput.editor.setPlaceholder(!1);
        var e = this.tagSuggest.get("interactive") ? this.tagSuggest.getCycledTag() : this.tagInput.getEditorValue();
        if ("" === e)return void this.trigger("postForms:focusOnNextEditor", t);
        e = e.toString().replace(/[,#]/g, ""), e.match(/<.*>/) && (e = e.replace(/[<>]/g, function (t) {
          return s.escape(t)
        }));
        var i = e.match(/"/g), o = i ? i.length : 0;
        if (o % 2 === 1) {
          var n = e.lastIndexOf('"');
          e = e.replace(/"/g, function (t, e) {
            return e === n ? '"' : ""
          })
        } else o > 0 && (e = e.replace(/"/g, ""));
        e = e.trim().substr(0, this.get("maxTagLength")), this.clearInput();
        var a = this.addTag(e);
        if (a) {
          var r = t ? t.which || t.keyCode : !1;
          if (r === !1 || "focusout" !== t.type && (9 !== r || !t.shiftKey))return this.tagInput.focus(), !1
        }
      },
      addTag: function (t) {
        if (t && !s.contains(this._postTags(!0), t.toLowerCase())) {
          this.post.get("tags").push(t);
          var e = new m({label: t});
          return this.addTagProperties(e, t), this.js$("tagInputFieldWrapper").before(e.render().$el), this.removePlaceholder(), !0
        }
        return !1
      },
      removeTag: function (t) {
        if (t || (t = s.last(this.post.get("tags"))), !t)return !1;
        var e = s.without(this._postTags(), t);
        s.isEmpty(e) && (this.setPlaceholder(this.placeholder), this.tagInput.editor.setPlaceholder(this.placeholder)), this.model.set("tags", e);
        var i = this.subViews["tagLabel_" + t];
        return i && (i.remove(), this.subViews["tagLabel_" + t] = null, s.remove(this.tagLabelViews, function (t) {
          return i === t
        })), !0
      },
      removeTags: function () {
        s.each(this.model.get("tags"), function (t) {
          this.removeTag(t)
        }, this), this.setPlaceholder(this.placeholder)
      },
      clearInput: function () {
        this.tagInput.trigger("tagInput:dismissSuggestions"), this.tagInput.setEditorValue("")
      },
      removePlaceholder: function () {
        this.setPlaceholder(null), this.$(this.get("tagEntryPlaceholder")).addClass("tiny-width")
      },
      setPlaceholder: function (t) {
        this.tagInput.editor.setPlaceholder(t), this.$(this.get("tagEntryPlaceholder")).removeClass("tiny-width")
      },
      _postTags: function (t) {
        return t ? s.map(this.model.get("tags"), function (t) {
          return t.toLowerCase()
        }) : s.clone(this.model.get("tags"))
      },
      focusOnTagEditor: function (t) {
        this.subViews.tagInputField.focus()
      },
      toggleTagSelection: function (t) {
        var e = o(t.target), i = o(t.target).text(), s = this.get("currentlySelectedTags"), n = s.indexOf(i), a = /Mac/.test(navigator.platform) ? t.metaKey : t.ctrlKey;
        a ? 0 > n ? (s.push(i), this.set("currentlySelectedTags", s), e.addClass("selected")) : (s.splice(n, 1), this.set("currentlySelectedTags", s), e.removeClass("selected"), e.removeClass("hover-style")) : 0 > n || s.length > 1 ? (this.set("currentlySelectedTags", [i]), this.$(".tag-label").removeClass("selected"), e.addClass("selected")) : (this.unselectAllTags(), e.removeClass("hover-style"))
      },
      addHoverStyle: function (t) {
        this.get("currentTag") && t.label !== this.get("currentTag") || this.$(t.eventTarget).addClass("hover-style")
      },
      removeHoverStyle: function (t) {
        this.$(".tag-label").removeClass("hover-style"), this.set("currentTag", null)
      },
      unselectAllTags: function (t) {
        this.set("currentlySelectedTags", []), this.$(".tag-label").removeClass("selected")
      }
    });
    e.exports = g
  }, {
    "../templates/tag_editor.tpl": 303,
    "./plaintext_editor": 345,
    "./tag_label": 368,
    "./tag_suggest": 369,
    "app/components/sortable/sortable": 388,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  368: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("prima/mixins/subviewable"), r = t("prima/mixins/selectorcache"), l = o.extend({
      className: "tag-label",
      defaults: {label: ""},
      mixins: [n, a, r],
      events: {click: "toggleTagSelection", mouseover: "hoveredTag", mouseout: "unhoveredTag"},
      tagName: "span",
      initialize: function (t) {
        t = s.extend({}, t), this.set(s.pick(t, s.keys(this.defaults)))
      },
      render: function () {
        return this.$el.text(this.get("label")), this
      },
      toggleTagSelection: function (t) {
        this.trigger("toggleTagSelection", t)
      },
      hoveredTag: function (t) {
        this.trigger("addHoverStyle", {label: this.get("label"), eventTarget: t.target})
      },
      unhoveredTag: function (t) {
        this.trigger("removeHoverStyle", t)
      }
    });
    e.exports = l
  }, {
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  369: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("prima/events"), r = t("../models/tag_suggestion"), l = t("prima/mixins/accessor"), h = t("prima/mixins/popoverbase"), c = t("prima/mixins/selectorcache"), d = t("../templates/tag_suggest.tpl"), u = n.extend({
      className: "popover--tag-suggest",
      defaults: {
        currentKeyedChoice: -1,
        currentMousedChoice: -1,
        interactive: !1,
        numSuggestions: 0,
        suggestPending: !1,
        lastResults: {}
      },
      mixins: [l, c, h],
      template: d,
      initialize: function (t) {
        this.model = new r(t), this.post = t.post, this.listenTo(this.model, "error", this._fetchSuggestionsError), this.listenTo(this, "change:lastResults", this.preRender)
      },
      preRender: function (t, e) {
        var i = s.reduce(e.results, function (t, e) {
          return t + (s.isArray(e) ? e.length : 0)
        }, 0);
        this.set({currentKeyedChoice: -1, interactive: !1});
        var o = this.get("suggestPending");
        i > 0 && o !== !1 && -1 === this.post.get("tags").indexOf(o) && this.render()
      },
      render: function () {
        return this.$el.html(this.template(this.get("lastResults"))), a.trigger("postForms:dismissListener:suspend"), this
      },
      afterRender: function () {
        this.$tagSuggestWrapper = this.js$("tagSuggestWrapper"), o(".item-option", this.$el).on("click", s.bind(this.selectCurrentCycledChoice, this)), o(".item-option", this.$el).on("mouseover", s.bind(this.handleMouseOver, this)), this.$el.on("mouseout", s.bind(this.handleMouseOut, this))
      },
      teardown: function () {
        return this.$el.remove(), a.trigger("postForms:dismissListener:resume"), this
      },
      cycleUp: function () {
        this._cycle(-1)
      },
      cycleDown: function () {
        this._cycle(1)
      },
      _cycle: function (t) {
        var e = this.get("currentKeyedChoice"), i = this.get("currentMousedChoice"), o = s.isNumber(i) && -1 !== i, n = o ? i : e, a = (n + t) % this.get("numSuggestions");
        this.get("numSuggestions") && (this.set({
          currentKeyedChoice: a >= 0 ? a : -1,
          currentMousedChoice: -1
        }), this.styleMenuItems(), this.set("interactive", this.get("currentKeyedChoice") >= 0))
      },
      getCycledTag: function () {
        return o(".item-option.cycled", this.$el).data("tag")
      },
      selectCurrentCycledChoice: function (t) {
        this.set("interactive", !0), o(t.currentTarget).addClass("cycled"), this.trigger("tagSuggest:submitTag")
      },
      styleMenuItems: function (t) {
        var e, i = t && "mouseout" !== t.type, n = this.get("currentKeyedChoice");
        s.each(o(".item-option", this.$el), function (s, a) {
          i ? o(s).toggleClass("cycled", t.currentTarget === s) : (o(s).toggleClass("cycled", a === n), a === n && (e = o(s)))
        }, this), i || -1 === n || this.cycleScroll(e)
      },
      cycleScroll: function (t) {
        var e = parseInt(t.position().top, 10), i = e + parseInt(t.height(), 10), s = parseInt(t.outerHeight(), 10), o = parseInt(this.$tagSuggestWrapper.height(), 10), n = parseInt(this.$tagSuggestWrapper.scrollTop(), 10);
        i > o ? this.$tagSuggestWrapper.scrollTop(n + s) : 0 > e && this.$tagSuggestWrapper.scrollTop(e + n)
      },
      handleMouseOver: function (t) {
        this.styleMenuItems(t), this.set({
          interactive: !0,
          currentMousedChoice: o(t.currentTarget).index(".item-option")
        })
      },
      handleMouseOut: function (t) {
        this.styleMenuItems(t), this.set({interactive: -1 !== this.get("currentKeyedChoice"), currentMousedChoice: -1})
      },
      fetchSuggestions: s.debounce(function (t, e) {
        var i = {query: t, success: s.bind(this.renderQueryResults, this), existing: e};
        this.set("suggestPending", t), this.model.fetch(i)
      }, 100),
      _fetchSuggestionsError: s.noop,
      renderQueryResults: function (t, e, i) {
        var s = this.finalResultsFilter(t.attributes.tagSuggestions, i.existing);
        this.set("numSuggestions", s.userTags.length + s.suggestions.length), this._rendered && this.teardown(), this.set("lastResults", {
          results: s,
          queryRegex: new RegExp(this.model._escapeRegex(i.query), "i")
        })
      },
      finalResultsFilter: function (t, e) {
        return s.mapValues(t, function (t) {
          return s.difference(t, e)
        })
      },
      dismiss: function () {
        this.teardown(), this.set({interactive: !1, suggestPending: !1, lastResults: {}})
      }
    });
    e.exports = u
  }, {
    "../models/tag_suggestion": 251,
    "../templates/tag_suggest.tpl": 304,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/accessor": 577,
    "prima/mixins/popoverbase": 583,
    "prima/mixins/selectorcache": 586,
    "prima/view": 612
  }],
  370: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("prima/mixins/subviewable"), r = t("prima/mixins/selectorcache"), l = t("prima/mixins/popoverbase"), h = t("../templates/tooltip.tpl"), c = o.extend({
      className: "tooltip-popover",
      mixins: [n, a, r, l],
      template: h,
      defaults: {sanitize: !0, text: ""},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults)))
      },
      serialize: function () {
        return this.toJSON()
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this._popoverBase.pinnedSide = "none", this._popoverBase.shift.x = 4 + this.$pinned.width(), this._popoverBase.shift.y = 8, this
      },
      teardown: function () {
        return this.$el.remove(), this
      }
    });
    e.exports = c
  }, {
    "../templates/tooltip.tpl": 306,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/popoverbase": 583,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  371: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("prima/mixins/subviewable"), r = t("prima/mixins/selectorcache"), l = t("../templates/tumblelog_select.tpl"), h = t("./tumblelog_select_dropdown"), c = o.extend({
      defaults: {modeRequiresDropdown: !0},
      events: {"click [data-js-clickableTumblelogLabel]": "toggleTumblelogSelectDropdown"},
      mixins: [n, a, r],
      template: l,
      initialize: function (t) {
        this.options = t || {}, this.user = t.user, this.listenTo(this.model, "change:tumblelog", this.adjustLabel), this.set("modeRequiresDropdown", "edit" !== this.model.get("mode"))
      },
      render: function () {
        return this.$el.html(this.template({post: this.model})), this.adjustLabel(), this.createDropdown(), this
      },
      createDropdown: function () {
        var t = s.extend(this.options, {shift: {x: 0, y: 10}, identifier: "postForms:tumblelogSelectDropdown"});
        this.get("modeRequiresDropdown") && (this.tumblelogSelectDropdown = new h(t), this.tumblelogSelectDropdown.setPinnedTarget(this.js$("tumblelogSelectPin")))
      },
      toggleTumblelogSelectDropdown: function () {
        this.get("modeRequiresDropdown") && (this.tumblelogSelectDropdown.isOrWasRecentlyRendered() || this.tumblelogSelectDropdown.render())
      },
      adjustLabel: function () {
        var t, e;
        this.user && this.model && (t = this.model.get("tumblelog"), e = this.user.getChannel(t), this.js$("tumblelogLabel").text(e ? e.getDisplayName() : t))
      }
    });
    e.exports = c
  }, {
    "../templates/tumblelog_select.tpl": 307,
    "./tumblelog_select_dropdown": 372,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  372: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/events"), a = t("app/lib/avatar-size"), r = t("prima/mixins/accessor"), l = t("prima/mixins/selectorcache"), h = t("prima/mixins/popoverbase"), c = t("app/lib/currentuser"), d = t("../templates/tumblelog_select_dropdown.tpl"), u = o.extend({
      className: "popover--tumblelog-select-dropdown",
      events: {"click [data-js-tumblelogChoice]": "selectBlog"},
      mixins: [r, l, h],
      template: d,
      defaultOptions: {size: 128},
      defaults: {tumblelog: !1},
      initialize: function (t) {
        this.options = t = s.extend({}, this.defaultOptions, t), this.user = t.user || c(), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), this.get("tumblelog") || this.set("tumblelog", this.user.getChannel().get("name"))
      },
      render: function () {
        return this.delegateEvents(), this.$el.html(this.template(this.serialize())), n.trigger("postForms:dismissListener:suspend"), this
      },
      teardown: function () {
        return this.$el.remove(), n.trigger("postForms:dismissListener:resume"), this
      },
      serialize: function () {
        var t = this.toJSON();
        return t.channels = this.user.channels.map(function (t) {
          return s.extend({
            avatarUrl: a(t.get("avatar_url"), this.options.size),
            displayName: t.getDisplayName()
          }, t.toJSON())
        }, this), t
      },
      selectBlog: function (t) {
        var e = this.$(t.currentTarget).index();
        this.model.set("tumblelog", this.user.channels.at(e).get("name")), this.teardown()
      }
    });
    e.exports = u
  }, {
    "../templates/tumblelog_select_dropdown.tpl": 308,
    "app/lib/avatar-size": 456,
    "app/lib/currentuser": 459,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/accessor": 577,
    "prima/mixins/popoverbase": 583,
    "prima/mixins/selectorcache": 586,
    "prima/view": 612
  }],
  373: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/events"), a = t("prima/mixins/accessor"), r = t("prima/mixins/subviewable"), l = t("prima/mixins/selectorcache"), h = t("prima/mixins/popoverbase"), c = t("../templates/tweet_dropdown.tpl"), d = t("../utils/string_helpers").truncateLongStrings, u = o.extend({
      className: "popover--tweet-dropdown",
      defaults: {focused: !1},
      events: {
        "input [data-js-customTweet]": "_onCustomTweetInput",
        "keyup [data-js-customTweet]": "_onCustomTweetInput",
        "change [data-js-customTweet]": "_onCustomTweetInput",
        "click [data-js-dismissTweet]": "_onClickDismissTweet",
        keydown: "_onKeyDown"
      },
      mixins: [a, r, l, h],
      template: c,
      _onCustomTweetInput: function (t) {
        var e = s.trim(this.js$("customTweet").val());
        this.model.set("customTweet", e), this.truncateTweet()
      },
      _onClickDismissTweet: function () {
        this.teardown()
      },
      _onKeyDown: function (t) {
        27 === t.keyCode && (t.stopPropagation(), this.teardown())
      },
      _onChangePost: function () {
        s.isString(this.model.get("customTweet")) || this.js$("customTweet").val(this.model.getTweetText()), this.updateTweetLengthCount()
      },
      updateTweetLengthCount: function (t) {
        var e = this.model.getTweetTextLength();
        this.js$("tweetRemaining").text(140 - e)
      },
      truncateTweet: function () {
        var t = this.js$("customTweet"), e = t.get(0), i = t.val(), s = i;
        if (!(this.model.getTweetTextLength(i) <= 140)) {
          var o = this.model.shortUrlLength, n = i.match(/\[URL\]/gi), a = !0;
          if (n && 1 === n.length) {
            var r = i.toLowerCase().indexOf("[url]");
            140 - o - 1 > r ? (i = d(i, 140 - o + 5), a = !1) : r && (i = d(i.split(/\[URL\]/i).join(""), 140 - o - 1) + " [URL]")
          } else i = d(i, 140);
          if (this.model.set("customTweet", i), s !== i) {
            var l = e.selectionEnd || 0, h = t.scrollTop();
            if (a) {
              var c = i.toLowerCase().lastIndexOf(" [url]");
              0 > c && (c = i.toLowerCase().lastIndexOf("[url]")), 0 > c && (c = i.toLowerCase().lastIndexOf(" [url]")), 0 > c && (c = i.toLowerCase().lastIndexOf("[url]")), c >= 0 && l > c && (l = c)
            }
            if (l = Math.max(0, Math.min(l, i.length)), t.val(i).focus(), e.setSelectionRange)e.setSelectionRange(l, l); else if (e.createRange) {
              var u = e.createRange();
              u.setStart("character", l), u.setEnd("character", l), u.select()
            }
            t.scrollTop(h)
          }
        }
      },
      setCaret: function (t) {
        var e = this.js$("customTweet"), i = e.get(0), s = e.val(), o = s.toLowerCase().lastIndexOf(" [url]");
        if (0 > o && (o = s.toLowerCase().lastIndexOf("[url]"), t && o >= 0 && (s = s.slice(0, o) + " " + s.slice(o), this.js$("customTweet").val(s))), 0 > o && (o = s.length), e.focus(), i.setSelectionRange)i.setSelectionRange(o, o); else if (i.createRange) {
          var n = i.createRange();
          n.setStart("character", o), n.setEnd("character", o), n.select()
        }
      },
      serialize: function () {
        return s.extend({
          tweetText: this.model.getTweetText(),
          tweetRemaining: 140 - this.model.getTweetTextLength()
        }, this.toJSON())
      },
      afterRender: function () {
        this.listenTo(this.model, "change", this._onChangePost), s.defer(s.bind(function () {
          this.setCaret(!0)
        }, this))
      },
      render: function () {
        return this.delegateEvents(), this.$el.html(this.template(this.serialize())), this.model.get("customTweet") && this.js$("customTweet").val(this.model.get("customTweet")), n.trigger("postForms:dismissListener:suspend"), this
      },
      teardown: function () {
        return "" === this.model.get("customTweet") && this.model.set("send_to_twitter", !1), this.remove(), n.trigger("postForms:dismissListener:resume"), this
      }
    });
    e.exports = u
  }, {
    "../templates/tweet_dropdown.tpl": 309,
    "../utils/string_helpers": 320,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/accessor": 577,
    "prima/mixins/popoverbase": 583,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  374: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("prima/mixins/subviewable"), r = t("prima/mixins/selectorcache"), l = t("../templates/uploading_indicator.tpl"), h = t("components/knight-rider-loader"), c = o.extend({
      className: "post-form--uploading-indicator",
      mixins: [n, a, r],
      template: l,
      defaults: {isUploading: !0, isVisible: !0, delay: 200},
      initialize: function (t) {
        this.options = t = s.extend({}, t), s.extend(this, s.pick(t, "post", "user", "uploads")), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), this.updateIsUploading(), this.set("isVisible", this.get("isUploading"))
      },
      _onChangeIsUploading: function (t, e) {
        e ? (clearTimeout(this._changeIsVisibleTimeout), this._changeIsVisibleTimeout = !1, this.set("isVisible", e)) : this._changeIsVisibleTimeout || (this._changeIsVisibleTimeout = s.delay(s.bind(function () {
          this._changeIsVisibleTimeout = !1, this.set("isVisible", e)
        }, this), this.get("delay")))
      },
      _onChangeIsVisible: function (t, e) {
        this.loader.set("loading", e)
      },
      updateIsUploading: function () {
        this.set("isUploading", this.post.get("hasLoadingInlineImages") || this.uploads.anyUploading() || this.post.get("loading"))
      },
      serialize: function () {
        return this.toJSON()
      },
      beforeRender: function () {
        this.loader = this.subViews.loader = new h({variation: "small"}), this.listenTo(this.uploads, "change:uploading", this.updateIsUploading), this.listenTo(this.post, "change:loading", this.updateIsUploading), this.listenTo(this.post, "change:hasLoadingInlineImages", this.updateIsUploading), this.listenTo(this, "change:isUploading", this._onChangeIsUploading), this.listenTo(this, "change:isVisible", this._onChangeIsVisible)
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.updateIsUploading(), this.loader.set("loading", this.get("isVisible")), this.attachSubViews(), this
      }
    });
    e.exports = c
  }, {
    "../templates/uploading_indicator.tpl": 310,
    "components/knight-rider-loader": 496,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  375: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("velocity-animate").animate, n = t("prima/view"), a = t("prima/mixins/accessor"), r = t("prima/mixins/subviewable"), l = t("prima/mixins/selectorcache"), h = t("../templates/webcam_button.tpl"), c = n.extend({
      className: "webcam-button-container",
      template: h,
      events: {mouseenter: "_onMouseEnter", mouseleave: "_onMouseLeave"},
      mixins: [a, r, l],
      wink: function (t) {
        !s.isUndefined(t) || (t = !this.js$("smiley").hasClass("icon_postforms_selfie_wink")), this.js$("smiley").toggleClass("icon_postforms_selfie_wink", t), this.js$("smiley").toggleClass("icon_postforms_selfie", !t)
      },
      _onMouseEnter: function () {
        var t = 100;
        o(this.js$("text"), "stop"), o(this.js$("text"), {opacity: 1}, {duration: t});
        var e = this.js$("smiley").outerWidth() + this.js$("text").outerWidth();
        o(this.$el, "stop"), o(this.$el, {
          marginLeft: -Math.round(.5 * e),
          width: e
        }, {duration: t}).then(s.bind(function () {
          this._winkTimeout = s.delay(s.bind(function () {
            this.wink(!0), this._winkTimeout = s.delay(s.bind(function () {
              this.wink(!1)
            }, this), 100)
          }, this), 400)
        }, this))
      },
      _onMouseLeave: function () {
        var t = 100;
        clearTimeout(this._winkTimeout), this.wink(!1), o(this.js$("text"), "stop"), o(this.js$("text"), {opacity: 0}, {duration: t});
        var e = this.js$("smiley").outerWidth();
        o(this.$el, "stop"), o(this.$el, {
          marginLeft: -Math.round(.5 * e),
          width: e
        }, {duration: t}).then(s.bind(function () {
        }))
      },
      render: function () {
        return this.$el.html(this.template()), this
      },
      teardown: function () {
        return clearTimeout(this._winkTimeout), this
      }
    });
    e.exports = c
  }, {
    "../templates/webcam_button.tpl": 311,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612,
    "velocity-animate": "lWl/mc"
  }],
  376: [function (t, e, i) {
    var s = t("prima/collection"), o = t("../models/reblog-list-item"), n = s.extend({model: o});
    e.exports = n
  }, {"../models/reblog-list-item": 377, "prima/collection": 544}],
  377: [function (t, e, i) {
    var s = t("prima/model"), o = s.extend({defaults: {pid: null, name: null, permalink: null, content: null}});
    e.exports = o
  }, {"prima/model": 590}],
  378: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="reblog-header">', permalink ? (__p += '<a class="reblog-avatar ' + (null == (__t = isOriginalEntry || isFirstEntry ? "" : "sub-icon-reblog") ? "" : __t) + '" href="' + (null == (__t = permalink) ? "" : _.escape(__t)) + '">', avatar_url && (__p += '<img class="reblog-avatar-image-thumb" src="' + (null == (__t = avatar_url) ? "" : _.escape(__t)) + '">'), __p += '</a> <a class="reblog-tumblelog-name" href="' + (null == (__t = permalink) ? "" : _.escape(__t)) + '">' + (null == (__t = name) ? "" : _.escape(__t)) + "</a>") : (__p += ' <span class="reblog-avatar inactive ' + (null == (__t = isOriginalEntry ? "" : "sub-icon-reblog") ? "" : __t) + '">', avatar_url && (__p += '<img class="reblog-avatar-image-thumb" src="' + (null == (__t = avatar_url) ? "" : _.escape(__t)) + '">'), __p += '</span> <span class="reblog-tumblelog-name inactive">' + (null == (__t = name) ? "" : _.escape(__t)) + "</span>"), __p += "</div>", title && (__p += '<div class="reblog-title">' + (null == (__t = title) ? "" : _.escape(__t)) + "</div>"), __p += "", content && "" !== content && (__p += '<div class="reblog-content">' + (null == (__t = content) ? "" : __t) + "</div>"), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  379: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="reblog-header"><span class="reblog-avatar">', avatar_url && (__p += '<img class="reblog-avatar-image-thumb" src="' + (null == (__t = avatar_url) ? "" : _.escape(__t)) + '">'), __p += '</span> <span class="reblog-tumblelog-name inactive">' + (null == (__t = name) ? "" : _.escape(__t)) + "</span></div>", title && (__p += '<div class="reblog-title">' + (null == (__t = title) ? "" : _.escape(__t)) + "</div>"), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  380: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="control-reblog-trail post"><div class="reblog-trail-post-content">', isRemovable && (__p += '<div class="remove-button-wrapper" data-subview="removeButton"></div><div class="btn-show-trail btn-toggle-reblog">' + (null == (__t = __("Put reblogs back")) ? "" : _.escape(__t)) + "</div>"), __p += "", this.subviews.reblogCollectionView && (__p += "" + (null == (__t = _subview("reblogCollectionView")) ? "" : __t)), __p += "</div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  381: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../templates/reblog-list-item.tpl"), a = o.extend({
      className: "reblog-list-item",
      template: n,
      defaults: {},
      initialize: function (t) {
        this.options = s.merge({}, this.defaults, t), this.options.origTextPost && this.$el.addClass("reblog-list-item--text-post-original")
      },
      getTemplateData: function () {
        var t = {
          name: this.model.get("name"),
          permalink: this.model.get("permalink"),
          avatar_url: this.model.get("avatar_url"),
          title: this.model.get("title"),
          content: s.trim(this.model.get("content")) ? this.model.get("content") : "",
          isOriginalEntry: this.model.get("is_original_entry"),
          isFirstEntry: this.options.isFirstEntry
        };
        return t
      }
    });
    e.exports = a
  }, {"../templates/reblog-list-item.tpl": 378, lodash: "MicNly", "prima/views/base": 613}],
  382: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../templates/reblog-list-title.tpl"), a = o.extend({
      className: "reblog-list-title reblog-list-item",
      template: n,
      defaults: {},
      initialize: function (t) {
        this.options = s.merge({}, this.defaults, t)
      },
      getTemplateData: function () {
        var t = {
          name: this.model.get("name"),
          avatar_url: this.model.get("avatar_url"),
          title: this.model.get("title")
        };
        return t
      }
    });
    e.exports = a
  }, {"../templates/reblog-list-title.tpl": 379, lodash: "MicNly", "prima/views/base": 613}],
  383: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("./reblog-list-item"), a = t("../models/reblog-list-item"), r = t("./reblog-list-title"), l = o.extend({
      className: "reblog-list",
      initialize: function (t) {
        this.options = s.merge({}, this.defaults, t);
        var e = this.collection, i = "text" === this.options.postType, o = this.options.titleData;
        if (o) {
          var l = new a(o);
          this.subviews["reblog-list-item-title"] = new r({model: l})
        }
        e.each(function (t, e) {
          var s = i && t.get("is_original_entry");
          this.subviews["reblog-list-item-" + e] = new n({model: t, origTextPost: s, isFirstEntry: 0 === e})
        }, this)
      },
      render: function () {
        return s.each(this.subviews, s.bind(function (t) {
          this.$el.append(t.render().$el)
        }, this)), this
      },
      teardown: function () {
        return s.each(this.subviews, function (t) {
          t.remove()
        }), this
      }
    });
    e.exports = l
  }, {
    "../models/reblog-list-item": 377,
    "./reblog-list-item": 381,
    "./reblog-list-title": 382,
    lodash: "MicNly",
    "prima/views/base": 613
  }],
  384: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/mixins/selectorcache"), n = t("prima/lib/translate"), a = t("prima/views/base"), r = t("../collections/reblog-list"), l = t("app/components/remove-button"), h = t("./reblog-list"), c = t("../templates/reblog-list.tpl"), d = a.extend({
      template: c,
      defaults: {isRemovable: !1},
      mixins: [o],
      events: {
        "click .btn-toggle-reblog": "toggleRemoveReblogTree",
        "mouseenter .reblog-trail-post-content": "_onMouseEnter",
        "mouseleave .reblog-trail-post-content": "_onMouseLeave"
      },
      initialize: function (t) {
        if (this.options = s.merge({}, this.defaults, t), this._getReblogTrail(this.model) && (this.reblogListCollection = new r(this._getReblogTrail(this.model))), this.reblogListCollection) {
          var e = this.reblogListCollection.length ? this.reblogListCollection.first().get("title") : !1, i = this._getCurrentTitleMeta(this.model);
          this.reblogCollectionView = this.subviews.reblogCollectionView = new h({
            collection: this.reblogListCollection,
            titleData: !e && i ? i : !1,
            postType: this.model.get("type")
          }), this.get("isRemovable") && (this.removeButton = this.subviews.removeButton = new l({
            tooltip: n("Remove reblogs"),
            buttonClass: "btn-remove-trail btn-toggle-reblog"
          }), this.listenTo(this.removeButton, "mouseenter", this._onMouseEnterRemoveButton), this.listenTo(this.removeButton, "mouseleave", this._onMouseLeaveRemoveButton))
        }
      },
      _getReblogData: function (t) {
        return JSON.parse(t.get("reblog_trail"))
      },
      _getReblogTrail: function (t) {
        return s.get(this._getReblogData(t), "reblog_entries")
      },
      _getCurrentTitleMeta: function (t) {
        return s.get(this._getReblogData(t), "current_title_meta")
      },
      getTemplateData: function () {
        return {isRemovable: this.get("isRemovable")}
      },
      toggleRemoveReblogTree: function () {
        var t = this.$$(".control-reblog-trail"), e = this.model.has("remove_reblog_tree") && this.model.get("remove_reblog_tree");
        this.model.set("remove_reblog_tree", !e), t.toggleClass("removed", !e)
      },
      _onMouseEnter: function () {
        this.removeButton.setActive()
      },
      _onMouseLeave: function () {
        this.removeButton.setInactive()
      },
      _onMouseEnterRemoveButton: function () {
        this.reblogCollectionView.$el.addClass("fade")
      },
      _onMouseLeaveRemoveButton: function () {
        this.reblogCollectionView.$el.removeClass("fade")
      }
    });
    e.exports = d
  }, {
    "../collections/reblog-list": 376,
    "../templates/reblog-list.tpl": 380,
    "./reblog-list": 383,
    "app/components/remove-button": 385,
    lodash: "MicNly",
    "prima/lib/translate": 575,
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  385: [function (t, e, i) {
    "use strict";
    var s = t("./views/remove-button.js");
    e.exports = s
  }, {"./views/remove-button.js": 387}],
  386: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="remove-button ' + (null == (__t = buttonClass) ? "" : _.escape(__t)) + '"><span class="icon"></span></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  387: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("prima/mixins/subviewable"), r = t("prima/mixins/selectorcache"), l = t("../templates/remove-button.tpl"), h = o.extend({
      events: {
        click: "_onClick",
        mouseenter: "_onMouseEnter",
        mouseleave: "_onMouseLeave"
      },
      template: l,
      mixins: [n, a, r],
      defaults: {dataJsName: "removeButton", buttonClass: ""},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), this.onClick = t.onClick
      },
      serialize: function () {
        return this.toJSON()
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.get("dataJsName") && this.$$(".remove-button").attr("data-js-" + this.get("dataJsName"), ""), this
      },
      setActive: function () {
        this.$$(".remove-button").addClass("active")
      },
      setInactive: function () {
        this.$$(".remove-button").removeClass("active")
      },
      _onClick: function () {
        s.isFunction(this.onClick) ? this.onClick(this) : this.trigger("remove")
      },
      _onMouseEnter: function () {
        this.trigger("mouseenter")
      },
      _onMouseLeave: function () {
        this.trigger("mouseleave")
      }
    });
    e.exports = h
  }, {
    "../templates/remove-button.tpl": 386,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  388: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("velocity-animate"), r = n.extend({
      initialize: function (t) {
        this.el = t.el || null, this.itemClassName = t.itemClassName || ".item", this.dropInParent = t.dropInParent || !1, this.transparentPlaceholder = t.transparentPlaceholder || !0, this.beforeDragStart = t.beforeDragStart || s.noop, this.afterDragEnd = t.afterDragEnd || s.noop, this.scrollable = t.scrollable || !1, this.isAnimating = !1, this.disableAnimation = t.disableAnimation || !1, this.disableAnimation && (this.calculateDropTarget = s.throttle(this.calculateDropTarget, 500)), this.$items = o(this.itemClassName), this.$currentlyDraggedItem = null, this.$placeholder = null, this.placeholderElement = null, this.renderedPlaceholder = !1, this.reloadItems()
      }, itemEvents: function (t) {
        t || (t = this.itemClassName);
        var e = {};
        return e["dragstart " + t] = "setPlaceholder", e["dragenter " + t] = "calculateDropTarget", e["dragend " + t] = "resetPlaceholder", this.dropInParent ? (e.dragover = "cancelEvent", e.drop = "dropItemAndResetPlaceholder") : (e["dragover " + t] = "cancelEvent", e["drop " + t] = "dropItem"), e
      }, setPlaceholder: function (t) {
        this.renderedPlaceholder = !1, t.originalEvent.dataTransfer.effectAllowed = "move";
        try {
          t.originalEvent.dataTransfer.setData("text/html", "")
        } catch (e) {
        }
        if (this.$currentlyDraggedItem = o(t.currentTarget), this.$currentlyDraggedItem) {
          if (this.$placeholder = this.$currentlyDraggedItem.clone().addClass("sortable-placeholder"), this.transparentPlaceholder && this.$placeholder.addClass("transparent-placeholder"), !this.disableAnimation) {
            var i = this.$currentlyDraggedItem.outerWidth();
            this.$placeholder.data("item-width", i).data("need-animation", !1)
          }
          this.placeholderElement = this.$placeholder.get(0), this.$currentlyDraggedItem.addClass("sortable-dragging"), this.beforeDragStart.call(this), this.trigger("dragstart", this), this.scrollable && (this.$el.on("dragover." + this.cid, s.throttle(function (t) {
            var e = .2, i = window.innerHeight, s = t.originalEvent.clientY / i, o = this.getBoundingClientRect();
            e > s && o.top < 0 ? window.scrollBy(0, -(200 * (e - s))) : s > 1 - e && window.scrollBy(0, 200 * (e + s - 1)),
              t.preventDefault()
          }, 50)), this.$currentlyDraggedItem.one("dragend", s.bind(function () {
            this.$el.off(["dragenter." + this.cid, "dragover." + this.cid].join(" "))
          }, this)))
        }
      }, calculateDropTarget: function (t) {
        if (this.$currentlyDraggedItem && !this.isAnimating) {
          t.preventDefault(), this.renderedPlaceholder = !0;
          var e = t.currentTarget, i = o(e);
          if (e === this.placeholderElement)return !1;
          this.$currentlyDraggedItem.hide();
          var s, n = i.index(this.itemClassName), a = this.$placeholder.index(this.itemClassName), r = this.$placeholder.data("need-animation") || !1, l = this.$placeholder.data("item-width");
          return this.disableAnimation || (s = o("<span>").css({
            width: l,
            display: "inline-block"
          }), this.$placeholder.after(s), r && this.$placeholder.css({
            width: 0,
            padding: 0
          })), n > a ? i.after(this.placeholderElement) : i.before(this.placeholderElement), this.disableAnimation || (r ? this.animatePlaceholderWidth(s, this.$placeholder, l, 200) : this.$placeholder.data("need-animation", !0)), this.lastDroppable = e, !1
        }
      }, animatePlaceholderWidth: function (t, e, i, o) {
        this.isAnimating = !0, a.animate(t, "stop"), a.animate(e, "stop"), a.animate(t, {width: 0}, o, "easeInOutQuart", s.bind(function () {
          t.remove(), this.isAnimating = !1
        }, this)), a.animate(e, {width: i}, o, "easeInOutQuart")
      }, cancelEvent: function (t) {
        this.$currentlyDraggedItem && t.preventDefault()
      }, dropItem: function (t) {
        return this.$currentlyDraggedItem && this.renderedPlaceholder && this.placeholderElement && (t.stopPropagation(), this.$currentlyDraggedItem.insertAfter(this.placeholderElement)), !1
      }, resetPlaceholder: function (t) {
        this.renderedPlaceholder = !1, this.placeholderElement = null, this.$currentlyDraggedItem && (this.$currentlyDraggedItem.removeClass("sortable-dragging").show(), this.$currentlyDraggedItem = null, this.$placeholder.detach(), t.stopPropagation(), this.afterDragEnd(), this.trigger("dragend", this), this.lastDroppable = null)
      }, dropItemAndResetPlaceholder: function (t) {
        return this.dropItem(t), this.resetPlaceholder(t)
      }, sequence: function () {
        var t = this.$items.toArray();
        return s.uniq(s.pluck(t, "id"))
      }, reloadItems: function () {
        return this.$items.attr("draggable", !0), this.$items.find("a").attr("draggable", !1), this.$items.find("img").attr("draggable", !1), this.delegateEvents(this.itemEvents(this.itemClassName)), this
      }, disableItems: function () {
        return this.$items.attr("draggable", !1), this.undelegateEvents(), this
      }, teardown: function () {
        return this.undelegateEvents(), this.scrollable && this.$el.off(["dragenter." + this.cid, "dragover." + this.cid].join(" ")), this.$items.add("a, img", this.$items).removeAttr("draggable"), this.$items = null, this.$placeholder = null, this.beforeDragStart = null, this.afterDragEnd = null, this.calculateDropTarget = null, this
      }
    });
    e.exports = r
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/view": 612, "velocity-animate": "lWl/mc"}],
  389: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/component"), a = t("prima/events"), r = t("prima/mixins/keycommands"), l = t("./views/fast_compose"), h = n.extend({
      name: "switcher",
      mixins: [r],
      keycommands: {"keydown:alt+c": "macFastCompose", "keydown:z+c": "winFastCompose"},
      loggingData: {},
      initialize: function () {
        this.$body = s("body"), this.$glass = null, this.suspended = !1, this.bindEvents()
      },
      bindEvents: function () {
        this.listenTo(a, "keycommands:suspend", this.suspend), this.listenTo(a, "keycommands:resume", this.resume), this.listenTo(a, "fastCompose:close:complete", this.dismissFastCompose), this.listenTo(a, "fastCompose:dismiss", this.dismissFastCompose), this.listenTo(a, "fastCompose:init", this.initFastCompose)
      },
      suspend: function () {
        this.suspended = !0
      },
      resume: function () {
        this.suspended = !1
      },
      macFastCompose: function (t) {
        "MacIntel" === navigator.platform && this.initFastCompose(t)
      },
      winFastCompose: function (t) {
        "Win32" === navigator.platform && this.initFastCompose(t)
      },
      initFastCompose: function (t) {
        this.suspended || this.fastCompose || (this.determineSource(t), this.fastCompose = new l({loggingData: this.loggingData}), this.$body.append(this.fastCompose.render().el), this.showPlexi(), this.fastCompose.open(), a.trigger("fastCompose:init:complete"))
      },
      dismissFastCompose: function () {
        this.fastCompose && (this.hidePlexi(), this.fastCompose.teardown(), this.fastCompose = null), a.trigger("fastCompose:dismiss:complete")
      },
      showPlexi: function () {
        this.$glass = s("<div>", {"class": "glass show"}).appendTo(this.$body), o.defer(o.bind(function () {
          this.$glass.addClass("blue")
        }, this)), a.trigger("drawer:suspend")
      },
      hidePlexi: function () {
        this.$glass.remove(), this.$glass = null, a.trigger("drawer:resume")
      },
      determineSource: function (t) {
        this.loggingData.source = "fast-compose", t && (t.originalEvent instanceof window.KeyboardEvent ? this.loggingData.source = "keycommand" : t.loggingData && t.loggingData.source && (this.loggingData.source = t.loggingData.source))
      }
    });
    e.exports = h
  }, {
    "./views/fast_compose": 391,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/component": 545,
    "prima/events": 546,
    "prima/mixins/keycommands": 581
  }],
  390: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="post-tab-switching"><div class="tab-post-types count-' + (null == (__t = icons.length) ? "" : _.escape(__t)) + '">', _.forEach(icons, function (t, e) {
          __p += '<div class="tab-post-type item" data-index="' + (null == (__t = e) ? "" : _.escape(__t)) + '" data-post-type="' + (null == (__t = t.name) ? "" : _.escape(__t)) + '"><div class="post-type-icon icon-' + (null == (__t = t.name) ? "" : _.escape(__t)) + '"><i class="post-type-icon-overlay"></i></div><div class="post-type-name"><span class="post-type-name-span">' + (null == (__t = t.label) ? "" : _.escape(__t)) + "</span></div></div>"
        }), __p += "</div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  391: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("velocity-animate"), a = t("prima/lib/data"), r = t("prima/lib/translate"), l = t("when"), h = t("prima/view"), c = t("prima/events"), d = t("prima/lib/flags"), u = t("prima/mixins/keycommands"), p = t("prima/mixins/accessor"), m = t("app/components/post-form-builder"), g = t("../templates/fast_compose.tpl"), _ = h.extend({
      template: g,
      className: "fast-compose",
      defaults: {
        tabIndex: -1,
        icons: [{name: "text", label: "Text"}, {name: "photo", label: "Photo"}, {
          name: "quote",
          label: "Quote"
        }, {name: "link", label: "Link"}, {name: "chat", label: "Chat"}, {
          name: "audio",
          label: "Audio"
        }, {name: "video", label: "Video"}]
      },
      events: {
        "click .post-tab-switching .tab-post-type": "clickCreate",
        "mouseover .post-tab-switching .tab-post-type": "mouseoverIcon",
        "click .post-tab-switching": "close"
      },
      mixins: [p, u],
      keycommands: {
        "keydown:c": "nextIcon",
        "keydown:shift+c": "previousIcon",
        "keydown:tab": "nextIcon",
        "keydown:shift+tab": "previousIcon",
        "keydown:right": "nextIcon",
        "keydown:left": "previousIcon",
        "keydown:enter": "enterCreate",
        "keydown:escape": "close"
      },
      initialize: function (t) {
        this.loggingData = t ? t.loggingData : {}, o.forEach(this.get("icons"), function (t) {
          t.label = r(t.label)
        }), this.$body = s("body"), this.$glass = null, this.$plexiInstance = s('.plexi[data-token="body-plexi"]'), this.resumeKeycommandsOnClose = !0
      },
      bindEvents: function () {
        this.listenTo(c, "DOMEventor:keydown:tab", this.disableKey), this.listenTo(c, "DOMEventor:keydown:shift+tab", this.disableKey), this.listenTo(this, "change:tabIndex", function (t, e) {
          this.$(".selected").removeClass("selected"), this.$('[data-index="' + e + '"]').addClass("selected")
        })
      },
      render: function () {
        return this.$el.append(this.template(this.toJSON())), this.bindEvents(), this
      },
      open: function () {
        o.defer(o.bind(this.show, this))
      },
      show: function () {
        c.trigger("keycommands:suspend");
        var t = 50;
        o.forEach(this.$(".tab-post-type"), function (e, i) {
          var o = s(e), a = o.find(".post-type-icon"), r = o.find(".post-type-name");
          n.animate(a, {opacity: ["1", "0"], translateY: ["0px", "15px"]}, {
            duration: 150,
            delay: i * t
          }), n.animate(r, {opacity: ["1", "0"], translateY: ["0px", "-15px"]}, {duration: 150, delay: i * t})
        }, this), s(".post-tab-switching").addClass("finish-animating")
      },
      enterCreate: function (t) {
        var e = this.$(".selected");
        if (e.length) {
          var i = e.attr("data-post-type");
          this.createNew(i), this.close()
        }
      },
      clickCreate: function (t) {
        this.createNew(s(t.currentTarget).data("postType"))
      },
      disableKey: function (t) {
        t.preventDefault()
      },
      mouseoverIcon: function (t) {
        this.$(".selected").removeClass("selected"), this.set("tabIndex", s(t.currentTarget).data("index"))
      },
      nextIcon: function (t) {
        var e = this.get("tabIndex") + 1;
        e >= this.get("icons").length && (e = 0), this.set("tabIndex", e)
      },
      previousIcon: function (t) {
        var e = this.get("tabIndex") - 1;
        0 > e && (e = this.get("icons").length - 1), this.set("tabIndex", e)
      },
      createNew: function (t) {
        this.resumeKeycommandsOnClose = !1, a.has("Components/PostFormBuilder") ? c.trigger("postForms:open", {
          updateURL: !1,
          postFormType: m.containerType("modal"),
          postType: t,
          fastCompose: !0,
          loggingData: this.loggingData
        }) : c.trigger("fastCompose:create", {type: t, loggingData: this.loggingData})
      },
      close: function () {
        var t = 50, e = this.$(".tab-post-type"), i = Math.floor(.5 * (e.length - 1));
        l.all(o.map(e, function (e, o) {
          var a = s(e), r = Math.floor(Math.abs(o - i)) * t;
          return n.animate(a, {opacity: ["0", "1"], translateY: ["-500px", "0px"]}, {duration: 150, delay: r})
        }, this)).then(function () {
          c.trigger("fastCompose:close:complete")
        })
      },
      teardown: function () {
        return this.resumeKeycommandsOnClose && c.trigger("keycommands:resume"), this.remove()
      }
    });
    e.exports = d.bool("is_logged_in") ? _ : o.noop
  }, {
    "../templates/fast_compose.tpl": 390,
    "app/components/post-form-builder": 224,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/data": 548,
    "prima/lib/flags": "f/LVtH",
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/mixins/keycommands": 581,
    "prima/view": 612,
    "velocity-animate": "lWl/mc",
    when: "RG2dij"
  }],
  392: [function (t, e, i) {
    "use strict";
    var s = t("prima/component"), o = t("./views/tooltip"), n = s.extend({
      name: "ToolTip",
      class_name: "tumblr_tooltip",
      initialize: function (t) {
        this.toolTipView = new o(t)
      }
    });
    e.exports = n
  }, {"./views/tooltip": 394, "prima/component": 545}],
  393: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="tooltip_wrapper ' + (null == (__t = placement) ? "" : _.escape(__t)) + " " + (null == (__t = class_name) ? "" : _.escape(__t)) + '" style="left:' + (null == (__t = left_css) ? "" : _.escape(__t)) + '"><div class="tooltip">' + (null == (__t = text) ? "" : __t) + "</div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  394: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/view"), a = t("../templates/tooltip.tpl"), r = n.extend({
      class_name: "tumblr_tooltip",
      template: a,
      defaults: {selector: "", class_name: "", offset: "50%", placement: "up"},
      initialize: function (t) {
        this.options = t || {}, this.options.selector = s.trim((t.selector || this.defaults.selector) + " "), this.options.class_name = t.class_name || this.defaults.class_name, this.options.offset = t.offset || this.defaults.offset, this.options.placement = t.placement || this.defaults.placement, this.tooltips = s(this.options.selector + "[data-tooltip]"), this.tooltips.on("remove", s.proxy(this.remove, this)), this.tooltips.on("mouseenter", o.bind(this.show, this)), this.tooltips.on("mouseleave", o.bind(this.hide, this))
      },
      show: function (t) {
        var e = s(t.currentTarget);
        this.tooltip_template_data = {tooltip: e.data("tooltip")};
        var i = s(this.tooltip(this.tooltip_template_data));
        e.append(i), this.setElement(i), this.delegateEvents(), i.removeClass("is_closed").addClass("is_open")
      },
      hide: function (t) {
        var e = s(t.currentTarget), i = e.find("." + this.class_name);
        i.removeClass("is_open").addClass("is_closed"), i.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd", o.bind(function (t) {
          this.remove(t)
        }, this))
      },
      remove: function (t) {
        s(t.currentTarget).remove()
      },
      tooltip: function (t) {
        return this.class_name = "tooltip_wrapper", this.attributes = {
          text: t.tooltip,
          placement: this.options.placement,
          class_name: this.options.class_name,
          left_css: this.options.offset
        }, this.template(this.attributes)
      }
    });
    e.exports = r
  }, {"../templates/tooltip.tpl": 393, jquery: "HlZQrA", lodash: "MicNly", "prima/view": 612}],
  395: [function (t, e, i) {
    "use strict";
    var s, o = t("jquery"), n = t("lodash"), a = t("prima/events"), r = t("prima/component"), l = r.extend({
      name: "TrackingPixels",
      initialize: function () {
        this.listenTo(a, "component:TrackingPixels", this.initPixels)
      },
      initPixels: function (t) {
        t.init && n.each(t.init, function (t) {
          t.script && o("body").append(t.script)
        })
      }
    });
    e.exports = {
      setup: function () {
        return s || (s = new l), s
      }
    }
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/component": 545, "prima/events": 546}],
  396: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/collection"), n = t("../models/upload"), a = t("when"), r = o.extend({
      model: n,
      _listenToUploadModel: function (t) {
        this.listenTo(t, "change", this._onUploadModelChange)
      },
      _stopListeningToUploadModel: function (t) {
        this.stopListening(t)
      },
      _onUploadModelChange: function (t) {
        s.has(t.changed, "complete") && this.trigger("complete", this, t), s.has(t.changed, "error") && t.get("error") && this.trigger("error", this, t), s.has(t.changed, "complete") && this.allComplete() && this.trigger("allComplete", this)
      },
      add: function (t) {
        return s.isArray(t) ? s.forEach(t, this._listenToUploadModel, this) : this._listenToUploadModel(t), o.prototype.add.apply(this, arguments)
      },
      remove: function (t) {
        return s.isArray(t) ? s.forEach(t, this._stopListeningToUploadModel, this) : this._stopListeningToUploadModel(t), o.prototype.remove.apply(this, arguments)
      },
      removeIncomplete: function (t) {
        var e = this.where({uploading: !1, complete: !1});
        return this.remove(e, t)
      },
      removeFailed: function (t) {
        var e = this.filter(function (t) {
          return t.get("error")
        });
        return this.remove(e, t)
      },
      allComplete: function () {
        return this.length ? this.every(function (t) {
          return t.get("complete")
        }) : !1
      },
      anyUploading: function () {
        return this.length > 0 && this.any(function (t) {
            return t.get("uploading")
          })
      },
      getProgress: function () {
        var t = 0, e = 0;
        return this.forEach(function (i) {
          i.get("error") && (t += i.get("bytesLoaded") || 0, e += i.get("bytesTotal") || 0)
        }), e ? t / e : 0
      },
      promise: function () {
        if (this.allComplete())return a.resolve(this);
        var t = a.promise(s.bind(function (t, e) {
          var i, o;
          i = s.bind(function () {
            this.stopListening(this, "uploads:allComplete", i), this.stopListening(this, "uploads:error", o), t.apply(this, arguments)
          }, this), o = s.bind(function () {
            this.stopListening(this, "uploads:allComplete", i), this.stopListening(this, "uploads:error", o), e.apply(this, arguments)
          }, this), this.listenToOnce(this, "uploads:allComplete", i), this.listenToOnce(this, "uploads:error", o)
        }, this));
        return t
      }
    });
    e.exports = r
  }, {"../models/upload": 398, lodash: "MicNly", "prima/collection": 544, when: "RG2dij"}],
  397: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/component"), n = t("./views/fileupload"), a = t("./collections/uploads"), r = (t("./models/upload"), o.extend({
      name: "Upload",
      initialize: function (t) {
        t = s.extend({}, t), this.collection = t.collection || (t.collection = new a), this.indexView = new n(t), this.listenTo(this.collection, "all", this._relayCollectionEvent)
      },
      _relayCollectionEvent: function () {
        this.trigger.apply(this, arguments)
      },
      addFiles: function (t) {
        return this.indexView.add({files: t})
      },
      promise: function () {
        return this.indexView.promise()
      },
      teardown: function () {
        return this.remove()
      },
      remove: function () {
        return this.indexView.remove(), this.stopListening(), this
      },
      render: function () {
        return this.indexView.render(), this
      },
      getElement: function () {
        return this.indexView.$el
      }
    }));
    e.exports = r
  }, {
    "./collections/uploads": 396,
    "./models/upload": 398,
    "./views/fileupload": 399,
    lodash: "MicNly",
    "prima/component": 545
  }],
  398: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/model"), n = o.extend({
      defaults: {
        url: "",
        file: null,
        error: !1,
        uploading: !1,
        complete: !1,
        bytesLoaded: 0,
        bytesTotal: 0
      }, initialize: function (t, e) {
        this.options = s.extend({}, e), this.options.jqXHR && this.setUploadRequest(this.options.jqXHR)
      }, setUploadRequest: function (t) {
        return this.jqXHR = t, t.then(function () {
        }), t
      }, _uploadDone: function () {
        this.set({error: !1, uploading: !1, complete: !0})
      }, _uploadFail: function () {
        this.set({error: !0, uploading: !1, complete: !1})
      }, cancelUpload: function () {
        var t;
        return this.jqXHR && (t = this.jqXHR.abort(), this.jqXHR = null), t
      }, getProgress: function () {
        return this.get("bytesTotal") ? this.get("bytesLoaded") / this.get("bytesTotal") : 0
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "prima/model": 590}],
  399: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("sprintf-js").sprintf, n = t("prima/view"), a = t("prima/lib/mixin"), r = t("when"), l = t("prima/lib/translate"), h = t("../collections/uploads"), c = t("../models/upload"), d = t("prima/utils/recontextify"), u = ["add", "submit", "send", "done", "fail", "always", "progress", "progressall", "start", "stop", "change", "paste", "drop", "dragover", "chunksend", "chunkdone", "chunkfail", "chunkalways"], p = ["add", "send", "progress", "active", "enable", "disable"], m = n.extend({
      tagName: "input",
      attributes: {type: "file"},
      defaults: {
        name: "photo",
        maxUploadSize: !1,
        uploadPattern: !1,
        mediaType: "image",
        message: {
          cancel: "Canceled upload",
          error: "Upload error",
          filesize: "The file is too big. Squish it down, and try again!",
          filetype: "This is not valid %1$s file."
        },
        fileUpload: {
          singleFileUploads: !0,
          limitConcurrentUploads: 1,
          sequentialUploads: !1,
          autoUpload: !0,
          formData: [],
          dataType: "json",
          dropZone: null,
          pasteZone: null
        }
      },
      _createUploadModel: function (t, e) {
        var i = new c(t);
        return this.collection.add(i, e || {}), i
      },
      _createUploadModelForFile: function (t, e, i) {
        e = s.extend({file: t}, e);
        var o = this._createUploadModel(e, i);
        return t._uploadModel = o, o
      },
      initialize: function (t) {
        if (this.options = s.merge({}, this.defaults, t), this.options.url && (this.options.fileUpload.url = this.options.url), this.options.collection ? this.collection = this.options.collection : this.collection = new h, !this.options.fileUpload.url)throw new Error("Upload requires an endpoint URL");
        this.$el.prop("tabindex", -1), this.options.fileUpload.multiple && this.$el.prop("multiple", !0), this.options.accept && this.$el.prop("accept", this.options.accept);
        var e = s.merge({}, this._fileUploadWrap);
        s.forEach(u, function (t) {
          s.isFunction(e.defaults[t]) || (e.defaults[t] = s.noop)
        }, this);
        var i = new a(e);
        i.applyTo(this.options.fileUpload), s.forEach(u, function (t) {
          this.options.fileUpload[t] = d(this.options.fileUpload[t], this)
        }, this), this.$el.attr("name", this.options.name).fileupload(this.options.fileUpload), this._fileUpload = this.$el.data("blueimp-fileupload"), s.forEach(p, function (t) {
          this[t] = function () {
            var e = s.toArray(arguments);
            e.unshift(t), this._fileUploadInvoke.apply(this, e)
          }
        }, this)
      },
      _fileUploadInvoke: function (t) {
        return this._fileUpload[t].apply(this._fileUpload, s.rest(arguments))
      },
      validateFile: function (t, e) {
        e || (e = this.options);
        var i = [];
        return e.maxUploadSize && t.size > e.maxUploadSize && i.push({
          type: "filesize",
          message: o(e.message.filesize, e.maxUploadSize)
        }), e.uploadPattern && t.type && !e.uploadPattern.test(t.type) && i.push({
          type: "filetype",
          message: o(e.message.filetype, e.mediaType)
        }), i
      },
      upload: function (t) {
        this.add({files: [t]})
      },
      cancel: function () {
        var t;
        return this.jqXHR ? (t = this.jqXHR.abort(), this.jqXHR = null) : t = r.reject(this.options.message.cancel), t
      },
      _forMatchingFiles: function (t, e) {
        var i = s.rest(arguments);
        this.collection.forEach(function (o) {
          if (s.contains(t, o.get("file"))) {
            var n = s.clone(i);
            n[0] = o, e.apply(this, n)
          }
        }, this)
      },
      promise: function () {
        return this.collection.promise()
      },
      _fileUploadWrap: {
        defaults: {
          change: function (t, e, i) {
            this._fileUpload.options.replaceFileInput && this.setElement(t)
          }, add: function (t, e, i) {
            var o = i.files[0], n = this.validateFile(o), a = {}, r = {};
            if (!s.isEmpty(n)) {
              a.error = s.pluck(n, "message"), a.file = o;
              var l = {errorType: "validation", messages: n, file: o};
              this.collection.trigger("invalid", this.collection, new this.collection.model(a)), this.trigger("error", l), r.silent = !0
            }
            return this._createUploadModelForFile(o, a, r), s.isEmpty(n)
          }, send: function (t, e, i) {
            return !0
          }
        }, before: {}, after: {
          done: function (t, e, i) {
            var o, n = s.get(i, "result.meta.status"), a = s.get(i, "result.response"), r = s.get(i, "result.errors");
            if (200 !== n || s.isEmpty(a)) {
              var h = function () {
                return a && a.msg ? a.msg : s.isArray(r) ? s.isEmpty(r) ? l("Woops :(") : r : r.join(" ")
              }();
              o = {error: h, uploading: !1}
            } else s.isArray(a) && (a = a[0]), o = s.extend({complete: !0, uploading: !1}, a);
            this._forMatchingFiles(i.files, function (t, e) {
              t.set(e)
            }, o)
          }, fail: function (t, e, i) {
            var o;
            o = "abort" === i.errorThrown ? {uploading: !1} : {
              error: this.options.message.error,
              uploading: !1
            }, o.responseJSON = s.get(i, "jqXHR.responseJSON"), this._forMatchingFiles(i.files, function (t, e) {
              t.set(e)
            }, o)
          }, progress: function (t, e, i) {
            this._forMatchingFiles(i.files, function (t, e) {
              t.set(e)
            }, {bytesLoaded: i.loaded, bytesTotal: i.total})
          }
        }, around: {
          add: function (t, e, i, o) {
            var n = t.apply(this, s.rest(arguments));
            return n === !1 || i.isDefaultPrevented() ? !1 : ((o.autoUpload || o.autoUpload !== !1 && this._fileUpload.options.autoUpload) && o.process().done(s.bind(function () {
              this.jqXHR = o.submit()
            }, this)), n)
          }, send: function (t, e, i, o) {
            o.with_form_key = !0;
            var n = t.apply(this, s.rest(arguments));
            if (n) {
              this._forMatchingFiles(o.files, function (t, e) {
                t.set(e)
              }, {uploading: !0});
              var a = {files: o.files};
              this.collection.trigger("send", this.collection, a), this.trigger("send", a)
            }
            return n
          }
        }
      }
    });
    e.exports = m
  }, {
    "../collections/uploads": 396,
    "../models/upload": 398,
    lodash: "MicNly",
    "prima/lib/mixin": 572,
    "prima/lib/translate": 575,
    "prima/utils/recontextify": 608,
    "prima/view": 612,
    "sprintf-js": "qPOUxN",
    when: "RG2dij"
  }],
  400: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/component"), n = t("./views/webcam"), a = t("./utils/get_user_media"), r = o.extend({
      name: "Webcam",
      initialize: function (t) {
        this.options = t = s.extend({}, t), this.indexView = new n(t), this.listenTo(this.indexView, "all", this._relayViewEvent);
        var e = ["teardown", "render", "remove"].concat(r.prototype.commands || []);
        s.forEach(e, function (t) {
          var e = this.indexView;
          this[t] = function () {
            return e[t].apply(e, arguments), this
          }
        }, this)
      },
      _relayViewEvent: function () {
        this.trigger.apply(this, arguments)
      },
      getElement: function () {
        return this.indexView.$el
      },
      getHeightForWidth: function (t) {
        return this.indexView.get("width") ? t * this.indexView.get("height") / this.indexView.get("width") : 0
      }
    }, {
      hasUserMediaSupport: function () {
        return !!a
      }
    });
    e.exports = r
  }, {
    "./utils/get_user_media": 405,
    "./views/video_stream": 407,
    "./views/webcam": 408,
    lodash: "MicNly",
    "prima/component": 545
  }],
  401: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-js-inner class="countdown-timer--inner"><div data-js-ticks class="countdown-timer--ticks"></div><div data-js-inner class="countdown-timer--fill"><div class="mask-static-half"><div class="fill"></div></div><div class="mask-rotating-half"><div data-js-rotator class="fill"></div></div></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  402: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<video class="video-stream--video" width="' + (null == (__t = retina ? 2 * width : width) ? "" : _.escape(__t)) + '" height="' + (null == (__t = retina ? 2 * height : height) ? "" : _.escape(__t)) + '"></video><div data-js-novideo class="video-stream--no-video"><div data-subview="loader"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  403: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-js-sizer class="webcam--sizer" style="padding-top:' + (null == (__t = ratio) ? "" : _.escape(__t)) + '"><div class="webcam--container"><div data-js-videostreamcontainer class="webcam--container-layer"><div data-subview="videoStream"></div></div><div data-js-watermarkcontainer class="webcam-watermark ' + (null == (__t = loading ? "webcam-watermark--hidden" : "") ? "" : _.escape(__t)) + '"></div><div data-js-previewcontainer class="webcam--container-layer" style="display:' + (null == (__t = showPreviewContainer ? "block" : "none") ? "" : _.escape(__t)) + '"><canvas data-js-canvas width="' + (null == (__t = retina ? 2 * width : width) ? "" : _.escape(__t)) + '" height="' + (null == (__t = retina ? 2 * height : height) ? "" : _.escape(__t)) + '" class="webcam--canvas"></canvas></div><div data-js-controlcontainer class="webcam--container-layer"><div data-subview="webcamControls"></div></div></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  404: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-js-overlaybuttons class="media-overlay">', enableFlash && (__p += '<div data-js-flashbutton class="button webcam--flash-button ' + (null == (__t = flash ? "active" : "") ? "" : _.escape(__t)) + '"><div class="icon"></div></div>'), __p += "", enableRemove && (__p += '<div data-subview="removeButton"></div>'), __p += '</div><div data-js-primarybutton class="big-button webcam--primary-button"><div data-js-snapbuttongroup="countdownTimer" class="big-button-group"><div data-subview="countdownTimer"></div></div><div data-js-snapbuttongroup="snapButton" class="big-button-group"><div data-js-snapbutton class="button webcam--snap-button"><div class="icon"></div></div>', enableGifMode && (__p += '<div data-js-gifbutton class="button webcam--gif-button"><div class="icon"></div></div>'), __p += '</div><div data-js-snapbuttongroup="processing" class="big-button-group"><div data-js-processingbutton class="button webcam--processing-button"><div class="icon"></div></div></div><div data-js-snapbuttongroup="retakeButton" class="big-button-group"><div data-js-retakebutton class="button webcam--retake-button"><div class="icon"></div></div></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  405: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery").browser, n = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
    o.mozilla && Math.floor(o.version) >= 20 && (n = navigator.mozGetUserMedia), n && (n = s.bind(n, navigator)), e.exports = n
  }, {jquery: "HlZQrA", lodash: "MicNly"}],
  406: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("when"), a = t("velocity-animate").hook, r = t("velocity-animate").animate, l = t("prima/view"), h = t("prima/mixins/accessor"), c = t("prima/mixins/subviewable"), d = t("prima/mixins/selectorcache"), u = t("../templates/countdown_timer.tpl"), p = l.extend({
      className: "countdown-timer",
      template: u,
      mixins: [h, c, d],
      defaults: {duration: 3e3, ticks: 1},
      initialize: function (t) {
        this.options = t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults)))
      },
      start: function (t, e) {
        s.isNumber(t) || (t = this.get("duration")), s.isNumber(e) || (e = this.get("ticks")), this.set({
          duration: t,
          ticks: e
        }), this._generateTickMarks(e), this.stop(), this.trigger("countdown:start"), this.js$("inner").removeClass("half-past"), this._halfPastTimeout = s.delay(s.bind(function () {
          this.js$("inner").addClass("half-past")
        }, this), Math.floor(t / 2));
        var i = 0;
        return n.join(n.promise(s.bind(function (o, n) {
          clearInterval(this._tickerInterval), this._tickerInterval = setInterval(s.bind(function () {
            this.trigger("countdown:tick", i++, e), i >= e && (clearInterval(this._tickerInterval), o())
          }, this), t / e)
        }, this)), r(this.js$("rotator"), {rotateZ: ["360deg", "0deg"]}, {
          easing: "linear",
          duration: t
        })).then(s.bind(function () {
          this.trigger("countdown:complete")
        }, this))
      },
      stop: function () {
        clearTimeout(this._halfPastTimeout), clearInterval(this._tickerInterval), r(this.js$("rotator"), "stop")
      },
      teardown: function () {
        return clearTimeout(this._halfPastTimeout), clearInterval(this._tickerInterval), this.stopListening(), this
      },
      remove: function () {
        return this.teardown(), l.prototype.remove.apply(this, arguments)
      },
      _generateTickMarks: function (t) {
        s.isNumber(t) || (t = this.get("ticks")), this.js$("ticks").empty(), t > 1 && s.forEach(s.range(t), function (e) {
          var i = o('<div class="countdown-timer--tick"></div>');
          a(i, "rotateZ", 360 * e / t + "deg"), a(i, "translateY", "-50%"), this.js$("ticks").append(i)
        }, this)
      },
      serialize: function () {
        return this.toJSON()
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this._generateTickMarks(), this.attachSubViews(), this
      }
    });
    e.exports = p
  }, {
    "../templates/countdown_timer.tpl": 401,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612,
    "velocity-animate": "lWl/mc",
    when: "RG2dij"
  }],
  407: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("velocity-animate").animate, a = t("prima/view"), r = t("app/lib/create-object-url"), l = t("../utils/get_user_media"), h = t("prima/mixins/accessor"), c = t("prima/mixins/subviewable"), d = t("prima/mixins/selectorcache"), u = t("../templates/video_stream.tpl"), p = t("components/knight-rider-loader"), m = a.extend({
      className: "video-stream",
      template: u,
      mixins: [h, c, d],
      defaultOptions: {video: !0, audio: !1},
      defaults: {width: 500, height: 375, retina: !0, mirrored: !0, needsPermission: !0, running: !1},
      initialize: function (t) {
        this.options = t = s.extend({}, this.defaultOptions, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults)))
      },
      _onChangeRetina: function (t, e) {
        e ? this.$video.attr({
          width: 2 * this.get("width"),
          height: 2 * this.get("height")
        }) : this.$video.attr({width: this.get("width"), height: this.get("height")})
      },
      _onChangeMirrored: function (t, e) {
        this.$el.toggleClass("mirrored", e)
      },
      _onChangeRunning: function (t, e) {
        this.loader && this.loader.set("animate", !e), n(this.js$("noVideo"), "stop"), n(this.js$("noVideo"), {opacity: e ? 0 : 1}, {
          display: e ? "none" : "block",
          delay: e ? 50 : 0,
          duration: 100
        })
      },
      startStream: function () {
        if (!l)throw new Error("VideoStream: Cannot initialize without getUserMedia support");
        return l(s.pick(this.options, ["audio", "video"]), s.bind(this._onStreamReady, this), s.bind(this._onStreamError, this))
      },
      stopStream: function () {
        this.set("running", !1), this.streamURL = null, this.stream && (this.stream.stop(), this.stream = null)
      },
      _onStreamReady: function (t) {
        this.set("needsPermission", !1), this.stream = t, this.streamURL = r(this.stream), this._playVideoSteam()
      },
      _onStreamError: function (t) {
        this.stopStream(), this.trigger("error", t)
      },
      _playVideoSteam: function () {
        this.video && this.streamURL && (this.video.src = this.streamURL, this.$video.one("loadeddata", s.bind(function (t) {
          this.set("running", !0)
        }, this)), this.video.play())
      },
      remove: function () {
        o(this.video).remove(), a.prototype.apply(this, arguments)
      },
      teardown: function () {
        return this.stopStream(), this.stopListening(), this
      },
      beforeRender: function () {
        this.loader = this.subViews.loader = new p({
          variation: "centered",
          loading: !this.get("running")
        }), this.listenTo(this, "change:retina", this._onChangeRetina), this.listenTo(this, "change:mirrored", this._onChangeMirrored), this.listenTo(this, "change:running", this._onChangeRunning)
      },
      render: function () {
        return this._onChangeMirrored(this, this.get("mirrored")), this.$el.html(this.template(this.toJSON())), this.attachSubViews(), this.$video = this.$(".video-stream--video"), this.video = this.$video.get(0), this._playVideoSteam(), this
      }
    });
    e.exports = m
  }, {
    "../templates/video_stream.tpl": 402,
    "../utils/get_user_media": 405,
    "app/lib/create-object-url": 458,
    "components/knight-rider-loader": 496,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612,
    "velocity-animate": "lWl/mc"
  }],
  408: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("when"), a = t("velocity-animate").animate, r = t("prima/lib/data"), l = t("prima/view"), h = t("app/vendor/gif.js"), c = t("prima/utils/image/loader"), d = t("prima/utils/image/filereader"), u = t("prima/utils/image/canvas"), p = t("prima/mixins/accessor"), m = t("prima/mixins/subviewable"), g = t("prima/mixins/selectorcache"), _ = t("../templates/webcam.tpl"), f = t("./video_stream"), v = t("./webcam_controls"), b = 250, y = 300, w = o(document), x = "", C = l.extend({
      className: "webcam",
      template: _,
      mixins: [p, m, g],
      defaults: {
        watermarkUrl: "",
        width: 540,
        height: 405,
        retina: !0,
        mirrored: !0,
        enabled: !0,
        needsPermission: !0,
        showControls: !1,
        flash: !0,
        showPreviewContainer: !1,
        defaultTimer: 3e3,
        timePerFrame: 1e3,
        gifFrameCount: 4,
        gifSpeed: 200,
        enableFlash: !0,
        enableGifMode: !0,
        enableRemove: !0
      },
      commands: ["toggleFlash", "toggleMirrored", "snap", "gif", "flash", "gifStart", "gifSnap", "gifComplete", "retake", "close"],
      initialize: function (t) {
        this.options = t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), x = r.get("Context/hosts/assets_host"), this._WebcamControlsView = t.WebcamControlsView || v
      },
      _onChangeEnabled: function (t, e) {
        e ? this.videoStream.startStream() : this.videoStream.stopStream()
      },
      _onChangeNeedsPermission: function (t, e) {
        var i = 200;
        e || clearTimeout(this._delayedPermissionCheck), a(this.$arrow, "stop"), a(this.$arrow, {opacity: e ? 1 : 0}, {
          display: e ? "block" : "none",
          duration: i
        })
      },
      _onChangeWatermarkUrl: function (t, e) {
        if (this.js$("watermarkContainer").empty(), this.$watermark = !1, e) {
          if (!s.startsWith(e, "data:image/png;base64") && (e.match(/^\w*:\/\//i) || !s.startsWith(e, "/")))throw new Error("Webcam watermark must be an absolute path or base64-encoded image.");
          s.startsWith(e, "/") && (e = x + e), this.$watermark = o("<img/>", {
            alt: "",
            src: e
          }), this.js$("watermarkContainer").append(this.$watermark)
        }
      },
      _onChangeShowControls: function (t, e) {
        var i = 200;
        a(this.js$("controlContainer"), "stop"), a(this.js$("controlContainer"), {opacity: e ? 1 : 0}, {
          display: e ? "block" : "none",
          duration: i
        })
      },
      _onChangeShowPreviewContainer: function (t, e) {
        e ? this.js$("previewContainer").css("display", "block") : (this.js$("previewContainer").children("img").remove(), this.js$("previewContainer").css("display", "none"))
      },
      startStream: function () {
        this.set("enabled", !0)
      },
      stopStream: function () {
        this.set("enabled", !1)
      },
      snap: function (t, e) {
        this._snapFrame(t, e).then(s.bind(function (t) {
          this.set("showPreviewContainer", !0), this.trigger("webcam:image", t), this.webcamControls.trigger("webcam:snapped")
        }, this))
      },
      gif: function (t, e, i, o) {
        s.isNumber(t) || (t = this.get("gifFrameCount")), s.isNumber(e) || (e = this.get("timePerFrame")), !s.isUndefined(i) || (i = this.get("flash")), !s.isUndefined(o) || (o = !!this.get("watermarkUrl")), this.gifStart();
        var n = 0;
        clearInterval(this._gifInterval), this._gifInterval = setInterval(s.bind(function () {
          n++, this.gifSnap(n >= t), o && clearInterval(this._gifInterval)
        }, this), e)
      },
      gifStart: function () {
        this._frameBuffer = []
      },
      gifSnap: function (t, e, i) {
        this._snapFrame(e, i).then(s.bind(function (e) {
          var i = this.js$("canvas"), s = i.get(0), o = document.createElement("canvas");
          o.width = .5 * (s.width || i.width()), o.height = .5 * (s.height || i.height()), u.drawElToCanvas(this.js$("canvas"), o), this._frameBuffer.push(o), t && this.gifComplete()
        }, this))
      },
      gifComplete: function (t) {
        s.isNumber(t) || (t = this.get("gifSpeed"));
        var e = new h({workers: 3, quality: 1});
        s.forEach(this._frameBuffer, function (i) {
          e.addFrame(i, {delay: t})
        }, this), e.on("finished", s.bind(function (t) {
          d.read(t).then(s.bind(function (t) {
            c.load(t.base64).then(s.bind(function (t) {
              var e = o('<img data-js-gif class="webcam--preview-image"/>');
              e.attr("src", t.src), this.js$("previewContainer").append(e), s.extend(t, {
                base64: t.src,
                isGif: !0
              }), this.trigger("webcam:image", t), this.webcamControls.showSnapButtonGroup("retakeButton"), this.set("showPreviewContainer", !0)
            }, this))
          }, this))
        }, this)), e.render(), delete this._frameBuffer
      },
      retake: function () {
        this.set("showPreviewContainer", !1), this.trigger("webcam:reset")
      },
      close: function () {
        this.trigger("webcam:close")
      },
      _snapFrame: function (t, e) {
        !s.isUndefined(t) || (t = this.get("flash")), !s.isUndefined(e) || (e = !!this.get("watermarkUrl"));
        var i = s.bind(this.flash, this), o = s.bind(this.grabVideoFrame, this, e);
        return n.promise(function (e, n) {
          t ? (i(), s.delay(function () {
            e(o())
          }, .5 * y)) : e(o())
        })
      },
      drawWatermark: function () {
        var t = this.$watermark;
        if (t.get(0)) {
          var e = this.js$("canvas").get(0), i = e.getContext("2d"), s = t.offset(), o = this.$el.offset();
          i.drawImage(t.get(0), 2 * (s.left - o.left), 2 * (s.top - o.top), t.width(), t.height())
        }
      },
      grabVideoFrame: function (t) {
        u.drawElToCanvas(this.videoStream.video, this.js$("canvas"), this.get("mirrored")), t && this.drawWatermark();
        var e = this.js$("canvas").get(0);
        return e ? {width: e.width, height: e.height, base64: e.toDataURL("image/jpeg")} : {
          width: 0,
          height: 0,
          base64: null
        }
      },
      toggleFlash: function (t) {
        !s.isUndefined(t) || (t = !this.get("flash")), this.set("flash", t)
      },
      toggleMirrored: function (t) {
        !s.isUndefined(t) || (t = !this.get("mirrored")), this.set("mirrored", t)
      },
      flash: function () {
        return a(this.$flash, "stop"), this.$flash.css({
          display: "block",
          opacity: 1
        }), a(this.$flash, {opacity: [0, 1]}, {display: "block", delay: y, duration: b}).then(s.bind(function () {
          this.$flash.css("display", "none")
        }, this))
      },
      _checkVideoStreamPermissions: function () {
        this._delayedPermissionCheck = s.delay(s.bind(function () {
          this.get("needsPermission") && this._onChangeNeedsPermission(this, !0)
        }, this), 1e3), this.get("needsPermission") ? (this.js$("controlContainer").css({
          display: "none",
          opacity: 0
        }), this.listenToOnce(this.videoStream, "change:needsPermission", function (t, e) {
          this.set("needsPermission", e)
        }), this.listenToOnce(this.videoStream, "change:running", function (t, e) {
          clearTimeout(this._delayedPermissionCheck), e && (this.set("needsPermission", !1), this.set("showControls", !0))
        })) : this.set("showControls", !0)
      },
      serialize: function () {
        var t = this.toJSON();
        return t.ratio = (t.width ? t.height / t.width * 100 : 0) + "%", t.loading = this.videoStream ? !this.videoStream.get("running") : !1, t
      },
      teardown: function () {
        return clearInterval(this._gifInterval), clearTimeout(this._delayedPermissionCheck), w.off("keydown.webcam keyup.webcam"), this.stopListening(), this.$flash && this.$flash.remove(), delete this.$flash, this.$arrow && this.$arrow.remove(), delete this.$arrow, this
      },
      remove: function () {
        return this.teardown(), l.prototype.remove.apply(this, arguments)
      },
      beforeRender: function () {
        var t = s.pick(this.attributes, s.keys(f.prototype.defaults)), e = s.pick(this.attributes, s.keys(this._WebcamControlsView.prototype.defaults));
        this.videoStream = this.subViews.videoStream = new f(t), this.webcamControls = this.subViews.webcamControls = new this._WebcamControlsView(e), this.$flash = o('<div class="webcam--flash"></div>').appendTo("body"), this.$arrow = o('<div class="webcam--permission-arrow"></div>').appendTo("body"), o.browser.mozilla && this.$arrow.addClass("firefox"), this.set("needsPermission", !this.videoStream.get("running")), this.listenTo(this, "change:enabled", this._onChangeEnabled), this.listenTo(this, "change:needsPermission", this._onChangeNeedsPermission), this.listenTo(this, "change:watermarkUrl", this._onChangeWatermarkUrl), this.listenTo(this, "change:showControls", this._onChangeShowControls), this.listenTo(this, "change:showPreviewContainer", this._onChangeShowPreviewContainer), this.listenTo(this.videoStream, "change:running", function (t, e) {
          this.js$("watermarkContainer").toggleClass("webcam-watermark--hidden", !e)
        }), this.listenTo(this.videoStream, "error", function (t) {
          this.trigger("webcam:error", t), this.close()
        }), this.listenTo(this, "change:flash", function (t, e) {
          this.webcamControls.set("flash", e)
        }), this.listenTo(this, "change:mirrored", function (t, e) {
          this.videoStream.set("mirrored", e), this.webcamControls.set("mirrored", e)
        }), this.listenTo(this.webcamControls, "webcam", function (t) {
          if (s.contains(this.commands, t)) {
            var e = this[t];
            s.isFunction(e) && e.apply(this, s.rest(arguments))
          }
        }), w.on("keydown.webcam keyup.webcam", s.bind(function (t) {
          switch (t.which || t.keyCode) {
            case 16:
              this.set("flash", "keyup" === t.type);
              break;
            case 18:
              "keydown" === t.type && t.metaKey && this.toggle("mirrored");
              break;
            case 91:
            case 92:
            case 93:
              "keydown" === t.type && t.altKey && this.toggle("mirrored")
          }
        }, this))
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.attachSubViews(), this._checkVideoStreamPermissions(), this.get("enabled") && this.videoStream.startStream(), this.get("watermarkUrl") && this._onChangeWatermarkUrl(this, this.get("watermarkUrl")), this
      }
    });
    e.exports = C
  }, {
    "../templates/webcam.tpl": 403,
    "./video_stream": 407,
    "./webcam_controls": 409,
    "app/vendor/gif.js": 466,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/data": 548,
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/utils/image/canvas": 603,
    "prima/utils/image/filereader": 604,
    "prima/utils/image/loader": 605,
    "prima/view": 612,
    "velocity-animate": "lWl/mc",
    when: "RG2dij"
  }],
  409: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("velocity-animate").hook, n = t("velocity-animate").animate, a = t("prima/view"), r = t("prima/mixins/accessor"), l = t("prima/mixins/subviewable"), h = t("prima/mixins/selectorcache"), c = t("./countdown_timer"), d = t("app/components/remove-button"), u = t("../templates/webcam_controls.tpl"), p = a.extend({
      className: "webcam-controls",
      template: u,
      events: {
        mouseenter: "_onHoverControls",
        mouseleave: "_onHoverControls",
        "click [data-js-flashButton]": "_onClickFlashButton",
        "click [data-js-snapButton]": "_onClickSnapButton",
        "click [data-js-gifButton]": "_onClickGifButton",
        "click [data-js-retakeButton]": "_onClickRetakeButton"
      },
      mixins: [r, l, h],
      defaults: {
        isActive: !1,
        flash: !0,
        mirrored: !0,
        defaultTimer: 3e3,
        timePerFrame: 1e3,
        gifFrameCount: 4,
        enableFlash: !0,
        enableGifMode: !0,
        enableRemove: !0
      },
      initialize: function (t) {
        this.options = t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults)))
      },
      _onHoverControls: function (t) {
        clearTimeout(this._removeIsActive);
        var e = "mouseover" === t.type || "mouseenter" === t.type;
        e ? this.set("isActive", !0) : this._removeIsActive = s.delay(s.bind(function () {
          this.set("isActive", !1)
        }, this), 500)
      },
      _onClickFlashButton: function () {
        this.trigger("webcam", "toggleFlash", !this.get("flash"))
      },
      _onClickSnapButton: function (t) {
        var e = !t.altKey;
        this.countdownTimer.stop(), this.listenToOnce(this, "webcam:snapped", function () {
          this.showSnapButtonGroup("retakeButton")
        });
        var i = this.get("defaultTimer");
        e ? (this.showSnapButtonGroup("countdownTimer", 0), this.countdownTimer.start(i, 1).then(s.bind(function () {
          this.trigger("webcam", "snap")
        }, this))) : this.trigger("webcam", "snap")
      },
      _onClickGifButton: function (t) {
        this.countdownTimer.stop(), this.trigger("webcam", "gifStart"), this.listenTo(this.countdownTimer, "countdown:tick", function (t, e) {
          this.trigger("webcam", "gifSnap", t + 1 >= e), e > t + 1 && this.pulseButton()
        });
        var e = this.get("gifFrameCount"), i = this.get("timePerFrame");
        this.showSnapButtonGroup("countdownTimer", 0), this.countdownTimer.start(e * i, e).then(s.bind(function () {
          this.stopListening(this.countdownTimer, "countdown:tick"), this.showSnapButtonGroup("processing")
        }, this))
      },
      _onClickRetakeButton: function (t) {
        this.showSnapButtonGroup("snapButton"), this.trigger("webcam", "retake")
      },
      pulseButton: function () {
        var t = 1.5;
        o(this.js$("primaryButton"), "translateX", "-50%"), o(this.js$("primaryButton"), "scale", t), n(this.js$("primaryButton"), "stop"), n(this.js$("primaryButton"), {scale: [1, t]}, {duration: 200})
      },
      showSnapButtonGroup: function (t, e) {
        s.isNumber(e) || (e = 100);
        var i = this.js$("snapButtonGroup").filter('[data-js-snapButtonGroup="' + t + '"]');
        if (!s.isEmpty(i)) {
          var o = this.js$("snapButtonGroup").not(i);
          n(i, "stop"), n(o, "stop"), n(this.js$("primaryButton"), "stop"), n(i, {opacity: 1}, {
            display: "block",
            duration: e
          }), n(o, {opacity: 0}, {
            display: "none",
            duration: e
          }), this.js$("primaryButton").toggleClass("invert", "processing" === t);
          var a = 60;
          "snapButton" === t && this.get("enableGifMode") && (a = 150), n(this.js$("primaryButton"), {width: a}, {
            display: "block",
            duration: e
          })
        }
      },
      serialize: function () {
        return this.toJSON()
      },
      teardown: function () {
        return this
      },
      beforeRender: function () {
        this.countdownTimer = this.subViews.countdownTimer = new c, this.listenTo(this, "change:flash", function (t, e) {
          this.js$("flashButton").toggleClass("active", e)
        }), this.removeButton = this.subViews.removeButton = new d({
          buttonClass: "active", onClick: s.bind(function () {
            this.trigger("webcam", "close")
          }, this)
        }), this.listenTo(this, "change:isActive", function (t, e) {
          this.js$("overlayButtons").toggleClass("active", e)
        })
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this.attachSubViews(), this.showSnapButtonGroup("snapButton", 0), this
      }
    });
    e.exports = p
  }, {
    "../templates/webcam_controls.tpl": 404,
    "./countdown_timer": 406,
    "app/components/remove-button": 385,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612,
    "velocity-animate": "lWl/mc"
  }],
  410: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/component"), n = t("prima/lib/data"), a = o.extend({
      name: "AdsPaginationHelper",
      defaults: {nextAdPos: 0},
      initialize: function () {
        var t = n.get("Components/AdsPaginationHelper");
        this.adsData = s.extend({}, this.defaults, t)
      },
      getNextAdPos: function () {
        return this.adsData.nextAdPos
      }
    });
    e.exports = a
  }, {lodash: "MicNly", "prima/component": 545, "prima/lib/data": 548}],
  411: [function (t, e, i) {
    "use strict";
    function s(t) {
      return new o(t)
    }

    var o = t("./views/blog-search-view");
    e.exports = s
  }, {"./views/blog-search-view": 424}],
  412: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/events"), a = t("prima/model"), r = t("prima/collection"), l = a.extend({
      defaults: {
        maxRender: 20,
        matchTerm: "",
        typeAheadMatches: []
      }, urlRoot: "/svc/search/blog_search_typeahead", url: function () {
        return this.urlRoot + "/" + this.get("blogname")
      }, initialize: function () {
        this.items = new r, this.fetched = !1, this.listenTo(n, "peeprsearch:change:unsetTerm", this.onUnsetTermChange), this.listenTo(this, "change:matchTerm sync", this.setMatches)
      }, onUnsetTermChange: function (t) {
        this.set("matchTerm", t.term)
      }, hasMatches: function () {
        return this.items.length && this.get("typeAheadMatches").length || !this.fetched
      }, setMatches: function () {
        var t = this.get("matchTerm");
        if (!t.length)return void this.set("typeAheadMatches", this.items.toJSON());
        var e = this.items.filter(function (e) {
          return e.get("tag").indexOf(t) > -1
        });
        this.set("typeAheadMatches", o.invoke(e, "toJSON"))
      }, getItems: function () {
        if (this.items.length) {
          var t = s.Deferred();
          return t.resolve(), t.promise()
        }
        return this.fetch(arguments)
      }, parse: function (t) {
        return this.items.reset(t.tags), this.fetched = !0, o.omit(t, "tags")
      }
    });
    e.exports = l
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/collection": 544, "prima/events": 546, "prima/model": 590}],
  413: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/events"), n = t("prima/model"), a = t("prima/collection"), r = n.extend({
      urlRoot: "/svc/search/blog_search",
      defaults: {
        next_offset: 0,
        limit: 10,
        sort: "CREATED_DESC",
        post_type: "ANY",
        term: "",
        unsetTerm: "",
        post_role: "ANY",
        filter_nsfw: !1,
        showOriginalPostsSwitch: !0,
        showNsfwSwitch: !1
      },
      initialize: function () {
        this.listenTo(this, "change:unsetTerm", this.onUnsetTermChange), this.listenTo(o, "peeprsearch:change:term", this.onTermSelect), this.listenTo(this, "change:term change:sort change:post_type change:post_role", this.resetSearch), this.posts = new a
      },
      resetSearch: function () {
        this.set(s.pick(this.defaults, ["limit", "next_offset"])), this.posts.reset(), this.trigger("search:reset")
      },
      reset: function () {
        this.posts.reset(), this.set(this.defaults), this.trigger("reset")
      },
      url: function () {
        return this.urlRoot + "/" + this.get("blogname") + "/" + this.get("term")
      },
      onTermSelect: function (t) {
        this.search(t.term)
      },
      onUnsetTermChange: function () {
        o.trigger("peeprsearch:change:unsetTerm", {term: this.get("unsetTerm")})
      },
      search: function (t) {
        t = t || this.get("unsetTerm"), t.length && this.set("term", t)
      },
      fetch: function () {
        this.get("next_offset") < 0 || n.prototype.fetch.apply(this, arguments)
      },
      parse: function (t) {
        return this.posts.length ? s.each(t.response.posts, function (t) {
          this.posts.add(t)
        }, this) : this.posts.reset(t.response.posts), delete t.response.posts, t.response
      },
      sync: function (t, e, i) {
        "read" === t && (i.data = this.pick("next_offset", "limit", "sort", "post_type", "post_role", "filter_nsfw")), n.prototype.sync.apply(this, arguments)
      }
    });
    e.exports = r
  }, {lodash: "MicNly", "prima/collection": 544, "prima/events": 546, "prima/model": 590}],
  414: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<ul class="popover_inner_list search_filter_items"><li class="popover_menu_item sort_filter" data-filter="sort:POPULARITY_DESC"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i>' + (null == (__t = __("Top Posts")) ? "" : _.escape(__t)) + '</span></li><li class="popover_menu_item sort_filter" data-filter="sort:CREATED_DESC"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i>' + (null == (__t = __("Recent Posts")) ? "" : _.escape(__t)) + "</span></li></ul>", model.showOriginalPostsSwitch && (__p += '<ul class="popover_inner_list search_filter_items"><li class="popover_menu_item sort_filter toggle"><span class="popover_menu_item_anchor"><div class="option-radio"><label class="binary_switch"><input type="checkbox" name="post_role" id="post_role" data-value="ORIGINAL"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label></div>' + (null == (__t = __("Original Posts")) ? "" : _.escape(__t)) + "</span></li></ul>"), __p += '<ul class="popover_inner_list search_filter_items"><li class="popover_menu_item post_type_filter" data-filter="post_type:ANY"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i>' + (null == (__t = __("All Types")) ? "" : _.escape(__t)) + '</span></li><li class="popover_menu_item post_type_filter post_text_filter" data-filter="post_type:TEXT"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_text_small"></i>' + (null == (__t = __("Text")) ? "" : _.escape(__t)) + '</span></li><li class="popover_menu_item post_type_filter post_photo_filter" data-filter="post_type:PHOTO"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_photo_small"></i>' + (null == (__t = __("Photo")) ? "" : _.escape(__t)) + '</span></li><li class="popover_menu_item post_type_filter post_quote_filter" data-filter="post_type:QUOTE"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_quote_small"></i>' + (null == (__t = __("Quote")) ? "" : _.escape(__t)) + '</span></li><li class="popover_menu_item post_type_filter post_link_filter" data-filter="post_type:LINK"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_link_small"></i>' + (null == (__t = __("Link")) ? "" : _.escape(__t)) + '</span></li><li class="popover_menu_item post_type_filter post_chat_filter" data-filter="post_type:CHAT"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_chat_small"></i>' + (null == (__t = __("Chat")) ? "" : _.escape(__t)) + '</span></li><li class="popover_menu_item post_type_filter post_audio_filter" data-filter="post_type:AUDIO"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_audio_small"></i>' + (null == (__t = __("Audio")) ? "" : _.escape(__t)) + '</span></li><li class="popover_menu_item post_type_filter post_video_filter" data-filter="post_type:VIDEO"><span class="popover_menu_item_anchor"><i class="icon icon_checkmark"></i> <i class="icon post_type_icon icon_post_video_small"></i>' + (null == (__t = __("Video")) ? "" : _.escape(__t)) + "</span></li></ul>", model.showNsfwSwitch && (__p += '<ul class="popover_inner_list search_filter_items"><li class="popover_menu_item sort_filter toggle"><span class="popover_menu_item_anchor"><div class="option-radio"><label class="binary_switch"><input type="checkbox" name="filter_nsfw" id="filter_nsfw" data-value="true" class="search-nsfw-filter-checkbox-input"> <span class="binary_switch_track"></span> <span class="binary_switch_button"></span></label></div>' + (null == (__t = __("Safe search")) ? "" : _.escape(__t)) + "</span></li></ul>"), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  415: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<i class="icon_filter show-filter-popover nav_icon"></i>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  416: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {}) {
          __p += '<ul class="popover_inner_list search_filter_items"><li class="popover_header">' + (null == (__t = __("Popular Tags:")) ? "" : _.escape(__t)) + "</li>";
          for (var i = 0; i < model.maxRender && i < model.typeAheadMatches.length; i++)__p += '<li class="popover_menu_item" data-term="' + (null == (__t = model.typeAheadMatches[i].tag) ? "" : _.escape(__t)) + '"><span class="popover_menu_item_anchor">#' + (null == (__t = model.typeAheadMatches[i].tag) ? "" : _.escape(__t)) + "</span></li>";
          __p += "</ul>"
        }
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  417: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<input type="text" class="blog-search-input" placeholder="' + (null == (__t = __("Search %s", model.blogname)) ? "" : _.escape(__t)) + '">';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  418: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<p class="no-results-text" style="color: ' + (null == (__t = model.themeParams.title_color) ? "" : _.escape(__t)) + '">' + (null == (__t = __("Nothing here about<br/>%s.", _.escape(model.term))) ? "" : __t) + "</p>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  419: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="popover popover_menu popover_gradient"><div class="popover_inner"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  420: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<form class="blog-search-form"><div data-subview="filters"></div><i class="icon_arrow_thin_left clear-search nav_icon"></i> <i class="icon_search toggle-search nav_icon"></i><div data-subview="input"></div></form>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  421: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../templates/blog-filters.tpl"), a = t("./popovers/blog-search-filter-popover"), r = o.extend({
      className: "search-filters",
      template: n,
      events: {"click .show-filter-popover": "showPopover"},
      initialize: function () {
        this.listenTo(this.model, "search:reset", this.hidePopover)
      },
      showPopover: function () {
        this.popover || (this.popover = new a({
          pinnedTarget: this.$el,
          model: this.model,
          preventInteraction: !0
        }), this.popover.render(), this.listenTo(this.popover, "close", this.onPopoverClose))
      },
      hidePopover: function () {
        this.popover && this.popover.hide()
      },
      onPopoverClose: function () {
        s.defer(s.bind(function () {
          this.popover = null
        }, this))
      }
    });
    e.exports = r
  }, {
    "../templates/blog-filters.tpl": 415,
    "./popovers/blog-search-filter-popover": 429,
    lodash: "MicNly",
    "prima/views/base": 613
  }],
  422: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("prima/events"), a = t("prima/mixins/selectorcache"), r = t("./popovers/blog-search-autocomplete-helper"), l = t("../models/blog-search-autocomplete-model"), h = t("../templates/blog-search-input.tpl"), c = o.extend({
      className: "search-input",
      template: h,
      mixins: [a],
      $$cacheKeys: {"blog-search-input": ".blog-search-input"},
      initialize: function () {
        this.autocompletePopover = null, this.bindEvents(), this.blogSearchAutocompleteModel = new l({blogname: this.model.get("blogname")})
      },
      afterRender: function () {
        this.blogSearchAutocompleteHelper = new r({
          model: this.blogSearchAutocompleteModel,
          el: this.$$(".blog-search-input")
        })
      },
      events: {
        "focus .blog-search-input": "inputFocusHandler",
        "keyup .blog-search-input": "inputKeyUpHandler",
        "blur .blog-search-input": "inputBlurHandler"
      },
      bindEvents: function () {
        this.listenTo(this.model, "change:term", this.onTermChange), this.listenTo(this.model, "reset", this.onModelReset)
      },
      inputKeyUpHandler: function () {
        this.model.set("unsetTerm", this.getTerm()), this.blogSearchAutocompleteModel.set("matchTerm", this.getTerm())
      },
      focusInput: function () {
        this.$$(".blog-search-input").focus(), this.blogSearchAutocompleteHelper.showPopover()
      },
      getTerm: function () {
        return s.trim(this.$$(".blog-search-input").val())
      },
      setTerm: function (t) {
        this.$$(".blog-search-input").val(t).blur()
      },
      onTermChange: function (t, e) {
        this.setTerm(e)
      },
      onModelReset: function () {
        this.setTerm("")
      },
      inputFocusHandler: function () {
        n.trigger("indashblog:keycommands:suspend", !0)
      },
      inputBlurHandler: function () {
        n.trigger("indashblog:keycommands:resume")
      }
    });
    e.exports = c
  }, {
    "../models/blog-search-autocomplete-model": 412,
    "../templates/blog-search-input.tpl": 417,
    "./popovers/blog-search-autocomplete-helper": 425,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/selectorcache": 586,
    "prima/views/base": 613
  }],
  423: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/events"), a = t("prima/views/base"), r = t("../templates/blog-search-no-results.tpl"), l = a.extend({
      className: "search-no-results",
      template: r,
      afterRender: function () {
        this.setHeight(), this.listenTo(n, "DOMEventor:flatresize", o.throttle(this.setHeight, 300))
      },
      setHeight: function () {
        var t = s(".indash_blog .posts"), e = t.outerHeight() - t.height(), i = s(".indash_blog .header").height();
        this.$el.height(s(window).height() - i - e)
      }
    });
    e.exports = l
  }, {
    "../templates/blog-search-no-results.tpl": 418,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/views/base": 613
  }],
  424: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/views/base"), a = t("prima/events"), r = t("../templates/blog-search.tpl"), l = t("./blog-search-filters"), h = t("./blog-search-input"), c = t("./blog-search-no-results"), d = t("../models/blog-search-model"), u = n.extend({
      className: "peepr-blog-search",
      template: r,
      subviews: {filters: {constructor: l}, input: {constructor: h}},
      events: {
        "submit .blog-search-form": "formSubmitHandler",
        "click .blog-search-form": "onFormClick",
        "click .clear-search": "clearSearch",
        "click .toggle-search": "toggleSearch"
      },
      initialize: function (t) {
        this.options = t, this.searchActive = !1, this.blog = t.blog, this.model = new d({
          blogname: this.blog.tumblelog_name_or_id,
          themeParams: this.blog.get("global_theme_params")
        }), s.each(this.subviews, function (t) {
          t.options = t.options || {}, t.options.model = this.model
        }, this), this.bindEvents()
      },
      bindEvents: function () {
        this.listenTo(this.model.posts, "reset", this.onPostsReset), this.listenTo(this.model.posts, "add", this.onPostsAdd), this.listenTo(this.model, "search:reset", this.onSearchReset), this.listenTo(this.model, "change:next_offset", this.onOffsetChange), this.listenTo(this.model, "change:term", s.bind(this.log, this, "search-start", {})), this.listenTo(a, "indashblog:search:fetch-requested", this.onFetchRequested), this.listenTo(a, "indashblog:ready-animation-start", this.onPeeprReady)
      },
      onPeeprReady: function () {
        this.setWidth()
      },
      setWidth: function () {
        var t = this.$el.parents(".navigation_inner"), e = t.width(), i = t.find(".header_controls").outerWidth();
        this.$el.width(e - i)
      },
      onFetchRequested: function (t) {
        this.model.fetch(t)
      },
      formSubmitHandler: function (t) {
        t.preventDefault(), this.model.search()
      },
      onFormClick: function (t) {
        t.stopPropagation()
      },
      toggleSearch: function (t) {
        return t = s.defaults(t, {
          force: null,
          focus: !0
        }), this.model.get("term").length && null === t.force ? void this.clearSearch() : (this.searchActive = s.isBoolean(t.force) ? t.force : !this.searchActive, this.$el.toggleClass("show-search", this.searchActive), o(".indash_header_wrapper").toggleClass("search-active", this.searchActive), void(this.searchActive ? t.focus && s.delay(s.bind(this.input.focusInput, this.input), 300) : this.model.reset()))
      },
      clearSearch: function () {
        this.toggleSearch({force: !1}), a.trigger("indashblog:search:clear"), this.log("search-clear")
      },
      onSearchReset: function () {
        var t = this.model.get("term").length > 0;
        this.$el.toggleClass("term-entered", t), t && (a.trigger("indashblog:search:start"), this.searchActive || this.toggleSearch({
          focus: !1,
          force: !0
        }))
      },
      onPostsReset: function (t) {
        t.length && (a.trigger("indashblog:search:complete", t.toJSON()), this.log("search-complete"))
      },
      onOffsetChange: function (t, e) {
        e >= 0 || (a.trigger("indashblog:search:results-end", this.model.posts.length ? null : new c({model: this.model})), this.log("search-results-end"))
      },
      onPostsAdd: function (t) {
        a.trigger("indashblog:search:post-added", t.toJSON())
      },
      log: function (t, e) {
        var i = {
          loggingData: s.defaults({
            blogname: this.blog.tumblelog_name_or_id,
            term: this.model.get("term"),
            sort: this.model.get("sort"),
            post_type: this.model.get("post_type"),
            post_role: this.model.get("post_role"),
            next_offset: this.model.get("next_offset")
          }, e || {})
        };
        a.trigger("peepr-search:" + t, i)
      },
      remove: function () {
        this.model.stopListening(), n.prototype.remove.call(this)
      }
    });
    e.exports = u
  }, {
    "../models/blog-search-model": 413,
    "../templates/blog-search.tpl": 420,
    "./blog-search-filters": 421,
    "./blog-search-input": 422,
    "./blog-search-no-results": 423,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/views/base": 613
  }],
  425: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("./blog-search-autocomplete-popover"), a = o.extend({
      events: {
        click: "showPopover",
        blur: "onInputBlur"
      }, initialize: function () {
        this.popover = null, this.bindEvents()
      }, bindEvents: function () {
        this.listenTo(this.model, "change:matchTerm", this.onMatchTermChange)
      }, onMatchTermChange: function () {
        this.model.get("typeAheadMatches").length ? this.showPopover() : this.hidePopover()
      }, showPopover: function () {
        this.model.getItems().then(s.bind(function () {
          !this.popover && this.model.hasMatches() && (this.popover = new n({
            pinnedTarget: this.$el,
            model: this.model,
            shift: {x: -this.getLeftOffset(), y: 0},
            preventInteraction: !0,
            keycommands: !0
          }).render(), this.listenTo(this.popover, "close", this.onPopoverClose))
        }, this))
      }, getLeftOffset: function () {
        return this._leftOffset = this._leftOffset || this.$el.width() / 2, this._leftOffset
      }, onInputBlur: function () {
        s.delay(s.bind(this.hidePopover, this), 100)
      }, hidePopover: function () {
        this.popover && this.popover.hide()
      }, onPopoverClose: function () {
        s.defer(s.bind(function () {
          this.popover = null
        }, this))
      }
    });
    e.exports = a
  }, {"./blog-search-autocomplete-popover": 427, lodash: "MicNly", "prima/views/base": 613}],
  426: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("prima/events"), n = t("prima/views/base"), a = t("../../templates/blog-search-autocomplete-list.tpl"), r = n.extend({
      template: a,
      events: {"click [data-term]": "onTermClick"},
      initialize: function () {
        this.bindEvents()
      },
      bindEvents: function () {
        this.listenTo(this.model, "change:typeAheadMatches", this.render)
      },
      onTermClick: function (t) {
        this.selectTerm(s(t.currentTarget))
      },
      selectTerm: function (t) {
        o.trigger("peeprsearch:change:term", {term: t.attr("data-term")})
      }
    });
    e.exports = r
  }, {
    "../../templates/blog-search-autocomplete-list.tpl": 416,
    jquery: "HlZQrA",
    "prima/events": 546,
    "prima/views/base": 613
  }],
  427: [function (t, e, i) {
    "use strict";
    var s = t("./blog-search-popover"), o = t("./blog-search-autocomplete-list"), n = s.extend({
      className: s.prototype.className + " blog-search-autocomplete-popover",
      bindEvents: function () {
        s.prototype.bindEvents.apply(this, arguments), this.listenTo(this, "itemSelected", this.subview.selectTerm)
      },
      Subview: o
    });
    e.exports = n
  }, {"./blog-search-autocomplete-list": 426, "./blog-search-popover": 430}],
  428: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("prima/views/base"), n = t("../../templates/blog-filters-popover.tpl"), a = o.extend({
      template: n,
      events: {
        "click [data-filter]": "onFilterClick",
        "click .sort_filter.toggle": "onToggleFilterClick",
        "click .option-radio": "onCheckboxClick",
        "change [type=checkbox]": "onCheckboxChange"
      },
      initialize: function () {
        this.bindEvents()
      },
      afterRender: function () {
        this.onPostTypeChange(), this.onSortChange(), this.onPostRoleChange(), this.onFilterNsfwChange()
      },
      bindEvents: function () {
        this.listenTo(this.model, "change:sort", this.onSortChange), this.listenTo(this.model, "change:post_type", this.onPostTypeChange), this.listenTo(this.model, "change:post_role", this.onPostRoleChange), this.listenTo(this.model, "change:filter_nsfw", this.onFilterNsfwChange)
      },
      onPostRoleChange: function () {
        this.$("#post_role").prop("checked", this.model.get("post_role") !== this.model.defaults.post_role)
      },
      onPostTypeChange: function () {
        this.$(".post_type_filter.active").removeClass("active"), this.$('[data-filter="post_type:' + this.model.get("post_type") + '"]').addClass("active")
      },
      onFilterNsfwChange: function () {
        this.$(".search-nsfw-filter-checkbox-input").prop("checked", this.model.get("filter_nsfw") !== this.model.defaults.filter_nsfw)
      },
      onSortChange: function () {
        this.$(".sort_filter.active").removeClass("active"), this.$('[data-filter="sort:' + this.model.get("sort") + '"]').addClass("active")
      },
      onFilterClick: function (t) {
        var e = s(t.currentTarget).data("filter").split(":");
        this.model.set(e[0], e[1])
      },
      onCheckboxChange: function (t) {
        var e = s(t.currentTarget), i = t.currentTarget.id, o = e.data("value"), n = e.prop("checked");
        this.model.set(i, n ? o : this.model.defaults[i])
      },
      onCheckboxClick: function (t) {
        t.stopPropagation()
      },
      onToggleFilterClick: function (t) {
        var e = s(t.currentTarget).find("[type=checkbox]"), i = e.prop("checked");
        e.prop("checked", !i).trigger("change")
      }
    });
    e.exports = a
  }, {"../../templates/blog-filters-popover.tpl": 414, jquery: "HlZQrA", "prima/views/base": 613}],
  429: [function (t, e, i) {
    "use strict";
    var s = t("./blog-search-popover"), o = t("./blog-search-filter-list"), n = s.extend({
      className: s.prototype.className + " blog-search-filters-popover",
      Subview: o
    });
    e.exports = n
  }, {"./blog-search-filter-list": 428, "./blog-search-popover": 430}],
  430: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/mixins/popoverbase"), n = t("prima/view"), a = t("prima/utils/bindendevent").transition, r = t("prima/lib/clickoutside"), l = t("prima/mixins/keycommands"), h = t("../../templates/blog-search-popover.tpl"), c = n.extend({
      className: "popover--blog-search",
      mixins: [o, l],
      template: h,
      keycommands: {
        "keydown:down": "targetNextLi",
        "keydown:tab": "targetNextLi",
        "keydown:up": "targetPrevLi",
        "keydown:shift+tab": "targetPrevLi",
        "keyup:enter": "selectLi"
      },
      defaults: {keycommands: !1, keyboardFocusClass: "keyboard_focus"},
      initialize: function (t) {
        return this.options = s.defaults(t, this.defaults), this.Subview ? (this.subview = new this.Subview(t), void this.bindEvents()) : void this.remove()
      },
      render: function () {
        return this.$el.html(this.template()), this.$(".popover_inner").append(this.subview.render().$el), this.$main = this.$el.find(".popover"), s.delay(s.bind(function () {
          this.$main.addClass("popover--active"), this.bindClickOutside()
        }, this), 1), this
      },
      bindEvents: function () {
        this.listenTo(this.subview, "remove", this.hide), this.options.keycommands || this.disableKeys()
      },
      bindClickOutside: function () {
        this._popoverBase.autoTeardown && (this.clickOutside = new r(this.el), this.clickOutside.on("click:outside", this.hide, this))
      },
      unbindClickOutside: function () {
        this.clickOutside && (this.clickOutside.remove(), this.clickOutside = null)
      },
      targetNextLi: function (t) {
        t.preventDefault(), this.$active ? (this.$active.removeClass(this.options.keyboardFocusClass), this.$active = this.$active.next().length ? this.$active.next() : this.$(".popover_menu_item").first()) : this.$active = this.$(".popover_menu_item").first(), this.$active.addClass(this.options.keyboardFocusClass), this.scrollToActive()
      },
      targetPrevLi: function (t) {
        t.preventDefault(), this.$active ? (this.$active.removeClass(this.options.keyboardFocusClass), this.$active = this.$active.prev().length ? this.$active.prev() : this.$(".popover_menu_item").last()) : this.$active = this.$(".popover_menu_item").last(), this.$active.addClass(this.options.keyboardFocusClass), this.scrollToActive()
      },
      selectLi: function () {
        this.$active && this.trigger("itemSelected", this.$active)
      },
      scrollToActive: function () {
        this.$scrollable = this.$scrollable || this.$(".popover_inner"), this.$scrollable.scrollTop(this.$scrollable.scrollTop() + this.$active.position().top - this.$scrollable.height() + this.$active.outerHeight())
      },
      hide: function () {
        this.$main.removeClass("popover--active"), this.unbindClickOutside(), a(this.$el, s.bind(function () {
          this.subview.remove(), this.remove(), this.teardown()
        }, this))
      }
    });
    e.exports = c
  }, {
    "../../templates/blog-search-popover.tpl": 419,
    lodash: "MicNly",
    "prima/lib/clickoutside": 547,
    "prima/mixins/keycommands": 581,
    "prima/mixins/popoverbase": 583,
    "prima/utils/bindendevent": 593,
    "prima/view": 612
  }],
  431: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/component"), a = t("prima/events"), r = t("./views/showcase"), l = n.extend({
      name: "AboutTumblr",
      __logoClick: function (t) {
        t.preventDefault(), this.showcaseView.setSection(0)
      },
      __signupClick: function (t) {
        t.preventDefault(), this.showcaseView.setSection(0)
      },
      __aboutTumblrChange: function (t, e) {
        this.$lastSlideInput.length && 0 !== t && this.$lastSlideInput.val(e)
      },
      initialize: function (t) {
        this.options = o.extend({}, this.defaults, t), this.$lastSlideInput = s("#about_tumblr_slide"), this.showcaseView = new r({componentData: this.getOwnData()}), this.listenTo(a, "loggedoutheader:logoclick", this.__logoClick), this.listenTo(a, "abouttumblr:change", this.__aboutTumblrChange), this.options.isLogin ? this.listenTo(a, "loggedoutheader:loginclick", this.__signupClick) : this.listenTo(a, "loggedoutheader:signupclick", this.__signupClick)
      },
      render: function () {
        return this.showcaseView.render(), this
      },
      remove: function () {
        return this.showcaseView.teardown(), this
      }
    });
    e.exports = l
  }, {"./views/showcase": 447, jquery: "HlZQrA", lodash: "MicNly", "prima/component": 545, "prima/events": 546}],
  432: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", _.each(slides, function (t) {
          __p += '<div class="dot" title="' + (null == (__t = t) ? "" : _.escape(__t)) + '"></div>'
        }), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  433: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", "undefined" != typeof posts && (__p += '<div class="blogs-graphic"><div class="blogs-post-column">', _.each(posts, function (t, e) {
          __p += "", e > 0 && e % 3 === 0 && (__p += '</div><div class="blogs-post-column">'), __p += '<div class="blogs-post"><div class="post-top"><div class="ui-avatar" style="background-image:url(' + (null == (__t = t.avatar) ? "" : _.escape(__t)) + ')"></div><a class="ui-username" href="' + (null == (__t = t.post_url) ? "" : _.escape(__t)) + '" target="_blank">' + (null == (__t = t.tumblelog_name) ? "" : _.escape(__t)) + '</a></div><img class="post-image" src="' + (null == (__t = t.post_image) ? "" : _.escape(__t)) + '" alt=""><div class="post-bottom"><div class="ui-notes">' + (null == (__t = t.notes) ? "" : _.escape(__t)) + '</div><div class="post_controls"><div class="post_controls_inner"><div class="post_control share"></div><div class="post_control reblog"></div><div class="post_control like"></div></div></div></div></div>'
        }), __p += "</div></div>"), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  434: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="create-graphic"><div class="post-icon text-icon"><span class="icon-label">' + (null == (__t = __("Text")) ? "" : _.escape(__t)) + '</span></div><div class="post-icon photo-icon"><span class="icon-label">' + (null == (__t = __("Photo")) ? "" : _.escape(__t)) + '</span></div><div class="post-icon quote-icon"><span class="icon-label">' + (null == (__t = __("Quote")) ? "" : _.escape(__t)) + '</span></div><div class="post-icon link-icon"><span class="icon-label">' + (null == (__t = __("Link")) ? "" : _.escape(__t)) + '</span></div><div class="post-icon chat-icon"><span class="icon-label">' + (null == (__t = __("Chat")) ? "" : _.escape(__t)) + '</span></div><div class="post-icon audio-icon"><span class="icon-label">' + (null == (__t = __("Audio")) ? "" : _.escape(__t)) + '</span></div><div class="post-icon video-icon"><span class="icon-label">' + (null == (__t = __("Video")) ? "" : _.escape(__t)) + "</span></div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  435: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="post post_full"><div class="post_avatar faded_sub_avatar"><div class="post_avatar_link" style="background-image: url(' + (null == (__t = avatar) ? "" : _.escape(__t)) + ')"><img class="post_avatar_image" src="' + (null == (__t = avatar) ? "" : _.escape(__t)) + '" width="64" height="64"></div></div><div class="post_wrapper"><div class="post_header"><div class="post_info"><span class="post_info_link">' + (null == (__t = username) ? "" : _.escape(__t)) + '</span></div></div><div class="post_content clearfix"><div class="post_content_inner clearfix"><div class="post_media"><img class="post_media_photo image" alt="" src="' + (null == (__t = post_image) ? "" : _.escape(__t)) + '"></div></div></div><div class="post_footer clearfix"><div class="post_notes"><div class="post_notes_inner"><div class="post_notes_label note_count"><span class="note_link_current">' + (null == (__t = notes) ? "" : _.escape(__t)) + '</span></div></div></div><div class="post_controls"><div class="post_controls_inner"><div class="post_control share"></div><div class="post_control reply"></div><div class="post_control reblog"></div><div class="post_control like"></div></div></div></div></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  436: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="dashboard-graphic">', "undefined" != typeof post_form && (__p += '<div class="post_container new_post_buttons_container" id="new_post_buttons"><div class="new_post_buttons post post_full is_mine with_avatar new_post" id="new_post"><div class="post_buttons clearfix"><a href="#" class="new_post_label"><i class="icon_post_text"></i> <span class="new_post_label_text">' + (null == (__t = __("Text")) ? "" : _.escape(__t)) + '</span></a> <a href="#" class="new_post_label"><i class="icon_post_photo"></i> <span class="new_post_label_text">' + (null == (__t = __("Photo")) ? "" : _.escape(__t)) + '</span></a> <a href="#" class="new_post_label"><i class="icon_post_quote"></i> <span class="new_post_label_text">' + (null == (__t = __("Quote")) ? "" : _.escape(__t)) + '</span></a> <a href="#" class="new_post_label"><i class="icon_post_link"></i> <span class="new_post_label_text">' + (null == (__t = __("Link")) ? "" : _.escape(__t)) + '</span></a> <a href="#" class="new_post_label"><i class="icon_post_chat"></i> <span class="new_post_label_text">' + (null == (__t = __("Chat")) ? "" : _.escape(__t)) + '</span></a> <a href="#" class="new_post_label"><i class="icon_post_audio"></i> <span class="new_post_label_text">' + (null == (__t = __("Audio")) ? "" : _.escape(__t)) + '</span></a> <a href="#" class="new_post_label"><i class="icon_post_video"></i> <span class="new_post_label_text">' + (null == (__t = __("Video")) ? "" : _.escape(__t)) + '</span></a></div><div class="post_avatar"><div class="post_avatar_link" style="background-image:url(\'' + (null == (__t = post_form.avatar) ? "" : _.escape(__t)) + '\')"><img class="post_avatar_image" src="' + (null == (__t = post_form.avatar) ? "" : _.escape(__t)) + '" height="64" width="64"></div></div></div></div>'), __p += '<div class="post-top-wrapper"></div>', "undefined" != typeof notification && (__p += '<div class="notification single_notification alt notification_like can_ignore"><div class="notification_inner clearfix"><div class="notification_sentence"><div class="hide_overflow">' + (null == (__t = sprintf(__("%1$s liked your photo"), '<span class="username">' + notification.username + "</span>")) ? "" : __t) + '</div></div></div><div class="control avatar_frame"><img alt="" class="avatar" src="' + (null == (__t = notification.avatar) ? "" : _.escape(__t)) + '"></div><div class="control notification_right"><div class="preview_frame"><img src="' + (null == (__t = notification.preview) ? "" : _.escape(__t)) + '"></div></div></div>'), __p += '<div class="post-bottom-wrapper"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  437: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", "undefined" != typeof post && (__p += '<div class="fullscreen_post_bg" style="background-image:url(' + (null == (__t = post.post_image) ? "" : _.escape(__t)) + ')"></div><div class="fullscreen_post_footer"><div class="fullscreen_post_posted_by show"><a href="' + (null == (__t = post.tumblelog_url) ? "" : _.escape(__t)) + '" target="_blank" rel="nofollow" title="' + (null == (__t = __("Posted by")) ? "" : _.escape(__t)) + " " + (null == (__t = post.tumblelog_name) ? "" : _.escape(__t)) + '">' + (null == (__t = __("Posted by")) ? "" : _.escape(__t)) + "&nbsp;<strong>" + (null == (__t = post.tumblelog_name) ? "" : _.escape(__t)) + '</strong></a> <a href="' + (null == (__t = post.tumblelog_url) ? "" : _.escape(__t)) + '" target="_blank" rel="nofollow" title="' + (null == (__t = post.tumblelog_name) ? "" : _.escape(__t)) + '" class="post_avatar root_tumblelog" style="background-image:url(' + (null == (__t = post.avatar) ? "" : _.escape(__t)) + ')"><img src="' + (null == (__t = post.avatar) ? "" : _.escape(__t)) + '" alt="' + (null == (__t = post.tumblelog_name) ? "" : _.escape(__t)) + '"></a></div></div>'), __p += "";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  438: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/view"), a = t("prima/events"), r = t("../templates/pagination.tpl"), l = n.extend({
      className: "showcase-pagination",
      defaults: {slides: []},
      events: {"click .dot": "__dotClick"},
      template: r,
      __dotClick: function (t) {
        t.preventDefault();
        var e = s(t.currentTarget);
        e.hasClass("active") || (this.$dots.removeClass("active"), e.addClass("active"), a.trigger("abouttumblr:navigate", e.index()))
      },
      initialize: function (t) {
        this.options = o.extend({}, this.defaults, t), this.$dots = s()
      },
      render: function () {
        return this.$el.html(this.template({slides: this.options.slides})), this.$dots = this.$(".dot"), this
      },
      update: function (t) {
        this.$dots.removeClass("active"), this.$dots.eq(t).addClass("active")
      }
    });
    e.exports = l
  }, {"../templates/pagination.tpl": 432, jquery: "HlZQrA", lodash: "MicNly", "prima/events": 546, "prima/view": 612}],
  439: [function (t, e, i) {
    "use script";
    e.exports = {
      about: t("./sections/about"),
      blogs: t("./sections/blogs"),
      create: t("./sections/create"),
      dashboard: t("./sections/dashboard"),
      login: t("./sections/login"),
      welcome: t("./sections/welcome")
    }
  }, {
    "./sections/about": 440,
    "./sections/blogs": 442,
    "./sections/create": 443,
    "./sections/dashboard": 444,
    "./sections/login": 445,
    "./sections/welcome": 446
  }],
  440: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("velocity-animate"), a = t("./base"), r = a.extend({
      el: ".about-section",
      defaults: {introDelay: 500, introDuration: 1500},
      iconAnimationPositions: [{selector: ".audio-a", x: "100%", y: "90%"}, {
        selector: ".audio-b",
        x: "-30%",
        y: "-70%"
      }, {selector: ".chat-a", x: "80%", y: "-10%"}, {selector: ".chat-b", x: "0", y: "-70%"}, {
        selector: ".chat-c",
        x: "-110%",
        y: "90%"
      }, {selector: ".follow-a", x: "140%", y: "-50%"}, {
        selector: ".follow-b",
        x: "130%",
        y: "0"
      }, {selector: ".follow-c", x: "-60%", y: "40%"}, {selector: ".like-a", x: "10%", y: "-70%"}, {
        selector: ".like-b",
        x: "-80%",
        y: "10%"
      }, {selector: ".like-c", x: "-50%", y: "90%"}, {selector: ".link-a", x: "60%", y: "-100%"}, {
        selector: ".link-b",
        x: "-60%",
        y: "0"
      }, {selector: ".photo-a", x: "40%", y: "140%"}, {
        selector: ".photo-b",
        x: "-150%",
        y: "-30%"
      }, {selector: ".quote-a", x: "140%", y: "10%"}, {
        selector: ".quote-b",
        x: "-125%",
        y: "20%"
      }, {selector: ".reblog-a", x: "-60%", y: "-100%"}, {
        selector: ".reblog-b",
        x: "25%",
        y: "100%"
      }, {selector: ".text-a", x: "120%", y: "-15%"}, {
        selector: ".video-a",
        x: "70%",
        y: "-110%"
      }, {selector: ".video-b", x: "-80%", y: "-90%"}],
      initialize: function (t) {
        a.prototype.initialize.call(this, t), this.$graphic = this.$(".about-graphic")
      },
      showSlide: function () {
        return this.$graphic.length && o.forEach(this.iconAnimationPositions, o.bind(function (t) {
          var e = s(t.selector).css("opacity", 0);
          n.animate(e, "stop"), n.animate(e, {
            opacity: 1,
            translateX: [0, t.x],
            translateY: [0, t.y]
          }, {
            delay: this.options.introDelay,
            duration: this.options.introDuration + 300 * Math.random(),
            easing: "easeOutQuart"
          })
        }, this)), a.prototype.showSlide.call(this, arguments)
      }
    });
    e.exports = r
  }, {"./base": 441, jquery: "HlZQrA", lodash: "MicNly", "velocity-animate": "lWl/mc"}],
  441: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = o.extend({
      initialize: function (t) {
        this.options = s.extend({}, this.defaults, t), this.componentData = this.options.componentData, this.slideName = this.options.slideName, this.slideIndex = this.options.slideIndex, this.$wrapper = this.$(".section-wrapper"), this.render()
      }, render: function () {
        var t = this.$wrapper.length ? this.$wrapper : this.$el;
        return this.template && s.has(this.componentData, this.slideName) && t.append(this.template(this.componentData[this.slideName])), this
      }, showSlide: function () {
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "prima/view": 612}],
  442: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("./base"), a = t("../../templates/sections/blogs.tpl"), r = n.extend({
      el: ".blogs-section",
      template: a,
      initialize: function (t) {
        n.prototype.initialize.call(this, t)
      },
      render: function () {
        return s.ajax({
          url: "/about_tumblr/slide_data/blogs", success: o.bind(function (t) {
            this.componentData.blogs = t.response, n.prototype.render.call(this)
          }, this)
        }), this
      }
    });
    e.exports = r
  }, {"../../templates/sections/blogs.tpl": 433, "./base": 441, jquery: "HlZQrA", lodash: "MicNly"}],
  443: [function (t, e, i) {
    "use strict";
    var s = t("./base"), o = t("../../templates/sections/create.tpl"), n = s.extend({
      el: ".create-section",
      template: o,
      render: function () {
        return this.$wrapper.prepend(o()), this
      }
    });
    e.exports = n
  }, {"../../templates/sections/create.tpl": 434, "./base": 441}],
  444: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("./base"), n = t("../../templates/sections/dashboard.tpl"), a = t("../../templates/sections/dashboard-post.tpl"), r = o.extend({
      el: ".dashboard-section",
      template: n,
      render: function () {
        o.prototype.render.call(this);
        var t = this.componentData[this.slideName];
        if (s.isEmpty(t))return this;
        var e = this.$(".post-top-wrapper"), i = this.$(".post-bottom-wrapper");
        return e.length && !s.isEmpty(t.post_top) && e.html(a(t.post_top)), i.length && !s.isEmpty(t.post_bottom) && i.html(a(t.post_bottom)), this
      }
    });
    e.exports = r
  }, {
    "../../templates/sections/dashboard-post.tpl": 435,
    "../../templates/sections/dashboard.tpl": 436,
    "./base": 441,
    lodash: "MicNly"
  }],
  445: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("prima/events"), n = t("./base"), a = n.extend({
      el: ".login-section",
      events: {"click .about-tumblr-btn": "__aboutButtonClick"},
      __aboutButtonClick: function (t) {
        t.preventDefault(), o.trigger("abouttumblr:navigate", 1)
      },
      initialize: function (t) {
        n.prototype.initialize.call(this, t), this.$emailInput = s("#signup_email")
      },
      showSlide: function () {
        this.$emailInput.focus()
      }
    });
    e.exports = a
  }, {"./base": 441, jquery: "HlZQrA", "prima/events": 546}],
  446: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("./base"), n = t("../../templates/sections/welcome.tpl"), a = o.extend({
      el: ".welcome-section",
      template: n,
      initialize: function (t) {
        o.prototype.initialize.call(this, t), this.$emailInput = s("#signup_email")
      },
      showSlide: function () {
        this.$emailInput.focus()
      }
    });
    e.exports = a
  }, {"../../templates/sections/welcome.tpl": 437, "./base": 441, jquery: "HlZQrA"}],
  447: [function (t, e, i) {
    "use strict";
    //var f = jQuery;
    var s = t("jquery");
    var  o = t("lodash"), n = t("prima/view"), a = t("prima/events"), r = t("prima/lib/domeventor"), l = t("prima/mixins/keycommands"), h = t("./sections"), c = t("./sections/base"), d = t("./pagination"), u = n.extend({
      el: ".about-tumblr-showcase",
      defaults: {scrollSpeed: 700},
      mixins: [l],
      keycommands: {
        "keydown:j": "__keydown",
        "keydown:down": "__keydown",
        "keydown:k": "__keydown",
        "keydown:up": "__keydown"
      },
      __navigateTo: function (t) {
        this.setSection(t)
      },
      __keydown: function (t) {
        var e = s(t.target);
        if (!e.is(":input") && !e.hasClass("result_link"))switch (t.which) {
          case 40:
          case 74:
            this.nextSection();
            break;
          case 38:
          case 75:
            this.previousSection()
        }
      },
      __resize: function () {
        this.slideshowHeight = r.rect().windowHeight
      },
      __mousewheel: function (t) {
        if (t.preventDefault(), t.stopPropagation(), t = t.originalEvent, this.isScrolling)return !1;
        var e = Math.max(-1, Math.min(1, t.wheelDelta || -t.deltaY || -t.detail));
        return 0 > e ? this.nextSection() : this.previousSection(), !1
      },
      _setUpSections: function () {
        this.$sections.each(o.bind(function (t, e) {
          var i = s(e), o = i.data("section"), n = h[o];
          n ? this.sectionViews[o] = new n({
            componentData: this.componentData,
            slideName: o,
            slideIndex: t
          }) : this.sectionViews[o] = new c({
            el: i,
            componentData: this.componentData,
            slideName: o,
            slideIndex: t
          }), i.css("z-index", this.totalSections - t)
        }, this))
      },
      _resetScrolling: function () {
        var t = o.bind(function () {
          this.isScrolling = !1
        }, this);
        setTimeout(t, 320)
      },
      _setActiveSection: function () {
        this.$sections.removeClass("active"), this.$sections.eq(this.activeSectionIndex).addClass("active"), this.activeSectionView && this.activeSectionView.showSlide()
      },
      _unsetActiveSection: function () {
        this.$el.removeClass("show-" + this.activeSection)
      },
      initialize: function (t) {
        this.options = o.extend({}, this.defaults, t), this.$html = s("html"), this.$body = s("body"), this.$header = s(".logged-out-header"), this.$logo = s("#logo"), this.$showcase = this.$(".showcase"), this.$sections = this.$(".section"), this.activeSection = "", this.activeSectionIndex = -1, this.activeSectionView = null, this.totalSections = this.$sections.length, this.sectionViews = {}, this.componentData = this.options.componentData, this.slideshowHeight = 1.2 * r.rect().windowHeight, this.activeSlideTimeout = null, this.scrollTimeout = null, this.isScrolling = !1, this.paginationView = new d({
          slides: this.$sections.map(function () {
            return s(this).data("section-title")
          }).get()
        }), this.listenTo(a, "abouttumblr:navigate", this.__navigateTo), this.listenTo(a, "DOMEventor:flatresize", this.__resize), this.__resize(), this._setUpSections(), this.$el.addClass("ready"), this.$html.addClass("show-about-tumblr")
      },
      nextSection: function () {
        this.activeSectionIndex < this.totalSections - 1 && this.setSection(this.activeSectionIndex + 1)
      },
      previousSection: function () {
        this.activeSectionIndex > 0 && this.setSection(this.activeSectionIndex - 1)
      },
      setSection: function (t) {
        var e = s("." + this.$sections.eq(t).attr("class").split(" ").join("."));
        t !== this.activeSectionIndex && e.length && (this._unsetActiveSection(), this.activeSection = e.data("section"), this.activeSectionIndex = t, this.activeSectionView = this.sectionViews[this.activeSection], this.isScrolling = !0, this.paginationView.update(t), this.$sections.removeClass("old-hat").filter(":lt(" + this.activeSectionIndex + ")").addClass("old-hat"), this.activeSlideTimeout && (clearTimeout(this.activeSlideTimeout), this.activeSlideTimeout = null), this.scrollTimeout && (clearTimeout(this.scrollTimeout), this.scrollTimeout = null), this.activeSlideTimeout = setTimeout(o.bind(function () {
          this._resetScrolling(), this._setActiveSection()
        }, this), this.options.scrollSpeed), a.trigger("abouttumblr:change", this.activeSectionIndex, this.activeSection), o.delay(o.bind(function () {
          this.$el.addClass("show-" + this.activeSection)
        }, this), 50))
      },
      render: function () {
        if (!this.$sections.length)return this;
        this.$el.append(this.paginationView.render().el), this.setSection(0), this.paginationView.update(0);
        var t = o.throttle(o.bind(this.__mousewheel, this), 1e3, {trailing: !1});
        return this.$el.on("wheel mousewheel", t), a.trigger("abouttumblr:start", this.activeSectionIndex), this
      },
      teardown: function () {
        return a.trigger("abouttumblr:remove"), o.each(this.sectionViews, function (t) {
          t.remove()
        }), this.$html.removeClass("show-about-tumblr"), this.$logo.off(".about-tumblr"), this.$el.off(), this.remove(), this
      }
    });
    e.exports = u
  }, {
    "./pagination": 438,
    "./sections": 439,
    "./sections/base": 441,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/domeventor": 550,
    "prima/mixins/keycommands": 581,
    "prima/view": 612
  }],
  448: [function (t, e, i) {
    "use strict";
    e.exports = t("./views/button")
  }, {"./views/button": 450}],
  449: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<a class="explore" href="/explore"><span class="explore_icon"></span>' + (null == (__t = __("Explore Tumblr")) ? "" : __t) + "</a>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  450: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("../templates/button.tpl"), r = n.extend({
      events: {"click .explore": "onClick"},
      keyFields: ["#signup_email", "#signup_password", "#signup_username"],
      initialize: function (t) {
        s.forEach(this.keyFields, function (t) {
          o(t).on("keyup", this.boundInputChanged)
        }, this), this.render()
      },
      remove: function () {
        s.forEach(this.keyFields, function (t) {
          o(t).off("keyup", this.boundInputChanged)
        }, this), n.prototype.remove.apply(this)
      },
      render: function () {
        this.$el.append(a())
      },
      hasEnteredInfo: function () {
        return s.some(this.keyFields, function (t) {
          return o(t).val() ? !0 : void 0
        })
      }
    });
    e.exports = r
  }, {"../templates/button.tpl": 449, jquery: "HlZQrA", lodash: "MicNly", "prima/view": 612}],
  451: [function (t, e, i) {
    "use strict";
    e.exports = {HeaderView: t("./views/header")}
  }, {"./views/header": 452}],
  452: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/events"), a = o.extend({
      el: ".logged-out-header",
      events: {
        "click .logo": "__logoClick",
        "click .login-button": "__loginButtonClick",
        "click .signup-button": "__signupButtonClick"
      },
      __logoClick: function (t) {
        n.trigger("loggedoutheader:logoclick", t)
      },
      __loginButtonClick: function (t) {
        n.trigger("loggedoutheader:loginclick", t)
      },
      __signupButtonClick: function (t) {
        n.trigger("loggedoutheader:signupclick", t)
      },
      initialize: function (t) {
        this.options = s.extend({}, this.defaults, t)
      },
      hideLogo: function () {
        this.$el.addClass("hide-logo")
      },
      showLogo: function () {
        this.$el.removeClass("hide-logo")
      }
    });
    e.exports = a
  }, {lodash: "MicNly", "prima/events": 546, "prima/view": 612}],
  context: [function (t, e, i) {
    e.exports = t("ERJJGK")
  }, {}],
  ERJJGK: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("app/router"), a = t("prima/events"), r = t("components/help-form"), l = t("./components/about-tumblr"), h = t("./components/logged-out-header").HeaderView, c = t("./components/explore-button"), d = t("app/components/mobile-app-banner"), u = t("prima/lib/flags"), p = n.extend({
      root: "/",
      routes: {register: "register", login: "login", "*default": "register"},
      __aboutTumblrChange: function (t) {
        0 === t ? this.headerView.hideLogo() : this.headerView.showLogo()
      },
      _createAboutTumblr: function (t) {
        this.isLoggedIn || this.isMobile || (this.aboutTumblr = new l({isLogin: t}).render(), a.on("abouttumblr:change", o.bind(this.__aboutTumblrChange, this)))
      },
      initialize: function () {
        this.helpForm = new r, this.headerView = new h;
        var t = s("body");
        this.isMobile = t.hasClass("is_mobile"), this.isLoggedIn = t.hasClass("logged_in"), !this.isLoggedIn && this.isMobile && (this.mobileAppBanner = new d({
          type: "download-banner",
          attachTo: '[prima-component="MobileAppBanner"]'
        }), this.mobileAppBanner.render())
      },
      register: function () {
        this._createAboutTumblr(!1), u.bool("discovery_hub_access") && (this.exploreButton = new c({el: s(".signup_forms")}))
      },
      login: function () {
        this._createAboutTumblr(!0)
      }
    });
    e.exports = p
  }, {
    "./components/about-tumblr": 431,
    "./components/explore-button": 448,
    "./components/logged-out-header": 451,
    "app/components/mobile-app-banner": 184,
    "app/router": 465,
    "components/help-form": 489,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/flags": "f/LVtH"
  }],
  455: [function (t, e, i) {
    "use strict";
    var s = t("prima/utils/exposer");
    s({
      "Tumblr.Prima.Upload": t("app/components/upload"),
      "Tumblr.Prima.Ligature": t("ligature"),
      "Tumblr.Events": t("prima/events"),
      "Tumblr.Prima.Events": t("prima/events"),
      "Tumblr.Prima.Dialog": t("app/components/dialog"),
      "Tumblr.Dialog": t("app/components/dialog"),
      "Tumblr.PostMessageChannel": t("components/post-message-channel"),
      "Tumblr.Prima.DOMEventor": t("prima/lib/domeventor"),
      "Tumblr.Prima.gutterMediaManager": t("app/components/gutter-media-manager"),
      "Tumblr.Prima.Vendor.when": t("when"),
      "Tumblr.Prima.Vendor.sequence": t("when/sequence"),
      "Tumblr.log_lady": t("prima/lib/loglady"),
      "Tumblr.Prima.logLady": t("prima/lib/loglady"),
      "Tumblr.Prima.Models.Post": t("app/models/post"),
      "Tumblr.Prima.Models.Tumblelog": t("app/models/tumblelog"),
      "Tumblr.Prima.CrtPlayer": t("components/crt/player"),
      "Tumblr.Prima.BlogCard": t("app/components/blog-card"),
      "Tumblr.Prima.Url": t("prima/utils/url"),
      ace: t("app/vendor/ace"),
      "Tumblr.Prima.ToolTip": t("app/components/tooltip"),
      "Tumblr.Prima.SharePopover": t("components/popover/views/share-popover"),
      "Tumblr.Prima.Messaging.SharePost": t("app/components/messaging-share-post"),
      "Tumblr.Prima.utils.caniuse": t("prima/utils/caniuse"),
      "Tumblr.Prima.ConfettiView": t("app/components/confetti/views/confetti-view"),
      "Tumblr.Prima.FlatSelect": t("app/components/flat-select"),
      "Tumblr.Prima.Mixins.loggingData": t("prima/mixins/generate-logging-data"),
      "Tumblr.Prima.Scrollbar": t("app/lib/scrollbar"),
      "Tumblr.Prima.MessageControlsPopover": t("components/popover/views/message-controls-popover"),
      "Tumblr.Prima.Block": t("app/lib/block"),
      "Tumblr.Prima.PeeprSearch": t("app/context/indash-blog/components/blog-search"),
      "Tumblr.Prima.MessagingPopover": t("app/components/peepr/components/messaging-popover"),
      "Tumblr.Prima.currentUser": t("app/lib/currentuser"),
      "Tumblr.Prima.AdsPaginationHelper": t("app/context/dashboard/components/ads_pagination_helper")
    }), e.exports = s
  }, {
    "app/components/blog-card": 30,
    "app/components/confetti/views/confetti-view": 43,
    "app/components/dialog": 44,
    "app/components/flat-select": 52,
    "app/components/gutter-media-manager": 72,
    "app/components/messaging-share-post": 80,
    "app/components/peepr/components/messaging-popover": 194,
    "app/components/tooltip": 392,
    "app/components/upload": 397,
    "app/context/dashboard/components/ads_pagination_helper": 410,
    "app/context/indash-blog/components/blog-search": 411,
    "app/lib/block": 457,
    "app/lib/currentuser": 459,
    "app/lib/scrollbar": 460,
    "app/models/post": 462,
    "app/models/tumblelog": 463,
    "app/vendor/ace": "4e8++S",
    "components/crt/player": 469,
    "components/popover/views/message-controls-popover": 510,
    "components/popover/views/share-popover": 511,
    "components/post-message-channel": 512,
    ligature: 652,
    "prima/events": 546,
    "prima/lib/domeventor": 550,
    "prima/lib/loglady": 566,
    "prima/mixins/generate-logging-data": 580,
    "prima/utils/caniuse": 595,
    "prima/utils/exposer": 602,
    "prima/utils/url": 611,
    when: "RG2dij",
    "when/sequence": 662
  }],
  456: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = [16, 24, 30, 40, 48, 64, 96, 128, 512], n = s.last(o), a = 128, r = function (t) {
      return t >= n ? n : s.find(o, function (e) {
        return e >= t
      })
    }, l = function (t, e) {
      var i = function (e) {
        return e = null == e ? a : r(e), t.replace(/^(.*_)?(\d+)(\D.*)?$/, "$1" + e + "$3")
      };
      return i.toString = function () {
        return this()
      }, null != e ? i(e) : i
    };
    e.exports = l
  }, {lodash: "MicNly"}],
  457: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/lib/translate"), a = t("prima/lib/data"), r = t("app/components/dialog"), l = t("when"), h = {
      _getCurrentTumblelog: function () {
        var t = "", e = a.get("Context/userinfo");
        return e && o.each(e.channels, function (e) {
          e.is_current && (t = e.name)
        }), t
      }, block: function (t) {
        t = t || {};
        var e = {};
        return e.tumblelog = t.currentTumblelog || this._getCurrentTumblelog(), t.blockedTumblelog ? e.blocked_tumblelog = t.blockedTumblelog : t.blockedPost && (e.blocked_post = t.blockedPost), s.ajax({
          url: "/svc/block/add",
          type: "POST",
          data: e,
          with_form_key: !0
        })
      }, unblock: function (t) {
        t = t || {};
        var e = {};
        return e.tumblelog = t.currentTumblelog || this._getCurrentTumblelog(), e.blocked_tumblelog = t.blockedTumblelog, s.ajax({
          url: "/svc/block/remove",
          type: "POST",
          data: e,
          with_form_key: !0
        })
      }, confirmBlock: function (t) {
        t = t || {};
        var e, i = t.currentTumblelog || this._getCurrentTumblelog(), s = l.defer();
        if (t.blockedTumblelog)e = n("%1$sAre you sure you want to block %2$s from %3$s?%4$sThey won't be able to follow %3$s, send %3$s messages, see %3$s in search results, or interact with any of %3$s's posts.%5$s", "<h3>", t.blockedTumblelog, i, "</h3><small>", "</small>"); else {
          if (!t.blockedPost)return s.reject(), s.promise;
          e = n("%1$sBlock messages from this sender?%2$sAny further messages sent from their IP address will be blocked from your inbox. This can't be undone, by the way.%3$s", "<h3>", "</h3><small>", "</small>")
        }
        return r.confirm(e, function () {
          s.resolve(t.blockedTumblelog ? t.blockedTumblelog : t.blockedPost)
        }, function () {
          s.reject()
        }, n("Block"), n("Nevermind")), s.promise["catch"](o.noop), s.promise
      }
    };
    e.exports = h
  }, {
    "app/components/dialog": 44,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/data": 548,
    "prima/lib/translate": 575,
    when: "RG2dij"
  }],
  458: [function (t, e, i) {
    "use strict";
    var s = (window.URL || window.webkitURL || window.mozURL || window.msURL || {}).createObjectURL;
    e.exports = s
  }, {}],
  459: [function (t, e, i) {
    "use strict";
    var s, o = t("app/models/user"), n = t("prima/lib/data"), a = t("prima/events"), r = function () {
      if (null == s) {
        var t = n.get("Context/userinfo");
        s = t && t.name ? new o(t) : !1, s && (s.listenTo(a, "post:like:set", s.incrementLikeCount), s.listenTo(a, "post:unlike:set", s.decrementLikeCount), s.listenTo(a, "tumblelog:follow", s.incrementFollowingCount), s.listenTo(a, "tumblelog:unfollow", s.decrementFollowingCount))
      }
      return s
    };
    e.exports = r
  }, {"app/models/user": 464, "prima/events": 546, "prima/lib/data": 548}],
  460: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("fastdom"), a = t("prima/events"), r = t("prima/class"), l = t("prima/mixins/accessor"), h = r.extend({
      mixins: [l],
      defaults: {
        tplScrollbarWrapper: '<div class="tx-scroll"></div>',
        tplScrollbarTrack: '<div class="tx-scrollbar-track"><div class="tx-scrollbar-thumb"></div></div>',
        trackActiveClass: "tx-scrollbar-track--active",
        scrollingClass: "tx-scroll--scrolling",
        containerClass: "tx-scroll-container",
        infiniteScrollPercent: .9,
        scrollable: !1,
        scrolling: !1
      },
      destroyed: !1,
      constructor: function () {
        this.initialize.apply(this, arguments)
      },
      initialize: function (t) {
        this.$window = o(window), this.$container = o(t), this.container = this.$container[0], this.container && (this._onScrollStop = s.debounce(s.bind(this.onScrollStop, this), 150), this._onResize = s.debounce(s.bind(this.onResize, this), 150), this.createElements(), this.wrapContainer(), this.bindEvents(), this.update())
      },
      createElements: function () {
        this.$wrapper = o(this.get("tplScrollbarWrapper")), this.$track = o(this.get("tplScrollbarTrack")), this.$thumb = this.$track.find(".tx-scrollbar-thumb")
      },
      wrapContainer: function () {
        this.$container.wrap(this.$wrapper), this.$wrapper.remove(), this.$wrapper = this.$container.parent()
      },
      appendTrack: function () {
        this.$track.insertAfter(this.$container)
      },
      removeTrack: function () {
        this.$track.remove()
      },
      bindEvents: function () {
        this.listenTo(a, "DOMEventor:flatresize", this._onResize), this.$wrapper.on("mousedown.txScroll", ".tx-scrollbar-thumb", s.bind(this.onThumbMousedown, this)), this.$container.on("scroll.txScroll", s.bind(this.onScroll, this))
      },
      update: function () {
        if (!this.destroyed) {
          if (this.$container.addClass(this.get("containerClass")), !this.get("scrollable") && this._isScrollable() ? (this.set("scrollable", !0), this.appendTrack(), "ontouchstart" in document.documentElement || (this.$container.off("mousewheel.txScroll DOMMouseScroll.txScroll"), this.$container.on("mousewheel.txScroll DOMMouseScroll.txScroll", s.bind(this.stealScroll, this)))) : this._isScrollable() || (this.set("scrollable", !1), this.$container.removeClass(this.get("containerClass")), this.removeTrack()), this.get("scrollable")) {
            var t = this.$container.height() / this.container.scrollHeight;
            this.$thumb.height(this.$track.height() * t)
          }
          this.updateScrollContstants(), this.positionThumb()
        }
      },
      updateScrollContstants: function () {
        this.currentScrollTop = this.$container.scrollTop(), this.percentageDifference = (this.container.scrollHeight - this.$container.height()) / (this.$track.height() - this.$thumb.height())
      },
      onResize: function () {
        this.update()
      },
      _isScrollable: function () {
        return this.container && this.container.scrollHeight > this.$container.height()
      },
      _getScrollTop: function (t, e) {
        return t.pageY - e.offset().top
      },
      onThumbMousedown: function (t) {
        t.preventDefault(), this.$track.addClass(this.get("trackActiveClass")), this.$window.on("mousemove.txScroll", s.bind(this.onTrackMousemove, this)), this.$window.on("mouseup.txScroll", s.bind(this.onTrackMouseup, this)), this.mouseDownOriginalOffsetY = this._getScrollTop(t, this.$track), this.updateScrollContstants()
      },
      onTrackMousemove: function (t) {
        var e;
        n.read(function () {
          this.destroyed || (e = this._getScrollTop(t, this.$track) - this.mouseDownOriginalOffsetY, n.write(function () {
            this.destroyed || this.$container.scrollTop(this.currentScrollTop + e * this.percentageDifference)
          }, this))
        }, this)
      },
      onTrackMouseup: function (t) {
        t.preventDefault(), this.$track.removeClass(this.get("trackActiveClass")), this.$window.off(".txScroll")
      },
      positionThumb: function () {
        var t, e, i;
        this.destroyed || (i = this.container.scrollTop, t = i / (this.container.scrollHeight - this.$container.height()), e = this.$track.height() - this.$thumb.height(), n.write(function () {
          this.destroyed || (this.$thumb.css("transform", "translate3d(0, " + e * t + "px, 0)"), this.trigger("scroll", i, t), t > this.get("infiniteScrollPercent") && this.trigger("infinitescroll", i, t))
        }, this))
      },
      onScroll: function () {
        this.get("scrolling") || (this.trigger("scrollstart"), this.$wrapper.addClass(this.get("scrollingClass"))), this.set("scrolling", !0), this._onScrollStop(), n.read(s.bind(this.positionThumb, this))
      },
      onScrollStop: function () {
        this.destroyed || (this.trigger("scrollstop"), this.set("scrolling", !1), this.$wrapper.removeClass(this.get("scrollingClass")))
      },
      stealScroll: function (t) {
        var e = t.currentTarget, i = t.originalEvent.wheelDelta || -t.originalEvent.detail;
        i > 0 && e.scrollTop <= 0 && t.preventDefault(), 0 > i && e.scrollTop >= e.scrollHeight - o(e).height() && t.preventDefault()
      },
      destroy: function () {
        this.destroyed = !0, this.$track.off().remove(), this.$thumb.remove(), this.$wrapper.off(".txScroll"), this.$container.off(".txScroll"), this.$container.unwrap(), this.$container.removeClass(this.get("containerClass")), this.$track = null, this.$thumb = null, this.$container = null, this.container = null, this.$wrapper = null, this.$window = null, this.set("scrollable", !1), this.off()
      }
    });
    e.exports = h
  }, {
    fastdom: 641,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/class": 543,
    "prima/events": 546,
    "prima/mixins/accessor": 577
  }],
  461: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/lib/mixin"), a = new n({
      setUpSelector: function (t) {
        t.on("change", o.bind(this.__select_change, this))
      }, __select_change: function (t) {
        var e = s(t.currentTarget);
        this.__update_select(e)
      }, __update_select: function (t) {
        var e = t.siblings("label");
        e.text(t.find(":selected").text())
      }
    });
    e.exports = a
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/lib/mixin": 572}],
  462: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/model"), a = t("prima/events"), r = t("app/models/tumblelog"), l = t("app/components/dialog"), h = t("app/components/post-embed-code"), c = t("prima/lib/translate"), d = n.extend({
      defaults: {},
      endpoints: {
        like: "/svc/like",
        unlike: "/svc/unlike",
        reblog: "/fast_reblog",
        reply: "/svc/reply",
        publish: "/publish",
        queue: "/publish",
        destroy: "/svc/post/delete",
        promote: "/svc/promote",
        unpromote: "/svc/unpromote",
        answer: "/answer",
        deny: "/deny_submission",
        approve: "/approve_submission",
        remove_source: "remove_app_attribution"
      },
      initialize: function (t) {
        this._createPostTumblelogModel("tumblelog", this.get("tumblelog-data")), this._createPostTumblelogModel("parentTumblelog", this.get("tumblelog-parent-data")), this._createPostTumblelogModel("rootTumblelog", this.get("tumblelog-root-data"))
      },
      _createPostTumblelogModel: function (t, e) {
        t = t || "tumblelog", e = e || !1;
        var i = !1;
        e && e.name && (i = new r(s(e).omit(s.isUndefined).omit(s.isNull).value())), this[t] = i
      },
      _setTumblelog: function () {
        this.tumblelog = new r(s({
          name: this.get("tumblelog"),
          ignoring: !1,
          sponsor: this.get("sponsored"),
          following: this.get("following"),
          mention_key: this.get("tumblelog_mention_key")
        }).omit(s.isUndefined).omit(s.isNull).value())
      },
      _setReblogTumblelog: function () {
        var t = this.get("reblog_source");
        t && t.name && (this.reblogTumblelog = new r(s({
          name: t.name,
          ignoring: !1,
          following: t.following
        }).omit(s.isUndefined).omit(s.isNull).value()))
      },
      _xhrRequest: function (t, e, i) {
        i.init && i.init();
        var n = o.ajax({data: e, type: "POST", url: t, with_form_key: !0});
        return n.done(s.bind(function (t) {
          i[200] && i[200].call(this, t)
        }, this)), n.fail(s.bind(function (t) {
          i[t.status] && i[t.status].call(this, t.status)
        }, this)), n.always(s.bind(function () {
          i.always && i.always()
        }, this)), n
      },
      _xhrSuccess: function (t) {
        this.trigger(t + ":success")
      },
      _xhrFailure: function (t) {
        l.alert(c("Sorry, we seem to be having technical trouble.  Please try again later.")), this.trigger(t + ":failure")
      },
      _xhrForbidden: function (t) {
        this.trigger(t + ":forbidden")
      },
      save: function (t, e, i) {
        if (i || (i = {}), this.endpoints[t]) {
          var o = {
            200: s.bind(this._xhrSuccess, this, t),
            401: s.bind(this._xhrFailure, this, t),
            404: s.bind(this._xhrFailure, this, t),
            403: s.bind(this._xhrForbidden, this, t),
            500: s.bind(this._xhrFailure, this, t)
          };
          return this._xhrRequest(this.endpoints[t], e, s.defaults(i, o))
        }
        throw new Error("Missing endpoint url for " + t)
      },
      like: function (t) {
        if (!this.get("is_mine")) {
          if (this.get("liked") === !1) {
            this.set("liked", !0);
            var e = this.likePayload(t, this.getLikeSource("like"));
            this.save("like", {data: e})
          }
          this.trigger("like:set", this), a.trigger("post:like:set", this.get("id"), this, t)
        }
      },
      unlike: function () {
        if (this.get("liked") === !0) {
          this.set("liked", !1);
          var t = this.likePayload("mouse", this.getLikeSource("unlike"));
          this.save("unlike", {data: t})
        }
        this.trigger("unlike:set", this), a.trigger("post:unlike:set", this.get("id"))
      },
      toggleLike: function () {
        this.get("liked") ? this.unlike() : this.like()
      },
      getLikeSource: function (t) {
        t = t || "like";
        var e = "LIKE_";
        switch (t) {
          case"unlike":
            e = "UNLIKE_";
            break;
          case"reply":
            e = "REPLY_";
            break;
          case"ignore":
            e = "IGNORE_"
        }
        var i = location.pathname;
        return i.match(/^\/dashboard/) ? e + "SOURCE_DASHBOARD" : i.match(/^\/tagged/) ? e + "SOURCE_TAG_PAGE" : i.match(/^\/likes/) ? e + "SOURCE_LIKES_PAGE" : i.match(/^\/inbox/) ? e + "SOURCE_INBOX" : i.match(/^\/search/) ? e + "SOURCE_SEARCH_RESULTS_PAGE" : i.match(/^\/explore/) ? e + "SOURCE_DISCOVER" : i.match(/^\/tv/) ? e + "SOURCE_TV" : i.match(/^\/indash_blog\/peepr/) ? e + this.getPeeprSource() : e + "SOURCE_UNKNOWN"
      },
      getPeeprSource: function () {
        if (window.parent && window.parent.location) {
          var t = window.parent.location.pathname;
          if (t.match(/search/))return "SOURCE_SEARCH_PEEPR"
        }
        return "SOURCE_PEEPR"
      },
      getEmbedCode: function (t, e) {
        var i = {
          embed_key: this.get("embed_key"),
          embed_did: this.get("embed_did"),
          post_id: this.get("id"),
          post_url: this.get("post_url")
        };
        t && (i.language = t), e && (i.width = e);
        var s = new h(i);
        return s.getCode()
      },
      likePayload: function (t, e) {
        return t = t || "mouse", e = e || "LIKE_SOURCE_UNKNOWN", {
          id: this.get("id"),
          root_id: this.get("root_id"),
          key: this.get("reblog_key"),
          method: t,
          source: e,
          placement_id: this.get("placement_id") || !1,
          is_recommended: this.get("is_recommended") || "",
          pt: this.get("pt")
        }
      },
      reblog: function (t) {
        t || (t = {}), t = s.extend({
          oldPostFormData: {
            pt: this.get("pt"),
            type: this.get("type"),
            reblog_id: this.get("id"),
            detached: !0,
            reblog: !0,
            reblog_key: this.get("reblog_key")
          }
        }, t, {
          reblogId: this.get("id"),
          reblogKey: this.get("reblog_key"),
          pt: this.get("pt")
        }), a.trigger("postForms:reblog", t)
      },
      fastReblog: function (t) {
        t || (t = !1), this.trigger("fastreblog:success", t), a.trigger("post:fastreblog:set", {model: this});
        var e = {
          reblog_key: this.get("reblog_key"),
          reblog_post_id: this.get("id"),
          queue: t,
          pt: this.get("pt")
        }, i = {
          200: s.bind(function (t) {
            this.set("reblogged", !0), this.trigger("fastreblog:ajax:success", t.response)
          }, this)
        };
        this.save("reblog", e, i)
      },
      reply: function (t) {
        var e = {
          reply_text: t,
          post_id: this.get("id"),
          tumblelog: this.get("tumblelog"),
          tumblelog_key: this.get("tumblelog-key") || this.get("tumblelog_key"),
          source: this.getLikeSource("reply")
        }, i = {
          200: s.bind(function () {
            this.trigger("replied")
          }, this)
        };
        return this.save("reply", {data: e}, i)
      },
      destroy: function () {
        var t = {post_id: this.get("id"), channel_id: this.get("tumblelog")};
        this.save("destroy", t)
      },
      publish: function () {
        var t = this.save("publish", {id: this.get("id")});
        t.fail(s.bind(function (t) {
          this.trigger("publish:failure", o.parseJSON(t.responseText))
        }, this))
      },
      promote: function (t) {
        var e = {
          tag: t,
          post_id: this.get("id"),
          reblog_key: this.get("reblog_key"),
          tumblelog_name: this.get("tumblelog")
        };
        return this.save("promote", e)
      },
      unpromote: function (t) {
        var e = {
          tag_id: t,
          post_id: this.get("id"),
          reblog_key: this.get("reblog_key"),
          tumblelog_name: this.get("tumblelog")
        };
        return this.save("unpromote", e)
      },
      queue: function () {
        var t = {id: this.get("id"), queue: "queue"};
        this.save("queue", t)
      },
      removeSource: function () {
        var t = {post_id: this.get("id"), tumblelog_id: this.get("tumblelog")};
        return this.save("remove_source", t)
      },
      approve: function (t) {
        var e = {id: this.get("id"), queue: t};
        return this.save("approve", e)
      },
      deny: function () {
        return this.save("deny", {pid: this.get("id")})
      },
      answer: function (t) {
        var e = {
          post_id: this.get("id"),
          tumblelog: this.get("tumblelog"),
          key: this.get("tumblelog-key"),
          answer_text: t
        };
        return this.save("answer", e)
      },
      embedFocus: function () {
        this.trigger("embed:focus", this)
      },
      updateReblogControl: function (t) {
        this.trigger("reblog:success", t)
      },
      dismiss: function () {
        this.trigger("dismiss", this)
      }
    });
    e.exports = d
  }, {
    "app/components/dialog": 44,
    "app/components/post-embed-code": 222,
    "app/models/tumblelog": 463,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/translate": 575,
    "prima/model": 590
  }],
  463: [function (t, e, i) {
    "use strict";
    function s(t, e, i) {
      var s = r.Deferred(), o = {data: {tumblelog: t.get("name")}};
      i.placement_id && (o.data.placement_id = i.placement_id), i.pt && (o.data.pt = i.pt), i.source && (o.data.source = i.source), i.context && (o.data.context = i.context), i.tlt && (o.data.tlt = i.tlt);
      var n = function () {
        i.wait || t.set({following: e.following}, i)
      }, a = function (o, n) {
        i.wait || t.set({following: !e.following}, i), s.reject(n)
      }, l = function () {
        i.wait && t.set({following: e.following}, i), s.resolve()
      }, h = e.following ? "/svc/follow" : "/svc/unfollow";
      return r.ajax({
        beforeSend: n,
        cache: !i.force,
        data: o,
        error: a,
        type: "POST",
        success: l,
        url: h,
        with_form_key: !0
      }), s.promise()
    }

    function o(t, e) {
      var i = r.Deferred(), s = {};
      l.has(e, "is_tumblelog_popover") && (s.is_tumblelog_popover = e.is_tumblelog_popover), l.has(e, "is_user_mention") && (s.is_user_mention = e.is_user_mention);
      var o = function (t, e) {
        i.reject(e)
      }, n = function (e) {
        l.has(e, "highlighted_posts") || (e = {highlighted_posts: e}), t.set(e), i.resolve()
      };
      return r.ajax({
        cache: !e.force,
        data: s,
        error: o,
        type: "GET",
        success: n,
        url: p(t),
        with_form_key: !0
      }), i.promise()
    }

    function n(t, e) {
      return h.promise(function (i, s) {
        var o = {tumblelog: t.get("name")};
        l.has(e, "include_member_data") && (o.include_member_data = e.include_member_data), l.has(e, "include_activity_data") && l.has(e, "include_member_data") && (o.include_activity_data = e.include_activity_data), l.has(e, "include_activity_notifications") && l.has(e, "include_member_data") && (o.include_activity_notifications = e.include_activity_notifications);
        var n = function (t, e) {
          s(e)
        }, a = function (e) {
          t.set(e.response), i()
        };
        r.ajax({data: o, type: "GET", error: n, success: a, url: "/svc/data/tumblelog", with_form_key: !0})
      })
    }

    function a(t, e) {
      return r.ajax({cache: !e.force, data: e.data, type: "GET", url: "/svc/tumblelog_popover/" + t, with_form_key: !0})
    }

    var r = t("jquery"), l = t("lodash"), h = t("when"), c = t("prima/events"), d = t("app/lib/block"), u = t("prima/singletonmodel"), p = function () {
      function t(t) {
        return t.has("avatar_url") && t.has("global_theme_params")
      }

      return function (e) {
        return t(e) ? "/svc/" + e.get("name") + "/posts/highlighted" : "/svc/tumblelog_popover/" + e.get("name")
      }
    }(), m = u.extend({
      save_following: function (t, e) {
        e || (e = {}), t || (t = {}), t.following = !!t.following;
        var i = this;
        return e.force || i.get("following") !== t.following ? s(i, t, e).then(l.bindKey(i, "save_following", t)) : r.when(i.get("following"))
      }, fetch_popover_data: function (t) {
        t || (t = {}), t.is_user_mention = !!t.is_user_mention, t.is_tumblelog_popover = !!t.is_tumblelog_popover;
        var e = this;
        return !t.force && e.has("highlighted_posts") ? r.when(e.get("highlighted_posts")) : o(e, t).then(l.bindKey(e, "fetch_popover_data", void 0))
      }, fetch_analytics_data: function () {
        return n(this, {include_member_data: !0, include_activity_data: !0})
      }, fetch_activity_notifications: function () {
        return n(this, {include_member_data: !0, include_activity_data: !0, include_activity_notifications: !0})
      }, toggle_spam: function () {
        return r.ajax({url: "/spam/toggle", type: "POST", data: {tumblelog: this.id}, with_form_key: !0})
      }, toggle_nsfw: function () {
        return r.ajax({url: "/nsfw/toggle", type: "POST", data: {tumblelog: this.id}, with_form_key: !0})
      }, toggle_adult: function () {
        return r.ajax({url: "/adult/toggle", type: "POST", data: {tumblelog: this.id}, with_form_key: !0})
      }, toggle_uniblock: function () {
        return r.ajax({url: "/uniblock/toggle", type: "POST", data: {tumblelog: this.id}, with_form_key: !0})
      }, toggle_suspended: function () {
        return r.ajax({url: "/suspended/toggle", type: "POST", data: {tumblelog: this.id}, with_form_key: !0})
      }, follow: function (t) {
        this.save_following({following: !0}, t)
      }, _unfollow: function (t) {
        this.save_following({following: !1}, t)
      }, requestUnfollow: function (t) {
        var e = h.defer();
        return e.promise.then(l.bind(this._unfollow, this, t))["catch"](l.noop), e
      }, block: function () {
        return d.block({blockedTumblelog: this.id})
      }, unblock: function () {
        return d.unblock({blockedTumblelog: this.id})
      }, defaults: null, idAttribute: "name", initialize: function () {
        this.bindEvents()
      }, bindEvents: function () {
        var t = this.get("name");
        this.on("change:following", function () {
          if (void 0 !== this.previous("following")) {
            var e = this.get("following") ? "tumblelog:follow" : "tumblelog:unfollow";
            c.trigger(e, {name: t, loggingData: t})
          }
        }, this)
      }, getDisplayName: function () {
        return this.get("is_legacy_private_channel") ? this.get("directory_safe_title") : this.get("name")
      }, parse: function (t) {
        return t
      }, validate: function () {
        return !1
      }, destroy: function () {
        return this
      }, fetch: function () {
        return this
      }, save: function () {
        return this
      }, url: function () {
      }, urlRoot: function () {
      }
    }, {
      collection: null, modelFromToken: function (t) {
        var e, i = m.getCollection(), s = r.Deferred(), o = i.findWhere({token: t});
        return o ? s.resolve(o) : (e = {data: {is_user_mention: !0}}, a(t, e).then(function (e) {
          var i = new m(e);
          i.set({token: t}), s.resolve(i)
        }, function () {
          s.reject()
        })), s.promise()
      }
    });
    m.collection = m.getCollection(), e.exports = m
  }, {
    "app/lib/block": 457,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/singletonmodel": 592,
    when: "RG2dij"
  }],
  464: [function (t, e, i) {
    "use strict";
    var s = t("prima/singletonmodel"), o = t("prima/model"), n = t("../collections/tumblelogs"), a = s.extend({
      idAttribute: "name",
      initialize: function (t) {
        this.channels = new n(t.channels)
      },
      incrementLikeCount: function () {
        var t = this.get("liked_post_count");
        this.set("liked_post_count", t + 1)
      },
      decrementLikeCount: function () {
        var t = this.get("liked_post_count");
        t > 0 && this.set("liked_post_count", t - 1)
      },
      incrementFollowingCount: function () {
        var t = this.get("friend_count");
        this.set("friend_count", t + 1)
      },
      decrementFollowingCount: function () {
        var t = this.get("friend_count");
        t > 0 && this.set("friend_count", t - 1)
      },
      getUnreadCount: function () {
        return this.channels.reduce(function (t, e) {
          return parseInt(t, 10) + parseInt(e.get("unread_count"), 10)
        }, 0)
      },
      getChannel: function (t) {
        return null == t && (t = this.get("primary")), this.channels.findWhere({name: t})
      },
      canMessage: function () {
        return this.get("can_message")
      },
      getChannelsEnabledForMessaging: function () {
        return this.channels.where({can_send_messages: !0})
      },
      toJSON: function () {
        var t = o.prototype.toJSON.apply(this, arguments);
        return t.channels = this.channels.toJSON(), t
      },
      getChannelProperty: function (t, e) {
        var i = this.getChannel(t);
        if (!(i && "get" in i))return null;
        var s = i.get(e);
        return "undefined" == typeof s ? null : s
      }
    });
    e.exports = a
  }, {"../collections/tumblelogs": 2, "prima/model": 590, "prima/singletonmodel": 592}],
  465: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("sprintf-js").sprintf, n = t("backbone"), a = t("prima/router"), r = t("prima/lib/data"), l = t("prima/lib/flags"), h = t("app/lib/currentuser"), c = t("./bootloader"), d = t("app/components/header"), u = t("app/components/footer"), p = t("app/components/peepr"), m = t("app/components/ask-form"), g = t("standalone/mobile/components/mobile-header"), _ = t("moment"), f = a.extend({
      logs: function () {
        var e = [t("logs/instruments/embed"), t("logs/instruments/help-form"), t("logs/instruments/keycommands"), t("logs/instruments/login-register"), t("logs/instruments/video-player"), t("logs/instruments/vendor-button"), t("logs/instruments/dashboard-sharing"), t("logs/instruments/related-recommendations"), t("logs/instruments/explore-trending"), t("logs/instruments/roadblock"), t("logs/instruments/linkpost-interactions"), t("logs/instruments/peepr"), t("logs/instruments/abuse-form"), t("logs/instruments/recommended-blogs"), t("logs/instruments/tour-guide-account"), t("logs/instruments/blocks"), t("logs/instruments/postform-interactions"), t("logs/instruments/header-search"), t("logs/instruments/postform-gifsearch"), t("logs/instruments/little-sister"), t("logs/instruments/messaging-interactions"), t("logs/instruments/onboarding-verified-blogs"), t("logs/instruments/reactivation"), t("logs/instruments/external-inline-images"), t("logs/instruments/activity-links")];
        return s.union(e, a.prototype.logs.apply(this))
      }, constructor: function () {
        a.apply(this, arguments), this.startHistory(), this.initializeApp()
      }, getName: function () {
        return this.name = r.get("Context/name"), o("Context/%s", this.name)
      }, initializeApp: function () {
        l.bool("is_mobile_handset") && l.bool("responsive_help_docs") ? new g : new d, new u, l.bool("indash_blogs") && (this.peepr = new p), l.bool("ask_form") && (this.askForm = new m({user: h()})), _.locale(r.get("Context.language"))
      }, startHistory: function (t) {
        n.History.started || s.isEmpty(this.routes) || (this.routeFound = n.history.start({
          pushState: "pushState" in window.history,
          hashChange: t ? !("pushState" in window.history) : !1,
          root: this.root
        }))
      }
    }, {Bootloader: c});
    e.exports = f
  }, {
    "./bootloader": 1,
    "app/components/ask-form": 25,
    "app/components/footer": 54,
    "app/components/header": 73,
    "app/components/peepr": 201,
    "app/lib/currentuser": 459,
    backbone: "5kFNoY",
    lodash: "MicNly",
    "logs/instruments/abuse-form": 515,
    "logs/instruments/activity-links": 516,
    "logs/instruments/blocks": 518,
    "logs/instruments/dashboard-sharing": 519,
    "logs/instruments/embed": 520,
    "logs/instruments/explore-trending": 521,
    "logs/instruments/external-inline-images": 522,
    "logs/instruments/header-search": 523,
    "logs/instruments/help-form": 524,
    "logs/instruments/keycommands": 525,
    "logs/instruments/linkpost-interactions": 526,
    "logs/instruments/little-sister": 527,
    "logs/instruments/login-register": 528,
    "logs/instruments/messaging-interactions": 529,
    "logs/instruments/onboarding-verified-blogs": 530,
    "logs/instruments/peepr": 531,
    "logs/instruments/postform-gifsearch": 532,
    "logs/instruments/postform-interactions": 533,
    "logs/instruments/reactivation": 534,
    "logs/instruments/recommended-blogs": 535,
    "logs/instruments/related-recommendations": 536,
    "logs/instruments/roadblock": 537,
    "logs/instruments/tour-guide-account": 538,
    "logs/instruments/vendor-button": 539,
    "logs/instruments/video-player": 540,
    moment: "iROhDJ",
    "prima/lib/data": 548,
    "prima/lib/flags": "f/LVtH",
    "prima/router": 591,
    "sprintf-js": "qPOUxN",
    "standalone/mobile/components/mobile-header": 614
  }],
  466: [function (t, e, i) {
    "use strict";
    var s = t("gif.js/dist/gif").GIF, o = t("./inline-worker"), n = function (t) {
      var e = o;
      return t || (t = {}), t.workerScript || (t.workerScript = e), new s(t)
    };
    e.exports = n
  }, {"./inline-worker": 467, "gif.js/dist/gif": 642}],
  467: [function (t, e, i) {
    var s = (window.URL || window.webkitURL || window.mozURL || window.msURL || {}).createObjectURL;
    s && (e.exports = s(new Blob(["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n(function(b){function a(b,d){if({}.hasOwnProperty.call(a.cache,b))return a.cache[b];var e=a.resolve(b);if(!e)throw new Error('Failed to resolve module '+b);var c={id:b,require:a,filename:b,exports:{},loaded:!1,parent:d,children:[]};d&&d.children.push(c);var f=b.slice(0,b.lastIndexOf('/')+1);return a.cache[b]=c.exports,e.call(c.exports,c,c.exports,f,b),c.loaded=!0,a.cache[b]=c.exports}a.modules={},a.cache={},a.resolve=function(b){return{}.hasOwnProperty.call(a.modules,b)?a.modules[b]:void 0},a.define=function(b,c){a.modules[b]=c},a.define('/gif.worker.coffee',function(d,e,f,g){var b,c;b=a('/GIFEncoder.js',d),c=function(a){var c,e,d,f;return c=new b(a.width,a.height),a.index===0?c.writeHeader():c.firstFrame=!1,c.setTransparent(a.transparent),c.setRepeat(a.repeat),c.setDelay(a.delay),c.setQuality(a.quality),c.addFrame(a.data),a.last&&c.finish(),d=c.stream(),a.data=d.pages,a.cursor=d.cursor,a.pageSize=d.constructor.pageSize,a.canTransfer?(f=function(c){for(var b=0,d=a.data.length;b<d;++b)e=a.data[b],c.push(e.buffer);return c}.call(this,[]),self.postMessage(a,f)):self.postMessage(a)},self.onmessage=function(a){return c(a.data)}}),a.define('/GIFEncoder.js',function(e,h,i,j){function c(){this.page=-1,this.pages=[],this.newPage()}function b(a,b){this.width=~~a,this.height=~~b,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.out=new c}var f=a('/TypedNeuQuant.js',e),g=a('/LZWEncoder.js',e);c.pageSize=4096,c.charMap={};for(var d=0;d<256;d++)c.charMap[d]=String.fromCharCode(d);c.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(c.pageSize),this.cursor=0},c.prototype.getData=function(){var d='';for(var a=0;a<this.pages.length;a++)for(var b=0;b<c.pageSize;b++)d+=c.charMap[this.pages[a][b]];return d},c.prototype.writeByte=function(a){this.cursor>=c.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=a},c.prototype.writeUTFBytes=function(b){for(var c=b.length,a=0;a<c;a++)this.writeByte(b.charCodeAt(a))},c.prototype.writeBytes=function(b,d,e){for(var c=e||b.length,a=d||0;a<c;a++)this.writeByte(b[a])},b.prototype.setDelay=function(a){this.delay=Math.round(a/10)},b.prototype.setFrameRate=function(a){this.delay=Math.round(100/a)},b.prototype.setDispose=function(a){a>=0&&(this.dispose=a)},b.prototype.setRepeat=function(a){this.repeat=a},b.prototype.setTransparent=function(a){this.transparent=a},b.prototype.addFrame=function(a){this.image=a,this.getImagePixels(),this.analyzePixels(),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.writePalette(),this.writePixels(),this.firstFrame=!1},b.prototype.finish=function(){this.out.writeByte(59)},b.prototype.setQuality=function(a){a<1&&(a=1),this.sample=a},b.prototype.writeHeader=function(){this.out.writeUTFBytes('GIF89a')},b.prototype.analyzePixels=function(){var g=this.pixels.length,d=g/3;this.indexedPixels=new Uint8Array(d);var a=new f(this.pixels,this.sample);a.buildColormap(),this.colorTab=a.getColormap();var b=0;for(var c=0;c<d;c++){var e=a.lookupRGB(this.pixels[b++]&255,this.pixels[b++]&255,this.pixels[b++]&255);this.usedEntry[e]=!0,this.indexedPixels[c]=e}this.pixels=null,this.colorDepth=8,this.palSize=7,this.transparent!==null&&(this.transIndex=this.findClosest(this.transparent))},b.prototype.findClosest=function(e){if(this.colorTab===null)return-1;var k=(e&16711680)>>16,l=(e&65280)>>8,m=e&255,c=0,d=16777216,j=this.colorTab.length;for(var a=0;a<j;){var f=k-(this.colorTab[a++]&255),g=l-(this.colorTab[a++]&255),h=m-(this.colorTab[a]&255),i=f*f+g*g+h*h,b=parseInt(a/3);this.usedEntry[b]&&i<d&&(d=i,c=b),a++}return c},b.prototype.getImagePixels=function(){var a=this.width,g=this.height;this.pixels=new Uint8Array(a*g*3);var b=this.image,c=0;for(var d=0;d<g;d++)for(var e=0;e<a;e++){var f=d*a*4+e*4;this.pixels[c++]=b[f],this.pixels[c++]=b[f+1],this.pixels[c++]=b[f+2]}},b.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4);var b,a;this.transparent===null?(b=0,a=0):(b=1,a=2),this.dispose>=0&&(a=dispose&7),a<<=2,this.out.writeByte(0|a|0|b),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},b.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},b.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},b.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes('NETSCAPE2.0'),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},b.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);var b=768-this.colorTab.length;for(var a=0;a<b;a++)this.out.writeByte(0)},b.prototype.writeShort=function(a){this.out.writeByte(a&255),this.out.writeByte(a>>8&255)},b.prototype.writePixels=function(){var a=new g(this.width,this.height,this.indexedPixels,this.colorDepth);a.encode(this.out)},b.prototype.stream=function(){return this.out},e.exports=b}),a.define('/LZWEncoder.js',function(e,g,h,i){function f(y,D,C,B){function w(a,b){r[f++]=a,f>=254&&t(b)}function x(b){u(a),k=i+2,j=!0,l(i,b)}function u(b){for(var a=0;a<b;++a)h[a]=-1}function A(z,r){var g,t,d,e,y,w,s;for(q=z,j=!1,n_bits=q,m=p(n_bits),i=1<<z-1,o=i+1,k=i+2,f=0,e=v(),s=0,g=a;g<65536;g*=2)++s;s=8-s,w=a,u(w),l(i,r);a:while((t=v())!=c){if(g=(t<<b)+e,d=t<<s^e,h[d]===g){e=n[d];continue}if(h[d]>=0){y=w-d,d===0&&(y=1);do if((d-=y)<0&&(d+=w),h[d]===g){e=n[d];continue a}while(h[d]>=0)}l(e,r),e=t,k<1<<b?(n[d]=k++,h[d]=g):x(r)}l(e,r),l(o,r)}function z(a){a.writeByte(s),remaining=y*D,curPixel=0,A(s+1,a),a.writeByte(0)}function t(a){f>0&&(a.writeByte(f),a.writeBytes(r,0,f),f=0)}function p(a){return(1<<a)-1}function v(){if(remaining===0)return c;--remaining;var a=C[curPixel++];return a&255}function l(a,c){g&=d[e],e>0?g|=a<<e:g=a,e+=n_bits;while(e>=8)w(g&255,c),g>>=8,e-=8;if((k>m||j)&&(j?(m=p(n_bits=q),j=!1):(++n_bits,n_bits==b?m=1<<b:m=p(n_bits))),a==o){while(e>0)w(g&255,c),g>>=8,e-=8;t(c)}}var s=Math.max(2,B),r=new Uint8Array(256),h=new Int32Array(a),n=new Int32Array(a),g,e=0,f,k=0,m,j=!1,q,i,o;this.encode=z}var c=-1,b=12,a=5003,d=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];e.exports=f}),a.define('/TypedNeuQuant.js',function(A,F,E,D){function C(A,B){function I(){o=[],q=new Int32Array(256),t=new Int32Array(a),y=new Int32Array(a),z=new Int32Array(a>>3);var c,d;for(c=0;c<a;c++)d=(c<<b+8)/a,o[c]=new Float64Array([d,d,d,0]),y[c]=e/a,t[c]=0}function J(){for(var c=0;c<a;c++)o[c][0]>>=b,o[c][1]>>=b,o[c][2]>>=b,o[c][3]=c}function K(b,a,c,e,f){o[a][0]-=b*(o[a][0]-c)/d,o[a][1]-=b*(o[a][1]-e)/d,o[a][2]-=b*(o[a][2]-f)/d}function L(j,e,n,l,k){var h=Math.abs(e-j),i=Math.min(e+j,a),g=e+1,f=e-1,m=1,b,d;while(g<i||f>h)d=z[m++],g<i&&(b=o[g++],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c),f>h&&(b=o[f--],b[0]-=d*(b[0]-n)/c,b[1]-=d*(b[1]-l)/c,b[2]-=d*(b[2]-k)/c)}function C(p,s,q){var h=2147483647,k=h,d=-1,m=d,c,j,e,n,l;for(c=0;c<a;c++)j=o[c],e=Math.abs(j[0]-p)+Math.abs(j[1]-s)+Math.abs(j[2]-q),e<h&&(h=e,d=c),n=e-(t[c]>>i-b),n<k&&(k=n,m=c),l=y[c]>>g,y[c]-=l,t[c]+=l<<f;return y[d]+=x,t[d]-=r,m}function D(){var d,b,e,c,h,g,f=0,i=0;for(d=0;d<a;d++){for(e=o[d],h=d,g=e[1],b=d+1;b<a;b++)c=o[b],c[1]<g&&(h=b,g=c[1]);if(c=o[h],d!=h&&(b=c[0],c[0]=e[0],e[0]=b,b=c[1],c[1]=e[1],e[1]=b,b=c[2],c[2]=e[2],e[2]=b,b=c[3],c[3]=e[3],e[3]=b),g!=f){for(q[f]=i+d>>1,b=f+1;b<g;b++)q[b]=d;f=g,i=d}}for(q[f]=i+n>>1,b=f+1;b<256;b++)q[b]=n}function E(j,i,k){var b,d,c,e=1e3,h=-1,f=q[i],g=f-1;while(f<a||g>=0)f<a&&(d=o[f],c=d[1]-i,c>=e?f=a:(f++,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3])))),g>=0&&(d=o[g],c=i-d[1],c>=e?g=-1:(g--,c<0&&(c=-c),b=d[0]-j,b<0&&(b=-b),c+=b,c<e&&(b=d[2]-k,b<0&&(b=-b),c+=b,c<e&&(e=c,h=d[3]))));return h}function F(){var c,f=A.length,D=30+(B-1)/3,y=f/(3*B),q=~~(y/w),n=d,o=u,a=o>>h;for(a<=1&&(a=0),c=0;c<a;c++)z[c]=n*((a*a-c*c)*m/(a*a));var i;f<s?(B=1,i=3):f%l!==0?i=3*l:f%k!==0?i=3*k:f%p!==0?i=3*p:i=3*j;var r,t,x,e,g=0;c=0;while(c<y)if(r=(A[g]&255)<<b,t=(A[g+1]&255)<<b,x=(A[g+2]&255)<<b,e=C(r,t,x),K(n,e,r,t,x),a!==0&&L(a,e,r,t,x),g+=i,g>=f&&(g-=f),c++,q===0&&(q=1),c%q===0)for(n-=n/D,o-=o/v,a=o>>h,a<=1&&(a=0),e=0;e<a;e++)z[e]=n*((a*a-e*e)*m/(a*a))}function G(){I(),F(),J(),D()}function H(){var b=[],g=[];for(var c=0;c<a;c++)g[o[c][3]]=c;var d=0;for(var e=0;e<a;e++){var f=g[e];b[d++]=o[f][0],b[d++]=o[f][1],b[d++]=o[f][2]}return b}var o,q,t,y,z;this.buildColormap=G,this.getColormap=H,this.lookupRGB=E}var w=100,a=256,n=a-1,b=4,i=16,e=1<<i,f=10,B=1<<f,g=10,x=e>>g,r=e<<f-g,z=a>>3,h=6,t=1<<h,u=z*t,v=30,o=10,d=1<<o,q=8,m=1<<q,y=o+q,c=1<<y,l=499,k=491,p=487,j=503,s=3*j;A.exports=C}),a('/gif.worker.coffee')}.call(this,this))\n//# sourceMappingURL=gif.worker.js.map\n// gif.worker.js 0.1.6 - https://github.com/jnordberg/gif.js\n\n},{}]},{},[1])"], {type: "text/javascript"})))
  }, {}],
  468: [function (t, e, i) {
    "use strict";
    var s = function () {
    }, o = e.exports = {};
    o.stringIsClean = function (t) {
      for (var e = 0; e < t.length; e++)if (t.charCodeAt(e) < 32)return !1;
      return !0
    }, o.parseNum = function (t, e, i, s) {
      var o, n, a = ">" === t;
      for (void 0 === i && (i = 0), void 0 === s && (s = e.length - i), o = a ? i : i + s - 1; a ? i + s > o : o >= i; a ? o++ : o--)n <<= 8, n += e.charCodeAt(o);
      return n
    }, o.parseSnum = function (t, e, i, s) {
      var o, n, a, r = ">" === t;
      for (void 0 === i && (i = 0), void 0 === s && (s = e.length - i), o = r ? i : i + s - 1; r ? i + s > o : o >= i; r ? o++ : o--)void 0 === a && (a = 128 === (128 & e.charCodeAt(o))), n <<= 8, n += a ? 255 & ~e.charCodeAt(o) : e.charCodeAt(o);
      return a && (n += 1, n *= -1), n
    }, o.Rational = function (t, e) {
      return this.num = t, this.den = e || 1, this
    }, o.Rational.prototype.toString = function () {
      return 0 === this.num ? "" + this.num : 1 === this.den ? "" + this.num : 1 === this.num ? this.num + " / " + this.den : this.num / this.den;
    }, o.Rational.prototype.asFloat = function () {
      return this.num / this.den
    }, o.MetaGroup = function (t, e) {
      return this.fieldName = t, this.description = e, this.metaProps = {}, this
    }, o.MetaGroup.prototype._addProperty = function (t, e, i) {
      var s = new o.MetaProp(t, e, i);
      this[s.fieldName] = s, this.metaProps[s.fieldName] = s
    }, o.MetaGroup.prototype.toString = function () {
      return "[MetaGroup " + this.description + "]"
    }, o.MetaProp = function (t, e, i) {
      return this.fieldName = t, this.description = e, this.value = i, this
    }, o.MetaProp.prototype.toString = function () {
      return "" + this.value
    }, o.JpegFile = function (t, e) {
      var i = this._SOS;
      this.metaGroups = {}, this._binary_data = t, this.filename = e;
      var s, n, a, r, l, h, c, d = 0, u = 0;
      if (this._binary_data.slice(0, 2) !== this._SOI_MARKER)throw new Error("Doesn't look like a JPEG file. First two bytes are " + this._binary_data.charCodeAt(0) + "," + this._binary_data.charCodeAt(1) + ".");
      for (d += 2; d < this._binary_data.length && (s = this._binary_data.charCodeAt(d++), n = this._binary_data.charCodeAt(d++), u = d, s == this._DELIM) && n !== i;) {
        for (l = o.parseNum(">", this._binary_data, d, 2), d += l; d < this._binary_data.length;)if (s = this._binary_data.charCodeAt(d++), s == this._DELIM && (a = this._binary_data.charCodeAt(d++), 0 !== a)) {
          d -= 2;
          break
        }
        r = d - u, this._markers[n] ? (h = this._markers[n][0], c = this._markers[n][1]) : (h = "UNKN", c = void 0), c && this[c](n, u + 2)
      }
      if (void 0 === this.general)throw Error("Invalid JPEG file.");
      return this
    }, o.JpegFile.prototype.toString = function () {
      return "[JpegFile " + this.filename + " " + this.general.type + " " + this.general.pixelWidth + "x" + this.general.pixelHeight + " Depth: " + this.general.depth + "]"
    }, o.JpegFile.prototype._SOI_MARKER = "", o.JpegFile.prototype._DELIM = 255, o.JpegFile.prototype._EOI = 217, o.JpegFile.prototype._SOS = 218, o.JpegFile.prototype._sofHandler = function (t, e) {
      if (void 0 !== this.general)throw Error("Unexpected multiple-frame image");
      this._addMetaGroup("general", "General"), this.general._addProperty("depth", "Depth", o.parseNum(">", this._binary_data, e, 1)), this.general._addProperty("pixelHeight", "Pixel Height", o.parseNum(">", this._binary_data, e + 1, 2)), this.general._addProperty("pixelWidth", "Pixel Width", o.parseNum(">", this._binary_data, e + 3, 2)), this.general._addProperty("type", "Type", this._markers[t][2])
    }, o.JpegFile.prototype._JFIF_IDENT = "JFIF\x00", o.JpegFile.prototype._JFXX_IDENT = "JFXX\x00", o.JpegFile.prototype._EXIF_IDENT = "Exif\x00", o.JpegFile.prototype._types = {
      1: ["BYTE", 1],
      2: ["ASCII", 1],
      3: ["SHORT", 2],
      4: ["LONG", 4],
      5: ["RATIONAL", 8],
      6: ["SBYTE", 1],
      7: ["UNDEFINED", 1],
      8: ["SSHORT", 2],
      9: ["SLONG", 4],
      10: ["SRATIONAL", 8],
      11: ["FLOAT", 4],
      12: ["DOUBLE", 8]
    }, o.JpegFile.prototype._tifftags = {
      256: ["Image width", "ImageWidth"],
      257: ["Image height", "ImageLength"],
      258: ["Number of bits per component", "BitsPerSample"],
      259: ["Compression scheme", "Compression", {1: "uncompressed", 6: "JPEG compression"}],
      262: ["Pixel composition", "PhotmetricInerpretation", {2: "RGB", 6: "YCbCr"}],
      274: ["Orientation of image", "Orientation", {
        1: "Normal",
        2: "Reverse?",
        3: "Upside-down",
        4: "Upside-down Reverse",
        5: "90 degree CW",
        6: "90 degree CW reverse",
        7: "90 degree CCW",
        8: "90 degree CCW reverse"
      }],
      277: ["Number of components", "SamplesPerPixel"],
      284: ["Image data arrangement", "PlanarConfiguration", {1: "chunky format", 2: "planar format"}],
      530: ["Subsampling ratio of Y to C", "YCbCrSubSampling"],
      531: ["Y and C positioning", "YCbCrPositioning", {1: "centered", 2: "co-sited"}],
      282: ["X Resolution", "XResolution"],
      283: ["Y Resolution", "YResolution"],
      296: ["Resolution Unit", "ResolutionUnit", {2: "inches", 3: "centimeters"}],
      273: ["Image data location", "StripOffsets"],
      278: ["Number of rows per strip", "RowsPerStrip"],
      279: ["Bytes per compressed strip", "StripByteCounts"],
      513: ["Offset to JPEG SOI", "JPEGInterchangeFormat"],
      514: ["Bytes of JPEG Data", "JPEGInterchangeFormatLength"],
      301: ["Transfer function", "TransferFunction"],
      318: ["White point chromaticity", "WhitePoint"],
      319: ["Chromaticities of primaries", "PrimaryChromaticities"],
      529: ["Color space transformation matrix coefficients", "YCbCrCoefficients"],
      532: ["Pair of black and white reference values", "ReferenceBlackWhite"],
      306: ["Date and time", "DateTime"],
      270: ["Image title", "ImageDescription"],
      271: ["Make", "Make"],
      272: ["Model", "Model"],
      305: ["Software", "Software"],
      315: ["Person who created the image", "Artist"],
      316: ["Host Computer", "HostComputer"],
      33432: ["Copyright holder", "Copyright"],
      34665: ["Exif tag", "ExifIfdPointer"],
      34853: ["GPS tag", "GPSInfoIfdPointer"]
    }, o.JpegFile.prototype._exiftags = {
      36864: ["Exif Version", "ExifVersion"],
      40960: ["FlashPix Version", "FlashpixVersion"],
      40961: ["Color Space", "ColorSpace"],
      37121: ["Meaning of each component", "ComponentsConfiguration"],
      37122: ["Compressed Bits Per Pixel", "CompressedBitsPerPixel"],
      40962: ["Pixel X Dimension", "PixelXDimension"],
      40963: ["Pixel Y Dimension", "PixelYDimension"],
      37500: ["Manufacturer notes", "MakerNote"],
      37510: ["User comments", "UserComment"],
      40964: ["Related audio file", "RelatedSoundFile"],
      36867: ["Date Time Original", "DateTimeOriginal"],
      36868: ["Date Time Digitized", "DateTimeDigitized"],
      37520: ["DateTime subseconds", "SubSecTime"],
      37521: ["DateTimeOriginal subseconds", "SubSecTimeOriginal"],
      37522: ["DateTimeDigitized subseconds", "SubSecTimeDigitized"],
      33434: ["Exposure time", "ExposureTime"],
      33437: ["FNumber", "FNumber"],
      34850: ["Exposure program", "ExposureProgram"],
      34852: ["Spectral sensitivity", "SpectralSensitivity"],
      34855: ["ISO Speed Ratings", "ISOSpeedRatings"],
      34856: ["Optoelectric coefficient", "OECF"],
      37377: ["Shutter Speed", "ShutterSpeedValue"],
      37378: ["Aperture Value", "ApertureValue"],
      37379: ["Brightness", "BrightnessValue"],
      37380: ["Exposure Bias Value", "ExposureBiasValue"],
      37381: ["Max Aperture Value", "MaxApertureValue"],
      37382: ["Subject Distance", "SubjectDistance"],
      37383: ["Metering Mode", "MeteringMode"],
      37384: ["Light Source", "LightSource"],
      37385: ["Flash", "Flash"],
      37386: ["Focal Length", "FocalLength"],
      37396: ["Subject Area", "SubjectArea"],
      41483: ["Flash Energy", "FlashEnergy"],
      41484: ["Spatial Frequency Response", "SpatialFrequencyResponse"],
      41486: ["Focal Plane X Resolution", "FocalPlaneXResolution"],
      41487: ["Focal Plane Y Resolution", "FocalPlaneYResolution"],
      41488: ["Focal Plane Resolution Unit", "FocalPlaneResolutionUnit"],
      41492: ["Subject Location", "SubjectLocation"],
      41493: ["Exposure Index", "ExposureIndex"],
      41495: ["Sensing Method", "SensingMethod"],
      41728: ["File Source", "FileSource"],
      41729: ["Scene Type", "SceneType"],
      41730: ["CFA Pattern", "CFAPattern"],
      41985: ["Custom Rendered", "CustomRendered"],
      41986: ["Exposure Mode", "Exposure Mode"],
      41987: ["White Balance", "WhiteBalance"],
      41988: ["Digital Zoom Ratio", "DigitalZoomRatio"],
      41989: ["Focal length in 35 mm film", "FocalLengthIn35mmFilm"],
      41990: ["Scene Capture Type", "SceneCaptureType"],
      41991: ["Gain Control", "GainControl"],
      41992: ["Contrast", "Contrast"],
      41993: ["Saturation", "Saturation"],
      41994: ["Sharpness", "Sharpness"],
      41995: ["Device settings description", "DeviceSettingDescription"],
      41996: ["Subject distance range", "SubjectDistanceRange"],
      42016: ["Unique image ID", "ImageUniqueID"],
      40965: ["Interoperability tag", "InteroperabilityIFDPointer"]
    }, o.JpegFile.prototype._gpstags = {
      0: ["GPS tag version", "GPSVersionID"],
      1: ["North or South Latitude", "GPSLatitudeRef"],
      2: ["Latitude", "GPSLatitude"],
      3: ["East or West Longitude", "GPSLongitudeRef"],
      4: ["Longitude", "GPSLongitude"],
      5: ["Altitude reference", "GPSAltitudeRef"],
      6: ["Altitude", "GPSAltitude"],
      7: ["GPS time (atomic clock)", "GPSTimeStamp"],
      8: ["GPS satellites usedd for measurement", "GPSSatellites"],
      9: ["GPS receiver status", "GPSStatus"],
      10: ["GPS mesaurement mode", "GPSMeasureMode"],
      11: ["Measurement precision", "GPSDOP"],
      12: ["Speed unit", "GPSSpeedRef"],
      13: ["Speed of GPS receiver", "GPSSpeed"],
      14: ["Reference for direction of movement", "GPSTrackRef"],
      15: ["Direction of movement", "GPSTrack"],
      16: ["Reference for direction of image", "GPSImgDirectionRef"],
      17: ["Direction of image", "GPSImgDirection"],
      18: ["Geodetic survey data used", "GPSMapDatum"],
      19: ["Reference for latitude of destination", "GPSDestLatitudeRef"],
      20: ["Latitude of destination", "GPSDestLatitude"],
      21: ["Reference for longitude of destination", "GPSDestLongitudeRef"],
      22: ["Longitude of destination", "GPSDestLongitude"],
      23: ["Reference for bearing of destination", "GPSDestBearingRef"],
      24: ["Bearing of destination", "GPSDestBearing"],
      25: ["Reference for distance to destination", "GPSDestDistanceRef"],
      26: ["Distance to destination", "GPSDestDistance"],
      27: ["Name of GPS processing method", "GPSProcessingMethod"],
      28: ["Name of GPS area", "GPSAreaInformation"],
      29: ["GPS Date", "GPSDateStamp"],
      30: ["GPS differential correction", "GPSDifferential"]
    }, o.JpegFile.prototype._markers = {
      192: ["SOF0", "_sofHandler", "Baseline DCT"],
      193: ["SOF1", "_sofHandler", "Extended sequential DCT"],
      194: ["SOF2", "_sofHandler", "Progressive DCT"],
      195: ["SOF3", "_sofHandler", "Lossless (sequential)"],
      197: ["SOF5", "_sofHandler", "Differential sequential DCT"],
      198: ["SOF6", "_sofHandler", "Differential progressive DCT"],
      199: ["SOF7", "_sofHandler", "Differential lossless (sequential)"],
      200: ["JPG", null, "Reserved for JPEG extensions"],
      201: ["SOF9", "_sofHandler", "Extended sequential DCT"],
      202: ["SOF10", "_sofHandler", "Progressive DCT"],
      203: ["SOF11", "_sofHandler", "Lossless (sequential)"],
      205: ["SOF13", "_sofHandler", "Differential sequential DCT"],
      206: ["SOF14", "_sofHandler", "Differential progressive DCT"],
      207: ["SOF15", "_sofHandler", "Differential lossless (sequential)"],
      196: ["DHT", null, "Define Huffman table(s)"],
      204: ["DAC", null, "Define arithmetic coding conditioning(s)"],
      208: ["RST0", null, "Restart with modulo 8 count 0"],
      209: ["RST1", null, "Restart with modulo 8 count 1"],
      210: ["RST2", null, "Restart with modulo 8 count 2"],
      211: ["RST3", null, "Restart with modulo 8 count 3"],
      212: ["RST4", null, "Restart with modulo 8 count 4"],
      213: ["RST5", null, "Restart with modulo 8 count 5"],
      214: ["RST6", null, "Restart with modulo 8 count 6"],
      215: ["RST7", null, "Restart with modulo 8 count 7"],
      216: ["SOI", null, "Start of image"],
      217: ["EOI", null, "End of image"],
      218: ["SOS", null, "Start of scan"],
      219: ["DQT", null, "Define quantization table(s)"],
      220: ["DNL", null, "Define number of lines"],
      221: ["DRI", null, "Define restart interval"],
      222: ["DHP", null, "Define hierarchical progression"],
      223: ["EXP", null, "Expand reference component(s)"],
      224: ["APP0", "_app0Handler", "Reserved for application segments"],
      225: ["APP1", "_app1Handler"],
      226: ["APP2", null],
      227: ["APP3", null],
      228: ["APP4", null],
      229: ["APP5", null],
      230: ["APP6", null],
      231: ["APP7", null],
      232: ["APP8", null],
      233: ["APP9", null],
      234: ["APP10", null],
      235: ["APP11", null],
      236: ["APP12", null],
      237: ["APP13", null],
      238: ["APP14", null],
      239: ["APP15", null],
      240: ["JPG0", null],
      241: ["JPG1", null],
      242: ["JPG2", null],
      243: ["JPG3", null],
      244: ["JPG4", null],
      245: ["JPG5", null],
      246: ["JPG6", null],
      247: ["JPG7", null],
      248: ["JPG8", null],
      249: ["JPG9", null],
      250: ["JPG10", null],
      251: ["JPG11", null],
      252: ["JPG12", null],
      253: ["JPG13", null],
      254: ["COM", null],
      1: ["JPG13", null]
    }, o.JpegFile.prototype._addMetaGroup = function (t, e) {
      var i = new o.MetaGroup(t, e);
      return this[i.fieldName] = i, this.metaGroups[i.fieldName] = i, i
    }, o.JpegFile.prototype._parseIfd = function (t, e, i, n, a, r, l) {
      var h, c, d, u, p, m, g, _, f, v, b, y = o.parseNum(t, e, i + n, 2);
      b = this._addMetaGroup(r, l);
      for (var w = 0; y > w; w++)if (h = i + n + 2 + 12 * w, c = o.parseNum(t, e, h, 2), u = o.parseNum(t, e, h + 2, 2), m = o.parseNum(t, e, h + 4, 4), g = o.parseNum(t, e, h + 8, 4), void 0 !== this._types[u]) {
        if (d = this._types[u][0], p = this._types[u][1], g = 4 >= p * m ? h + 8 : i + g, "UNDEFINED" == d)_ = void 0; else if ("ASCII" == d)_ = e.slice(g, g + m), _ = _.split("\x00")[0], o.stringIsClean(_) || (_ = ""); else {
          _ = [];
          for (var x = 0; m > x; x++, g += p)("BYTE" == d || "SHORT" == d || "LONG" == d) && _.push(o.parseNum(t, e, g, p)), ("SBYTE" == d || "SSHORT" == d || "SLONG" == d) && _.push(o.parseSnum(t, e, g, p)), "RATIONAL" == d && (f = o.parseNum(t, e, g, 4), v = o.parseNum(t, e, g + 4, 4), _.push(new o.Rational(f, v))), "SRATIONAL" == d && (f = o.parseSnum(t, e, g, 4), v = o.parseSnum(t, e, g + 4, 4), _.push(new o.Rational(f, v))), _.push();
          1 === m && (_ = _[0])
        }
        a.hasOwnProperty(c) ? b._addProperty(a[c][1], a[c][0], _) : s("WARNING(jpegmeta.js): Unknown tag: ", c)
      }
    }, o.JpegFile.prototype._jfifHandler = function (t, e) {
      if (void 0 !== this.jfif)throw Error("Multiple JFIF segments found");
      this._addMetaGroup("jfif", "JFIF"), this.jfif._addProperty("version_major", "Version Major", this._binary_data.charCodeAt(e + 5)), this.jfif._addProperty("version_minor", "Version Minor", this._binary_data.charCodeAt(e + 6)), this.jfif._addProperty("version", "JFIF Version", this.jfif.version_major.value + "." + this.jfif.version_minor.value), this.jfif._addProperty("units", "Density Unit", this._binary_data.charCodeAt(e + 7)), this.jfif._addProperty("Xdensity", "X density", o.parseNum(">", this._binary_data, e + 8, 2)), this.jfif._addProperty("Ydensity", "Y Density", o.parseNum(">", this._binary_data, e + 10, 2)), this.jfif._addProperty("Xthumbnail", "X Thumbnail", o.parseNum(">", this._binary_data, e + 12, 1)), this.jfif._addProperty("Ythumbnail", "Y Thumbnail", o.parseNum(">", this._binary_data, e + 13, 1))
    }, o.JpegFile.prototype._app0Handler = function (t, e) {
      var i = this._binary_data.slice(e, e + 5);
      i == this._JFIF_IDENT ? this._jfifHandler(t, e) : i == this._JFXX_IDENT
    }, o.JpegFile.prototype._app1Handler = function (t, e) {
      var i = this._binary_data.slice(e, e + 5);
      i == this._EXIF_IDENT && this._exifHandler(t, e + 6)
    }, o.JpegFile.prototype._exifHandler = function (t, e) {
      if (void 0 !== this.exif)throw new Error("Multiple JFIF segments found");
      var i, s, n, a = this._binary_data.slice(e, e + 2);
      if ("II" === a)i = "<"; else {
        if ("MM" !== a)throw new Error("Malformed TIFF meta-data. Unknown endianess: " + a);
        i = ">"
      }
      if (s = o.parseNum(i, this._binary_data, e + 2, 2), 42 !== s)throw new Error("Malformed TIFF meta-data. Bad magic: " + s);
      if (n = o.parseNum(i, this._binary_data, e + 4, 4), this._parseIfd(i, this._binary_data, e, n, this._tifftags, "tiff", "TIFF"), this.tiff.ExifIfdPointer && this._parseIfd(i, this._binary_data, e, this.tiff.ExifIfdPointer.value, this._exiftags, "exif", "Exif"), this.tiff.GPSInfoIfdPointer) {
        if (this._parseIfd(i, this._binary_data, e, this.tiff.GPSInfoIfdPointer.value, this._gpstags, "gps", "GPS"), this.gps.GPSLatitude) {
          var r;
          r = this.gps.GPSLatitude.value[0].asFloat() + 1 / 60 * this.gps.GPSLatitude.value[1].asFloat() + 1 / 3600 * this.gps.GPSLatitude.value[2].asFloat(), "S" === this.gps.GPSLatitudeRef.value && (r = -r), this.gps._addProperty("latitude", "Dec. Latitude", r)
        }
        if (this.gps.GPSLongitude) {
          var l;
          l = this.gps.GPSLongitude.value[0].asFloat() + 1 / 60 * this.gps.GPSLongitude.value[1].asFloat() + 1 / 3600 * this.gps.GPSLongitude.value[2].asFloat(), "W" === this.gps.GPSLongitudeRef.value && (l = -l), this.gps._addProperty("longitude", "Dec. Longitude", l)
        }
      }
    }
  }, {}],
  469: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("scrollmonitor"), a = t("fastdom"), r = t("prima/class"), l = t("prima/mixins/accessor"), h = t("prima/lib/flags"), c = t("prima/events"), d = t("prima/utils/caniuse"), u = t("./plugins/videojs-crt"), p = r.extend({
      mixins: [l],
      defaults: {
        loaded: !1,
        paused: !0,
        muted: !1,
        autoplay: !1,
        _preload: !1,
        _preloadThreshold: 10,
        loop: !0,
        autoheight: !1,
        watch: !0,
        duration: 0,
        hideFullscreen: !1,
        _elapsed: 0,
        _position: 0,
        _startSeekJumpTime: null,
        minLoopDuration: 1
      },
      classNames: {
        base: "crt-video crt-skin-default",
        autoplay: "crt-state-autoplaying",
        autoheight: "crt-autoheight",
        hideFullscreen: "crt-hide-fullscreen-toggle"
      },
      constructor: function (t, e) {
        this._id = s.uniqueId("crtplayer"), this.initialize(t, e)
      },
      initialize: function (t, e) {
        e || (e = {}), s.isObject(e.attributes) && this.set(e.attributes), this.video = t, this.$video = o(this.video);
        var i = this.$video.data("crt-options");
        this.$video.removeAttr("data-crt-options"), this.vjsOptions = s.defaults({
          crt: this,
          crtOptions: i
        }, e.vjsOptions || {}), i && i.duration && this.set("duration", i.duration), a.write(function () {
          this.$video.addClass(this.classNames.base)
        }, this)
      },
      render: function () {
        return a.write(function () {
          u(this.video, this.vjsOptions).then(s.bind(this.ready, this))
        }, this), this
      },
      ready: function (t) {
        this.player = t, this.el = t.player_.el(), this.$el = o(this.el), this.$post = this.$el.closest(".post"), this.playerID = this.player.id_, this.hasLooped = !1, this._bindEvents(), this.setAutoplayState(this.shouldAutoplay()), this.setMutedState(this.shouldAutoplay()), this.setLoopState(!0), this.setAutoheightState(), this.setFullscreenControl(!d.prop("requestFullscreen")), this.shouldForceHD() && this.player.src({
          src: this.vjsOptions.crtOptions.hdUrl,
          type: "video/mp4"
        }), this.get("watch") && this.setupWatcher(), c.trigger("CrtPlayer:ready", this), this.trigger("ready", this)
      },
      _bindEvents: function () {
        this.listenTo(c, "peepr:open", this.pause), this.listenTo(c, "post:form:show", this.pause), this.listenTo(c, "post:docked:afterRender", this.onDockedAfterRender), this.on("change:autoplay", this.onChangeAutoplay, this), this.on("change:autoheight", this.onChangeAutoheight, this), this.on("change:duration", this.onChangeDuration, this), this.on("change:loop", this.onChangeLoop, this), this.on("change:muted", this.onChangeMuted, this), this.player.on("loadedmetadata", s.bind(this.onLoadedMetadata, this)), this.player.on("durationchange", s.bind(this.onUpdateDuration, this)), this.player.on("play", s.bind(this.onPlay, this)), this.player.on("pause", s.bind(this.onPause, this)), this.player.on("ended", s.bind(this.onEnded, this)), this.player.on("fullscreenchange", s.bind(this.onFullscreenChange, this)), this.player.on("error", s.bind(this.onError, this))
      },
      setupWatcher: function () {
        this.watcher = n.create(this.el, -100), this.watcher.fullyEnterViewport(s.bind(function () {
          this.trigger("fullyEnterViewport")
        }, this)), this.watcher.partiallyExitViewport(s.bind(function () {
          this.trigger("partiallyExitViewport")
        }, this)), this.watcher.exitViewport(s.bind(function () {
          this.trigger("exitViewport"), this.shouldAutoplay() && this.pause()
        }, this)), this.shouldAutoplay() && this.$el.on("click.crtAutoPlay touchend.crtAutoPlay", s.bind(this.onClickPlayer, this))
      },
      onClickPlayer: function (t) {
        o(t.target).closest(".vjs-mute-control").length || o(t.target).closest(".vjs-fullscreen-control").length ? this.restart() : this.pause(), this.set("autoplay", !1), this.set("muted", !1), this.$el.off("click.crtAutoPlay touchend.crtAutoPlay")
      },
      restart: function () {
        this.get("autoplay") && (this.set("autoplay", !1), this.set("muted", !1), this.onTimeUpdate(), this.player.trigger({
          type: "restart",
          start: this.player.currentTime(),
          end: 0
        }), this.player.currentTime(0))
      },
      pollTimeUpdate: function () {
        this.get("paused") || (this.onTimeUpdate(), setTimeout(s.bind(this.pollTimeUpdate, this), 150))
      },
      shouldAutoplay: function () {
        return this.get("autoplay") && !h.bool("is_mobile") && this.get("duration") > this.get("minLoopDuration") && this.$el.is(":visible")
      },
      shouldForceHD: function () {
        return !(!this.vjsOptions.forceHD || !this.vjsOptions.crtOptions.hdUrl)
      },
      play: function (t) {
        t || (t = {}), this.player.paused() && (this.player.play(), t.skipLog || (t.type = "userPlay", this.player.trigger(t)))
      },
      pause: function (t) {
        t || (t = {}), this.player.paused() || (this.player.pause(), t.skipLog || this.player.trigger("userPause"))
      },
      onPlay: function () {
        this.set("paused", !1), this.pollTimeUpdate()
      },
      onPause: function () {
        this.set("paused", !0)
      },
      onUpdateDuration: function (t) {
        this.get("duration") || this.set("duration", this.player.duration())
      },
      onLoadedMetadata: function (t) {
        this.set("loaded", !0)
      },
      onEnded: function (t) {
        this.get("loop") === !0 ? (this.play({skipLog: !0}), this.player.trigger("looped"), this.get("autoplay") || this.hasLooped || (this.hasLooped = !0)) : (this.pause({skipLog: !0}), this.player.trigger("videoEnded"))
      },
      onError: function (t) {
        this.set("paused", !0), this.set("loop", !1), this.set("autoplay", !1)
      },
      onChangeAutoplay: function (t, e, i) {
        this.setAutoplayState(e, i)
      },
      onChangeAutoheight: function (t, e) {
        this.setAutoheightState(e)
      },
      onChangeDuration: function (t, e) {
        this.setLoopState(!0)
      },
      onChangeLoop: function (t, e) {
        this.setLoopState(e)
      },
      onChangeMuted: function (t, e) {
        this.player.muted(e)
      },
      onFullscreenChange: function () {
        this.$post.hasClass("docked") && (this.player.isFullscreen() ? (this.cached_top = this.$el.position().top, this.$el.css("top", 0)) : this.$el.css("top", this.cached_top))
      },
      onDockedAfterRender: function (t) {
        s.isEmpty(t.embedID) || this.playerID === t.embedID && this.player.trigger("CRTPlayer:updateDimensions")
      },
      setLoopState: function (t) {
        s.isUndefined(t) && (t = this.get("loop")), this.set("loop", t), "undefined" != typeof this.get("duration") && this.get("duration") <= this.get("minLoopDuration") && this.set("loop", !1)
      },
      setMutedState: function (t) {
        s.isUndefined(t) && (t = this.get("muted")), this.set("muted", t)
      },
      setAutoplayState: function (t) {
        s.isUndefined(t) && (t = this.get("autoplay")), this.set("autoplay", t), this.toggleAttrClass("autoplay", t), !t && this.get("duration") && this.setLoopState(!0)
      },
      setAutoheightState: function (t) {
        s.isUndefined(t) && (t = this.get("autoheight")), this.set("autoheight", t), this.toggleAttrClass("autoheight", t)
      },
      setFullscreenControl: function (t) {
        s.isUndefined(t) && (t = this.get("hideFullscreen")), this.set("hideFullscreen", t), this.toggleAttrClass("hideFullscreen", t)
      },
      onTimeUpdate: function () {
        var t = .3, e = this.get("_position"), i = this.player.currentTime(), s = Math.abs(e - i);
        t > s && this.set("_elapsed", this.get("_elapsed") + s), this.set("_position", i), this.set("_startSeekJumpTime", i)
      },
      getStartSeekJumpPosition: function () {
        return this.get("_startSeekJumpTime")
      },
      getPosition: function () {
        return Math.floor(this.get("_position"))
      },
      getElapsed: function () {
        return Math.floor(this.get("_elapsed"))
      },
      toggleAttrClass: function (t, e) {
        this.classNames[t] && a.write(function () {
          this.$el.toggleClass(this.classNames[t], e)
        }, this)
      },
      teardown: function () {
        this.trigger("teardown", this), this.off(), this.stopListening(), this.watcher && (this.watcher.destroy(), this.watcher = null), this.player && (this.player.dispose(), this.player = null)
      }
    });
    e.exports = p
  }, {
    "./plugins/videojs-crt": 483,
    fastdom: 641,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/class": 543,
    "prima/events": 546,
    "prima/lib/flags": "f/LVtH",
    "prima/mixins/accessor": 577,
    "prima/utils/caniuse": 595,
    scrollmonitor: "y33VHk"
  }],
  470: [function (t, e, i) {
    "use strict";
    var s = t("video.js"), o = t("./templates/mute_toggle.tpl"), n = s.MuteToggle.extend({
      init: function (t, e) {
        s.MuteToggle.prototype.init.call(this, t, e), this.addListeners(t)
      }, addListeners: function (t) {
        this.on("click", this.onMuteClick)
      }, onMuteClick: function () {
        this.player_.trigger("muteClicked")
      }, createEl: function () {
        var t = "vjs-mute-control vjs-control";
        return this.player_.options_.muted && (t += " vjs-vol-0"), s.Button.prototype.createEl.call(this, "div", {
          className: t,
          innerHTML: o()
        })
      }, update: function () {
        var t = this.player_.volume(), e = 3;
        0 === t || this.player_.muted() ? e = 0 : .33 > t ? e = 1 : .67 > t && (e = 2), this.player_.muted() ? "Unmute" !== this.el_.children[1].children[0].innerHTML && (this.el_.children[1].children[0].innerHTML = "Unmute") : "Mute" !== this.el_.children[1].children[0].innerHTML && (this.el_.children[1].children[0].innerHTML = "Mute");
        for (var i = 0; 4 > i; i++)s.removeClass(this.el_, "vjs-vol-" + i);
        s.addClass(this.el_, "vjs-vol-" + e)
      }
    });
    e.exports = n
  }, {"./templates/mute_toggle.tpl": 482, "video.js": "AcVSFw"}],
  471: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("video.js"), a = n.CoreObject.extend({
      init: function (t, e) {
        this.options = e || {}, this.player = t, this.$player = o(this.player.el()), this._selectorCache(), this.player.on("dispose", s.bind(this.dispose, this)), this.initialize.apply(this, arguments)
      }, _selectorCache: function () {
        this.$$ = s.memoize(function (t) {
          return this.$player.find(t)
        }, s.identity), this.$$.remove = s.bind(function (t) {
          this.$$.cache["delete"](t)
        }, this), this.$$.clear = s.bind(function () {
          this.$$.cache = new s.memoize.Cache
        }, this)
      }, initialize: function () {
      }, dispose: function () {
        this.$$.clear(), this.$player.off()
      }
    });
    e.exports = a
  }, {jquery: "HlZQrA", lodash: "MicNly", "video.js": "AcVSFw"}],
  472: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("video.js"), a = t("prima/utils/bindendevent").animation, r = n.Button.extend({
      init: function () {
        n.Button.prototype.init.apply(this, arguments), this.player().usingNativeControls() && this.player().controls(!1)
      }, createEl: function () {
        return n.Button.prototype.createEl.call(this, "div", {
          className: "vjs-big-play-button",
          innerHTML: '<span class="vjs-big-play-button-icon"></span><span class="vjs-big-pause-button-icon"></span></span><span aria-hidden="true"></span>',
          "aria-label": "play video"
        })
      }, onClick: function () {
        this.$el = this.$el || s(this.el()), this.player_.userActive(!0), this.player().usingNativeControls() ? this.player().paused() && (this.player().play(), this.player().controls(!0)) : this.togglePlay()
      }, togglePlay: function () {
        a(this.$el, o.bind(function (t) {
          this.$el.removeClass("poof-play poof-pause")
        }, this)), this.player().paused() ? (this.player().play(), this.$el.removeClass("poof-pause").addClass("poof-play")) : (this.player().pause(), this.$el.removeClass("poof-play").addClass("poof-pause"))
      }
    });
    e.exports = r
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/utils/bindendevent": 593, "video.js": "AcVSFw"}],
  473: [function (t, e, i) {
    "use strict";
    var s = t("video.js"), o = s.SeekBar.extend({
      onMouseMove: function (t) {
        s.SeekBar.prototype.onMouseMove.apply(this, arguments), this.update()
      }, update: function () {
        if (this.el_) {
          var t = this.getPercent(), e = this.handle, i = this.bar;
          isNaN(t) && (t = 0);
          var o = s.round(100 * t, 2) + "%";
          e.el().style.left = o, i.el().style.width = o
        }
      }
    });
    e.exports = o
  }, {"video.js": "AcVSFw"}],
  474: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("./base/base-plugin"), n = o.extend({
      elSelector: ".vjs-progress-holder",
      lastPlayPosition: 0,
      currentPlayPosition: 0,
      lastWaitedTime: 0,
      buffering: !1,
      polling: !1,
      interval: 100,
      initialize: function (t, e) {
        this.player.on("play", s.bind(this.startPolling, this)), this.player.on("ended", s.bind(this.stopPolling, this)), this.player.on("pause", s.bind(this.stopPolling, this))
      },
      checkBuffering: function () {
        this.currentPlayPosition = this.player.currentTime();
        var t = 1 / this.interval;
        if (!this.buffering && this.currentPlayPosition < this.lastPlayPosition + t && !this.player.paused() && (this.lastWaitedTime = s.now(), this.$player.trigger("waiting"), this.buffering = !0), this.buffering && this.currentPlayPosition > this.lastPlayPosition + t && !this.player.paused()) {
          var e = s.now() - this.lastWaitedTime;
          this.$player.trigger("stopwaiting", {timeWaited: e}), this.buffering = !1
        }
        this.lastPlayPosition = this.currentPlayPosition
      },
      tick: function () {
        this.polling && (this.checkBuffering(), s.delay(s.bind(this.tick, this), this.interval))
      },
      startPolling: function (t) {
        this.polling || (this.polling = !0, this.tick())
      },
      stopPolling: function (t) {
        this.polling = !1
      }
    });
    e.exports = n
  }, {"./base/base-plugin": 471, lodash: "MicNly"}],
  475: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/events"), a = t("prima/lib/flags"), r = t("./base/base-plugin"), l = r.extend({
      videoConversionLogged: !1,
      loggingInProgress: !1,
      startSeekTime: null,
      loadStartTime: 0,
      triggerElement: o(),
      initialize: function (t, e) {
        this.player.crt.on("ready", s.bind(function () {
          this.setPlayerData(), this.bindEvents(), this.cacheUnloadData()
        }, this)), this.$doc = o(document)
      },
      setPlayerData: function () {
        this.playerData = {
          id: this.player.crt.playerID,
          tech: this.player.techName,
          postData: this.player.crt.$post.data("json"),
          duration: this.player.crt.get("duration")
        }
      },
      bindEvents: function () {
        this.$player.on("mousedown touchstart", s.bind(this.setTriggerElement, this)), this.player.on("userPlay", s.bind(this.onUserPlay, this)), this.player.on("play", s.bind(this.onVJSPlay, this)), this.player.on("userPause", s.bind(this.onUserPause, this)), this.player.on("pause", s.bind(this.onVJSPause, this)), this.player.on("looped", s.bind(this.onLooped, this)), this.player.on("videoEnded", s.bind(this.onVideoEnded, this)), this.player.on("restart", s.bind(this.onRestart, this)), this.player.on("muteClicked", s.bind(this.onMuteClicked, this)), this.player.on("fullscreenchange", s.bind(this.onFullscreenChange, this)), this.player.on("error", s.bind(this.onError, this)), this.player.on("seeking", s.bind(this.onSeeking, this)), this.player.on("resolutionchange", s.bind(this.onResolutionChange, this)), this.player.on("timeupdate", s.bind(this.onTimeUpdate, this)), this.$player.on("stopwaiting", s.bind(this.onStopWaiting, this)), this.player.on("firstplay", s.bind(this.onLoadStart, this)), this.player.on("loadeddata", s.bind(this.onLoadedData, this))
      },
      triggerEvent: function (t, e) {
        e = this._buildLoggingData(e), n.trigger("VideoPlayer:" + t, {loggingData: e})
      },
      _buildLoggingData: function (t) {
        return t = s.extend({}, this.playerData, t), t.elapsed = this.player.crt.getElapsed(), t.position = this.player.crt.getPosition(), t
      },
      setTriggerElement: function (t) {
        this.triggerElement = o(t.target)
      },
      onLogComplete: function () {
        this.triggerElement = o()
      },
      cacheUnloadData: function () {
        this.triggerEvent("cacheUnload")
      },
      onError: function (t) {
        var e = this.player.error(), i = "MEDIA_ERR_CUSTOM";
        if (e) {
          switch (e.code) {
            case 1:
              i = "MEDIA_ERR_ABORTED";
              break;
            case 2:
              i = "MEDIA_ERR_NETWORK";
              break;
            case 3:
              i = "MEDIA_ERR_DECODE";
              break;
            case 4:
              i = "MEDIA_ERR_SRC_NOT_SUPPORTED";
              break;
            case 5:
              i = "MEDIA_ERR_ENCRYPTED"
          }
          this.triggerEvent("error", {code: e.code, name: i})
        }
      },
      onUserPlay: function (t) {
        this.onPlay(!0, t)
      },
      onVJSPlay: function (t) {
        this.onPlay(!1, t)
      },
      onPlay: function (t, e) {
        if (t || 0 !== this.triggerElement.closest(".vjs-big-play-button").length || 0 !== this.triggerElement.closest(".vjs-play-control").length) {
          var i = this.player.crt.get("autoplay"), s = {};
          e.onDock && (s.onDock = !0), this.logConversion({
            name: "CONVERSION_ACTION_HTML5_VIDEO",
            extra: {player: this.player.techName, player_version: 2}
          }), this.triggerEvent(i ? "autoplay" : "play", s), this.onLogComplete()
        }
      },
      onUserPause: function () {
        this.onPause(!0)
      },
      onVJSPause: function () {
        this.onPause(!1)
      },
      onPause: function (t) {
        (t || 0 !== this.triggerElement.closest(".vjs-big-play-button").length || 0 !== this.triggerElement.closest(".vjs-play-control").length) && (this.triggerEvent("pause", this.playerData), this.onLogComplete())
      },
      onLooped: function () {
        this.triggerEvent("looped")
      },
      onVideoEnded: function () {
        this.triggerEvent("ended")
      },
      onRestart: function (t) {
        var e = s.pick(t, ["start", "end"]);
        this.triggerEvent("restart", e)
      },
      onFullscreenChange: function () {
        this.triggerEvent("fullscreen", {fullscreen: this.player.isFullscreen()}), this.onLogComplete()
      },
      onMuteClicked: function () {
        this.triggerEvent("muted", {muted: this.player.muted()}), this.onLogComplete()
      },
      onSeeking: function () {
        0 !== this.triggerElement.closest(".vjs-progress-control").length && (this.startSeekTime || (this.startSeekTime = this.player.crt.getStartSeekJumpPosition()), this.$doc.one("mouseup.crtEvents touchend.crtEvents", s.bind(this.onSeeked, this)))
      },
      onSeeked: function () {
        if (this.startSeekTime) {
          var t = {start: this.startSeekTime, end: this.player.currentTime()};
          this.triggerEvent("seek", t), this.startSeekTime = null
        }
      },
      onTimeUpdate: function () {
        this.triggerEvent("timeupdate")
      },
      onResolutionChange: function (t) {
        var e = s.pick(t, "resolution");
        this.triggerEvent("resolutionchange", e)
      },
      onStopWaiting: function (t, e) {
        !e.timeWaited || e.timeWaited < 2e3 || this.triggerEvent("waiting", e)
      },
      onLoadStart: function () {
        this.loadStartTime = s.now()
      },
      onLoadedData: function () {
        var t = s.now() - this.loadStartTime;
        this.triggerEvent("initialLoad", {loadTime: t})
      },
      logConversion: function (t) {
        if (!this.videoConversionLogged && a.bool("is_logged_in") && !this.loggingInProgress) {
          this.loggingInProgress = !0;
          var e = o.ajax({
            url: "/svc/log/conversion",
            type: "POST",
            contentType: "application/x-www-form-urlencoded",
            with_form_key: !0,
            data: "log=" + JSON.stringify(t)
          });
          e.done(s.bind(this.onConversionSuccess, this)), e.fail(s.bind(this.onConversionFail, this))
        }
      },
      onConversionSuccess: function () {
        this.videoConversionLogged = !0, this.loggingInProgress = !1
      },
      onConversionFail: function () {
        this.loggingInProgress = !1
      }
    });
    e.exports = l
  }, {"./base/base-plugin": 471, jquery: "HlZQrA", lodash: "MicNly", "prima/events": 546, "prima/lib/flags": "f/LVtH"}],
  476: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("video.js"), n = o.Component.extend({
      sdURL: null, hdURL: null, forceHD: null, isUsingSD: !0, timeIntervalBinding: null, init: function (t, e) {
        o.Component.prototype.init.call(this, t, e), this.addListeners(t)
      }, addListeners: function (t) {
        this.on("click", this.toggleHDState)
      }, createEl: function () {
        if (this.hdURL = this.player_.options_.crtOptions.hdUrl, this.forceHD = this.player_.options_.forceHD, !this.hdURL || this.forceHD)return o.Component.prototype.createEl.call(this, "div", {});
        this.player_.addClass("vjs-has-hd-toggle");
        var t = o.Component.prototype.createEl.call(this, "div", {
          className: "vjs-hd-toggle vjs-sd vjs-menu-button vjs-control",
          innerHTML: "<span>HD</span>"
        });
        return t
      }, currentSource: function () {
        return this.player_.currentSrc()
      }, toggleSrc: function () {
        var t;
        this.isUsingSD ? (this.sdURL = this.currentSource(), t = this.hdURL, o.removeClass(this.el_, "vjs-sd"), o.addClass(this.el_, "vjs-hd")) : (t = this.sdURL, o.removeClass(this.el_, "vjs-hd"), o.addClass(this.el_, "vjs-sd")), this.isUsingSD = !this.isUsingSD, this.player_.src({
          src: t,
          type: "video/mp4"
        })
      }, toggleHDState: function () {
        var t = this.player_.currentTime(), e = this.player_.paused(), i = this.player_.muted();
        this.player_.addClass("vjs-quality-toggling"), this.player_.trigger({
          type: "resolutionchange",
          resolution: this.isUsingSD ? "hd" : "sd"
        }), s.delay(s.bind(function () {
          this.player_.pause(), this.toggleSrc(),
            this.player_.ready(function () {
              this.player_.one("loadedmetadata", s.bind(function () {
                this.player_.currentTime(t)
              }, this)), this.timeIntervalBinding = s.bind(function () {
                this.player_.currentTime() - t > .1 && (this.player_.removeClass("vjs-quality-toggling"), this.player_.off("timeupdate", this.timeIntervalBinding), e && (this.player_.pause(), this.player_.muted(i)))
              }, this), this.player_.on("timeupdate", this.timeIntervalBinding), s.defer(s.bind(function () {
                this.player_.load(), i === !1 && e === !0 && this.player_.muted(!0), this.player_.play()
              }, this))
            })
        }, this), 300)
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "video.js": "AcVSFw"}],
  477: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("video.js"), n = t("./base/base-plugin"), a = n.extend({
      seeking: !1,
      render: function () {
        return this.$el = s('<div class="vjs-hover-handle vjs-slider-handle" aria-live="off"><span class="vjs-control-text"></span></div>'), this
      },
      afterRender: function () {
        this.$seekHandle = this.$$(".vjs-seek-handle")
      },
      update: function (t) {
        t || (t = {}), this.$time_el = this.$time_el || this.$el.find(".vjs-hover-handle-time");
        var e = t.hoverX || 0, i = t.hoverTime || "0:00", s = o.formatTime(i);
        this.$time_el.html(s), this.$el.css("left", e + "px")
      }
    });
    e.exports = a
  }, {"./base/base-plugin": 471, jquery: "HlZQrA", "video.js": "AcVSFw"}],
  478: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("video.js"), n = t("./base/base-plugin"), a = n.extend({
      render: function () {
        return this.$el = s('<div class="vjs-hover-slider-time" aria-live="off"></div>'), this
      }, update: function (t) {
        t || (t = {});
        var e = t.hoverX || 0, i = t.hoverTime || "0:00", s = o.formatTime(i);
        this.$el.html(s), this.$el.css("left", e + "px")
      }
    });
    e.exports = a
  }, {"./base/base-plugin": 471, jquery: "HlZQrA", "video.js": "AcVSFw"}],
  479: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("video.js"), n = t("./base/base-plugin"), a = t("./hover-slider-handle"), r = t("./hover-slider-time"), l = t("./progress-bar-tooltip"), h = n.extend({
      elSelector: ".vjs-progress-holder",
      initialize: function (t, e) {
        this.children = {}, this.$el = this.$$(this.elSelector), this.slider_width = this.$el.width(), this.createChildren(), this.$player.on("mousemove.sliderHover", this.elSelector, s.bind(this.onMouseMove, this)), this.$player.on("mouseenter.sliderHover", this.elSelector, s.bind(this.onMouseEnter, this)), this.$player.on("mouseout.sliderHover", this.elSelector, s.bind(this.onMouseOut, this)), this.player.on("dispose", s.bind(this.dispose, this)), this.player.on("fullscreenchange", s.bind(this.onUpdateDimensions, this)), this.player.on("CRTPlayer:updateDimensions", s.bind(this.onUpdateDimensions, this))
      },
      onUpdateDimensions: function () {
        this.slider_width = this.$el.width()
      },
      createChildren: function () {
        this.children.hoverSliderHandle = new a(this.player), this.children.hoverSliderTime = new r(this.player), this.player.options_.crtOptions.filmstrip && (this.$el.addClass("with-filmstrip"), this.children.progressBarTooltip = new l(this.player)), this.appendChildren()
      },
      appendChildren: function () {
        s.each(this.children, s.bind(function (t) {
          this.$el.append(t.render().$el)
        }, this))
      },
      updateChildren: function (t) {
        s.each(this.children, function (e) {
          e.update(t)
        })
      },
      onMouseMove: function (t) {
        this.$el.removeClass("auto-hide");
        var e = o.findPosition(this.$el[0]), i = t.pageX - e.left, s = o.Slider.prototype.calculateDistance.apply(this.player.controlBar.progressControl, [t.originalEvent]), n = s * this.player.player().duration(), a = n / this.player.player().duration();
        0 > i ? i = 0 : i > this.slider_width && (i = this.slider_width), this.updateChildren({
          hoverX: i,
          hoverTime: n,
          hoverPercent: a
        })
      },
      onMouseOut: function (t) {
        this.$el.addClass("auto-hide")
      },
      onMouseEnter: function (t) {
        this.$el.removeClass("auto-hide")
      },
      dispose: function () {
        s.each(this.children, function (t) {
          s.result(t, "dispose")
        }), n.prototype.dispose.apply(this, arguments)
      }
    });
    e.exports = h
  }, {
    "./base/base-plugin": 471,
    "./hover-slider-handle": 477,
    "./hover-slider-time": 478,
    "./progress-bar-tooltip": 481,
    lodash: "MicNly",
    "video.js": "AcVSFw"
  }],
  480: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("video.js"), a = n.Component.extend({
      isHidden: !0,
      init: function (t, e) {
        n.Component.call(this, t, e), t.ready(o.bind(this.onReady, this))
      },
      onReady: function () {
        this.$player = s(this.player().el_), this.$el = s(this.el()), this.$loader = this.$el.find(".Knight-Rider-loader");
        var t = o.bind(this.hideLoader, this), e = o.bind(this.showLoader, this);
        this.player().on("waiting", e), this.player().on("canplay", t), this.player().on("canplaythrough", t), this.player().on("playing", t), this.player().on("seeking", e), this.player().on("seeked", t), this.player().on("ended", t), this.player().on("resolutionchange", e)
      },
      createEl: function () {
        return n.Component.prototype.createEl.call(this, "div", {
          className: "vjs-loading-spinner",
          innerHTML: '<div class="Knight-Rider-loader centered"><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div><div class="Knight-Rider-bar"></div></div>',
          "aria-label": "loading"
        })
      },
      hideLoader: function (t) {
        return this.isHidden ? this : (this.$loader.removeClass("animate"), this.$player.removeClass("vjs-loading"), this.isHidden = !0, this)
      },
      showLoader: function (t) {
        return this.isHidden ? (this.$loader.addClass("animate"), this.$player.addClass("vjs-loading"), this.isHidden = !1, this) : this
      },
      dispose: function () {
        n.Component.prototype.dispose.apply(this, arguments), this.$player = null, this.$el = null
      }
    });
    e.exports = a
  }, {jquery: "HlZQrA", lodash: "MicNly", "video.js": "AcVSFw"}],
  481: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("./base/base-plugin"), n = o.extend({
      filmstrip_thumbnail_count: 10, render: function () {
        var t = this.player.options_.crtOptions.filmstrip, e = t.url, i = .5 * t.width, o = .5 * t.height, n = 6;
        return this.$el = s('<div class="crt-progress-tooltip"></div>'), this.$thumbnail = s('<div class="crt-progress-tooltip-thumbnail"></div>'), this.$el.css({
          transform: "translateX(-50%)",
          width: i + n + "px",
          height: o + n + "px"
        }), this.$thumbnail.css({
          width: i + "px",
          height: o + "px",
          "background-image": "url(" + e + ")",
          "background-size": i * this.filmstrip_thumbnail_count + "px " + o + "px"
        }), this.$el.append(this.$thumbnail), this
      }, update: function (t) {
        t || (t = {});
        var e = t.hoverX || 0;
        this.$el.css("left", e + "px");
        var i = isNaN(t.hoverPercent) ? 0 : 100 * t.hoverPercent, s = 100 / (this.filmstrip_thumbnail_count - 1), o = Math.floor(i / this.filmstrip_thumbnail_count) * s;
        this.$thumbnail.css("background-position", o + "% 0%")
      }
    });
    e.exports = n
  }, {"./base/base-plugin": 471, jquery: "HlZQrA"}],
  482: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="mute-icon"><div class="speaker"></div><div class="unmuted"></div><div class="muted"></div></div><div><span class="vjs-control-text">Mute</span></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  483: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      var i = o.merge({}, m(), e);
      o.extend(i, o.pick(e, "techOrder"));
      var s = a.defer(), r = function () {
        var t;
        e.src && e.type ? (this.src(e), s.resolve(this)) : e.file ? (t = e.file.type || "video/mp4", this.src({
          src: l(e.file),
          type: t
        }), s.resolve(this), delete e.file) : s.resolve(this)
      };
      return n(t, i, r), s.promise
    }

    var o = t("lodash"), n = t("video.js"), a = t("when"), r = t("prima/lib/data"), l = t("app/lib/create-object-url"), h = t("./hover-slider"), c = t("./detect-buffering"), d = t("./event-dispatcher");
    n.BigPlayToggle = t("./big-play-toggle"), n.AnimatingMuteToggle = t("./animating-mute-toggle"), n.CrtSeekBar = t("./crt-seekbar"), n.LoadingSpinner = t("./loading-spinner"), n.HDToggle = t("./hd-toggle"), n.log = o.noop, n.log.error = o.noop, n.log.warn = o.noop, n.log.history = [];
    var u = function (t) {
      this.crt = this.options_.crt, this.options_.crt = null, this.hoverSlider = new h(this, t), this.detectBuffering = new c(this, t), this.eventDispatcher = new d(this, t)
    };
    n.plugin("crt", u);
    var p, m = function () {
      var t = r.get("Context/hosts");
      return p || (p = {
        children: ["mediaLoader", "posterImage", "bigPlayToggle", {
          name: "controlBar",
          children: ["playToggle", "currentTimeDisplay", "timeDivider", "durationDisplay", "remainingTimeDisplay", {
            name: "progressControl",
            children: ["crtSeekBar"]
          }, "fullscreenToggle", "hDToggle", "animatingMuteToggle", "loadingSpinner"]
        }, "errorDisplay"],
        plugins: {crt: {}},
        crtOptions: {filmstrip: !1, hdUrl: !1, duration: null},
        controls: !0,
        autoplay: !1,
        defaultVolume: .8,
        flash: {swf: t.assets_host + "/assets/src/scripts/vendor/video-js/video-js-swf-4.5.2.swf"},
        techOrder: ["html5", "flash"]
      }), p
    };
    e.exports = s
  }, {
    "./animating-mute-toggle": 470,
    "./big-play-toggle": 472,
    "./crt-seekbar": 473,
    "./detect-buffering": 474,
    "./event-dispatcher": 475,
    "./hd-toggle": 476,
    "./hover-slider": 479,
    "./loading-spinner": 480,
    "app/lib/create-object-url": 458,
    lodash: "MicNly",
    "prima/lib/data": 548,
    "video.js": "AcVSFw",
    when: "RG2dij"
  }],
  484: [function (t, e, i) {
    "use strict";
    var s = t("./views/drawerform.js");
    e.exports = s
  }, {"./views/drawerform.js": 485}],
  485: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("prima/view"), n = t("prima/lib/translate"), a = t("prima/mixins/accessor"), r = t("prima/events"), l = t("./imageupload"), h = t("./fieldvalidation"), c = t("./errortags"), d = o.extend({
      mixins: [a],
      templateAttributes: {__: n, formKey: s("#tumblr_form_key").attr("content")},
      initialize: function (t) {
        t = t || {}, this.set("complete", !1), this.fieldValidation = new h({el: this.$el}), this.imageUpload = new l({el: this.$el}), this.errortags = new c({mobileMode: "undefined" != typeof t.mobileMode ? t.mobileMode : !1}), this._bindEvents()
      },
      _bindEvents: function () {
        this.listenTo(r, "drawer:close", this._teardown), this.listenTo(r, "drawerform:validation", this._updateCompleteStatus)
      },
      _updateCompleteStatus: function (t) {
        this.set("complete", t.status)
      },
      _teardown: function () {
        this.fieldValidation.remove(), this.imageUpload.remove(), this.errortags.remove()
      }
    });
    e.exports = d
  }, {
    "./errortags": 486,
    "./fieldvalidation": 487,
    "./imageupload": 488,
    jquery: "HlZQrA",
    "prima/events": 546,
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/view": 612
  }],
  486: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/lib/translate"), a = t("prima/mixins/accessor"), r = t("prima/view"), l = t("prima/events"), h = t("velocity-animate"), c = r.extend({
      mixins: [a],
      el: ".form-container",
      defaultText: "A few details, please",
      initialize: function (t) {
        this.set("mobileMode", "undefined" != typeof t && t.mobileMode ? t.mobileMode : !1), this.errorTags = {}, this.listenTo(l, "drawerform:errortag:show", this.showErrorTag), this.listenTo(l, "drawerform:errortag:remove", this.removeErrorTag), this.listenTo(l, "drawerform:errortag:removeall", this.removeAllErrorTags)
      },
      showErrorTag: function (t) {
        if ("undefined" != typeof t && t.field) {
          var e = t.field, i = t.text || n(this.defaultText), a = e.attr("name");
          if (!this.errorTags[a])if (this.errorTags[a] = s("<div>").addClass("drawer-error-tag").text(i), this.get("mobileMode")) {
            this.groupName && this.labelName || (this.formClass = e.parents(".form").parent().attr("class"), "help-form" === this.formClass ? (this.groupName = ".form-group", this.labelName = ".group-label") : "abuse-form" === this.formClass && (this.groupName = ".form-row", this.labelName = ".row-label"));
            var r = e.parents(this.groupName), l = r.find(this.labelName);
            this.errorTags[a].addClass(a).appendTo(l), h.animate(this.errorTags[a], "fadeIn", {
              duration: 100,
              easing: "easeInOut"
            }), h.animate(this.errorTags[a], "fadeOut", {
              duration: 100,
              easing: "easeIn",
              delay: 3e3,
              complete: o.bind(function () {
                this.removeErrorTag({field: e})
              }, this)
            })
          } else"undefined" == typeof this.drawer && (this.$drawer = s(".drawer"), this.$drawer.on("scroll", o.bind(this.updateErrortagPosition, this))), this.errorTags[a].css({
            top: e.offset().top,
            right: this.$drawer.width()
          }).insertAfter(this.$drawer), h.animate(this.errorTags[a], {translateX: ["-5px", "0px"]}, {
            duration: 100,
            easing: "easeInOut"
          })
        }
      },
      removeErrorTag: function (t) {
        var e = t.field, i = e.attr("name");
        "undefined" != typeof this.errorTags && this.errorTags[i] && (this.errorTags[i].remove(), delete this.errorTags[i])
      },
      removeAllErrorTags: function () {
        "undefined" != typeof this.errorTags && this.errorTags && o.each(this.errorTags, function (t) {
          t && (t.remove(), t = "")
        })
      },
      updateErrortagPosition: function () {
        "undefined" != typeof this.errorTags && this.errorTags && o.each(this.errorTags, function (t, e) {
          var i = s('.form-container [name="' + e + '"]');
          i ? t.css({top: i.offset().top}) : (t.remove(), this.removeErrorTag({field: i}))
        }, this)
      },
      remove: function () {
        this.removeAllErrorTags(), "undefined" != typeof this.$drawer && this.$drawer.off("scroll", o.bind(this.updateErrortagPosition, this)), r.prototype.remove.apply(this)
      }
    });
    e.exports = c
  }, {
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/translate": 575,
    "prima/mixins/accessor": 577,
    "prima/view": 612,
    "velocity-animate": "lWl/mc"
  }],
  487: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/lib/translate"), a = t("prima/view"), r = t("prima/events"), l = t("prima/lib/validators"), h = 5e3, c = a.extend({
      events: {
        'change [data-validate-input="dropdown"]': "fieldValidationHandler",
        'keyup [data-validate-input="email"]': "fieldValidationHandler",
        'blur [data-validate-input="email"]': "fieldValidationHandler",
        'keyup [data-validate-input="text"]': "fieldValidationHandler",
        'blur [data-validate-input="text"]': "fieldValidationHandler",
        'keyup [data-validate-input="url"]': "fieldValidationHandler",
        'blur [data-validate-input="url"]': "fieldValidationHandler",
        'change [data-validate-input="file"]': "fieldValidationHandler",
        'change [data-validate-input="checkbox"]': "validateAllFields"
      },
      validationErrorMessages: {email: "We gotta write you back, though", url: "Invalid URL"},
      initialize: function () {
        this.listenTo(r, "drawerform:validation:trigger", this.validateAllFields)
      },
      validateAllFields: function () {
        var t = s("[data-validate-input]"), e = t.length > 0;
        o.each(t, function (t) {
          var i = s(t), o = i.data("validate-input"), n = i.val(), a = i.prop("required");
          return this.isFieldValid(n, o, a) ? void 0 : (e = !1, !1)
        }, this), r.trigger("drawerform:validation", {status: e})
      },
      fieldValidationHandler: function (t) {
        var e = s(t.target), i = e.val().trim(), o = e.data("validate-input"), a = e.prop("required");
        this.isFieldValid(i, o, a) ? (e.hasClass("error") && e.removeClass("error"), r.trigger("drawerform:errortag:remove", {field: e}), "focusout" === t.type && "url" === o && i.length && 0 !== i.indexOf("http") && s(t.target).val("http://" + i)) : "focusout" === t.type && (e.addClass("error"), r.trigger("drawerform:errortag:show", {
          field: e,
          text: n(this.validationErrorMessages[o])
        })), this.validateAllFields()
      },
      isFieldValid: function (t, e, i) {
        var s;
        if (i = "undefined" == typeof i ? !1 : i, l.isBlank(t))return !i;
        switch (e) {
          case"email":
            s = l.isEmail(t);
            break;
          case"text":
            s = l.maxLength(t, h);
            break;
          case"file":
            s = !0;
            break;
          case"dropdown":
            s = !0;
            break;
          case"url":
            s = l.isUrl(t);
            break;
          case"checkbox":
            s = this.isAtLeastOneChecked()
        }
        return s
      },
      isAtLeastOneChecked: function () {
        var t = s('input[type="checkbox"]:checked');
        return t.length > 0
      }
    });
    e.exports = c
  }, {
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/translate": 575,
    "prima/lib/validators": 576,
    "prima/view": 612
  }],
  488: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/lib/translate"), a = t("prima/view"), r = t("prima/events"), l = 15e6, h = a.extend({
      events: {
        "change .image-upload": "onImageUploadClick",
        "click .btn-remove-uploaded": "onRemoveImageClick"
      }, onImageUploadClick: function (t) {
        var e = t.currentTarget;
        if (this.imageUploadEl = s(".image-upload-input"), this.imagePreviewEl = s(".image-upload-preview"), e.files && e.files[0]) {
          if (e.files[0].size > l)return r.trigger("drawerform:errortag:show", {
            field: this.imageUploadEl,
            text: n("File is too big.")
          }), void s(e).replaceWith(s(e).val("").clone(!0));
          r.trigger("drawerform:errortag:remove", {field: this.imageUploadEl}), this.imageUploadEl.addClass("hidden");
          var i = new FileReader;
          i.readAsDataURL(e.files[0]), i.onload = o.bind(function (t) {
            this.imagePreviewEl.removeClass("hidden"), t.target.result && t.target.result.length ? (this.imagePreviewEl.find("img").attr("src", t.target.result), this.imagePreviewEl.addClass("shown")) : this.imageUploadEl.removeClass("hidden")
          }, this)
        }
      }, onRemoveImageClick: function () {
        var t = s(".image-upload-input input");
        t.replaceWith(t.val("").clone(!0)), s(".image-upload-input input").trigger("change"), this.imagePreviewEl.removeClass("shown"), this.imageUploadEl.removeClass("hidden")
      }
    });
    e.exports = h
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/events": 546, "prima/lib/translate": 575, "prima/view": 612}],
  489: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/component"), a = t("prima/events"), r = t("app/components/drawer"), l = t("prima/mixins/keycommands"), h = t("./views/helpformview.js"), c = n.extend({
      name: "HelpForm",
      mixins: [l],
      keycommands: {"keydown:shift+h": "open"},
      initialize: function () {
        this.drawerManager = r(), this.bindEvents()
      },
      bindEvents: function () {
        this.listenTo(a, "helpform:open", this.open), this.listenTo(a, "helpform:close", this.close), this.listenTo(this.drawerManager, "open:helpform", this.openEventHandler), this.listenTo(this.drawerManager, "open:helpform:terminated", o.partial(this.openEventHandler, {category: "terminated"})), this.listenTo(this.drawerManager, "open:helpform:login", o.partial(this.openEventHandler, {category: "login"}))
      },
      close: function () {
        this.drawerManager.close(), a.trigger("helpform:closed")
      },
      openEventHandler: function (t) {
        this.open(t), a.trigger("helpform:opened:withButton")
      },
      open: function (t) {
        var e = s(document.activeElement).is("input,textarea,div[contenteditable]");
        this.drawerManager.canOpen() && !e ? this.drawerManager.open(h, t) : this.drawerManager.close()
      }
    });
    e.exports = c
  }, {
    "./views/helpformview.js": 495,
    "app/components/drawer": 49,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/component": 545,
    "prima/events": 546,
    "prima/mixins/keycommands": 581
  }],
  490: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="form-container form"><div class="form-header with-border"><h1 class="form-heading">' + (null == (__t = __("Help me, Tumblr")) ? "" : __t) + '</h1><div class="form-description"><p>' + (null == (__t = __("You got it. Describe the problem you're having as best you can, and a member of our Support team will be in touch with you as soon as possible.")) ? "" : __t) + "</p><br><p>" + (null == (__t = __("%1$sNote:%2$s This form is for technical issues and general weirdness. If you're reporting a violation of our Community Guidelines, use %3$sthis other form%4$s instead.", "<strong>", "</strong>", '<a href="/abuse">', "</a>")) ? "" : __t) + '</p></div></div><form action="/support/ticket/new" src="" method="POST" enctype="multipart/form-data" target="help_form_target"><iframe id="help_form_target" name="help_form_target" style="width:0;height:0;border:none;margin:0;padding:0"></iframe><input type="hidden" name="jsonp" value="help_modal.evaluate_response"> <input type="hidden" name="support_type" id="support_form_support_type" value="support"> <input type="hidden" name="form_key" id="support_form_form_key" value="' + (null == (__t = formKey) ? "" : __t) + '">', languageNotice && (__p += '<div class="form-group"><div class="group-row"><span class="language-notice">' + (null == (__t = __("Just so you know, we're not yet able to address queries that are written in [language]. You can still use this form to contact our Support team, but you'll need to fill it out in English. Sorry about that, and thanks for your patience.")) ? "" : __t) + "</span></div></div>"), __p += '<div class="form-group"><div class="group-label"><h3 class="settings_subheading">' + (null == (__t = __("What's going on?")) ? "" : __t) + '</h3></div><div class="group-content"><div class="flat_select attached">', preSelectedCategory ? (__p += '<select name="subject" id="category" class="category" data-validate-input="dropdown"><option value="' + (null == (__t = __("Category")) ? "" : __t) + '" disabled="disabled">' + (null == (__t = __("Category")) ? "" : __t) + "</option>", _.each(categories, function (t, e) {
          __p += "", __p += e === preSelectedCategory ? '<option value="' + (null == (__t = e) ? "" : __t) + '" selected="selected">' + (null == (__t = __(t)) ? "" : __t) + "</option>" : '<option value="' + (null == (__t = e) ? "" : __t) + '">' + (null == (__t = __(t)) ? "" : __t) + "</option>", __p += ""
        }), __p += '</select><label for="category" class="current_selection">' + (null == (__t = categories[preSelectedCategory]) ? "" : __t) + "</label>") : (__p += '<select name="subject" id="category" class="category" data-validate-input="dropdown" required><option value="' + (null == (__t = __("Category")) ? "" : __t) + '" disabled="disabled" selected="selected">' + (null == (__t = __("Category")) ? "" : __t) + "</option>", _.each(categories, function (t, e) {
          __p += '<option value="' + (null == (__t = e) ? "" : __t) + '">' + (null == (__t = __(t)) ? "" : __t) + "</option>"
        }), __p += '</select><label for="category" class="current_selection">' + (null == (__t = __("Category")) ? "" : __t) + "</label>"), __p += '<i class="icon"></i></div><textarea class="body" data-validate-input="text" required name="body" cols="30" rows="5" placeholder="' + (null == (__t = __("The more details, the better")) ? "" : __t) + '"></textarea></div></div><div class="form-group"><div class="group-label"><h3 class="settings_subheading">' + (null == (__t = __("Attachment")) ? "" : __t) + '</h3><div class="sub-label">' + (null == (__t = __("Optional")) ? "" : __t) + '</div></div><div class="group-content"><div class="image-upload-input"><input id="image-upload" class="image-upload" type="file" name="attachments[]" accept="image/*"><label class="image-upload" for="image-upload"></label></div><div class="image-upload-preview"><img src=""><div class="btn_remove btn-remove-uploaded" data-tooltip="' + (null == (__t = __("Remove image")) ? "" : __t) + '"></div></div></div></div><div class="form-group"><div class="group-label"><h3 class="settings_subheading">' + (null == (__t = __("Relevant blog")) ? "" : __t) + '</h3><div class="sub-label">' + (null == (__t = __("Optional")) ? "" : __t) + '</div></div><div class="group-content">', tumblelogs && _.size(tumblelogs) >= 1 ? (__p += '<div class="flat_select"><select name="support_form_blog" id="tumblelog" class="tumblelog"><option value="" selected="selected">' + (null == (__t = __("None selected")) ? "" : __t) + "</option>", _.each(tumblelogs, function (t) {
          __p += '<option value="' + (null == (__t = t.name) ? "" : _.escape(__t)) + '">' + (null == (__t = t.name) ? "" : _.escape(__t)) + "</option>"
        }), __p += '</select><label for="tumblelog" class="current_selection">' + (null == (__t = __("None selected")) ? "" : __t) + '</label><i class="icon"></i></div>') : __p += '<input class="text_field" name="support_form_blog" placeholder="' + (null == (__t = __("Username or URL")) ? "" : __t) + '">', __p += '</div></div><div class="form-group"><div class="group-label"><h3 class="settings_subheading">' + (null == (__t = __("Where should we reach you?")) ? "" : __t) + '</h3></div><div class="group-content"><input class="text_field" data-validate-input="email" required name="user_email" placeholder="' + (null == (__t = __("Email address")) ? "" : __t) + '" value="' + (null == (__t = email) ? "" : __t) + '"></div></div><div class="form-group"><button class="chrome big blue right help-form-next" disabled="disabled"><span class="label">' + (null == (__t = __("Next")) ? "" : __t) + '</span> <span class="Knight-Rider-loader animate"><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span></span></button></div></form></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  491: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="error-message"><div class="error-text">', errors ? (__p += "", _.each(errors, function (t) {
          __p += "<div>" + (null == (__t = t.error) ? "" : _.escape(__t)) + "</div>"
        }), __p += "") : __p += "" + (null == (__t = __("Oops. There was an error. Try again.")) ? "" : __t), __p += "</div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  492: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="question">' + (null == (__t = question) ? "" : __t) + '</div><div class="answer">' + (null == (__t = answer) ? "" : __t) + "</div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  493: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="form-container suggestions"><div class="form-header with-border"><h1 class="form-heading">' + (null == (__t = __("Does any of this help?")) ? "" : __t) + '</h1></div><div class="suggestions-list"></div><div class="form-group"><button class="chrome big left help-form-dismiss">' + (null == (__t = __("Yep, found it")) ? "" : __t) + '</button> <button class="chrome big blue right help-form-submit"><span class="label">' + (null == (__t = __("No, send my thing")) ? "" : __t) + '</span> <span class="Knight-Rider-loader animate"><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span><span class="Knight-Rider-bar"></span></span></button></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  494: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="form-container success"><div class="success-message"><h1 class="message-title">' + (null == (__t = __("Got it")) ? "" : __t) + '</h1><p class="message-text">' + (null == (__t = __("Our Support team will be emailing you shortly.")) ? "" : __t) + "<br>" + (null == (__t = __("And thanks for bringing this thing to our attention.")) ? "" : __t) + "</p></div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  495: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/lib/data"), a = t("prima/events"), r = t("prima/lib/flags"), l = t("prima/mixins/accessor"), h = t("app/mixins/tumblrselect"), c = t("../templates/helpform.tpl"), d = t("../templates/suggestions.tpl"), u = t("../templates/ticketcreated.tpl"), p = t("../templates/partials/error_message.tpl"), m = t("../templates/partials/suggestion_item.tpl"), g = t("components/drawer-form"), _ = g.extend({
      mixins: [l, h],
      templates: {helpForm: c, suggestions: d, suggestionItem: m, ticketCreated: u, errorMessage: p},
      events: {
        "click .help-form-next": "onFormNextClick",
        "click .help-form-submit": "onFormSubmitClick",
        "click .help-form-dismiss": "dismissForm",
        "click .suggestion.with-link": "onSuggestionClick",
        "change [data-validate-input]": "onFieldInputChange"
      },
      className: "help-form",
      initialize: function (t) {
        try {
          g.prototype.initialize.call(this, t), this.set("suggestionsShown", !1), this.on("change:complete", this.updateSubmitButton), this.set("wasFormTouched", !1), this.set("wasFaqLoaded", !1), this.set("mobileMode", t.mobileMode || !1), a.on("drawer:close", o.bind(this.teardown, this));
          var e = n.get("Components/HelpForm");
          this.templateAttributes.email = e.email, this.templateAttributes.tumblelogs = e.tumblelogs, this.templateAttributes.languageNotice = e.language_notice, this.templateAttributes.categories = e.category_opt, this.templateAttributes.preSelectedCategory = t && t.category ? t.category : "", this.lang = e.lang, this.setUpResponseHandler(), r.bool("static_help_form") && (s(".contact_button_static").remove(), s(".static_help_form").remove())
        } catch (i) {
          this.onCatchFallBack(i)
        }
      },
      onCatchFallBack: function (t) {
        r.bool("static_help_form") && window.location && (this.get("mobileMode") && "/help" !== window.location.pathname ? o.defer(function () {
          s(".help-form").remove()
        }) : "/support" !== window.location.pathname ? window.location = "/support" : o.defer(function () {
          a.trigger("helpform:close")
        }))
      },
      dismissForm: function () {
        this.logEvent("foundItClicked"), this.get("mobileMode") ? "undefined" != typeof window.history && window.history.length > 2 ? window.history.go(-1) : window.location = "/dashboard" : a.trigger("helpform:close")
      },
      setUpResponseHandler: function () {
        window.help_modal = {}, window.help_modal.evaluate_response = o.bind(function (t) {
          t.meta && 201 === t.meta.status ? this.onRequestSuccess() : this.onRequestFail(t)
        }, this)
      },
      getFaqs: function () {
        var t = s.ajax({url: "/svc/faqs/" + this.lang});
        t.then(o.bind(this.onFaqRequestSuccess, this), o.bind(this.onFaqRequestFail, this))
      },
      onFaqRequestSuccess: function (t) {
        "undefined" != typeof t.response.faqs ? this.prepareFaqIndex(t.response.faqs) : this.prepareFaqIndex([])
      },
      onFaqRequestFail: function () {
        this.prepareFaqIndex([])
      },
      prepareFaqIndex: function (t) {
        this.keywordIndex = {}, this.faqList = {};
        var e;
        "undefined" != typeof t && t.length > 0 && o.each(t, function (t) {
          o.each(t.keywords.split(","), function (i) {
            this.faqList[t.id] = {}, this.faqList[t.id].question = t.question, this.faqList[t.id].answer = t.answer, e = t.question.match('(https?://[^"]+)'), this.faqList[t.id].faqLink = null !== e ? e[0] : !1, "undefined" == typeof this.keywordIndex[i] && (this.keywordIndex[i] = []), this.keywordIndex[i].push(t.id)
          }, this)
        }, this), this.set("wasFaqLoaded", !0)
      },
      updateSubmitButton: function () {
        this.get("complete") === !0 ? this.nextFormButton.removeAttr("disabled") : this.nextFormButton.attr("disabled", "disabled")
      },
      onRequestSuccess: function () {
        this.$el.html(this.templates.ticketCreated(this.templateAttributes)), this.resetScroll(), this.logEvent("submit:success"), a.trigger("drawer:disableCloseConfirmation"), setTimeout(function () {
          a.trigger("helpform:close")
        }, 5e3)
      },
      onRequestFail: function (t) {
        var e = s(this.get("suggestionsShown") ? ".help-form-submit" : ".help-form-next"), i = o.clone(this.templateAttributes), n = s(".error-message");
        n && n.remove(), t.response && t.response.errors && o.extend(i, t.response), s(this.templates.errorMessage(i)).insertBefore(e.closest(".form-group")), e.removeClass("loading"), this.logEvent("submit:error", {error: t})
      },
      onFormNextClick: function (t) {
        if (t.target && t.preventDefault(), a.trigger("drawerform:errortag:removeall"), !this.get("wasFaqLoaded"))return this.nextFormButton.addClass("loading"), void this.once("change:wasFaqLoaded", this.onFormNextClick, this);
        var e = this.getSuggestions();
        e.length > 0 ? (this.set("suggestionsShown", !0), this.form.addClass("not-shown"), this.get("mobileMode") && this.form.addClass("hidden"), this.$el.prepend(this.templates.suggestions(o.extend(this.templateAttributes))), this.fillInSuggestions(e), this.resetScroll(), this.logEvent("suggestions:found", {suggestions: e})) : (this.form.find("form").submit(), this.nextFormButton.addClass("loading"), this.logEvent("suggestions:notfound")), this.sendLogQuery()
      },
      onSuggestionClick: function (t) {
        var e = s(t.target);
        this.logEvent("suggestions:clicked", {faqLink: e.attr("href")})
      },
      onFieldInputChange: function (t) {
        this.get("wasFormTouched") || (this.set("wasFormTouched", !0), a.trigger("drawer:enableCloseConfirmation"), this.getFaqs())
      },
      resetScroll: function () {
        var t;
        this.get("mobileMode") ? t = s("body") : ("undefined" == typeof this.drawer && (this.drawer = this.$el.closest(".drawer")), t = this.drawer), o.defer(function () {
          t.scrollTop(0)
        })
      },
      logEvent: function (t, e) {
        if (t && t.length) {
          var i = {category: this.categoryField.val() || "", query: this.bodyField.val() || ""};
          o.extend(i, e), a.trigger("helpform:" + t, {loggingData: i})
        }
      },
      fillInSuggestions: function (t) {
        var e = s(".suggestions-list");
        o.each(t, function (t) {
          t.faqLink ? s("<a></a>").attr({
            href: t.faqLink,
            target: "_blank",
            "class": "suggestion with-link"
          }).html(this.templates.suggestionItem(t)).appendTo(e) : s("<div></div>").attr({"class": "suggestion"}).html(this.templates.suggestionItem(t)).appendTo(e)
        }, this)
      },
      onFormSubmitClick: function () {
        this.form.find("form").submit(), this.$el.find(".help-form-submit").addClass("loading")
      },
      sendLogQuery: function () {
        s.ajax({
          url: "/help/query",
          type: "POST",
          data: {query: this.bodyField.val(), matched: this.get("suggestionsShown") ? 1 : 0}
        })
      },
      getSuggestions: function () {
        var t = this.bodyField.val().trim().toLowerCase(), e = {}, i = [];
        return o.each(this.keywordIndex, function (i, s) {
          (0 === t.indexOf(s) || t.indexOf(" " + s) > 0) && o.each(i, function (t, i) {
            "undefined" == typeof e[t] && (e[t] = 0), e[t] += 10 > i ? .05 * (10 - i) : 0
          }, this)
        }, this), e = o.chain(e).map(function (t, e) {
          return {name: e, score: t}
        }).sortBy(function (t) {
          return t.score
        }).reverse().filter(function (t, e) {
          return 5 > e
        }).value(), o.each(e, function (t) {
          i.push(this.faqList[t.name])
        }, this), i
      },
      render: function () {
        return this.$el.html(this.templates.helpForm(this.templateAttributes)), this.form = this.$el.find(".form-container.form"), this.bodyField = this.$el.find(".body"), this.categoryField = this.$el.find(".category"), this.nextFormButton = this.$el.find(".help-form-next"), this.setUpSelector(this.$el.find(".category")), this.setUpSelector(this.$el.find(".tumblelog")), this
      },
      teardown: function () {
        window.location && "/support" === window.location.pathname && a.trigger("helpform:navigateBackToHelp")
      }
    });
    e.exports = _
  }, {
    "../templates/helpform.tpl": 490,
    "../templates/partials/error_message.tpl": 491,
    "../templates/partials/suggestion_item.tpl": 492,
    "../templates/suggestions.tpl": 493,
    "../templates/ticketcreated.tpl": 494,
    "app/mixins/tumblrselect": 461,
    "components/drawer-form": 484,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/data": 548,
    "prima/lib/flags": "f/LVtH",
    "prima/mixins/accessor": 577
  }],
  496: [function (t, e, i) {
    "use strict";
    var s = t("./views/knight-rider-loader-view.js");
    e.exports = s
  }, {"./views/knight-rider-loader-view.js": 498}],
  497: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="knight-rider-loader ' + (null == (__t = variation) ? "" : _.escape(__t)) + '" data-js-knightrider><div class="knight-rider-bar"></div><div class="knight-rider-bar"></div><div class="knight-rider-bar"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  498: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/subviewable"), a = t("prima/mixins/selectorcache"), r = t("prima/mixins/accessor"), l = t("../templates/knight-rider-loader.tpl"), h = o.extend({
      className: "knight-rider-container",
      mixins: [n, a, r],
      template: l,
      defaults: {variation: "", loading: !1},
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, s.pick(t, s.keys(this.defaults))), this.listenTo(this, "change:loading", this._onChangeLoading)
      },
      _onChangeLoading: function (t, e) {
        this.$el.toggleClass("loading", e), this.js$("knightRider").toggleClass("animate", e), this.$el.toggle(e)
      },
      serialize: function () {
        return this.toJSON()
      },
      render: function () {
        return this.$el.html(this.template(this.serialize())), this._onChangeLoading(this, this.get("loading")), this
      }
    });
    e.exports = h
  }, {
    "../templates/knight-rider-loader.tpl": 497,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/selectorcache": 586,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  499: [function (t, e, i) {
    "use strict";
    var s = t("./views/base.js");
    e.exports = s
  }, {"./views/base.js": 503}],
  500: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="bar white"></div><div class="bar red"></div><div class="bar orange"></div><div class="bar green"></div><div class="bar purple"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  501: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "" + (null == (__t = _subview("loaderType")) ? "" : __t);
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  502: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("../templates/bar.tpl"), a = o.extend({
      className: "loader-bar",
      template: n,
      defaults: {classModifiers: "", loading: !1},
      initialize: function (t) {
        this.options = s.extend({}, this.defaults, t), this.$el.addClass(this.get("classModifiers")), this.interval = null, this.timeout = null
      },
      afterRender: function () {
        this.$bars = this.$el.find(".bar"), this.get("loading") === !0 && this.toggleLoading(this.get("loading"))
      },
      toggleLoading: function (t) {
        this.currentBar = 0, this.counter = 0, t === !0 ? (clearTimeout(this.timeout), this.$el.addClass("loading"), this.$bars.addClass("animating"), this.startAnimating()) : (this.$el.removeClass("loading"), this.stopAnimating(), setTimeout(s.bind(function () {
          this.$bars.removeClass("animating")
        }, this), 300))
      },
      showBar: function (t) {
        this.$bars.eq(t).addClass("active")
      },
      hideBar: function (t) {
        this.$bars.eq(t).removeClass("active")
      },
      loop: function () {
        var t = this.$bars.eq(this.currentBar);
        t.remove(), this.$el.append(t), this.currentBar += 1, this.currentBar >= this.$bars.length && (this.currentBar = 0), this.counter++
      },
      startAnimating: function () {
        this.stopAnimating(), this.loop(), this.interval = setInterval(s.bind(function () {
          this.loop()
        }, this), 300)
      },
      stopAnimating: function () {
        clearInterval(this.interval)
      }
    });
    e.exports = a
  }, {"../templates/bar.tpl": 500, lodash: "MicNly", "prima/views/base": 613}],
  503: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/views/base"), n = t("./bar.js"), a = t("../templates/base.tpl"), r = o.extend({
      className: "loader-container",
      template: a,
      defaults: {type: "", classModifiers: "", loading: !1},
      initialize: function (t) {
        this.options = s.extend({}, this.defaults, t), this.$container = t.$container, "bar" === this.get("type") && this.createBarLoader(), this.listenTo(this, "change:loading", this._onChangeLoading), this.attach()
      },
      createBarLoader: function () {
        this.subviews.loaderType = new n(this.options)
      },
      _onChangeLoading: function (t, e) {
        this.subviews.loaderType.toggleLoading(e)
      },
      attach: function () {
        this.render(), this.$el.attr("data-subview=loader"), this.$container.find("[data-subview=loader]").replaceWith(this.$el)
      }
    });
    e.exports = r
  }, {"../templates/base.tpl": 501, "./bar.js": 502, lodash: "MicNly", "prima/views/base": 613}],
  504: [function (t, e, i) {
    "use strict";
    e.exports = {
      SharePopoverView: t("./views/share-popover"),
      FeatureHelpPopoverView: t("./views/feature-help-popover")
    }
  }, {"./views/feature-help-popover": 509, "./views/share-popover": 511}],
  505: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/model"), a = t("prima/lib/data"), r = t("prima/lib/flags"), l = t("app/components/post-embed-code"), h = n.extend({
      urlRoot: function () {
        var t = a.get("Context/hosts");
        return o.isEmpty(t) ? "http://www.tumblr.com" : t.www_host
      },
      defaults: {
        embed_code: "",
        form_key: s("#tumblr_form_key").attr("content"),
        has_facebook: !1,
        has_user: !1,
        is_private: !1,
        permalink_label: "",
        post_id: "",
        post_tiny_url: "",
        post_url: "",
        show_email: !0,
        show_embed: !0,
        show_facebook: !0,
        show_permalink: !0,
        show_pinterest: !0,
        show_twitter: !0,
        show_reddit: !0,
        show_flagging: !0,
        tumblelog_name: "",
        twitter_username: "",
        embed_key: "",
        pinterest_share_window: {}
      },
      initialize: function (t) {
        this.get("embed_code") || this.set("embed_code", new l(this.toJSON()).getCode()), r.bool("enable_share_embed_code") || this.set("show_embed", !1), r.bool("pinterest_sharing") || this.set("show_pinterest", !1), r.bool("reddit_sharing") || this.set("show_reddit", !1)
      },
      shareEmail: function (t) {
        return this.share("/svc/share/email", t)
      },
      shareTwitter: function (t) {
        return this.share("/svc/share/twitter", t)
      },
      shareFacebook: function (t) {
        return this.share("/svc/share/facebook", t)
      },
      sharePinterest: function (t) {
        return this.share("/svc/share/pinterest", t)
      },
      shareReddit: function (t) {
        return this.share("/svc/share/reddit", t)
      },
      facebookStatus: function () {
        return s.ajax({
          url: this.urlRoot() + "/svc/facebook_status",
          type: "post",
          data: {form_key: this.get("form_key")}
        })
      },
      share: function (t, e) {
        return e = e || [], e.push({name: "form_key", value: this.get("form_key")}), s.ajax({
          url: this.urlRoot() + t,
          type: "post",
          data: e,
          success: o.bind(function () {
            this.trigger("success")
          }, this),
          error: o.bind(function () {
            this.trigger("error")
          }, this)
        }), this
      }
    });
    e.exports = h
  }, {
    "app/components/post-embed-code": 222,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/data": 548,
    "prima/lib/flags": "f/LVtH",
    "prima/model": 590
  }],
  506: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", "undefined" != typeof template && "standard" === template ? (__p += '<div class="popover tutorial ' + (null == (__t = name) ? "" : _.escape(__t)) + '_step">', "undefined" != typeof title && (__p += '<h3 class="title">' + (null == (__t = title) ? "" : __t) + "</h3>"), __p += '<p class="content">' + (null == (__t = content) ? "" : _.escape(__t)) + "</p>", "undefined" != typeof ok_text && (__p += '<button class="chrome blue ok_button" type="button">' + (null == (__t = ok_text) ? "" : _.escape(__t)) + "</button>"), __p += "</div>") : "undefined" != typeof template && "appearance" === template && (__p += '<div class="popover tutorial ' + (null == (__t = name) ? "" : _.escape(__t)) + '_step"><div class="popover_inner">', "undefined" != typeof title && (__p += '<h3 class="title">' + (null == (__t = title) ? "" : __t) + "</h3>"), __p += '<p class="content">' + (null == (__t = content) ? "" : _.escape(__t)) + '</p></div><div class="appearance small" style="background-color:' + (null == (__t = appearance_data.global_theme_params.background_color) ? "" : _.escape(__t)) + "; color:" + (null == (__t = appearance_data.global_theme_params.background_color) ? "" : _.escape(__t)) + '"><div class="navigation"><a class="chrome edit_button" href="/settings/blog/' + (null == (__t = appearance_data.name) ? "" : _.escape(__t)) + '">' + (null == (__t = edit_text) ? "" : _.escape(__t)) + '</a></div><div class="header_image" style="background-image:url(' + (null == (__t = appearance_data.global_theme_params.header_image_focused) ? "" : _.escape(__t)) + ')"></div><div class="avatar ' + (null == (__t = appearance_data.global_theme_params.avatar_shape) ? "" : _.escape(__t)) + '" style="background-image:url(' + (null == (__t = appearance_data.avatar_url) ? "" : _.escape(__t)) + ')"><img src="' + (null == (__t = appearance_data.avatar_url) ? "" : _.escape(__t)) + '" alt=""></div><div class="info" style="color:' + (null == (__t = appearance_data.global_theme_params.title_color) ? "" : _.escape(__t)) + '">', appearance_data.title && (__p += '<h1 class="title" style="font-weight:' + (null == (__t = appearance_data.global_theme_params.title_font_weight) ? "" : _.escape(__t)) + '">' + (null == (__t = appearance_data.title) ? "" : _.escape(__t)) + "</h1>"), __p += "", appearance_data.description && (__p += '<div class="description"><p class="description_inner">' + (null == (__t = appearance_data.description) ? "" : _.escape(__t)) + "</p></div>"), __p += "</div></div></div>"), __p += '<div class="glass blue"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  507: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="popover popover_menu popover_gradient message-controls-popover"><div class="popover_inner"><ul>', this.showFlagAndBlock && (__p += '<li class="popover_menu_item" data-action="block" data-block="' + (null == (__t = this.options.blockString) ? "" : _.escape(__t)) + '"><a class="popover_menu_item_anchor" href="#">' + (null == (__t = __("Block")) ? "" : _.escape(__t)) + '</a></li><li class="popover_menu_item" data-action="flag"><a class="popover_menu_item_anchor" href="#">' + (null == (__t = __("Flag")) ? "" : _.escape(__t)) + "</a></li>"), __p += '<li class="popover_menu_item" data-action="delete" data-confirm="' + (null == (__t = __("Are you sure you want to delete this?")) ? "" : __t) + '"><a class="popover_menu_item_anchor" href="#">' + (null == (__t = __("Delete")) ? "" : _.escape(__t)) + "</a></li></ul></div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  508: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="popover popover_menu popover_gradient popover_share_social"><div class="popover_inner"><ul class="share_options active" data-tumblelog-name="' + (null == (__t = tumblelog_name) ? "" : _.escape(__t)) + '" data-post-id="' + (null == (__t = post_id) ? "" : _.escape(__t)) + '" data-root-id="' + (null == (__t = root_id) ? "" : _.escape(__t)) + '" data-post-url="' + (null == (__t = post_url) ? "" : _.escape(__t)) + '" data-post-tiny-url="' + (null == (__t = post_tiny_url) ? "" : _.escape(__t)) + '" data-embed-key="' + (null == (__t = embed_key) ? "" : _.escape(__t)) + '" data-embed-did="' + (null == (__t = embed_did) ? "" : _.escape(__t)) + '">', is_private || (__p += "", show_permalink && (__p += '<li class="share_permalink popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="permalink" href="' + (null == (__t = post_url) ? "" : _.escape(__t)) + '" target="_blank" class="external" title="' + (null == (__t = permalink_label) ? "" : _.escape(__t)) + '">' + (null == (__t = permalink_label) ? "" : _.escape(__t)) + '<i class="icon icon_arrow_carrot_right"></i></a></li>'), __p += "", show_embed && (__p += '<li class="embed_post popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="embed" href="#">' + (null == (__t = __("Embed")) ? "" : _.escape(__t)) + "</a></li>"), __p += "", show_email && (__p += '<li class="share_email popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="email" href="#">' + (null == (__t = __("Email")) ? "" : _.escape(__t)) + "</a></li>"), __p += "", show_twitter && (__p += '<li class="share_twitter popover_menu_item" data-twitter-username="' + (null == (__t = twitter_username) ? "" : _.escape(__t)) + '"><a class="popover_menu_item_anchor" data-share-type="twitter" href="#">' + (null == (__t = __("Twitter")) ? "" : _.escape(__t)) + "</a></li>"), __p += "", show_facebook && (__p += '<li class="share_facebook popover_menu_item" data-has-facebook="' + (null == (__t = has_facebook ? "1" : "") ? "" : __t) + '"><a class="popover_menu_item_anchor" data-share-type="facebook" href="#">' + (null == (__t = __("Facebook")) ? "" : _.escape(__t)) + "</a></li>"), __p += "", show_pinterest && (__p += '<li class="share_pinterest popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="pinterest" href="#">' + (null == (__t = __("Pinterest")) ? "" : _.escape(__t)) + "</a></li>"), __p += "", show_reddit && (__p += '<li class="share_reddit popover_menu_item"><a class="popover_menu_item_anchor" data-share-type="reddit" href="#">' + (null == (__t = __("Reddit")) ? "" : _.escape(__t)) + "</a></li>"), __p += "", show_flagging && (__p += '<li class="flag_post popover_menu_item"><a class="popover_menu_item_anchor" href="#">' + (null == (__t = __("Flag this post")) ? "" : _.escape(__t)) + "</a></li>"), __p += "", show_reporting_links && (__p += '<li class="popover_menu_item"><a class="popover_menu_item_anchor" target="_blank" href="' + (null == (__t = abuse_url) ? "" : _.escape(__t)) + '">' + (null == (__t = __("Report Abuse")) ? "" : _.escape(__t)) + "</a></li>"), __p += ""), __p += "</ul>", is_private || (__p += '<form method="post" class="share_form email_form" id="share_email_' + (null == (__t = post_id) ? "" : _.escape(__t)) + '" novalidate><div class="form_wrapper"><div class="share_label" data-embed-label="' + (null == (__t = __("Embed")) ? "" : _.escape(__t)) + '"></div><span class="cancel service icon_arrow_thin_left"></span><div class="input_group"><ul><li><input type="email" class="email_address" name="email_address" maxlength="100" placeholder="' + (null == (__t = __("Email")) ? "" : _.escape(__t)) + '" title="' + (null == (__t = __("Email")) ? "" : _.escape(__t)) + '"> <input type="hidden" name="post_id" value="' + (null == (__t = post_id) ? "" : _.escape(__t)) + '"> <input type="hidden" name="tumblelog_name" value="' + (null == (__t = tumblelog_name) ? "" : _.escape(__t)) + '"> <span class="cancel icon_close"></span></li><li><textarea name="message" class="share_message" maxlength="255" placeholder="' + (null == (__t = __("Message (Optional)")) ? "" : _.escape(__t)) + '" title="' + (null == (__t = __("Message (Optional)")) ? "" : _.escape(__t)) + '"></textarea><div class="character_count">140</div></li></ul></div>', show_embed && (__p += '<div class="embed_code_wrapper"><textarea name="embed_code" class="embed_code_text" spellcheck="false" readonly="readonly">' + (null == (__t = embed_code) ? "" : _.escape(__t)) + "</textarea></div>"), __p += "", has_user && (__p += '<div class="reply_to" title="' + (null == (__t = __("Let them reply to")) ? "" : _.escape(__t)) + '"><div class="menu_item_option"><label class="binary-switch"><input type="checkbox" id="allow_reply_to_' + (null == (__t = post_id) ? "" : _.escape(__t)) + '" class="reply_to_input" name="allow_reply_to"> <span class="binary-switch-track"></span> <span class="binary-switch-button"></span></label></div><label class="menu_item_label" for="allow_reply_to_' + (null == (__t = post_id) ? "" : _.escape(__t)) + '">' + (null == (__t = __("Let them reply to <span>")) ? "" : __t) + "</label></div>"), __p += '<div class="error_status"></div><button type="submit" class="flat-button blue email_submit" data-label-sending="' + (null == (__t = __("Sending...")) ? "" : _.escape(__t)) + '" data-label="' + (null == (__t = __("Send")) ? "" : _.escape(__t)) + '" disabled="disabled">' + (null == (__t = __("Send")) ? "" : _.escape(__t)) + '</button></div></form><div class="status" data-sent="' + (null == (__t = __("Sent!")) ? "" : _.escape(__t)) + '" data-error="' + (null == (__t = __("Error!")) ? "" : _.escape(__t)) + '"><span class="status_message">' + (null == (__t = __("Sent!")) ? "" : _.escape(__t)) + "</span></div>"), __p += "</div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  509: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/view"), a = t("prima/events"), r = t("prima/lib/domeventor"), l = t("prima/utils/bindendevent").transition, h = t("../templates/feature-help-popover.tpl"), c = {
      TOP: 1,
      BOTTOM: 2,
      LEFT: 4,
      RIGHT: 8,
      CENTER: 16
    }, d = n.extend({
      className: "tour_guide",
      template: h,
      events: {"click .glass": "_onHide", "click .ok_button": "_onDismiss"},
      _onDismiss: function (t) {
        this.trigger("dismiss"), this._onHide(t)
      },
      _onHide: function (t) {
        t.preventDefault(), this.hide(), this.trigger("hide")
      },
      _onScroll: function (t) {
        o.get(this.config, "isFadeOnScroll", !0) && (this.scrollPosition = t, this.isDim && this.fadeGlass())
      },
      initialize: function (t) {
        this.$body = s("body"), this.$highlighted = s(), this.$glass = s(), this.$popover = s(), this.isDim = !1, this.isOpen = !1, this.openScrollPosition = 0, this.highlightedClass = "", this.scrollPosition = r.rect(), this.listenTo(a, "DOMEventor:flatscroll", this._onScroll)
      },
      setHighlighted: function (t, e) {
        this.$highlighted = t, this.highlightedClass = e
      },
      show: function (t) {
        return this.config = t, this.$el.html(this.template(t)), this.$body.addClass("tour_guide_open").append(this.$el), this.isOpen = !0, this.config.pinnedTarget && (this.$highlighted = s(this.config.pinnedTarget)), this.config.highlightedClass && (this.highlightedClass = this.config.highlightedClass), this.config.glass && (this.$el.addClass("dim"), this.isDim = !0), this.config.name && this.$body.attr("data-help-popover", this.config.name), this.config.glass && this.$highlighted.length && this.$highlighted.addClass("tour_guide_element").addClass(this.highlightedClass), this.$highlighted.length ? this.openScrollPosition = this.scrollPosition.windowScrollTop : this.openScrollPosition = this.scrollPosition.windowScrollTop + .5 * this.scrollPosition.windowHeight, this.$glass = this.$(".glass"), this.$popover = this.$(".popover"), this.config.className && this.$popover.addClass(this.config.className), this.delegateEvents(), this.positionPopover(), this
      },
      hide: function () {
        this.$el.addClass("removing"), this.$body.addClass("help-popover-removing"), l(this.$el, this.remove.bind(this))
      },
      remove: function () {
        this.undelegateEvents(), this.isDim = !1, this.isOpen = !1, this.config = null, this.$el.removeClass("dim removing").remove(), this.$body.removeClass("tour_guide_open help-popover-removing").removeAttr("data-help-popover"), this.$highlighted.length && (this.$highlighted.off(".tour_guide_highlighted").removeClass("tour_guide_element").removeClass(this.highlightedClass), this.$highlighted = s(), this.highlightedClass = ""), this.trigger("removed")
      },
      fadeGlass: function () {
        var t = (this.openScrollPosition - this.scrollPosition.windowScrollTop) / this.scrollPosition.windowHeight, e = t > 0 ? 1 - t : t + 1;
        return 0 >= e ? (this.isDim = !1, this.hide(), void this.trigger("hide")) : void this.$glass.css("opacity", e)
      },
      positionPopover: function () {
        if (this.$popover.length) {
          var t = this.$popover.outerHeight(!0), e = this.$popover.outerWidth(!0);
          if (this.$highlighted.length) {
            var i, o, n = this.config.position, a = this.$highlighted.offset(), r = this.$highlighted.outerWidth(), l = a.left, h = a.top, d = h - t < this.scrollPosition.windowScrollTop + 80;
            if (n || (n = c.CENTER | d ? c.BOTTOM : c.TOP), n & c.LEFT ? (o = l, this.$popover.addClass("horizontal-left")) : n & c.RIGHT ? (o = l - e + r, this.$popover.addClass("horizontal-right")) : (o = l - .5 * (e - r), this.$popover.addClass("horizontal-center")), this.$popover.css("left", o), this.config.fixed_position)return this.$popover.css("position", "fixed"), void(s("#site_notice").length && this.$popover.css("margin-top", "+=" + s("#site_notice").outerHeight() + "px"));
            n & c.TOP ? (i = h - t, this.$popover.addClass("vertical-top")) : (i = h + this.$highlighted.outerHeight(), this.$popover.addClass("vertical-bottom")), this.$popover.css("top", i)
          } else this.$popover.addClass("centered").css({
            top: .5 * this.scrollPosition.windowHeight - .5 * t,
            left: .5 * this.scrollPosition.windowWidth - .5 * e
          })
        }
      },
      getPopoverElement: function () {
        return this.$popover ? this.$popover.get(0) : void 0
      },
      getGlassElement: function () {
        return this.$glass
      }
    }, {POSITION: c});
    e.exports = d
  }, {
    "../templates/feature-help-popover.tpl": 506,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/domeventor": 550,
    "prima/utils/bindendevent": 593,
    "prima/view": 612
  }],
  510: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/events"), a = t("prima/mixins/popoverbase"), r = t("prima/lib/data"), l = t("../templates/message-controls-popover.tpl"), h = o.extend({
      className: "popover--message-controls-popover",
      mixins: [a],
      template: l,
      events: {
        'click [data-action="delete"]': "_delete",
        'click [data-action="block"]': "_block",
        'click [data-action="flag"]': "_flag"
      },
      initialize: function (t) {
        this.options = s.extend({}, t), this.showFlagAndBlock = this.options.blockString && this._notUsersOwnBlog(), this.post = t.post
      },
      _getSender: function () {
        return this.options.blockString && -1 === this.options.blockString.indexOf(":") ? this.options.blockString : !1
      },
      _notUsersOwnBlog: function () {
        var t = this._getSender();
        if (t) {
          var e = r.get("Context/userinfo/channels");
          return e = s.pluck(e, "name"), !s.includes(e, t)
        }
        return !0
      },
      _delete: function (t) {
        t.preventDefault(), this.post["delete"](t)
      },
      _block: function (t) {
        t.preventDefault(), this.post.block(t)
      },
      _flag: function (t) {
        t.preventDefault();
        var e = {mode: "message", post: this.post.model}, i = this._getSender();
        i && (e.sender = i), n.trigger("abuseform:open", e)
      },
      render: function () {
        return this.$el.html(this.template()), this
      },
      teardown: function () {
        return this.$el.remove(), this
      }
    });
    e.exports = h
  }, {
    "../templates/message-controls-popover.tpl": 507,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/data": 548,
    "prima/mixins/popoverbase": 583,
    "prima/view": 612
  }],
  511: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/view"), a = t("prima/events"), r = t("prima/utils/cookie"), l = t("prima/mixins/popoverbase"), h = t("../templates/share-popover.tpl"), c = t("../models/share-popover"), d = t("app/models/post"), a = t("prima/events"), u = t("prima/mixins/generate-logging-data"), p = n.extend({
      className: "popover--post-share-popover",
      mixins: [l, u],
      template: h,
      defaults: {popoverData: {}, forceSocialFallback: !1, forceEmailFallback: !1},
      events: {
        "click .embed_post": "__embedPostClick",
        "click .share_email": "__emailTriggerClick",
        "click .share_facebook": "__shareFacebookClick",
        "click .share_pinterest": "__sharePinterestClick",
        "click .share_twitter": "__shareTwitterClick",
        "click .share_reddit": "__shareRedditClick",
        "click .share_permalink": "__sharePermalinkClick",
        "click .flag_post": "__flagPostClick",
        "click .cancel": "__cancelClick",
        "click .popover_menu_item_anchor": "__checkIfPremiumPost",
        "input .email_address": "__emailFormInput",
        "input .twitter .share_message": "__shareTwitterInput",
        "change .reply_to_input": "__replyToChange",
        "keydown .share_form": "__submitKeydown",
        "submit .share_form": "__submit",
        "focus input": "__suspendKeyCommands",
        "focus textarea": "__suspendKeyCommands",
        "blur textarea": "__resumeKeyCommands",
        "blur input": "__resumeKeyCommands"
      },
      __embedPostClick: function (t) {
        t.preventDefault(), a.trigger("dashboard-share:embed"), this._showEmbedCode()
      },
      __emailTriggerClick: function (t) {
        t.preventDefault(), a.trigger("dashboard-share:email"), this._toggleEmailForm()
      },
      __shareFacebookClick: function (t) {
        t.preventDefault(), a.trigger("dashboard-share:facebook"), this._shareFacebook()
      },
      __sharePinterestClick: function (t) {
        t.preventDefault(), a.trigger("dashboard-share:pinterest"), this._sharePinterest()
      },
      __shareRedditClick: function (t) {
        t.preventDefault(), a.trigger("dashboard-share:reddit"), this._shareReddit()
      },
      __shareTwitterClick: function (t) {
        t.preventDefault(), a.trigger("dashboard-share:twitter"), this._shareTwitter()
      },
      __sharePermalinkClick: function () {
        this.resetAndHide()
      },
      __flagPostClick: function (t) {
        t.preventDefault(), this.onClickOutside(), a.trigger("abuseform:open", {mode: "post", post: this.model})
      },
      __cancelClick: function (t) {
        t.preventDefault(), this._cancelOrClose()
      },
      __emailFormInput: function () {
        var t = p.validateEmail(this.$emailAddress.val());
        this.$submitButton.attr("disabled", !t)
      },
      __shareTwitterInput: function (t) {
        t.preventDefault();
        var e = p.validateTwitter(this.$shareMessage.val(), this.$characterCount);
        this.$submitButton.attr("disabled", !e)
      },
      __replyToChange: function (t) {
        var e = s(t.currentTarget).is(":checked");
        r.set("share_popover_reply_to", e, 31536e3)
      },
      __submitKeydown: function (t) {
        13 === t.keyCode && (t.ctrlKey || t.metaKey || t.altKey) && (t.preventDefault(), t.stopPropagation(), this.submitForm())
      },
      __submit: function () {
        return this.submitForm(), !1
      },
      __submitSuccess: function () {
        this.$status.show(), this._fadeoutPopover()
      },
      __submitError: function () {
        this.$errorStatus.html(this.errorText), this.$submitButton.html(this.$submitButton.data("label")), this.$submitButton.attr("disabled", !1), this.$errorStatus.addClass("active")
      },
      __suspendKeyCommands: function () {
        a.trigger("keycommands:suspend indashblog:keycommands:suspend")
      },
      __resumeKeyCommands: function () {
        a.trigger("keycommands:resume indashblog:keycommands:resume")
      },
      __checkIfPremiumPost: function () {
        var t = s("[data-id=" + this.options.popoverData.post_id + "]").data("json");
        if (t && t.pt) {
          var e = new d(t), i = this.loggingData({userAction: "share"});
          i && i.modelData && (i.modelData = e.toJSON()), a.trigger("useraction:explore_click:share", {
            model: e,
            loggingData: i
          })
        }
      },
      _shareTwitter: function () {
        !this.options.forceSocialFallback && this.twitterUsername ? (this.$serviceCancel.show(), this.$submitButton.html("Tweet"), this.$shareForm.data("type", "twitter"), this.$shareLabel.text("@" + this.twitterUsername), this.$shareMessage.val(" [URL]"), this.$shareForm.addClass("active"), this.$shareOptions.removeClass("active"), this.$shareMessage.get(0).setSelectionRange(0, 0), this.$shareMessage.attr("placeholder", ""), this.$submitButton.attr("disabled", !1), this.$shareForm.addClass("twitter"), p.validateTwitter(this.$shareMessage.val(), this.$characterCount), this.$shareForm.hasClass("active") && (this.$shareMessage.focus(), this.$shareMessage.get(0).setSelectionRange(0, 0))) : this._shareTwitterFallback()
      },
      _shareTwitterFallback: function () {
        window.open("https://twitter.com/intent/tweet?url=" + encodeURIComponent(this.tinyUrl || this.url), "twitter-share-dialog", "width=626,height=258");
        var t = this._getGenericShareData();
        this.model.shareTwitter(t), this.resetAndHide()
      },
      _shareFacebook: function () {
        !this.options.forceSocialFallback && this.hasFacebook ? this.model.facebookStatus().done(o.bind(this._shareFacebookSuccess, this)).fail(o.bind(this._shareFacebookFallback, this)) : this._shareFacebookFallback()
      },
      _shareFacebookSuccess: function (t) {
        t ? (this.$serviceCancel.show(), this.$submitButton.html(this.$submitButton.data("label")), this.$shareForm.data("type", "facebook"), this.$shareLabel.text(t), this.$submitButton.attr("disabled", !1), this.$shareForm.addClass("facebook"), this.$shareOptions.toggleClass("active"), this.$shareForm.toggleClass("active"), this.$shareForm.hasClass("active") && this.$shareMessage.focus()) : this._shareFacebookFallback()
      },
      _shareFacebookFallback: function () {
        window.open("https://www.facebook.com/sharer/sharer.php?u=" + encodeURIComponent(this.url), "facebook-share-dialog", "width=626,height=436");
        var t = this._getGenericShareData();
        this.model.shareFacebook(t), this.resetAndHide()
      },
      _sharePinterest: function () {
        var t = this.model.get("pinterest_share_window");
        window.open(t.url, t.name, t.dimensions);
        var e = this._getGenericShareData();
        this.model.sharePinterest(e), this.resetAndHide()
      },
      _shareReddit: function () {
        window.open("https://reddit.com/submit?url=" + this.model.get("post_url"), "reddit-share-dialog", "scrollbars=1,width=860,height=600");
        var t = this._getGenericShareData();
        this.model.shareReddit(t), this.resetAndHide()
      },
      _toggleEmailForm: function () {
        return this.options.forceEmailFallback || !this.model.get("has_user") ? void this._emailFormFallback() : (this.$submitButton.html(this.$submitButton.data("label")), this.$shareForm.data("type", "email"), this.$shareOptions.toggleClass("active"), this.$shareForm.toggleClass("active"), this.$replyTo.addClass("active"), void(this.$shareForm.hasClass("active") && this.$emailAddress.length && this.$emailAddress.focus()))
      },
      _emailFormFallback: function () {
        var t = this._getGenericShareData();
        this.model.shareEmail(t);
        var e = "mailto:?body=" + this.url;
        if (this.model.get("embed_key")) {
          var i = window.open();
          i.document.write('<html><script>location.href = "' + e + '";setTimeout(function(){window.close();},500);</script></html>'), i.document.close()
        } else window.location.href = e;
        this.resetAndHide()
      },
      _showEmbedCode: function () {
        this.$serviceCancel.show(), this.$shareForm.data("type", "embed"), this.$shareLabel.text(this.$shareLabel.data("embed-label")), this.$shareForm.addClass("active"), this.$shareOptions.removeClass("active"), this.$shareMessage.attr("placeholder", ""), this.$shareForm.addClass("embed");
        var t = this.$shareForm.find(".embed_code_text");
        t.length && (t.click(function () {
          t.select()
        }), setTimeout(function () {
          t.trigger("click")
        }, 100))
      },
      _fadeoutPopover: function () {
        setTimeout(o.bind(function () {
          this.$el.fadeOut(150, o.bind(this.resetAndHide, this))
        }, this), 1250)
      },
      _cancelOrClose: function () {
        var t = this.$emailAddress.val() || "";
        "email" === this.$shareForm.data("type") && t.length ? (this.$emailAddress.val(""), this.$submitButton.attr("disabled", !0)) : this.resetForm()
      },
      _getGenericShareData: function () {
        return [{name: "post_id", value: this.model.get("post_id")}, {
          name: "tumblelog_name",
          value: this.model.get("tumblelog_name")
        }, {name: "share_fallback", value: !0}]
      },
      initialize: function (t) {
        this.options = o.extend({}, this.defaults, t), this.model = new c(this.options.popoverData), this.listenTo(this.model, "error", this.__submitError), this.listenTo(this.model, "success", this.__submitSuccess)
      },
      cacheSelectors: function () {
        this.$shareForm = this.$(".share_form"), this.$shareLabel = this.$(".share_label"), this.$replyTo = this.$(".reply_to"), this.$shareOptions = this.$(".share_options"), this.$submitButton = this.$("button.email_submit"), this.$emailAddress = this.$(".email_address"), this.$shareMessage = this.$(".share_message"), this.$embedCode = this.$(".embed_code_text"), this.$characterCount = this.$(".character_count"), this.$serviceCancel = this.$(".cancel.service"), this.$status = this.$(".status"), this.$errorStatus = this.$(".error_status"), this.$statusMessage = this.$(".status_message"), this.$replyToInput = this.$(".reply_to_input"), this.sentText = this.$status.data("sent") || "", this.errorText = this.$status.data("error") || "", this.$(".share_twitter").length && (this.twitterUsername = this.$(".share_twitter").data("twitter-username")), this.$(".share_facebook").length && (this.hasFacebook = this.$(".share_facebook").data("has-facebook")), this.url = this.$shareOptions.data("post-url"), this.tinyUrl = this.$shareOptions.data("post-tiny-url"), this.tumblelogName = this.$shareOptions.data("tumblelog-name"), this.embedKey = this.$shareOptions.data("embed-key"), this.postId = this.$shareOptions.data("post-id"), this.rootId = this.$shareOptions.data("root-id")
      },
      render: function () {
        return this.$el.html(this.template(this.model.toJSON())), this.cacheSelectors(), this.$replyToInput.prop("checked", "true" === r.get("share_popover_reply_to")), this
      },
      resetForm: function () {
        this.$serviceCancel.hide(), this.$submitButton.html(this.$submitButton.data("label")), this.$submitButton.attr("disabled", !0), this.$emailAddress.val(""), this.$shareMessage.val(""), this.$shareMessage.attr("placeholder", this.$shareMessage.attr("title")), this.$shareOptions.addClass("active"), this.$shareForm.removeClass("active"), this.$shareForm.removeClass("facebook"), this.$shareForm.removeClass("twitter"), this.$shareForm.removeClass("embed"), this.$status.hide(), this.$statusMessage.html(this.sentText), this.$replyTo.removeClass("active"), this.$errorStatus.removeClass("active"), this.$el.show()
      },
      resetAndHide: function () {
        this.resetForm(), this.teardown()
      },
      submitForm: function () {
        var t = this.$shareForm.serializeArray();
        switch (this.$shareForm.data("type")) {
          case"facebook":
            this.model.shareFacebook(t);
            break;
          case"twitter":
            this.model.shareTwitter(t);
            break;
          default:
            this.model.shareEmail(t)
        }
        this.$submitButton.attr("disabled", !0), this.$submitButton.html(this.$submitButton.data("label-sending"))
      },
      teardown: function () {
        return this.__resumeKeyCommands(), this.$el.remove(), this
      }
    }, {
      placeholderSupport: function () {
        var t = document.createElement("input");
        return "placeholder" in t
      }, validateEmail: function (t) {
        var e = /\S+@\S+\.\S+/;
        return e.test(t)
      }, validateTwitter: function (t, e) {
        var i = t.match(/\[URL\]/gi), s = i ? 24 * i.length : 0, o = 140 - t.length - s, n = e && e.length ? e : !1;
        return n && (n.removeClass("character-limit").html(o),
        10 > o && n.addClass("character-limit")), 0 > o || 140 === o ? !1 : !0
      }
    });
    e.exports = p
  }, {
    "../models/share-popover": 505,
    "../templates/share-popover.tpl": 508,
    "app/models/post": 462,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/generate-logging-data": 580,
    "prima/mixins/popoverbase": 583,
    "prima/utils/cookie": 598,
    "prima/view": 612
  }],
  512: [function (t, e, i) {
    "use strict";
    function s(t) {
      return "string" == typeof t || t && "object" == typeof t && "[object String]" === u.call(t) || !1
    }

    function o() {
      var t = new m;
      return t.cid = g, g += 1, _[t.cid] = t, t
    }

    function n(t, e) {
      for (var i, s = f.length - 1; s >= 0; s--)f[s].message_callback(t, e);
      for (s = v.length - 1; s >= 0; s--)i = v[s], i && i.shouldRespond && i.shouldRespond(t, e) && i.cb(t, e)
    }

    function a(t) {
      if (t || (t = {}), !(h && h.stringify && h.parse))throw"Must have JSON parsing and stringify";
      if (t.iframe && (t.window = t.iframe.contentWindow, !t.origin)) {
        var e = t.iframe.src, i = e.match(/^(http(?:s)?:\/\/[\w_\-\.]+(?::\d+)?)\/?/);
        i && (t.origin = i[1])
      }
      this.namespace = t.namespace ? t.namespace + ":" : "", this.origin = t.origin || "*", this.responders = {
        _method_callback_responder: b,
        _syn: d(this._syn, this)
      }, this._on_connected = new p, this._unanswered_calls = {}, this.on_connection(d(this.enable_sending_post_message, this)), f.push(this), t.window && this.setWindow(t.window)
    }

    function r(t, e, i) {
      i || (i = this.origin), t.postMessage(e, i)
    }

    var l = t("prima/utils/clean-window-object"), h = l("JSON", function (t) {
      return t && t.stringify
    }), c = [].slice, d = function (t, e) {
      return function () {
        return t.apply(e, arguments)
      }
    }, u = Object.prototype.toString, p = t("./utils/one_time_event"), m = t("./utils/deferred"), g = 1, _ = {}, f = [], v = [];
    !function () {
      var t = window.addEventListener ? "addEventListener" : "attachEvent", e = window[t], i = "attachEvent" === t ? "onmessage" : "message";
      e(i, function (t) {
        var e;
        if ("string" == typeof t.data) {
          try {
            t.data && "{" === t.data[0] && (e = h.parse(t.data))
          } catch (i) {
          }
          e && e.method && n(t, e)
        }
      }, !1)
    }();
    var b = function (t) {
      if (t.cid_response && t.cid_response in _) {
        var e = _[t.cid_response];
        e.resolve.call(null, this, t.response), delete _[t.cid_response]
      }
    };
    a.prototype.setWindow = function (t) {
      if (t) {
        this.window = t;
        var e = this.call("_syn");
        e.then(d(function (t, e) {
          "ack" === e && this._is_connected()
        }, this))
      }
    }, a.on = function (t, e) {
      var i;
      i = "*" === t ? function () {
        return !0
      } : "*" === t[t.length - 1] ? function (e, i) {
        return 0 === i.method.indexOf(t.substring(0, t.length - 2))
      } : function (e, i) {
        return i.method === t
      }, v.push({shouldRespond: i, cb: e})
    }, a.off = function (t) {
      for (var e, i = v.length - 1; i >= 0; i--)if (v[i].cb === t) {
        e = i;
        break
      }
      return e && e > -1 ? (v.splice(e, 1), !0) : !1
    }, a.prototype.match_origin = function (t) {
      return "*" === this.origin ? !0 : this.origin === t
    }, a.prototype.message_callback = function (t, e) {
      var i;
      if ((!this.window || t.source === this.window) && this.match_origin(t.origin)) {
        if (e.method && e.method.slice(0, this.namespace.length) === this.namespace && (i = e.method.slice(this.namespace.length, e.method.length)), e.args && s(e.args))try {
          e.args = h.parse(e.args)
        } catch (o) {
          return
        }
        this.call_responder(i, t, e)
      }
    }, a.prototype.call_responder = function (t, e, i) {
      var s, o;
      if (t) {
        if (i.args || (i.args = []), o = this.responders[t], !o)return this._unanswered_calls[t] || (this._unanswered_calls[t] = []), void this._unanswered_calls[t].push(arguments);
        s = o.apply(e, i.args), i.cid && "_method_callback_responder" !== t && this.send_to_window(e.source, "_method_callback_responder", {
          cid_response: i.cid,
          response: s
        })
      }
    }, a.prototype._syn = function () {
      return this._is_connected(), "ack"
    }, a.prototype._is_connected = function () {
      this.connected || (this.connected = !0, this._on_connected.trigger(this))
    }, a.prototype.on_connection = function (t) {
      return this._on_connected.push.apply(this._on_connected, arguments), this
    }, a.prototype.method = function y(t) {
      var e = this, y = function () {
        var i = 1 <= arguments.length ? c.call(arguments, 0) : [];
        return i.unshift(t), e.send.apply(e, i)
      };
      return y
    }, a.prototype.call = function () {
      var t = 1 <= arguments.length ? c.call(arguments, 0) : [];
      return this.window ? (t.unshift(this.window), this.call_on_window.apply(this, t)) : void console.warn("no window specified on channel")
    }, a.prototype.call_on_window = function (t, e) {
      var i = 3 <= arguments.length ? c.call(arguments, 2) : [], s = o();
      try {
        var n = h.stringify({method: this.namespace + e, args: i, cid: s.cid});
        "_syn" === e || "_method_callback_responder" === e ? r.call(this, t, n) : this.send_post_message(t, n)
      } catch (a) {
        s.reject(a)
      }
      return s.promise()
    }, a.prototype.send = function () {
      var t = 1 <= arguments.length ? c.call(arguments, 0) : [];
      return this.window ? (t.unshift(this.window), this.send_to_window.apply(this, t)) : void console.warn("no window specified on channel")
    }, a.prototype.send_to_window = function (t, e) {
      var i = 3 <= arguments.length ? c.call(arguments, 2) : [], s = h.stringify({method: this.namespace + e, args: i});
      "_syn" === e || "_method_callback_responder" === e ? r.call(this, t, s) : this.send_post_message(t, s)
    }, a.prototype.send_post_message = function () {
      this._delayed_sent_messages || (this._delayed_sent_messages = []), this._delayed_sent_messages.push(arguments)
    }, a.prototype.enable_sending_post_message = function () {
      if (this.send_post_message = r, this._delayed_sent_messages) {
        for (var t = 0; t < this._delayed_sent_messages.length; t += 1)r.apply(this, this._delayed_sent_messages[t]);
        delete this._delayed_sent_messages
      }
    }, a.prototype.listening_to = function (t) {
      return t in this.responders
    }, a.prototype.listen_to = function (t, e, i) {
      if (s(t)) {
        if (t in this.responders)return void console.warn("already listening to this method, turn it off first");
        if (i && (e = d(e, i)), this.responders[t] = e, this._unanswered_calls[t]) {
          var o, n = this._unanswered_calls[t];
          delete this._unanswered_calls[t];
          for (var a = 0; a < n.length; a += 1)o = n[a], this.call_responder.apply(this, o)
        }
      } else {
        var r = t;
        for (t in r)r.hasOwnProperty(t) && this.listen_to(t, r[t], i)
      }
    }, a.prototype.stop_listen_to = function (t) {
      return "_method_callback_responder" === t ? void console.warn("cannot disable the method callback responder") : void delete this.responders[t]
    }, a.prototype.ensureChannelConnection = function (t) {
      this.send_to_window(t, "_syn")
    }, e.exports = a
  }, {"./utils/deferred": 513, "./utils/one_time_event": 514, "prima/utils/clean-window-object": 596}],
  513: [function (t, e, i) {
    "use strict";
    function s() {
      this._on_resolved = new a, this._on_rejected = new a, this.then = n(this.then, this), this.fail = n(this.fail, this), this.resolve = n(this.resolve, this), this.reject = n(this.reject, this)
    }

    var o = [].slice, n = function (t, e) {
      return function () {
        return t.apply(e, arguments)
      }
    }, a = t("./one_time_event");
    s.prototype.then = function () {
      return this._on_resolved.push.apply(this._on_resolved, arguments), this
    }, s.prototype.success = s.prototype.then, s.prototype.fail = function () {
      return this._on_resolved.push.apply(this._on_rejected, arguments), this
    }, s.prototype.resolve = function () {
      return this.resolved || this.rejected ? void 0 : (this._on_resolved.trigger.apply(this._on_resolved, arguments), this.resolved = !0, this)
    }, s.prototype.reject = function () {
      return this.resolved || this.rejected ? void 0 : (this._on_rejected.trigger.apply(this._on_rejected, arguments), this.rejected = !0, this)
    }, s.prototype.reject_timeout = function () {
      var t = 1 <= arguments.length ? o.call(arguments, 0) : [], e = t.shift();
      return setTimeout(n(function () {
        this.reject.apply(this, t)
      }, this), e), this
    }, s.prototype.promise = function () {
      function t() {
        var t = this;
        this.fail = function () {
          return e.fail.apply(e, arguments), t
        }, this.then = function () {
          return e.then.apply(e, arguments), t
        }, this.success = this.then, this.reject_timeout = function () {
          return e.reject_timeout.apply(e, arguments), t
        }, this.cid = e.cid
      }

      var e = this;
      return new t
    }, e.exports = s
  }, {"./one_time_event": 514}],
  514: [function (t, e, i) {
    "use strict";
    function s() {
      this.length = 0
    }

    var o = [].slice, n = [].push;
    s.prototype = {slice: o, indexOf: Array.prototype.indexOf}, s.prototype.push = function () {
      if (this.triggered_with)for (var t = 1 <= arguments.length ? o.call(arguments, 0) : [], e = 0; e < t.length; e += 1)t[e].apply(null, this.triggered_with);
      return n.apply(this, arguments)
    }, s.prototype.trigger = function () {
      var t = 1 <= arguments.length ? o.call(arguments, 0) : [], e = this.length;
      this.triggered_with = t;
      for (var i = 0; e > i; i += 1)this[i].apply(null, this.triggered_with);
      return this
    }, e.exports = s
  }, {}],
  515: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "abuseform",
      events: {"abuseform:*": "handleEvent"},
      logEnv: {location: document.location.pathname},
      handleEvent: function (t, e) {
        this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  516: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "activity_links",
      logOptions: {init_event: !1},
      logEnv: {location: document.location.pathname},
      events: {"activityLinks:*": "handleEvent"},
      handleEvent: function (t, e) {
        this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  517: [function (t, e, i) {
    "use strict";
    var s = t("backbone"), o = t("lodash"), n = t("prima/class"), a = t("prima/events"), r = t("prima/lib/logger"), l = [];
    l.push(t("prima/lib/loglady/endpoints/cslogger"));
    var h = /^\/(.+)\/([gimy]*)$/, c = n.extend({
      constructor: function () {
        this._eventHandlers = [], this.setupEndpoints(), this.initialize();
        var t = o.result(this, "events") || {};
        o.forEach(t, this._addEventHandlerByString, this);
        var e = o.result(this, "eventBus");
        this.listenTo(e, "all", this._handleEvent), r.log("LogLady", "[instrument]", this.logKey)
      }, logSpots: l, eventBus: a, _addEventHandlerByString: function (t, e) {
        var i, s = e.match(h);
        if (s) {
          var o = new RegExp(s[1], s[2]);
          i = function (t) {
            var e = t.match(o);
            if (e) {
              for (var i = new Array(e.length - 1), s = 0; s < e.length; s += 1)s > 0 && (i[s - 1] = e[s]);
              return i
            }
          }
        } else if ("*" === e[e.length - 1]) {
          var n = e.substring(0, e.length - 1);
          i = function (t) {
            var e = t.indexOf(n);
            return 0 === e ? [t.substring(n.length, t.length)] : void 0
          }
        } else i = function (t) {
          return t === e ? [t] : null
        };
        this._addEventHandler(t, i)
      }, _addEventHandler: function (t, e) {
        this._eventHandlers.push({method: t, matcher: e})
      }, _handleEvent: function (t, e) {
        for (var i, s, n, a = this._eventHandlers.length - 1; a >= 0; a--)i = this._eventHandlers[a], n = i.callback || this[i.method], n && (s = i.matcher.call(this, t, e), o.isArray(s) && (e && e.loggingData && s.push(o.cloneDeep(e.loggingData)), n.apply(this, s)))
      }, setupEndpoints: function () {
        var t = o.result(this, "logSpots");
        this.loggers = o(t).map(function (t) {
          return t(this)
        }, this).compact().value()
      }, initialize: o.noop, log: function () {
        for (var t = this.loggers.length - 1; t >= 0; t--) {
          var e = this.loggers[t];
          e.trigger.apply(e, arguments)
        }
      }
    }, {
      start: function () {
        return this._setupInstance || (this._setupInstance = new this), this._setupInstance
      }
    });
    o.extend(c.prototype, s.Events), e.exports = c
  }, {
    backbone: "5kFNoY",
    lodash: "MicNly",
    "prima/class": 543,
    "prima/events": 546,
    "prima/lib/logger": 553,
    "prima/lib/loglady/endpoints/cslogger": 558
  }],
  518: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "blocks",
      events: {"blocks:*": "handleEvent"},
      logEnv: {location: document.location.pathname},
      handleEvent: function (t, e) {
        this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  519: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "dashboard_sharing",
      events: {"dashboard-share:*": "handleEvent"},
      logEnv: {location: document.location.pathname},
      handleEvent: function (t, e) {
        e = e || {}, this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  520: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("logs/instruments/base"), n = o.extend({
      logKey: "dashboard_embed",
      logOptions: {init_event: !1},
      events: {"/^post:((?:un)?docked)$/": "handleEvent", "post:embed:stateChange": "logStateChange"},
      handleEvent: function (t, e) {
        var i = s.extend({}, e);
        i.postData && (i.post_id = i.postData.id, i.tumblelog = i.postData.tumblelog, delete i.postData), this.log(t, i)
      },
      logStateChange: function (t, e) {
        if (!s.isEmpty(e) && e.state && e.postID && e.service) {
          if ("tumblr" === e.service)return;
          this.log(e.state, {service: e.service, post_id: e.postID})
        }
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "logs/instruments/base": 517}],
  521: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "explore_trending",
      logOptions: {init_event: !1},
      events: {"explore-trending:*": "log"},
      logEnv: {location: document.location.pathname}
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  522: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "external_inline_images",
      logOptions: {init_event: !1},
      events: {"external-inline-images:*": "handleEvent"},
      logEnv: {location: document.location.pathname},
      handleEvent: function (t, e) {
        this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  523: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "header_search",
      logEnv: {referrer: document.location.pathname},
      events: {"header_search:*": "log"}
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  524: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "helpform",
      events: {"helpform:*": "handleEvent"},
      logEnv: {location: document.location.pathname},
      handleEvent: function (t, e) {
        this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  525: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "keycommands_trigger",
      events: {"keycommands:*": "handleEvent"},
      initialize: function () {
        this.hasLoggedJK = !1
      },
      handleEvent: function (t, e) {
        if ("jk" === t) {
          if (this.hasLoggedJK)return;
          this.hasLoggedJK = !0
        }
        this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  526: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "linkpost_interactions",
      logOptions: {init_event: !1},
      events: {"linkpost:*": "handleEvent"},
      logEnv: {location: document.location.pathname},
      handleEvent: function (t, e) {
        this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  527: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = t("prima/lib/loglady/endpoints/lslogger/lslogger"), n = t("prima/lib/flags"), a = s.extend({
      logKey: null,
      logSpots: [],
      events: function () {
        var t = {};
        return n.bool("little_sister_kill_switch") || (t["LSLog:*"] = "log"), t
      },
      log: function (t, e) {
        if (e && e.pt) {
          var i = {pt: e.pt, eventName: t};
          o.log(e.pt).trigger(t, i), e.is_ad && o.flush()
        }
      }
    });
    e.exports = a
  }, {"logs/instruments/base": 517, "prima/lib/flags": "f/LVtH", "prima/lib/loglady/endpoints/lslogger/lslogger": 565}],
  528: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "loginregister",
      events: {"loginregister:*": "handleEvent"},
      initialize: function () {
        this.hasStartedFunnel = !1
      },
      logEnv: {actionType: "/login" === document.location.pathname ? "login" : "register", captchaType: "recaptcha"},
      handleEvent: function (t, e) {
        if ("beginFlow" === t) {
          if (this.hasStartedFunnel)return;
          this.hasStartedFunnel = !0
        }
        this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  529: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "messaging_interactions",
      logOptions: {init_event: !1},
      events: {"messaging-interaction:*": "handleEvent"},
      logEnv: {location: document.location.pathname},
      handleEvent: function (t, e) {
        this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  530: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = t("prima/lib/data"), n = s.extend({
      logKey: "verified_onboarding_blogs",
      logEnv: {context: o.get("Context/name"), location: document.location.pathname},
      logOptions: {init_event: !1},
      events: {"verifiedBlogs:*": "log"}
    });
    e.exports = n
  }, {"logs/instruments/base": 517, "prima/lib/data": 548}],
  531: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/data"), n = t("prima/lib/loglady/endpoints/cslogger"), a = t("prima/lib/loglady/utils/uuid"), r = t("logs/instruments/base"), l = r.extend({
      logKey: "peepr",
      logEnv: {baseSessionId: o.get("Components/LogLady/default_session"), context: o.get("Context/name")},
      events: {
        "peepr:message:*": "logMessage",
        "peepr:open": "logOpen",
        "peepr:close": "logClose",
        "peepr:log:*": "logMessage"
      },
      logMessage: function (t, e) {
        this.log(t, e.payload)
      },
      logOpen: function () {
        this.logger()
      },
      logClose: function () {
        this._logger.stop(), this._logger = null
      },
      setupEndpoints: s.noop,
      logOptions: function () {
        return {uuid: a()}
      },
      logger: function () {
        return this._logger || (this._logger = n(this)), this._logger
      },
      log: function () {
        var t = this.logger();
        t.trigger.apply(t, arguments)
      }
    });
    e.exports = l
  }, {
    lodash: "MicNly",
    "logs/instruments/base": 517,
    "prima/lib/data": 548,
    "prima/lib/loglady/endpoints/cslogger": 558,
    "prima/lib/loglady/utils/uuid": 571
  }],
  532: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "gifsearch_interactions",
      logOptions: {init_event: !1},
      events: {"gifsearch:*": "handleEvent"},
      logEnv: {location: document.location.pathname},
      handleEvent: function (t, e) {
        "unload" !== t && this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  533: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "postform_interactions",
      logOptions: {init_event: !1},
      events: {"postform-interaction:*": "handleEvent"},
      logEnv: {location: document.location.pathname},
      handleEvent: function (t, e) {
        this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  534: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "reactivation",
      logOptions: {init_event: !1},
      events: {"reactivation:*": "handleEvent"},
      logEnv: {location: document.location.pathname},
      handleEvent: function (t, e) {
        this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  535: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = t("prima/lib/data"), n = s.extend({
      logKey: "recommended_blogs",
      logEnv: {context: o.get("Context/name"), location: document.location.pathname},
      logOptions: {init_event: !1},
      events: {"recommendedBlogs:*": "log"}
    });
    e.exports = n
  }, {"logs/instruments/base": 517, "prima/lib/data": 548}],
  536: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "related_recommendations",
      logOptions: {init_event: !1},
      events: {"rapid-recommendations:*": "handleEvent"},
      logEnv: {location: document.location.pathname},
      handleEvent: function (t, e) {
        this.log(t, e)
      }
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  537: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({logKey: "roadblock", events: {"roadblock:*": "log"}});
    e.exports = o
  }, {"logs/instruments/base": 517}],
  538: [function (t, e, i) {
    "use strict";
    var s = t("logs/instruments/base"), o = s.extend({
      logKey: "tourguide_account",
      logEnv: {referrer: document.location.pathname},
      logOptions: {init_event: !1},
      events: {"TourGuideAccount:*": "log"}
    });
    e.exports = o
  }, {"logs/instruments/base": 517}],
  539: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("logs/instruments/base"), n = o.extend({
      logKey: "vendorbutton",
      logEnv: {referrer: document.location.pathname},
      events: {"VendorButton:*": "handleEvent"},
      handleEvent: function (t, e) {
        var i = s.extend({}, e);
        i.post_id = e.postData.id, i.root_post_id = e.postData.root_id, i.tumblelog = e.postData.tumblelog, delete i.postData, this.log(t, i)
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "logs/instruments/base": 517}],
  540: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("logs/instruments/base"), n = o.extend({
      logKey: "videoplayer",
      logEnv: {referrer: document.location.pathname},
      events: {
        "VideoPlayer:cacheUnload": "cacheUnloadLog",
        "VideoPlayer:timeupdate": "updateLogCache",
        "VideoPlayer:*": "handleEvent"
      },
      initialize: function () {
        this.excludedEvents = ["cacheUnload", "timeupdate"], this.unloadData = {}, s.each(this.loggers, function (t) {
          t.before_unloaded = s.bind(this.beforeUnloaded, this)
        }, this)
      },
      handleEvent: function (t, e) {
        if (!s.contains(this.excludedEvents, t)) {
          var i = s.extend({}, e);
          i.postData && (i.post_id = i.postData.id, delete i.postData), this.log(t, i)
        }
      },
      cacheUnloadLog: function (t, e) {
        this.unloadData[e.id] = e
      },
      beforeUnloaded: function (t) {
        s.each(this.unloadData, function (t) {
          this.handleEvent("unload", t)
        }, this)
      },
      updateLogCache: function (t, e) {
        var i = ["elapsed", "position"];
        this.unloadData[e.id] = s.extend(this.unloadData[e.id], s.pick(e, i))
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "logs/instruments/base": 517}],
  541: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = {
      loadedLogs: [], init: function () {
      }, startLogs: function (t) {
        s.each(t, function (t) {
          var e = t.start();
          this.loadedLogs.push(e.logKey)
        }, this)
      }, startLog: function (t) {
        this.startLogs([t])
      }
    };
    e.exports = o
  }, {lodash: "MicNly"}],
  542: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/class"), n = t("prima/lib/data"), a = t("prima/lib/logger"), r = t("prima/lib/translate"), l = t("prima/lib/templateutils"), h = t("logs/logging-manager"), c = o.extend({
      constructor: function (t) {
        s.isEmpty(t) && (t = this._getBootstrap()), this.setup(t), this.initialize()
      }, setup: function (t) {
        if (s.isEmpty(t), !1)throw new Error("No bootstrap data for the bootloader O_O");
        n.setup(t), a.log("Exec", "Bootstrap/Data"), r.setup(t.Translations), a.log("Exec", "Bootstrap/Translations"), h.init(), a.log("Exec", "Bootstrap/logs")
      }, initialize: function () {
        throw new Error("No router defined")
      }, _getBootstrap: function () {
        var t = {}, e = document.getElementById("bootloader");
        return e && (t = JSON.parse(e.getAttribute("data-bootstrap")), e.parentNode.removeChild(e)), t
      }
    });
    s.extend(s.templateSettings.imports, l), e.exports = c
  }, {
    lodash: "MicNly",
    "logs/logging-manager": 541,
    "prima/class": 543,
    "prima/lib/data": 548,
    "prima/lib/logger": 553,
    "prima/lib/templateutils": 573,
    "prima/lib/translate": 575
  }],
  543: [function (t, e, i) {
    "use strict";
    function s() {
    }

    var o = t("backbone"), n = t("./lib/extendwithmixins");
    s.extend = o.Model.extend, n.applyTo(s), e.exports = s
  }, {"./lib/extendwithmixins": 552, backbone: "5kFNoY"}],
  544: [function (t, e, i) {
    "use strict";
    var s = t("backbone").Collection, o = t("./mixins/withformkeytrue"), n = t("./lib/extendwithmixins"), s = s.extend();
    o.applyTo(s.prototype), n.applyTo(s), e.exports = s
  }, {"./lib/extendwithmixins": 552, "./mixins/withformkeytrue": 589, backbone: "5kFNoY"}],
  545: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("backbone"), n = t("./class"), a = t("./lib/data"), r = (t("./lib/logger"), t("./utils/ensure-element")), l = t("./mixins/accessor/simple"), h = ["selector", "container", "rootEl", "view", "viewOptions", "autoAppend"], c = n.extend({
      name: null,
      rootEl: null,
      selector: null,
      view: null,
      viewOptions: {},
      autoAppend: !1,
      defaults: {},
      constructor: function (t) {
        t || (t = {}), this.cid = s.uniqueId("component"), s.extend(this, s.pick(t, h));
        var e = s.result(this, "defaults"), i = s.extend({}, e, s.pick(t, s.keys(e)));
        this.attributes = {}, this.set(i, {silent: !0}), this.changed = {}, (this.autoAppend || this.selector) && this.setContainer(), this.selector || (this.selector = this.defaultSelector), this.view && this.view.prototype && this.view.prototype instanceof o.View ? this.view = new this.view(this.viewOptions) : s.isFunction(this.view) && (this.view = this.view.call(this, this.viewOptions)), this.initialize.apply(this, arguments), this.autoAppend && this.append()
      },
      initialize: s.noop,
      setContainer: function () {
        return this.selector || (this.selector = this.defaultSelector), this.container = this.selector, this.container
      },
      getOwnData: function () {
        return this.data
      },
      remove: function () {
        s.result(this, "beforeRemove"), this.view && s.isFunction(this.view.remove) && this.view.remove();
        var t = ["container", "view", "defaults", "attributes"];
        return s.each(t, s.bind(function (t) {
          this[t] && delete this[t]
        }, this)), this.stopListening(), this.trigger("remove"), this
      },
      append: function () {
        return this.view && s.isFunction(this.view.render) && (this.container ? this.container.appendChild(this.view.render().el) : this.view.render()), this.trigger("append"), this
      }
    });
    Object.defineProperties(c.prototype, {
      defaultSelector: {
        get: function () {
          return "[prima-component=" + this.name + "]"
        }, set: function () {
        }
      }, container: {
        get: function () {
          return this._container
        }, set: function (t) {
          var e = r(t, this.rootEl);
          this._container = e
        }
      }, data: {
        get: function () {
          return this._data || (this._data = a.get("Components/" + this.name)), this._data
        }, set: function (t) {
          this._data = t
        }
      }
    }), l.mixin.applyTo(c.prototype), e.exports = c
  }, {
    "./class": 543,
    "./lib/data": 548,
    "./lib/logger": 553,
    "./mixins/accessor/simple": 578,
    "./utils/ensure-element": 601,
    backbone: "5kFNoY",
    lodash: "MicNly"
  }],
  546: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("backbone"), n = function () {
    };
    n.extend = o.Model.extend, s.extend(n.prototype, o.Events), n.prototype.trigger = function () {
      return s.isObject(arguments[1]) && (arguments[1].loggingData = arguments[1].loggingData || {}), o.Events.trigger.apply(this, arguments)
    }, e.exports = new n
  }, {backbone: "5kFNoY", lodash: "MicNly"}],
  547: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      this.options = o.extend({
        preventInteraction: !1,
        ignoreSelectors: []
      }, e), this._onClick = o.bind(this._onClick, this, t), document.addEventListener("click", this._onClick, !0)
    }

    var o = t("lodash"), n = t("jquery"), a = t("backbone");
    s.prototype._isForcedInsideTarget = function (t) {
      return o.isEmpty(this.options.ignoreSelectors) ? !1 : !o.isEmpty(t.closest(this.options.ignoreSelectors.join(",")))
    }, s.prototype._onClick = function (t, e) {
      var i = n(e.target);
      t === e.target || n.contains(t, e.target) || this._isForcedInsideTarget(i) ? this.trigger("click:inside", e) : (this.trigger("click:outside"), this.options.preventInteraction && (e.preventDefault(), e.stopPropagation()))
    }, s.prototype.remove = function () {
      return document.removeEventListener("click", this._onClick, !0), this.off(), this
    }, o.extend(s.prototype, a.Events), e.exports = s
  }, {backbone: "5kFNoY", jquery: "HlZQrA", lodash: "MicNly"}],
  548: [function (t, e, i) {
    "use strict";
    function s(t) {
      if (!a)throw new Error("Data hasn't been initialized with `setup`.");
      if (!r.isString(t))return null;
      var e = r.get(a, t.replace(/\//g, "."));
      return r.cloneDeep(e)
    }

    function o(t) {
      if (!a)throw new Error("Data hasn't been initialized with `setup`.");
      return r.isString(t) ? r.has(a, t.replace(/\//g, ".")) : null
    }

    function n(t) {
      a = r.isObject(t) ? t : {}
    }

    var a, r = t("lodash");
    e.exports = {get: s, has: o, setup: r.once(n)}
  }, {lodash: "MicNly"}],
  549: [function (t, e, i) {
    "use strict";
    function s(t) {
      t = o.extend({
        entries: {},
        name: "Dictionary"
      }, t), this._hadLastLookup = !1, this._entries = t.entries, this._name = t.name
    }

    var o = t("lodash"), n = (t("./logger"), t("sprintf-js").sprintf), a = function (t, e, i) {
      null != i || (i = this);
      var s = t.apply(i, e);
      return e = Array.prototype.slice.call(e, 1), e.unshift(s), e
    };
    s.prototype.addEntries = function (t) {
      return o.extend(this._entries, t), this
    }, s.prototype.lookup = function (t) {
      return o.has(this._entries, t) ? (this._hadLastLookup = !0, this._entries[t]) : (this._hadLastLookup = !1, t)
    }, s.prototype.lookupWithFormatting = function (t) {
      var e;
      return arguments.length > 1 ? (e = this.lookup(n.apply(this, arguments)), this._hadLastLookup || (e = n.apply(this, a(this.lookup, arguments, this)))) : e = this.lookup(t), e
    }, s.prototype.get = function (t) {
      var e = this.lookupWithFormatting.apply(this, arguments);
      return !this._hadLastLookup && this.logMissing, e
    }, s.prototype.getEntries = function () {
      return o.cloneDeep(this._entries)
    }, e.exports = s
  }, {"./logger": 553, lodash: "MicNly", "sprintf-js": "qPOUxN"}],
  550: [function (t, e, i) {
    "use strict";
    function s() {
      function t(t) {
        n(), d.trigger("DOMEventor:flatresize", m), e = !1
      }

      var e;
      p.on("resize.DOMEventor-nextResizeLoop", function () {
        e || (_(t), e = !0)
      })
    }

    function o() {
      function t(t) {
        i-- || (g.documentHeight = m.documentHeight, m.documentHeight = u.height(), i = 1), g.windowScrollTop = g.windowScrollY = m.windowScrollTop, m.windowScrollTop = m.windowScrollY = p.scrollTop(), d.trigger("DOMEventor:flatscroll", m), e = !1
      }

      var e, i = 0;
      p.on("scroll.DOMEventor-nextScrollLoop", function () {
        e || (_(t), e = !0)
      })
    }

    function n() {
      g.documentHeight = m.documentHeight, m.documentHeight = u.height(), g.windowHeight = m.windowHeight, m.windowHeight = p.height(), g.windowWidth = m.windowWidth, m.windowWidth = p.width(), g.windowScrollTop = g.windowScrollY = m.windowScrollTop, m.windowScrollTop = m.windowScrollY = p.scrollTop()
    }

    function a() {
      var t = [], e = {
        8: "backspace",
        9: "tab",
        13: "enter",
        16: "shift",
        17: "ctrl",
        18: "alt",
        20: "capslock",
        27: "escape",
        32: "space",
        33: "pageup",
        34: "pagedown",
        35: "end",
        36: "home",
        37: "left",
        38: "up",
        39: "right",
        40: "down",
        45: "insert",
        46: "delete",
        48: "0",
        49: "1",
        50: "2",
        51: "3",
        52: "4",
        53: "5",
        54: "6",
        55: "7",
        56: "8",
        57: "9",
        65: "a",
        66: "b",
        67: "c",
        68: "d",
        69: "e",
        70: "f",
        71: "g",
        72: "h",
        73: "i",
        74: "j",
        75: "k",
        76: "l",
        77: "m",
        78: "n",
        79: "o",
        80: "p",
        81: "q",
        82: "r",
        83: "s",
        84: "t",
        85: "u",
        86: "v",
        87: "w",
        88: "x",
        89: "y",
        90: "z",
        91: "leftmeta",
        92: "rightmeta",
        93: "rightmeta",
        96: "num0",
        97: "num1",
        98: "num2",
        99: "num3",
        100: "num4",
        101: "num5",
        102: "num6",
        103: "num7",
        104: "num8",
        105: "num9",
        106: "multiply",
        107: "add",
        109: "subtract",
        110: "decimal",
        111: "devide",
        112: "f1",
        113: "f2",
        114: "f3",
        115: "f4",
        116: "f5",
        117: "f6",
        118: "f7",
        119: "f8",
        120: "f9",
        121: "f10",
        122: "f11",
        123: "f12",
        144: "numlock",
        145: "scrolllock",
        186: "semicolon",
        187: "equal",
        188: "comma",
        189: "dash",
        190: "period",
        191: "forwardslash",
        192: "graveaccent",
        219: "openbracket",
        220: "backslash",
        221: "closebracket",
        222: "singlequote"
      };
      u.on("keydown.DOMEventor keyup.DOMEventor", function (i) {
        var s = i.type;
        if ("keyup" === s || "keydown" === s) {
          var o = c(i.target), n = i.which;
          if (!((o.is("input") || o.is("textarea") || o.is("select")) && n >= 48 && 90 >= n) || i.metaKey || i.ctrlKey || i.altKey) {
            n >= 48 && 90 >= n && "keydown" === s && (t[n] = 1);
            var a = "";
            for (var r in t)"keydown" === s && n !== parseInt(r, 10) && (a += e[r] ? e[r] + "+" : "");
            var l = s + ":" + (i.altKey && 18 !== n ? "alt+" : "") + (i.ctrlKey && 17 !== n ? "ctrl+" : "") + (i.metaKey && 91 !== n && 92 !== n && 93 !== n ? "meta+" : "") + (i.shiftKey && 16 !== n ? "shift+" : "") + (a || "") + (e[n] || "");
            d.trigger("DOMEventor:" + l, i, l), "keyup" === s && (t = [])
          }
        }
      }), d.off("DOMEventor:startKeyboardObserver"), d.on("DOMEventor:stopKeyboardObserver", r)
    }

    function r() {
      u.off("keydown.DOMEventor keyup.DOMEventor"), d.on("DOMEventor:startKeyboardObserver", a), d.off("DOMEventor:stopKeyboardObserver")
    }

    function l() {
      n(), o(), s(), a(), d.on("DOMEventor:updateRect", n)
    }

    var h = t("lodash"), c = t("jquery"), d = t("../events"), u = c(document), p = c(window), m = {}, g = {};
    m.documentHeight = g.documentHeight = null, m.windowHeight = g.windowHeight = null, m.windowWidth = g.windowHeight = null, m.windowScrollTop = g.windowScrollTop = null, m.windowScrollY = g.windowScrollY = null;
    var _ = !Object.hasOwnProperty.call(window, "requestAnimationFrame") && window.requestAnimationFrame || !Object.hasOwnProperty.call(window, "webkitRequestAnimationFrame") && window.webkitRequestAnimationFrame || !Object.hasOwnProperty.call(window, "mozRequestAnimationFrame") && window.mozRequestAnimationFrame || !Object.hasOwnProperty.call(window, "oRequestAnimationFrame") && window.oRequestAnimationFrame || function (t) {
        window.setTimeout(function () {
          t()
        }, 50)
      }, f = {
      init: h.once(l), rect: function () {
        return m
      }, lastRect: function () {
        return g
      }
    };
    e.exports = f
  }, {"../events": 546, jquery: "HlZQrA", lodash: "MicNly"}],
  551: [function (t, e, i) {
    "use strict";
    function s(t) {
      function e() {
        a.removeEventListener("DOMContentLoaded", e), t()
      }

      a.addEventListener("DOMContentLoaded", e)
    }

    function o(t) {
      n || (n = /^loaded|^i|^c/.test(a.readyState)), n ? setTimeout(t) : s(t)
    }

    var n, a = document;
    e.exports = o
  }, {}],
  552: [function (t, e, i) {
    "use strict";
    function s(t) {
      var e = a.apply(this, arguments);
      return n.has(t, "mixins") && t.mixins.forEach(function (t) {
        t.applyTo(e.prototype)
      }), e
    }

    function o(t) {
      t.extend = s
    }

    var n = t("lodash"), a = t("backbone").Model.extend;
    e.exports.applyTo = o
  }, {backbone: "5kFNoY", lodash: "MicNly"}],
  553: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = (t("./domready"), {}), n = function () {
      return o
    };
    o.log = n, o.logSaw = n, o.count = s.noop, o.echo = n, o.flush = n, o.flushCount = n, o.groupNameWithUrl = s.identity, e.exports = o
  }, {"./domready": 551, lodash: "MicNly"}],
  554: [function (t, e, i) {
    "use strict";
    function s(t) {
      this.watching = {}, this.pending_events = [], this.endpoint = t.endpoint, t.event_payload_name && (this.event_payload_name = t.event_payload_name), t.event_filter && (this.event_filter = t.event_filter), t.payload_formatter && (this.payload_formatter = t.payload_formatter), o.bindAll(this, "_flush_from_timeout"), this._flush_from_timeout();
      var e = t.EventClass || _;
      this.Log = g.extend({EventClass: e}), n(window).on("beforeunload.log_lady", o.bind(this._flush_on_unload, this)), this.set_flush_rate()
    }

    var o = t("lodash"), n = t("jquery"), a = t("backbone"), r = (t("prima/lib/logger"), t("prima/lib/flags")), l = t("prima/utils/realnow"), h = l.getRealNow, c = t("../utils/extend-with-defaults"), d = t("../utils/uuid"), u = t("../utils/send-beacon"), p = [].slice, m = t("./config"), g = t("./log"), _ = t("./logladyphp/event"), f = 1e3;
    o.extend(s.prototype, a.Events, {
      initialize: o.noop, defaults: {flush_rate: 15 * f}, min_flush_rate: function () {
        var t = o.map(this.watching, function (t) {
          return o.result(t, "flush_rate")
        });
        return t.push(this.defaults.flush_rate), o.min(t)
      }, set_flush_rate: function (t) {
        return t && (this.defaults.flush_rate = t), this.flush_rate = this.min_flush_rate(), this.flush_is_overdue() && this._flush_from_timeout(), this.flush_rate
      }, flush: function () {
        var t = this.build_payload();
        if (!(t[this.event_payload_name].length < 1) && r.bool("log_lady"))return u(this.endpoint, t, !this.unloading), this.last_flush_at = h(), !0
      }, _flush_on_unload: function () {
        this._flush_timeout && clearTimeout(this._flush_timeout), this._trigger_unloads(), this.unloading = !0, this.flush()
      }, _trigger_unloads: function () {
        var t;
        for (var e in this.watching)t = this.watching[e], "function" == typeof t.unloaded && t.unloaded()
      }, _flush_from_timeout: function () {
        this._flush_timeout && clearTimeout(this._flush_timeout);
        var t = this.flush();
        t !== !1 && (this._flush_timeout = setTimeout(this._flush_from_timeout, this.flush_rate))
      }, flush_is_overdue: function () {
        this.last_flush_at || (this.last_flush_at = h());
        var t = h() - this.last_flush_at;
        return t > this.flush_rate
      }, watch: function () {
        var t, e, i, s = p.apply(arguments);
        for (i = 0; i < s.length; i++)t = s[i], this.is_valid(t) && (t.log_lady = this, this.watching[t.log_key] && (e = this.watching[t.log_key],
        e && o.isFunction(e.replaced) && e.replaced(t)), this.watching[t.log_key] = t);
        return this.set_flush_rate(), this
      }, unwatch: function (t) {
        this.watching[t.log_key] && t && o.isFunction(t.replaced) && t.replaced(), delete this.watching[t.log_key]
      }, pending_log_events: function () {
        var t = this.pending_events;
        return this.pending_events = [], t
      }, event_payload_name: "payload", payload_formatter: function (t) {
        return t
      }, event_filter: function () {
        return !0
      }, build_payload: function () {
        var t = o.merge({}, this.watching, [this]), e = o(t).collect(function (t) {
          return t.pending_log_events()
        }).flatten().filter(this.event_filter).collect(o.bind(function (t) {
          return t.json
        }, this)).value(), i = {};
        return i[this.event_payload_name] = this.payload_formatter(e), i
      }, is_valid: function (t) {
        var e = !!t;
        return e && (e = o.result(t, "log_key")), e && (e = o.result(t, "uuid")), e && (e = o.isFunction(t.pending_log_events)), e
      }, log: function (t, e) {
        if (t) {
          if (!(t in this.watching)) {
            e && e.log_key && console.warn("log key gets overridden by log name");
            var i = m("keys", t);
            e = o.extend({}, i, e, {log_key: t});
            var s = new this.Log(e);
            this.watch(s)
          }
          return this.watching[t]
        }
      }, new_uuid: d
    }), s.extend = c, s.Log = g, e.exports = s
  }, {
    "../utils/extend-with-defaults": 569,
    "../utils/send-beacon": 570,
    "../utils/uuid": 571,
    "./config": 556,
    "./log": 560,
    "./logladyphp/event": 562,
    backbone: "5kFNoY",
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/lib/flags": "f/LVtH",
    "prima/lib/logger": 553,
    "prima/utils/realnow": 607
  }],
  555: [function (t, e, i) {
    "use strict";
    var s, o = t("prima/lib/data"), n = function () {
      return s || (s = o.get("Components/LogLady")), s
    };
    e.exports = n()
  }, {"prima/lib/data": 548}],
  556: [function (t, e, i) {
    "use strict";
    function s() {
      for (var t, e = a.apply(arguments), i = n, s = 0; s < e.length; s++) {
        if (t = e[s], !i || !o.has(i, t))return;
        i = i[t]
      }
      return i
    }

    var o = t("lodash"), n = t("./bootstrap"), a = [].slice;
    e.exports = s
  }, {"./bootstrap": 555, lodash: "MicNly"}],
  557: [function (t, e, i) {
    "use strict";
    function s(t) {
      return n.isString(t) ? t : JSON.stringify(t)
    }

    function o(t, e, i) {
      this.name = e, this.log_key = n.result(t, "log_key"), this.data = i || null;
      var o = l(), a = n.result(t, "generate_relative_id"), c = n.result(t, "env"), d = t.uuid, u = {category: this.log_key}, p = 8, m = new Array(p);
      m[0] = s(o), m[1] = s(h), m[2] = s(d), m[3] = s(a), m[4] = s(r.getElapsed(o)), m[5] = s(e), m[6] = s(i), m[7] = s(c), u.fields = m, this.json = u
    }

    var n = t("lodash"), a = t("prima/utils/cookie"), r = t("prima/utils/realnow"), l = r.getRealNow, h = a.get("tmgioct");
    e.exports = o
  }, {lodash: "MicNly", "prima/utils/cookie": 598, "prima/utils/realnow": 607}],
  558: [function (t, e, i) {
    "use strict";
    function s(t) {
      var e = o.result(t, "logKey"), i = o.result(t, "logEnv");
      if (e) {
        var s = o.result(t, "logOptions") || {};
        return i && (s.env = i), n.log(e, s)
      }
    }

    var o = t("lodash"), n = t("./logger");
    e.exports = s
  }, {"./logger": 559, lodash: "MicNly"}],
  559: [function (t, e, i) {
    "use strict";
    var s = t("../base"), o = t("./event"), n = new s({
      EventClass: o,
      event_payload_name: "payload",
      event_filter: function () {
        return !0
      },
      endpoint: "/services/cslog"
    });
    e.exports = n
  }, {"../base": 554, "./event": 557}],
  560: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      t.uuid ? (e = t, t = e.uuid) : e || !t || o.isString(t) || (e = t, t = void 0), this.options = o.extend({}, this.defaults, e), delete this.options.log_key, delete this.options.env, delete this.options.uuid, l(this, "uuid", t || this._generate_uuid()), e.env || (e.env = {}), o.each(e.flags, function (t) {
        e.env.flags || (e.env.flags = {}), e.env.flags[t] = a.bool(t)
      }), l(this, "env", e.env), this.log_key = e.log_key || this.log_key, this.events = [], this.event_count = 0, this.pending_events = [], this.event_counts = {}, this.started_at || (this.started_at = this.options.started_at || r.getRealNow()), delete this.options.started_at, this.initialize(e), this.options.init_event && this.trigger("init")
    }

    var o = t("lodash"), n = t("backbone"), a = t("prima/lib/flags"), r = t("prima/utils/realnow"), l = t("../utils/define-immutable-property"), h = t("../utils/extend-with-defaults"), c = t("../utils/uuid"), d = t("./config"), u = t("./logladyphp/event");
    o.extend(s.prototype, n.Events, {
      EventClass: u, initialize: o.noop, _generate_uuid: function () {
        return d("default_session") || c()
      }, defaults: {init_event: !0, keep_counts: !1}, pending_log_events: function () {
        var t = this.pending_events;
        return this.pending_events = [], t
      }, generate_relative_id: function () {
        return this.event_count
      }, unloaded: function (t) {
        t || (t = {}), t = this.before_unloaded(t) || {}, this.options.keep_counts && o.extend(t, {event_counts: this.event_counts}), o.isEmpty(t) || this.trigger("unload", t)
      }, before_unloaded: function (t) {
        return t
      }, replaced: function (t) {
        this.before_replaced(t);
        for (var e = this.pending_log_events(); e.length;)this.log_lady.pending_events.push(e.shift())
      }, before_replaced: o.noop, stop: function () {
        this.log_lady && this.log_lady.unwatch(this)
      }, trigger: function (t, e) {
        var i = new this.EventClass(this, t, e);
        return this.options.keep_counts && "init" !== t && "unload" !== t && (this.event_counts[t] || (this.event_counts[t] = 0), this.event_counts[t]++), this.event_count += 1, this.pending_events.push(i), n.Events.trigger.call(this, t, i, this), this
      }
    }), s.extend = h, e.exports = s
  }, {
    "../utils/define-immutable-property": 568,
    "../utils/extend-with-defaults": 569,
    "../utils/uuid": 571,
    "./config": 556,
    "./logladyphp/event": 562,
    backbone: "5kFNoY",
    lodash: "MicNly",
    "prima/lib/flags": "f/LVtH",
    "prima/utils/realnow": 607
  }],
  561: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("../config"), n = s.keys(o("keys"));
    e.exports = function (t) {
      return n.indexOf(t.log_key) >= 0
    }
  }, {"../config": 556, lodash: "MicNly"}],
  562: [function (t, e, i) {
    "use strict";
    function s(t, e, i) {
      this.name = e, this.log_key = o.result(t, "log_key"), this.data = i || null;
      var s = a(), n = o.result(t, "generate_relative_id"), l = o.result(t, "env"), h = t.uuid, c = {};
      c.log_key = this.log_key, c.uuid = h, c.event = this.name, c.ts = s, n !== !1 && void 0 !== n && (c.rid = n), c.elapsed = c.ts - r, c.data = this.data, c.env = l, this.json = c
    }

    var o = t("lodash"), n = t("prima/utils/realnow"), a = n.getRealNow, r = n.realStartedAt;
    e.exports = s
  }, {lodash: "MicNly", "prima/utils/realnow": 607}],
  563: [function (t, e, i) {
    "use strict";
    var s = t("prima/events"), o = t("../base"), n = t("./event"), a = t("./event-filter"), r = new o({
      EventClass: n,
      event_payload_name: "events",
      event_filter: a,
      endpoint: "/svc/log/lady"
    });
    s.on("Capture:push", function (t, e, i) {
      r.log(t, {init_event: !1}).trigger(e, i)
    }), e.exports = r
  }, {"../base": 554, "./event": 562, "./event-filter": 561, "prima/events": 546}],
  564: [function (t, e, i) {
    "use strict";
    function s(t, e, i) {
      this.name = e, this.log_key = o.result(t, "log_key"), this.data = i || {};
      var s = a(), n = {pt: this.data.pt, event_data: {timestamp: s, eventString: this.data.eventName}};
      this.json = n
    }

    var o = t("lodash"), n = t("prima/utils/realnow"), a = n.getRealNow;
    e.exports = s
  }, {lodash: "MicNly", "prima/utils/realnow": 607}],
  565: [function (t, e, i) {
    "use strict";
    function s(t) {
      var e = [];
      return o.forEach(t, function (t) {
        var i = o.find(e, {pt: t.pt});
        i || (i = {pt: t.pt, events: []}, e.push(i)), i.events.push(t.event_data)
      }), e
    }

    var o = t("lodash"), n = t("../base"), a = t("./event"), r = new n({
      EventClass: a,
      event_payload_name: "trackers",
      event_filter: function (t) {
        return t.data && t.data.pt
      },
      payload_formatter: s,
      endpoint: "https://ls.srvcs.tumblr.com/services/bblog"
    });
    e.exports = r
  }, {"../base": 554, "./event": 564, lodash: "MicNly"}],
  566: [function (t, e, i) {
    "use strict";
    var s = t("./endpoints/logladyphp/logger");
    e.exports = s
  }, {"./endpoints/logladyphp/logger": 563}],
  567: [function (t, e, i) {
    "use strict";
    function s(t) {
      var e, i;
      Object.freeze(t);
      for (i in t)e = t[i], t.hasOwnProperty(i) && null !== e && "object" == typeof e && !Object.isFrozen(e) && s(e)
    }

    e.exports = s
  }, {}],
  568: [function (t, e, i) {
    "use strict";
    function s(t, e, i) {
      o.isObject(i) && n(i), Object.defineProperty(t, e, {value: i, writeable: !1, enumerable: !0, configurable: !1})
    }

    var o = t("lodash"), n = t("./deepfreeze");
    e.exports = s
  }, {"./deepfreeze": 567, lodash: "MicNly"}],
  569: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      var i, s = this;
      i = t && o.has(t, "constructor") ? t.constructor : function () {
        return s.apply(this, arguments)
      }, o.extend(i, s, e);
      var n = function () {
        this.constructor = i
      };
      return n.prototype = s.prototype, i.prototype = new n, t.defaults && (o.extend(i.prototype.defaults, t.defaults), delete t.defaults), t && o.extend(i.prototype, t), i.__super__ = s.prototype, i
    }

    var o = t("lodash");
    e.exports = s
  }, {lodash: "MicNly"}],
  570: [function (t, e, i) {
    "use strict";
    function s(t, e, i) {
      return !!a.ajax({url: t, type: "POST", data: JSON.stringify(e), contentType: "text/plain", async: i})
    }

    function o(t, e, i) {
      var o = window.navigator.sendBeacon(t, JSON.stringify(e));
      return o || (o = s(t, e, i)), o
    }

    var n, a = t("jquery");
    n = window.navigator && window.navigator.sendBeacon ? o : s, e.exports = n
  }, {jquery: "HlZQrA"}],
  571: [function (t, e, i) {
    "use strict";
    function s() {
      return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (t) {
        var e = 16 * Math.random() | 0, i = "x" === t ? e : 3 & e | 8;
        return i.toString(16)
      })
    }

    e.exports = s
  }, {}],
  572: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      c.each(e, function (e, i) {
        var s = t[i];
        t[i] = function () {
          return e.apply(this, arguments), s.apply(this, arguments)
        }
      })
    }

    function o(t, e) {
      c.each(e, function (e, i) {
        var s = t[i];
        t[i] = function () {
          var t = s.apply(this, arguments);
          return e.apply(this, arguments), t
        }
      })
    }

    function n(t, e) {
      c.each(e, function (e, i) {
        var s = t[i];
        t[i] = function () {
          var t = c.toArray(arguments);
          return t.unshift(c.bind(s, this)), e.apply(this, t)
        }
      })
    }

    function a(t, e) {
      c.each(e, function (e, i) {
        var s = i in t ? t[i] : !1;
        t[i] = function () {
          var t = c.toArray(arguments), i = s ? c.bind(s, this) : c.noop;
          return t.unshift(i), e.apply(this, t)
        }
      })
    }

    function r(t, e) {
      c.defaults(t, e)
    }

    function l(t, e) {
      c.extend(t, e)
    }

    function h() {
      this.mixins = c.filter(arguments, function (t) {
        return t instanceof h
      }), this.properties = arguments[this.mixins.length] || {}
    }

    var c = t("lodash");
    h.prototype.mixins = null, h.prototype.properties = null, h.prototype.applyTo = function (t) {
      var e = this.properties;
      r(t, e.defaults), l(t, e.extend), c.extend(t, c.omit(e, "before", "after", "around", "onto", "defaults", "extend", "applyTo")), c.invoke(this.mixins, "applyTo", t), s(t, e.before), o(t, e.after), n(t, e.around), a(t, e.onto), c.isFunction(e.applyTo) && e.applyTo.apply(this, arguments)
    }, h.before = s, h.after = o, h.around = n, h.onto = a, e.exports = h
  }, {lodash: "MicNly"}],
  573: [function (t, e, i) {
    "use strict";
    var s = t("sprintf-js").sprintf, o = t("prima/lib/translate"), n = t("./subview");
    t("prima/lib/logger");
    e.exports = {__: o, sprintf: s, _subview: n}
  }, {"./subview": 574, "prima/lib/logger": 553, "prima/lib/translate": 575, "sprintf-js": "qPOUxN"}],
  574: [function (t, e, i) {
    "use strict";
    e.exports = function (t) {
      return '<noscript data-subview="' + t + '"></noscript>'
    }
  }, {}],
  575: [function (t, e, i) {
    "use strict";
    function s(t) {
      a.addEntries(o.isObject(t) ? t : {})
    }

    var o = t("lodash"), n = t("./dictionary"), a = new n({name: "Translations"}), r = o.bind(a.get, a);
    r.setup = o.once(s), e.exports = r
  }, {"./dictionary": 549, lodash: "MicNly"}],
  576: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = {
      isBlank: function (t) {
        return "" === s.trim(t)
      }, minLength: function (t, e) {
        return t.length >= e
      }, maxLength: function (t, e) {
        return t.length <= e
      }, range: function (t, e, i) {
        return t.length >= e && t.length <= i
      }, pattern: function (t, e) {
        return new RegExp(e, "gi").test(t) ? !0 : !1
      }, isEmail: function (t) {
        return this.pattern(t, "^[a-zA-Z0-9._+-]+@[a-zA-Z0-9][a-zA-Z0-9.-]*[.]{1}[a-zA-Z]{2,20}$")
      }, isUrl: function (t) {
        return this.pattern(t, "^\\s*((https?:)?[/\\\\]+)?([a-z0-9_-]+\\.){1,}([a-z\\.]{2,6})(/[^\\s]*)?\\s*$")
      }, equals: function (t, e) {
        return t === e
      }
    };
    e.exports = o
  }, {jquery: "HlZQrA"}],
  577: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("backbone"), n = t("../../lib/mixin"), a = t("./simple"), r = new n(s.extend({}, a.props, {
      defaults: s.extend({}, o.Events),
      before: {
        initialize: function () {
          var t = s.defaults({}, s.result(this, "defaults"));
          this.attributes = {}, this.set(t), this.changed = {}
        }
      }
    }));
    e.exports = r
  }, {"../../lib/mixin": 572, "./simple": 578, backbone: "5kFNoY", lodash: "MicNly"}],
  578: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("backbone"), n = t("../../lib/mixin"), a = o.Model.prototype, r = {
      get: a.get,
      has: a.has,
      set: a.set,
      unset: a.unset,
      clear: a.clear,
      hasChanged: a.hasChanged,
      changedAttributes: a.changedAttributes,
      previous: a.previous,
      toJSON: a.toJSON,
      toggle: function (t) {
        this.set(t, !this.get(t))
      },
      _validate: s.constant(!0)
    }, l = new n(s.extend({}, r, {defaults: s.extend({}, o.Events)}));
    e.exports = {props: r, mixin: l}
  }, {"../../lib/mixin": 572, backbone: "5kFNoY", lodash: "MicNly"}],
  579: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/mixin"), n = new o({
      delegateObject: function (t) {
        var e = {}, i = {};
        t && (s.each(t, function (t, s) {
          "undefined" != typeof t && ("function" == typeof t ? e[s] = t : i[s] = t)
        }, this), o.onto(this, e), s.extend(this, i))
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "prima/lib/mixin": 572}],
  580: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/lib/mixin"), n = new o({
      loggingData: function (t) {
        var e = {};
        return !s.isEmpty(this.model) && s.isFunction(this.model.toJSON) && (e.modelData = this.model.toJSON()), s.isObject(t) && (e = s.extend(e, t)), e
      }
    });
    e.exports = n
  }, {lodash: "MicNly", "prima/lib/mixin": 572}],
  581: [function (t, e, i) {
    "use strict";
    var s = t("prima/lib/mixin"), o = t("prima/events"), n = t("lodash"), a = t("./registry"), r = new s({
      __bindKeycommands: function () {
        n.result(this, "keycommands") && (n.each(n.result(this, "keycommands"), this.__bindKey, this), a.add({
          id: this.__keyId,
          keys: n.keys(n.result(this, "keycommands"))
        }))
      }, __bindKey: function (t, e) {
        this.listenTo(o, "DOMEventor:" + e, this.__keyFn)
      }, __keyFn: function (t, e) {
        !this.__keysDisabled && a.shouldRun(e, this.__keyId) && this[this.keycommands[e]].apply(this, arguments)
      }, focusKeys: function () {
        a.focus(this.__keyId)
      }, unfocusKeys: function () {
        a.unfocus(this.__keyId)
      }, soloKeys: function (t) {
        a.solo(this.__keyId, t)
      }, unSoloKeys: function () {
        a.unSolo(this.__keyId)
      }, disableKeys: function () {
        this.__keysDisabled = !0
      }, enableKeys: function () {
        this.__keysDisabled = !1
      }, before: {
        initialize: function () {
          this.keycommands || (this.keycommands = {}), this.__keysDisabled = !1, this.__keyId = n.uniqueId("keycomms"), this.__bindKeycommands()
        }, stopListening: function () {
          a.remove(this.__keyId)
        }
      }
    });
    e.exports = r
  }, {"./registry": 582, lodash: "MicNly", "prima/events": 546, "prima/lib/mixin": 572}],
  582: [function (t, e, i) {
    "use strict";
    var s = t("prima/class"), o = t("lodash"), n = s.extend({
      soloId: null,
      isSoloBubblingDisabled: !1,
      constructor: function () {
        this.keySets = []
      },
      add: function (t) {
        this.keySets.unshift(t)
      },
      remove: function (t) {
        var e = this.getSetForId(t);
        e && (this.unSolo(t), this.keySets = o.without(this.keySets, e))
      },
      focus: function (t) {
        var e = this.getSetForId(t);
        e && (this.keySets = o.without(this.keySets, e), this.keySets.unshift(e))
      },
      unfocus: function (t) {
        var e = this.getSetForId(t);
        e && (this.keySets = o.without(this.keySets, e), this.keySets.push(e))
      },
      solo: function (t, e) {
        var i = this.getSetForId(t);
        i && (this.soloId = t, this.isSoloBubblingDisabled = e === !0)
      },
      unSolo: function (t) {
        this.soloId === t && (this.soloId = null, this.isSoloBubblingDisabled = !1)
      },
      getSetForId: function (t) {
        return this.keySets[o.findIndex(this.keySets, {id: t})]
      },
      getSetsWithKey: function (t) {
        return o.where(this.keySets, {keys: [t]})
      },
      shouldRun: function (t, e) {
        var i = this.getSetsWithKey(t);
        return this.soloId === e ? !0 : this.isSoloBubblingDisabled ? !1 : i.length > 1 ? i[0].id === e : !0
      }
    });
    e.exports = new n
  }, {lodash: "MicNly", "prima/class": 543}],
  583: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = (t("sprintf-js").sprintf, t("../lib/mixin")), a = t("prima/events"), r = t("prima/mixins/subviewable"), l = !1, h = s("body"), c = s(window), d = t("prima/lib/clickoutside"), u = function (t) {
      return o.noop
    }, p = new n(r, {
      removeAutoTeardown: function () {
        this._popoverBase.clickOutside && (this._popoverBase.clickOutside.remove(), this._popoverBase.clickOutside = null)
      }, setupAutoTeardown: function () {
        this._rendered && (this.removeAutoTeardown(), this._popoverBase.autoTeardown && (this._popoverBase.clickOutside = new d(this.el, this.options), this._popoverBase.clickOutside.on("click:outside", this.onClickOutside, this)))
      }, onClickOutside: function () {
        this._popoverBase.shouldTeardown ? (this._popoverBase.lastAutoTeardown = o.now(), this.teardown()) : this._popoverBase.shouldTeardown = !0
      }, reposition: function () {
        if (!this.$pinned.closest("body").length)return void this.$el.css("visibility", "hidden");
        var t = this.pinnedRect(), e = {
          scrollTop: this.isContainerBody ? 0 : this.$container.scrollTop(),
          scrollLeft: this.isContainerBody ? 0 : this.$container.scrollLeft(),
          realTop: this.isContainerBody ? 0 : this.$container.offset().top,
          realLeft: this.isContainerBody ? 0 : this.$container.offset().left
        }, i = this._popoverBase.shift, s = this._popoverBase.pinnedSide, n = {visibility: "visible"}, a = {}, r = this.$el.width(), l = null, h = null, c = null, d = null;
        this.debug("reposition: pinnedSide=%s, shift=%O, pinnedRect=%O", s, i, t), this._popoverBase.isFixedPosition && (n.position = "fixed"), "top" === s || "bottom" === s ? (o.extend(n, {left: t.left + Math.floor(t.width / 2) + i.x}), a = {
          top: t.top + e.scrollTop - i.y,
          bottom: t.top + e.scrollTop + t.height + i.y,
          left: t.left + e.scrollLeft - i.x,
          right: t.left + e.scrollLeft + t.width + i.x
        }, a.center = (a.right - a.left) / 2, l = e.realTop + a.top - this.$el.height(), h = e.realTop + a.bottom + this.$el.height(), "top" === s && this._crossesViewportEdge("top", l) && !this._crossesViewportEdge("bottom", h) && (s = "bottom"), "bottom" === s && this._crossesViewportEdge("bottom", h) && !this._crossesViewportEdge("top", l) && (s = "top"), "bottom" === s ? o.extend(n, {
          top: a.bottom,
          transform: "translateX(-50%)"
        }) : "top" === s && o.extend(n, {
          top: a.top,
          transform: "translateX(-50%) translateY(-100%)"
        }), c = e.realLeft + (a.center + a.left) - r / 2, d = e.realLeft + (a.center + a.left) + r / 2, this._crossesViewportEdge("left", c) && !this._crossesViewportEdge("right", d) && o.extend(n, {
          left: this._popoverBase.minDistanceFromContainer + "px",
          transform: "top" === s ? "translateX(0) translateY(-100%)" : "translateX(0)"
        }), !this._crossesViewportEdge("left", c) && this._crossesViewportEdge("right", d) && o.extend(n, {
          left: "auto",
          right: this._popoverBase.minDistanceFromContainer + "px",
          transform: "top" === s ? "translateX(0) translateY(-100%)" : "translateX(0)"
        })) : "left" === s || "right" === s ? (o.extend(n, {top: t.top - i.y}), a = {
          left: t.left + e.scrollLeft - i.x,
          right: t.left + e.scrollLeft + t.width + i.x
        }, c = e.realLeft + a.left - this.$el.width(), d = e.realLeft + a.right + this.$el.width(), "left" === s && this._crossesViewportEdge("left", c) && !this._crossesViewportEdge("right", d) && (s = "right"), "right" === s && this._crossesViewportEdge("right", d) && !this._crossesViewportEdge("left", c) && (s = "left"), "left" === s ? o.extend(n, {
          left: a.left,
          transform: "translateX(-100%) translateY(-50%)"
        }) : "right" === s && o.extend(n, {
          left: a.right,
          transform: "translateY(-50%)"
        })) : o.extend(n, {
          top: t.top - i.y,
          left: t.left + i.x,
          transform: ""
        }), o.extend(n, {transform: n.transform}), this.$el.css(n), this.debug("reposition: ad-hoc css %O", n), this.$el.removeClass("top bottom left right").addClass(s)
      }, _crossesViewportEdge: function (t, e) {
        var i = s(window), o = {
          top: i.scrollTop(),
          left: i.scrollLeft(),
          right: i.scrollLeft() + i.width(),
          bottom: i.scrollTop() + i.height()
        };
        return this.debug("viewportCheck against %s side (%s) coordinate=[%s]", t, o[t], e), "top" === t ? o.top > e : "bottom" === t ? o.bottom < e : "left" === t ? o.left > e : "right" === t ? o.right < e : void 0
      }, isRendered: function () {
        return this._rendered
      }, isOrWasRecentlyRendered: function (t) {
        o.isNumber(t) || (t = 100);
        var e = this._popoverBase.lastAutoTeardown, i = o.now() - e;
        return t > i || this._rendered
      }, setPinnedSide: function (t) {
        return this._popoverBase.pinnedSide = t, this
      }, setPinnedTarget: function (t) {
        return this.$pinned = s(t).addClass("pinned-target"), this.debug("setPinnedTarget: %O", this.$pinned), this
      }, setPopoverContainer: function (t) {
        return this.$container = s(t), this.isContainerBody = this.$container.is(h), this.debug("setPopoverContainer: %O, isContainerBody=%s", this.$container, this.isContainerBody), this
      }, setShift: function (t) {
        if (!o.isObject(t) || !o.isNumber(t.x) || !o.isNumber(t.y))throw new Error("Popover shift needs to be: {Object} => x: {Number}, y: {Number}");
        return this._popoverBase.shift.x = t.x, this._popoverBase.shift.y = t.y, this
      }, getShift: function () {
        return this._popoverBase.shift
      }, _initializeDebugger: function () {
        this.debug = l ? u(this) : o.noop
      }, defaults: {
        pinnedRect: function () {
          var t, e, i = this.$container.offset();
          t = this.$pinned.offset(), e = t, this._popoverBase.isFixedPosition && (this.isContainerBody ? t.top -= c.scrollTop() : t.top -= this.$container.scrollTop());
          var s = {};
          return s.height = this.$pinned.outerHeight(), s.width = this.$pinned.outerWidth(), s.top = Math.round(t.top - i.top), s.left = Math.round(e.left - i.left), s.bottom = Math.round(s.top + s.height), s.right = Math.round(s.left + s.width), this.debug("pinnedRect calculation: container %O, pinned %O, containerOffset %O, pinnedOffset %O", this.$container, this.$pinned, i, e), this.debug("pinnedRect results: height(pinnedOuterHeight)=%s, width(pinnedOuterWidth)=%s, top(pTop-cTop)=%s, left=(pLeft-cLeft)=%s, bottom(top+height)=%s, right(left+width)=%s", s.height, s.width, s.top, s.left, s.bottom, s.right), s
        }
      }, after: {
        initialize: function (t) {
          var e = {
            identifier: "popover",
            pinnedSide: "bottom",
            className: "popover--base",
            autoTeardown: !0,
            teardownOnEscape: !0,
            minDistanceFromContainer: 10,
            shift: {x: 0, y: 0},
            clickOutside: null,
            lastAutoTeardown: 0,
            shouldTeardown: !0,
            isFixedPosition: !1
          };
          this._popoverBase = o.defaults(o.pick(t || {}, o.keys(e)), e), this._initializeDebugger(), this.setPinnedTarget(t.pinnedTarget || null), this.setPopoverContainer(t.popoverContainer || h)
        }, render: function () {
          this.$el.addClass(this._popoverBase.className), this.$el.appendTo(this.$container);
          var t = this.$el.children().first(), e = t.width();
          t.width(e - e % 2), this._popoverBase.autoTeardown && this.setupAutoTeardown(), this.reposition(), this.isContainerBody && (this.debug("DOMEventor subscribe: flatresize + flatscroll reposition active"), this.listenTo(a, "DOMEventor:flatresize", this.reposition), this._popoverBase.isFixedPosition || this.listenTo(a, "DOMEventor:flatscroll", this.reposition)), this._popoverBase.teardownOnEscape && this.listenTo(a, "DOMEventor:keyup:escape", this.teardown), this.trigger("open", this), a.trigger(this._popoverBase.identifier + ":open", this)
        }, teardown: function () {
          this.$pinned.removeClass("pinned-target"), this._popoverBase.teardownOnEscape && this.stopListening(a, "DOMEventor:keyup:escape"), this.$el.off("mousewheel DOMMouseScroll"), this.removeAutoTeardown(), this.trigger("close", this), a.trigger(this._popoverBase.identifier + ":close", this)
        }
      }
    });
    e.exports = p
  }, {
    "../lib/mixin": 572,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/clickoutside": 547,
    "prima/mixins/subviewable": 587,
    "sprintf-js": "qPOUxN"
  }],
  584: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("when"), n = t("../lib/mixin"), a = new n({
      defaults: {
        whenEvent: function (t, e) {
          return 1 === arguments.length && (e = t, t = this), o.promise(s.bind(function (i, s) {
            this.listenToOnce(t, e, function () {
              i.call(void 0, arguments)
            })
          }, this))
        }
      }
    });
    e.exports = a
  }, {"../lib/mixin": 572, lodash: "MicNly", when: "RG2dij"}],
  585: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("backbone"), n = t("prima/lib/mixin"), a = new n({
      before: {
        initialize: function (t, e) {
          this._bootstrapRelations(t, e)
        }
      }, extend: {
        _isModelOrCollection: function (t) {
          return t instanceof o.Collection || t instanceof o.Model
        }, _bootstrapRelations: function (t, e) {
          this._isBootstrapped || (s.each(this.relations, function (i, o) {
            var n = this.attributes[o];
            (s.isEmpty(n) || !n instanceof i) && (this.attributes[o] = new i(t[o], e))
          }, this), this._isBootstrapped = !0)
        }
      }, around: {
        set: function (t, e, i, n) {
          var a, r, l, h, c, d, u = this.relations, p = this.attributes;
          return s.isObject(e) ? (a = e, n = i) : (a = {})[e] = i, n = n || {}, c = s.result(n, "relationalSetOptions") || {}, this._bootstrapRelations(a, n), r = s.pick(a, s.keys(u)), s.isEmpty(u) || s.isEmpty(r) ? t.apply(this, s.rest(arguments)) : (d = s.isEmpty(this.relationsOrder) ? s.keys(r) : this.relationsOrder, s.each(d, function (t) {
            a[t] && (h = r[t], l = p[t], this._isModelOrCollection(l) && (n.unset ? l instanceof o.Collection ? l.reset() : l instanceof o.Model && l.clear() : (this._isModelOrCollection(h) && (h = h.toJSON()), n.reset && l instanceof o.Collection ? l.reset(h, s.extend({}, n, c[t])) : l.set(h, s.extend({}, n, c[t])))))
          }, this), t.call(this, s.omit(a, s.keys(u)), n))
        }, toJSON: function (t) {
          var e = t.apply(this, s.rest(arguments)) || {};
          for (var i in this.relations)e[i] = s.result(e[i], "toJSON") || e[i];
          return e
        }
      }
    });
    e.exports = a
  }, {backbone: "5kFNoY", lodash: "MicNly", "prima/lib/mixin": 572}],
  586: [function (t, e, i) {
    "use strict";
    function s(t) {
      return o.trim(t)
    }

    var o = t("lodash"), n = t("../lib/mixin"), a = function (t, e) {
      return t = s(t), e && o.isFunction(this.$$) && this.$$.cache["delete"](t), t
    }, r = function (t) {
      return this.$$ ? (t = s(t), this.$(t)) : void 0
    }, l = function (t) {
      this.$$ && (t = s(t), this.$$.cache["delete"](t))
    }, h = function (t) {
      return this.$$ ? (t = s(t), this.$$.cache["delete"](t), this.$(t)) : void 0
    }, c = function () {
      this.$$ && (this.$$.cache = new o.memoize.Cache)
    }, d = function (t) {
      return "[data-js-" + t + "]"
    }, u = function (t) {
      return function () {
        var t = o.memoize(o.bind(r, this), o.bind(a, this));
        t.update = o.bind(h, this), t.remove = o.bind(l, this), t.empty = o.bind(c, this);
        var e = function (e, i) {
          return t(d(e), i)
        };
        return e.update = function (e) {
          t.update(d(e))
        }, e.remove = function (e) {
          t.remove(d(e))
        }, this.$$ = t, this.js$ = e, this.$$initialize = o.noop, t
      }.call(t)
    }, p = new n({
      defaults: {
        $$cacheKeys: {}, $$cacheSelectors: function (t) {
          return "undefined" == typeof t && (t = this.$$cacheKeys), o.forEach(t, function (t) {
            this.$$.update(t)
          }, this), this
        }, $$initialize: function () {
          return u(this)
        }, $$: function () {
          return u(this).apply(this, arguments)
        }
      }, before: {
        initialize: function () {
          this.$$initialize()
        }, render: function () {
          this.$$.empty()
        }
      }, after: {
        setElement: function () {
          o.isFunction(this.$$.empty) && this.$$.empty()
        }, remove: function () {
          o.isFunction(this.$$.empty) && this.$$.empty()
        }, render: function () {
          o.isFunction(this.$$cacheSelectors) && this.$$cacheSelectors()
        }
      }
    });
    e.exports = p
  }, {"../lib/mixin": 572, lodash: "MicNly"}],
  587: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("../lib/mixin"), n = new o({
      defaults: {
        teardown: function () {
          return this
        }, beforeTeardown: function () {
        }, afterTeardown: function () {
          return this.teardownSubViews()
        }, render: function () {
          return this
        }, beforeRender: function () {
        }, afterRender: function () {
          return this.renderSubViews()
        }, attachSubView: function (t, e) {
          if (1 === arguments.length)if ("string" == typeof t) {
            if (e = t, t = this.subViews[e], !t)return this
          } else e = t.$el.data("subview") || "";
          var i = this.$('[data-subview="' + e + '"]');
          return i.length > 1 && (i = i.first()), t && i.length && (i.replaceWith(t.$el), t.$el.attr("data-subview", e)), this
        }, attachSubViews: function (t) {
          return s.forEach(this.subViews, this.attachSubView, this), this
        }, teardownSubViews: function () {
          return s.forEach(this.subViews, function (t, e) {
            t && s.isFunction(t.teardown) && t.teardown(), this.subViews[e] = null
          }, this), this.subViews = {}, this
        }, renderSubViews: function () {
          return s.forEach(this.subViews, function (t) {
            t && s.isFunction(t.render) && t.render()
          }, this), this
        }, isInitialized: function () {
          return this._initialized
        }, isRendered: function () {
          return this._rendered
        }, isRendering: function () {
          return this._rendering
        }, isRemoved: function () {
          return this._removed
        }
      }, around: {
        initialize: function (t) {
          this._initialized = !1, this._rendering = !1, this._rendered = !1, this._removed = !1, this.subViews = {};
          var e = t.apply(this, s.rest(arguments));
          return this._initialized = !0, e
        }, teardown: function (t) {
          var e = s.rest(arguments);
          s.isFunction(this.beforeTeardown) && this.beforeTeardown.apply(this, e);
          var i = t.apply(this, e);
          return s.isFunction(this.afterTeardown) && this.afterTeardown.apply(this, e), this._rendered = !1, i
        }, render: function (t) {
          var e = s.rest(arguments);
          this._rendering = !0, s.isFunction(this.beforeRender) && this.beforeRender.apply(this, e);
          var i = t.apply(this, e);
          return s.isFunction(this.afterRender) && this.afterRender.apply(this, e), this._rendering = !1, this._rendered = !0, this.trigger("rendered"), i
        }
      }, after: {
        remove: function () {
          this._removed = !0, this.subViews = null
        }
      }
    });
    e.exports = n
  }, {"../lib/mixin": 572, lodash: "MicNly"}],
  588: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/lib/mixin"), a = t("prima/events"), r = new n({
      defaults: {
        $tabLimiterEl: s(),
        _tabLimiterAutoFocus: !1,
        _tabLimiterItems: [],
        _tabLimiterSelector: ["input", "select", "textarea", "button", "object", "a", "div"],
        _tabLimiterCurrentIndex: -1,
        _tabLimiterEnterKey: !0
      }, __tabLimiterTabKeydown: function (t) {
        return t.preventDefault(), t.stopPropagation(), t.shiftKey && -1 === this._tabLimiterCurrentIndex && (this._tabLimiterCurrentIndex = 0), this._tabLimiterCurrentIndex = (this._tabLimiterCurrentIndex + (t.shiftKey ? -1 : 1) + this._tabLimiterItems.length) % this._tabLimiterItems.length, this._focusTabbableItem(), !1
      }, __tabLimiterItemKeydown: function (t) {
        t = t || window.event;
        var e = t.which || t.keyCode;
        if (13 === e) {
          t.preventDefault(), t.stopPropagation();
          var i = s(t.target), o = i.find("input");
          return o.length ? o.trigger("click") : i.trigger("click"), !1
        }
      }, __tabbableItemFocus: function (t) {
        var e = o.indexOf(this._tabLimiterItems, t.target);
        this._tabLimiterCurrentIndex = e >= 0 ? e : this._tabLimiterCurrentIndex
      }, _focusTabbableItem: function () {
        if (this.$tabLimiterEl && this.$tabLimiterEl.length) {
          var t = s(this._tabLimiterItems[this._tabLimiterCurrentIndex]);
          t.length && t.focus()
        }
      }, isTabbable: function (t) {
        var e = s(t), i = t.nodeName.toLowerCase(), o = e.attr("tabindex"), n = !1;
        return n = /input|select|textarea|button|object/.test(i) ? !t.disabled && !e.is(":hidden") : (t.href || !isNaN(o)) && !e.is(":hidden"), (isNaN(o) || o >= 0) && n
      }, updateTabbableItems: function () {
        this.$tabLimiterEl && this.$tabLimiterEl.length && (this._tabLimiterItems = o.filter(this.$tabLimiterEl.find(this._tabLimiterSelector.join(",")), o.bind(function (t) {
          return this.isTabbable(t)
        }, this)), this._tabLimiterItems.length && (this._tabLimiterItems = o.sortBy(this._tabLimiterItems, function (t) {
          return t.tabIndex
        })))
      }, catchTabs: function (t) {
        if (this.releaseTabs(), this.$tabLimiterEl = t ? s(t) : this.$tabLimiterEl, this.$tabLimiterEl && this.$tabLimiterEl.length) {
          this.updateTabbableItems(), this._tabLimiterAutoFocus && this._focusTabbableItem();
          var e = this._tabLimiterSelector.join(",");
          this.listenTo(a, "DOMEventor:keydown:tab", this.__tabLimiterTabKeydown), this.listenTo(a, "DOMEventor:keydown:shift+tab", this.__tabLimiterTabKeydown), this.$tabLimiterEl.on("focus.tablimiter", e, o.bind(this.__tabbableItemFocus, this)), this._tabLimiterEnterKey && this.$tabLimiterEl.on("keydown.tablimiter", e, o.bind(this.__tabLimiterItemKeydown, this))
        }
      }, releaseTabs: function () {
        this.$tabLimiterEl && this.$tabLimiterEl.length && (this._tabLimiterItems = [], this._tabLimiterCurrentIndex = -1, this.stopListening(a, "DOMEventor:keydown:tab", this.__tabLimiterTabKeydown), this.stopListening(a, "DOMEventor:keydown:shift+tab", this.__tabLimiterTabKeydown), this.$tabLimiterEl.off(".tablimiter"))
      }
    });
    e.exports = r
  }, {jquery: "HlZQrA", lodash: "MicNly", "prima/events": 546, "prima/lib/mixin": 572}],
  589: [function (t, e, i) {
    "use strict";
    var s = t("../lib/mixin"), o = new s({
      before: {
        sync: function (t, e, i) {
          i.with_form_key = !0
        }
      }
    });
    e.exports = o
  }, {"../lib/mixin": 572}],
  590: [function (t, e, i) {
    "use strict";
    var s = t("backbone"), o = t("./mixins/withformkeytrue"), n = t("./lib/extendwithmixins"), a = s.Model.extend({});
    o.applyTo(a.prototype), n.applyTo(a), e.exports = a
  }, {"./lib/extendwithmixins": 552, "./mixins/withformkeytrue": 589, backbone: "5kFNoY"}],
  591: [function (t, e, i) {
    "use strict";
    var s = t("backbone"), o = t("prima/bootloader"), n = (t("prima/lib/logger"), t("logs/logging-manager")), a = s.Router.extend({
      root: "/",
      logs: function () {
        return []
      },
      constructor: function () {
        n.startLogs(this.logs()), s.Router.apply(this, arguments)
      },
      getName: function () {
        return "Prima/Router"
      }
    }, {
      Bootloader: o, bootloader: function (t) {
        return new this.Bootloader(t)
      }
    });
    e.exports = a
  }, {backbone: "5kFNoY", "logs/logging-manager": 541, "prima/bootloader": 542, "prima/lib/logger": 553}],
  592: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      function i(t, e) {
        var i, s;
        if (!o.isObject(t))throw new Error("SingletonModel requires attributes");
        if (i = t[u], o.isEmpty(i) && !o.isNumber(i) && o.defer(function () {
            throw new Error('SingletonModel attributes require a "' + u + '"')
          }), s = c[i], d[i]++ || (d[i] = 1), s)o.keys(t).length >= 2 && s.set(t, e), s.collection !== !0 && (s.collection = !0); else {
          c[i] = this;
          try {
            Object.defineProperty(this, "collection", {value: !0, configurable: !1, enumerable: !0, writable: !1})
          } finally {
            this.collection || (this.collection = !0)
          }
          this.constructor.__super__.constructor.call(this, t, e), h.add(this)
        }
        return s || this
      }

      function s() {
        return this.id
      }

      function r() {
        return h
      }

      function l() {
        0 === --d[this.id] && (delete c[this.id], delete d[this.id], h.remove(this))
      }

      t || (t = {}), e || (e = {});
      var h = new n.Collection, c = Object.create(null), d = Object.create(null), u = t.idAttribute || a.prototype.idAttribute;
      return t.constructor = i, t.release = l, t.toString = s, t.toJSON = t.toJSON || a.prototype.toJSON, e.getCollection = r, a.extend(t, e)
    }

    var o = t("lodash"), n = t("backbone"), a = t("./model");
    e.exports.extend = s
  }, {"./model": 590, backbone: "5kFNoY", lodash: "MicNly"}],
  593: [function (t, e, i) {
    "use strict";
    function s() {
      var t, e, i = {
        animation: null,
        transition: null
      }, s = document.createElement("div"), o = {
        animation: "animationend",
        MozAnimation: "animationend",
        WebkitAnimation: "webkitAnimationEnd"
      };
      for (e in o)if (void 0 !== s.style[e]) {
        i.animation = o[e];
        break
      }
      var n = {transition: "transitionend", MozTransition: "transitionend", WebkitTransition: "webkitTransitionEnd"};
      for (t in n)if (void 0 !== s.style[t]) {
        i.transition = n[t];
        break
      }
      return i
    }

    function o(t, e) {
      r.animation ? a(t).one(r.animation, function (t) {
        e(t)
      }) : setTimeout(function (t) {
        e(t)
      }, 0)
    }

    function n(t, e) {
      r.transition ? a(t).one(r.transition, function (t) {
        e(t);
      }) : setTimeout(function (t) {
        e(t)
      }, 0)
    }

    var a = t("jquery"), r = s();
    e.exports = {animation: o, transition: n}
  }, {jquery: "HlZQrA"}],
  594: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = function (t, e) {
      return null == e ? e = 5 : s.isNumber(e) || (e = 0), s.transform(t, function (t, i, n) {
        e && s.isObject(i) && (i = o(i, e - 1)), t[s.camelCase(n)] = i
      })
    };
    e.exports = o
  }, {lodash: "MicNly"}],
  595: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/class"), n = {requestFullscreen: ["requestFullScreen"]}, a = o.extend({
      vendors: ["moz", "webkit", "ms", "o", "khtml"],
      el: document.body || document.documentElement,
      get: s.memoize(function (t) {
        var e = this._getProp(t);
        return !e && n[t] && s.each(n[t], function (t) {
          var i = this._getProp(t);
          i && (e = i)
        }, this), e
      }),
      prop: function (t) {
        return !!this.get(t)
      },
      _getProp: function (t) {
        var e = !1;
        return "string" == typeof this.el[t] ? t : "string" == typeof this._styles()[t] ? t : (t = t.charAt(0).toUpperCase() + t.substr(1), s.forEach(this.vendors, function (i) {
          "undefined" != typeof this.el[i + t] && (e = i + t), "undefined" != typeof this._styles()[i + t] && (e = i + t)
        }, this), e)
      },
      _styles: s.memoize(function () {
        return this.el.style
      })
    });
    e.exports = new a
  }, {lodash: "MicNly", "prima/class": 543}],
  596: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      if (t in o)return o[t];
      var i = window[t];
      if (!e || !e(i)) {
        var s = document.createElement("iframe");
        document.body.appendChild(s), i = s.contentWindow[t], document.body.removeChild(s)
      }
      return o[t] = i, i
    }

    var o = {};
    e.exports = s
  }, {}],
  597: [function (t, e, i) {
    "use strict";
    function s(t, e, i) {
      return "#" + ((1 << 24) + (t << 16) + (e << 8) + i).toString(16).slice(1)
    }

    function o(t) {
      t = String(t).replace(/[^0-9a-f]/gi, ""), t.length < 6 && (t = t[0] + t[0] + t[1] + t[1] + t[2] + t[2]);
      var e = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);
      return e ? {r: parseInt(e[1], 16), g: parseInt(e[2], 16), b: parseInt(e[3], 16)} : null
    }

    function n(t, e, i) {
      var s = Math.min(Math.min(t, e), i), o = Math.max(Math.max(t, e), i), n = o - s, a = {
        h: 6,
        s: o ? (o - s) / o : 0,
        v: o / 255
      };
      return n ? o === t ? a.h += (e - i) / n : o === e ? a.h += 2 + (i - t) / n : a.h += 4 + (t - e) / n : a.h = 0, a.h = 60 * a.h % 360, a
    }

    function a(t, e, i) {
      var s, o, n;
      if (e) {
        s = o = n = 0;
        var a = (t + 360) % 360 / 60, r = i * e, l = i - r, h = r * (1 - Math.abs(a % 2 - 1));
        1 > a ? (s = r, o = h) : 2 > a ? (s = h, o = r) : 3 > a ? (o = r, n = h) : 4 > a ? (o = h, n = r) : 5 > a ? (n = r, s = h) : (n = h, s = r), s += l, o += l, n += l
      } else s = o = n = i;
      return {r: Math.round(255 * s), g: Math.round(255 * o), b: Math.round(255 * n)}
    }

    function r(t) {
      t = String(t).replace(/[^0-9a-f]/gi, ""), t.length < 6 && (t = t[0] + t[0] + t[1] + t[1] + t[2] + t[2]);
      var e = o(t), i = n(e.r, e.g, e.b);
      return i
    }

    function l(t, e, i) {
      var o = a(t, e, i), n = s(o.r, o.g, o.b);
      return n
    }

    function h(t, e) {
      t = String(t).replace(/[^0-9a-f]/gi, ""), t.length < 6 && (t = t[0] + t[0] + t[1] + t[1] + t[2] + t[2]), e = e || 0;
      var i, s, o, n = parseInt(t, 16), a = 0 > e ? 0 : 255, r = 0 > e ? -e : e, l = n >> 16, h = n >> 8 & 255, c = 255 & n;
      return i = Math.round((a - l) * r) + l, s = Math.round((a - h) * r) + h, o = Math.round((a - c) * r) + c, "#" + (16777216 + 65536 * i + 256 * s + o).toString(16).slice(1)
    }

    function c(t, e, i) {
      return "string" == typeof t && (t = r(t)), e || (e = .2), i || (i = .8), t.s < e && t.v > i
    }

    function d(t) {
      return "string" == typeof t && (t = r(t)), c(t) ? "#444" : "#FFF"
    }

    function u(t, e, i) {
      var s = {upperBound: .8, lowerBound: .2, diffBound: .1, hueBound: 15};
      p.extend(s, i);
      var o = s.upperBound, n = s.lowerBound, a = s.diffBound, r = s.hueBound, l = Math.abs(t.h - e.h), h = Math.abs(t.s - e.s), c = Math.abs(t.v - e.v);
      return a >= l && a >= h && a >= c ? !0 : a >= h && a >= c && (h >= o || n >= h && c >= o || n >= c && r >= l) ? !0 : !1
    }

    var p = t("lodash");
    e.exports = {
      rgbToHex: s,
      hexToRgb: o,
      rgbToHsv: n,
      hsvToRgb: a,
      hexToHsv: r,
      hsvToHex: l,
      brighten: h,
      readable: d,
      compare: u,
      isLight: c
    }
  }, {lodash: "MicNly"}],
  598: [function (t, e, i) {
    "use strict";
    function s(t) {
      return new RegExp(t + "=([^;]+)").test(decodeURIComponent(document.cookie))
    }

    function o(t) {
      var e = decodeURIComponent(document.cookie).match(new RegExp(t + "=([^;]+)"));
      return e && e.length > 1 ? e[1] : null
    }

    function n(t, e, i, s) {
      "object" == typeof e && (e = JSON.stringify(e));
      var o = encodeURIComponent(t) + "=" + encodeURIComponent(e);
      if (h.isPlainObject(i) && (s = i, i = s ? s.expires : !1), s = h.extend({expires: i}, c, s), s.expires instanceof Date)o += ";expires=" + s.expires.toGMTString(); else if ("number" == typeof s.expires) {
        var n = new Date;
        n.setTime(n.getTime() + 1e3 * s.expires), o += ";expires=" + n.toGMTString()
      }
      s.path && (o += ";path=" + encodeURI(s.path)), s.secure && (o += ";secure"), s.domain && (o += ";domain=" + encodeURI(s.domain)), document.cookie = o
    }

    function a(t) {
      n(t, "", -1)
    }

    function r(t, e) {
      var i = o(t);
      try {
        i = JSON.parse(i)
      } catch (s) {
        return i
      }
      return e ? h.get(i, e) : i
    }

    function l(t, e, i, s) {
      var o;
      h.isPlainObject(e) ? (s = i, o = e) : (o = r(t) || {}, h.isPlainObject(o) || (o = {}), h.set(o, e, i)), n(t, JSON.stringify(o), s)
    }

    var h = t("lodash"), c = {path: "/", secure: !1, domain: ""}, d = {
      has: s,
      get: o,
      set: n,
      unset: a,
      getHash: r,
      setHash: l
    };
    e.exports = d
  }, {lodash: "MicNly"}],
  599: [function (t, e, i) {
    "use strict";
    function s(t, e, i) {
      return function () {
        i || (i = this);
        var s = arguments;
        return setTimeout(function () {
          t.apply(i, s)
        }, e)
      }
    }

    e.exports = s
  }, {}],
  600: [function (t, e, i) {
    "use strict";
    function s(t) {
      var e = document.implementation.createHTMLDocument("");
      return e.body.innerHTML = t, e.body
    }

    function o(t) {
      var e = document.implementation.createHTMLDocument("");
      return e.body.appendChild(t.cloneNode(!0)), e.body
    }

    function n(t) {
      return o(t).innerHTML
    }

    function a(t) {
      var e, i = document.implementation.createHTMLDocument("");
      return i.body.innerHTML = t, e = i.body.textContent || i.body.innerText || "", e = e.trim()
    }

    e.exports = {nodeFromString: s, wrapNode: o, outerHTML: n, stripTags: a}
  }, {}],
  601: [function (t, e, i) {
    "use strict";
    function s(t) {
      return t && t.nodeType && 1 === t.nodeType
    }

    var o = t("lodash");
    e.exports = function (t, e) {
      if (s(t))return t;
      if (o.isString(t)) {
        var i = (e || document).querySelector(t);
        if (s(i))return i
      }
      return t && t.jquery ? t.get(0) : !1
    }
  }, {lodash: "MicNly"}],
  602: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      e = e || "Exposer";
      var i = window;
      o.each(t, function (t, s) {
        if (o.has(i, s))throw new Error('"' + s + '" already exists');
        n.log(e, "%s.%s", i, s), o.set(i, s, t)
      })
    }

    var o = t("lodash"), n = t("../lib/logger");
    e.exports = s
  }, {"../lib/logger": 553, lodash: "MicNly"}],
  603: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = function (t, e, i) {
      if (0 === i)return 0;
      var s = null == i ? e : e / i;
      return 2 === arguments.length ? Math.round(t * s) : void 0
    }, n = function (t, e, i) {
      if (0 === i)return 0;
      var s = null == i ? e : e / i;
      return Math.round(t / s)
    }, a = function (t, e, i, s) {
      var a = t, r = e, l = t / e, h = i / s;
      return (t > i || e > s) && (l > h ? (a = i, r = n(a, l)) : (r = s, a = o(r, l))), {width: a, height: r}
    }, r = function (t, e, i, s, a, r) {
      null != a || (a = .5), null != r || (r = .5);
      var l = 0, h = 0, c = t, d = e, u = t / e, p = i / s;
      return u > p ? (c = o(e, p), l = Math.round(a * (t - c))) : p > u && (d = n(t, p), l = Math.round(r * (e - d))), {
        left: l,
        top: h,
        width: c,
        height: d
      }
    }, l = function (t) {
      var e;
      t instanceof s ? (e = t, t = e.get(0)) : e = s(t);
      var i = document.createElement("canvas");
      return i.width = t.width || e.width(), i.height = t.height || e.height(), i
    }, h = function (t, e, i) {
      var o;
      t instanceof s ? (o = t, t = o.get(0)) : o = s(t), e ? e instanceof s && (e = e.get(0)) : e = l(t);
      var n = e.width, a = e.height, r = e.getContext("2d");
      return r.save(), i && (r.translate(e.width, 0), r.scale(-1, 1)), r.drawImage(t, 0, 0, n, a), r.restore(), e
    }, c = function (t, e, i, o, a, r) {
      var l;
      t instanceof s ? (l = t, t = l.get(0)) : l = s(t);
      var h = 90 === o || 270 === o;
      h ? r && i > r && (e = n(r, i, e), i = r) : r && e > r && (i = n(r, e, i), e = r);
      var c = document.createElement("canvas");
      h ? (c.width = i, c.height = e) : (c.width = e, c.height = i);
      var d = c.getContext("2d");
      return d.save(), d.translate(.5 * c.width, .5 * c.height), d.rotate(o * Math.PI / 180), a && d.scale(-1, 1), d.drawImage(t, -.5 * e, -.5 * i, e, i), d.restore(), c
    }, d = {
      widthForHeight: o,
      heightForWidth: n,
      maxSize: a,
      cropBox: r,
      createCanvasForEl: l,
      drawElToCanvas: h,
      drawScaledAndRotated: c
    };
    e.exports = d
  }, {jquery: "HlZQrA"}],
  604: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("when"), n = t("prima/class"), a = "FileReader" in window && "readAsDataURL" in FileReader.prototype, r = (window.URL || window.webkitURL || window.mozURL || window.msURL || {}).createObjectURL, l = [], h = t("app/vendor/jpegmeta").JpegFile, c = n.extend({
      constructor: function (t) {
        null != t && this.read(t)
      }, read: function (t, e) {
        if (!s.isUndefined(e) || (e = !0), this.file = t, !t)return o.reject("No file to read");
        if (!a)return o.reject("FileReader is not supported");
        t.type.match(/image\/(jpg|jpeg)/i) || (e = !1);
        var i;
        return i = e && "readAsBinaryString" in FileReader.prototype ? this.readBinaryString(t).then(s.bind(function (e) {
          try {
            var i = new h(e.binary, t.name);
            e.rotation = function (t) {
              switch (t) {
                case 1:
                  return 0;
                case 2:
                  return 0;
                case 3:
                  return 180;
                case 4:
                  return 180;
                case 5:
                  return 270;
                case 6:
                  return 90;
                case 7:
                  return 90;
                case 8:
                  return 270;
                default:
                  return 0
              }
            }(i.tiff.Orientation.value), e.mirrored = function (t) {
              switch (t) {
                case 2:
                  return !0;
                case 4:
                  return !0;
                case 5:
                  return !0;
                case 7:
                  return !0;
                default:
                  return !1
              }
            }(i.tiff.Orientation.value)
          } catch (o) {
          }
          return this.readDataUrl(t).then(s.bind(function (t) {
            return s.extend(e, t)
          }, this))
        }, this)) : this.readDataUrl(t), this.promise = i, i
      }, readDataUrl: function (t) {
        var e = new FileReader;
        return "readAsDataURL" in e ? o.promise(function (i, s) {
          e.onload = function (t) {
            var s = t.target.result;
            i(s), e.onload = null, e.onerror = null
          }, e.onerror = function () {
            s(), e.onload = null, e.onerror = null
          }, e.readAsDataURL(t)
        }).then(s.bind(this._onLoadDataUrl, this), s.bind(this._onError, this)) : o.reject("FileReader.readAsDataURL is not supported")
      }, _onLoadDataUrl: function (t) {
        var e = {base64: t, file: this.file};
        return r && (e.objectUrl = r(this.file), l.push(e.objectUrl)), o.resolve(e)
      }, readBinaryString: function (t) {
        var e = new FileReader;
        return "readAsBinaryString" in e ? o.promise(function (i, s) {
          e.onload = function (t) {
            var s = t.target.result;
            i(s), e.onload = null, e.onerror = null
          }, e.onerror = function () {
            s(), e.onload = null, e.onerror = null
          }, e.readAsBinaryString(t)
        }).then(s.bind(this._onLoadBinaryString, this), s.bind(this._onError, this)) : o.reject("FileReader.readAsBinaryString is not supported")
      }, _onLoadBinaryString: function (t) {
        return o.resolve({binary: t, file: this.file})
      }, _onError: function (t) {
        return o.reject("Failed to read file")
      }
    }, {
      read: function (t, e) {
        var i = new c(t, e);
        return i.promise
      }, canReadFiles: function () {
        return a
      }
    });
    e.exports = c
  }, {"app/vendor/jpegmeta": 468, lodash: "MicNly", "prima/class": 543, when: "RG2dij"}],
  605: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("when"), n = t("prima/class"), a = n.extend({
      constructor: function (t) {
        null != t && this.load(t)
      }, load: function (t, e) {
        if (this.src = t, !t)return o.reject("No URL to load");
        var i = this, n = o.promise(function (o, n) {
          var a = new Image;
          a.src = t, i._img = a;
          var r;
          if (a.onload = function () {
              o(a), a.onload = null, a.error = null, clearInterval(r)
            }, a.onerror = function () {
              n(a), a.onload = null, a.error = null, clearInterval(r)
            }, a.complete)a.naturalWidth || a.naturalHeight ? "function" == typeof a.onload && a.onload() : "function" == typeof a.onerror && a.onerror(); else if (e) {
            var l = function () {
              return a.naturalWidth || a.naturalHeight ? ("function" == typeof a.onload && a.onload(), !0) : !1
            };
            l() || (s.isNumber(e) || (e = 100), r = setInterval(l, e))
          }
        });
        return this.promise = n = n.then(s.bind(this._onLoad, this), s.bind(this._onError, this)), n
      }, _onLoad: function (t) {
        return this._img === t ? (this.width = t.naturalWidth, this.height = t.naturalHeight, this.src = t.src, this.loaded = !0, o.resolve({
          width: this.width,
          height: this.height,
          src: this.src
        })) : this.promise
      }, _onError: function (t) {
        return this._img === t ? (this.width = null, this.height = null, this.src = t.src, this.loaded = !1, o.reject(this.src + " failed to load")) : this.promise
      }
    }, {
      load: function (t, e) {
        var i = new a(t, e);
        return i.promise
      }
    });
    e.exports = a
  }, {lodash: "MicNly", "prima/class": 543, when: "RG2dij"}],
  606: [function (t, e, i) {
    "use strict";
    function s(t) {
      return /.+[.](jpg|jpeg|png|gif)([?]|$)/.test(t) === !0
    }

    function o(t) {
      var e = {jpeg: "jpg"}, i = a.last((t || "").split("/")).toLowerCase();
      return a.has(e, i) ? e[i] : i
    }

    function n(t) {
      var e, i;
      return a.isString(t) && (i = t.match(/^data:(image\/.*?);/i), i ? e = i[1] : s(t) && (e = r.getExtension(t))), e ? o(e) : void 0
    }

    var a = t("lodash"), r = t("prima/utils/url");
    e.exports = {convertToNormalizedType: o, getImageType: n, isImageUrl: s}
  }, {lodash: "MicNly", "prima/utils/url": 611}],
  607: [function (t, e, i) {
    "use strict";
    var s, o = t("lodash"), n = t("../lib/data"), a = function (t, e) {
      var i = t && t.timing && t.timing.responseStart || Date.now();
      return function () {
        return e + (Date.now() - i)
      }
    }(window.performance, n.get("Context/time")), r = {
      getRealNow: o.get(window, "Tumblr.getRealNow"),
      realStartedAt: o.get(window, "Tumblr.real_started_at"),
      startedAt: o.get(window, "Tumblr.started_at")
    }, l = function () {
      return s || (s = r.getRealNow ? r : {getRealNow: a, realStartedAt: a(), startedAt: (new Date).getTime()}), s
    };
    e.exports = l(), e.exports.getElapsed = function (t) {
      return t || (t = this.getRealNow()), t - this.realStartedAt
    }
  }, {"../lib/data": 548, lodash: "MicNly"}],
  608: [function (t, e, i) {
    "use strict";
    var s = function (t, e) {
      return e || (e = this), function () {
        var i = Array.prototype.slice.call(arguments);
        return i.unshift(this), t.apply(e, i)
      }
    };
    e.exports = s
  }, {}],
  609: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("when/sequence"), n = function (t, e) {
      t = s.map(t, function (t) {
        return s.bind(t, this)
      }, e || this);
      var i = Array.prototype.slice.call(arguments, 1);
      return i[0] = t, o.apply(void 0, i)
    };
    e.exports = n
  }, {lodash: "MicNly", "when/sequence": 662}],
  610: [function (t, e, i) {
    "use strict";
    function s(t) {
      return o.isFunction(t.serialize) ? t.serialize() : o.isFunction(t.toJSON) ? t.toJSON() : void 0
    }

    var o = t("lodash");
    e.exports = s
  }, {lodash: "MicNly"}],
  611: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = {
      aElement: document.createElement("a"),
      acceptedProtocols: ["http:", "https:", "tumblr:", "mailto:"],
      _setUrl: function (t) {
        return this.aElement.setAttribute("href", t), this.aElement.setAttribute("href", this.aElement.href), this.aElement.href
      },
      parseUrl: function (t) {
        if (!s.startsWith(t, "http"))throw new URIError("Missing protocol in URL to be parsed. Must be http or https");
        return this._setUrl(t), {
          url: t,
          href: this.aElement.href,
          protocol: this.aElement.protocol,
          host: this.aElement.hostname,
          port: this.aElement.port,
          query: this.aElement.search,
          hash: this.aElement.hash,
          path: this.aElement.pathname
        }
      },
      parseTumblelogUrl: function (t) {
        try {
          -1 === t.indexOf("://") && (t = "http://" + t);
          var e = this.parseUrl(t), i = !1;
          if (s.endsWith(e.host, "tumblr.com") ? i = e.host.match(/([a-zA-Z0-9-_]+)\.tumblr\.com/i) : s.endsWith(e.host, "tumblr.net") ? i = e.host.match(/(?:^|\/\/)(?:([\w\-\_]+)\.)(?:[\w\-\_]+\.)*tumblr\.net/i) : s.endsWith(e.host, "t.dev") && (i = e.host.match(/([a-zA-Z0-9-_]+)\.t\.dev/i)), i) {
            var o = i[1];
            if ("www" === o)return !1;
            var n = {tumblelog_name: o}, a = e.path.match(/post\/([0-9]+)/i);
            return a && (n.post_id = a[1]), n
          }
          return !1
        } catch (r) {
          return !1
        }
      },
      isTumblelogUrl: function (t) {
        return this.parseTumblelogUrl(t) === !1 ? !1 : !0
      },
      parseTumblelogShortUrl: function (t) {
        try {
          -1 === t.indexOf("://") && (t = "http://" + t);
          var e = this.parseUrl(t);
          return "tmblr.co" !== e.host ? !1 : s.startsWith(e.path, "/m") ? {mentionKey: e.path.match(/^\/m([^\/]+)/)[0]} : s.startsWith(e.path, "/Z") ? {postTinyUrlHash: e.path.match(/^\/Z([^\/]+)/)[0]} : !1
        } catch (i) {
          return !1
        }
        return !1
      },
      isTumblelogShortUrl: function (t) {
        return this.parseTumblelogShortUrl(t) !== !1
      },
      isTumblrMediaUrl: function (t) {
        return t ? (-1 === t.indexOf("://") && (t = "http://" + t), !!t.match(/^https?:\/\/(\d+\.)media\.tumblr\.com\//i)) : !1
      },
      hasAllowedProtocol: function (t) {
        this._setUrl(t);
        var e = this.aElement.protocol;
        if (":" === e && (e = location.protocol), -1 === this.acceptedProtocols.indexOf(e))throw new Error("Unsupported protocol detected in URL: " + t);
        return !0
      },
      isAbsoluteUrl: function (t) {
        var e = new RegExp("^(?:[a-z]+:)?//", "i");
        return !!e.test(t || "")
      },
      getParameter: function (t) {
        var e = new RegExp("[?|&]" + t + "=([^&;]+?)(&|#|;|$)"), i = e.exec(location.search) || [null, ""], s = i[1].replace(/\+/g, "%20"), o = decodeURIComponent(s);
        return o || null
      },
      httpBuildQuery: function (t, e) {
        var i = [];
        for (var s in t)if (t.hasOwnProperty(s)) {
          var o = e ? e + "[" + s + "]" : s, n = t[s];
          if (!n)continue;
          i.push("object" == typeof n ? this.httpBuildQuery(n, o) : encodeURIComponent(o) + "=" + encodeURIComponent(n))
        }
        return i.join("&")
      },
      buildUrl: function (t, e) {
        var i = this.httpBuildQuery(e);
        return t + (s.isEmpty(i) ? "" : "?" + i)
      },
      getQueryStringHash: function (t) {
        var e = {};
        return t.replace(new RegExp("([^?=&]+)(=([^&]*))?", "g"), function (t, i, s, o) {
          e[i] = o
        }), e
      },
      isProtocolRelative: function (t) {
        var e = new RegExp("^//[^/]", "i");
        return e.test(t || "")
      },
      getExtension: function (t) {
        var e, i;
        return this.isProtocolRelative(t) && (t = this.addProtocolIfMissing(t, "http:")), s.startsWith(t, "http") && (i = this.parseUrl(t), s.isEmpty(i.path) || (e = i.path)), e || (e = t), s.last(e.split("."))
      },
      addProtocolIfMissing: function (t, e) {
        if (s.any(this.acceptedProtocols, function (e) {
            return s.startsWith(t, e)
          }))return t;
        if (-1 === this.acceptedProtocols.indexOf(e))throw new Error("Attempting to add an unsupported protocol: " + e);
        return (this.isProtocolRelative(t) ? e : e + "//") + t
      }
    };
    e.exports = o
  }, {lodash: "MicNly"}],
  612: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      e || (e = {}), t || (t = []), o.each(t, function (t) {
        o.isFunction(this[t]) && this[t].call(this, e)
      }, this)
    }

    var o = t("lodash"), n = t("backbone"), a = t("./lib/extendwithmixins"), r = ["model", "collection", "el", "id", "attributes", "className", "tagName", "events"], l = ["_setup"], h = n.View.extend({
      constructor: function (t) {
        this.cid = o.uniqueId("view"), t || (t = {}), o.extend(this, o.pick(t, r)), this._elAttributes = this.attributes, this.attributes = {}, this._ensureElement(), this.setupMethods = o.union(l, this.constructor.__super__.setupMethods, this.setupMethods), s.call(this, this.setupMethods, t), this.initialize.apply(this, arguments), this.delegateEvents()
      }, _setup: o.noop, _ensureElement: function () {
        if (this.el)this.setElement(o.result(this, "el"), !1); else {
          var t = o.extend({}, o.result(this, "_elAttributes"));
          this.id && (t.id = o.result(this, "id")), this.className && (t["class"] = o.result(this, "className"));
          var e = n.$("<" + o.result(this, "tagName") + ">").attr(t);
          this.setElement(e, !1)
        }
      }
    });
    a.applyTo(h), e.exports = h
  }, {"./lib/extendwithmixins": 552, backbone: "5kFNoY", lodash: "MicNly"}],
  613: [function (t, e, i) {
    "use strict";
    function s(t, e, i) {
      return o.isFunction(t) && (t = t(e, i)), t instanceof n ? t : e.$(t)
    }

    var o = t("lodash"), n = t("jquery"), a = t("backbone"), r = t("when"), l = t("prima/utils/serialize"), h = t("prima/mixins/accessor/simple"), c = t("../view"), d = c.extend({
      rendered: !1,
      disposed: !1,
      keepElement: !1,
      _setup: function (t) {
        t || (t = {});
        var e = o.extend({}, o.result(this.constructor.__super__, "defaults"), o.result(this, "defaults"));
        o.extend(e, o.pick(t, o.keys(e))), this.attributes = {}, this.set(e), this.changed = {};
        var i = this.render;
        this.render = o.bind(function () {
          this._beforeRender.apply(this, arguments), this.beforeRender.apply(this, arguments);
          var t = i.apply(this, arguments);
          return this.afterRender.apply(this, arguments), this._afterRender.apply(this, arguments), t
        }, this);
        var s = this.remove;
        this.remove = o.bind(function () {
          if (this.disposed)return this;
          this._beforeRemove.apply(this, arguments), this.beforeRemove.apply(this, arguments);
          var t = s.apply(this, arguments);
          return this.afterRemove.apply(this, arguments), this._afterRemove.apply(this, arguments), t
        }, this), this.subviews = o.extend({}, this.subviews, t.subviews)
      },
      initialize: o.noop,
      _registerSubview: function (t) {
        return this._subviews || (this._subviews = []), this._subviews.push(t), t
      },
      appendSubview: function (t, e) {
        return o.isString(e) && (e = this.$(e)), this._registerSubview(t), t.render(), (e || this.$el).append(t.el), t
      },
      removeSubviews: function () {
        var t = o.flatten(this._subviews);
        t && (o.invoke(t, "remove"), delete this._subviews)
      },
      renderSubviews: function () {
        this.subviews && o.forEach(this.subviews, function (t, e) {
          t instanceof a.View ? this.renderSubview(t, {name: e}) : t.collection ? this.renderCollectionSubviews(e) : this.renderSubview(e)
        }, this)
      },
      _createDefaultContainerFunction: function (t) {
        return o.bind(function () {
          return this.$('[data-subview="' + t + '[]"]')
        }, this)
      },
      _createDefaultPrepareViewFunction: function (t) {
        var e = this.subviews[t];
        return o.bind(function (i, s) {
          var o = new e.constructor(s);
          return o.$el.attr("data-subview", t), i.append(o.$el), o
        }, this)
      },
      renderCollectionSubviews: function (t) {
        var e = this.subviews[t];
        if (e) {
          var i = e.container || this._createDefaultContainerFunction(t), s = e.prepareView || this._createDefaultPrepareViewFunction(t), o = e.options || {}, n = this.createCollectionSubviewRenderer(e.collection, i, s, o, t);
          this.rendered ? n() : this.once("rendered", n, this)
        }
      },
      renderSubview: function (t, e) {
        var i, s, n, r;
        if (o.isString(t)) {
          if (r = t, t = this.subviews[r], !t)return;
          i = t.container || '[data-subview="' + r + '"]', n = t.options || {}, s = t.prepareView || function (e, i) {
              if (!o.isEmpty(e)) {
                var s = new t.constructor(i);
                return s.$el.attr("data-subview", r), e.replaceWith(s.$el), s
              }
            }
        } else t instanceof a.View && (e || (e = {}), r = e.name || "", i = e.container || '[data-subview="' + r + '"]', n = e.options || {}, s = e.prepareView || function (e) {
            return t.$el.attr("data-subview", r), e.replaceWith(t.$el), t
          });
        var l = this.createSubviewRenderer(i, s, n, r);
        this.rendered ? l() : this.once("rendered", l, this)
      },
      createSubviewRenderer: function (t, e, i, n) {
        return o.bind(function () {
          if (this.el) {
            i = i || {}, o.isFunction(i) && (i = i.call(i, this));
            var a = s(t, this, n), r = e.call(this, a, i);
            n && o.set(this, n, r), r.render(), this._registerSubview(r)
          }
        }, this)
      },
      createCollectionSubviewRenderer: function (t, e, i, n, r, l, h) {
        var c;
        return o.bind(function () {
          if (this.el) {
            var d = 0;
            if (r && (l ? d = this[r].length : this[r] = []), t === !0 && (t = this.collection), o.isFunction(t) && (t = t(this)), t instanceof a.Collection && (t = t.models), !o.isEmpty(t)) {
              var u = s(e, this, r);
              o.isEmpty(u) || (l || (c = u, u = c.clone()), o.forEach(t, function (t, e) {
                var s;
                s = o.isFunction(n) ? n.call(n, this) || {} : o.extend({}, n), s.model || (s.model = t);
                var a = "";
                r && (a = r + "[" + (d + e) + "]"), h && o.extend(s, h), this.createSubviewRenderer(u, i, s, a).call(this)
              }, this), l || c.replaceWith(u))
            }
          }
        }, this)
      },
      _beforeRender: o.noop,
      beforeRender: o.noop,
      render: function () {
        return this.disposed ? !1 : (this.renderWithTemplate(), this)
      },
      afterRender: o.noop,
      _afterRender: function () {
        this.renderSubviews(), this.rendered = !0, this.trigger("rendered", this), this._verifySubviewsRendered()
      },
      getTemplateData: function () {
        var t = l(this);
        return this.model && (t.model = l(this.model)), this.collection && (t.collection = {
          items: l(this.collection),
          length: this.collection.length
        }), t
      },
      renderWithTemplate: function (t) {
        if (o.isUndefined(this.template))throw new Error("Template function needed.");
        var e;
        return e = o.isFunction(this.template) ? this.template(t || this.getTemplateData()) : this.template, this.$el.html(e), this
      },
      afterRenderSubviews: o.noop,
      _verifySubviewsRendered: function () {
        var t = o.bind(function () {
          this.afterRenderSubviews(), this.trigger("renderedSubviews")
        }, this), e = o.reject(this._subviews, function (t) {
          return t.rendered === !0 || t._rendered === !0
        });
        o.isEmpty(e) ? t() : r.map(e, function (t) {
          return r.promise(o.partial(function (e, i) {
            t.once("rendered", e)
          }, t))
        }).then(t)
      },
      _beforeRemove: function () {
        this.removeSubviews()
      },
      beforeRemove: o.noop,
      remove: function () {
        return this.keepElement ? (this.undelegateEvents(), this.stopListening()) : c.prototype.remove.apply(this, arguments), this
      },
      afterRemove: o.noop,
      _afterRemove: function () {
        var t = ["el", "$el", "options", "model", "collection", "subviews", "_subviews", "defaults", "attributes"];
        o.forEach(t, o.bind(function (t) {
          this[t] && delete this[t]
        }, this)), this.rendered = !1, this.disposed = !0
      }
    });
    h.mixin.applyTo(d.prototype), e.exports = d
  }, {
    "../view": 612,
    backbone: "5kFNoY",
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/mixins/accessor/simple": 578,
    "prima/utils/serialize": 610,
    when: "RG2dij"
  }],
  614: [function (t, e, i) {
    "use strict";
    var s = t("prima/component"), o = t("./views/header-view"), n = s.extend({
      name: "MobileNav",
      autoAppend: !0,
      view: function () {
        return this.data ? new o(this.data) : void 0
      }
    });
    e.exports = n
  }, {"./views/header-view": 629, "prima/component": 545}],
  615: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<i class="icon_filter"></i>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  616: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<svg width="19px" height="22px" viewBox="0 0 26 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage"><path class="top-open" d="M13,10.0178223 L13,6.87965469 C13,6.06618011 12.84,2.7245838 14.527,1.44641061 C15.998,-0.143241692 17.454,0.00292164862 19.602,0.00392966862 C21.465,0.00292164862 23.022,0.163197309 24.209,1.44641061 C25.399,2.73063194 26,4.966427 26,6.87965469 L26,10.0178223 L23,10.0178223 L23,7.11103029 C23,6.27883295 22.983076,5.4231481 22.7865717,4.7089045 C22.6847765,4.3389045 22.5347899,4.00686105 22.314,3.73570197 C21.664,2.94225222 20.538,2.65089839 19.602,2.65089839 C19.4989445,2.65089839 19.3929679,2.65441527 19.2850939,2.66172851 C18.4111108,2.72097959 17.4125863,3.02942637 16.834,3.73570197 C16.189,4.53260651 16,5.84772931 16,7.11103029 L16,10.0178223 L13,10.0178223 Z" fill="#000000" sketch:type="MSShapeGroup"></path><path class="top-closed" d="M3,10.0178223 L3,6.87965469 C3,6.06618011 2.84,2.7245838 4.527,1.44641061 C5.998,-0.143241692 7.454,0.00292164862 9.602,0.00392966862 C11.465,0.00292164862 13.022,0.163197309 14.209,1.44641061 C15.399,2.73063194 16,4.966427 16,6.87965469 L16,10.0178223 L13,10.0178223 L13,7.11103029 C13,6.27883295 12.983076,5.4231481 12.7865717,4.7089045 C12.6847765,4.3389045 12.5347899,4.00686105 12.314,3.73570197 C11.664,2.94225222 10.538,2.65089839 9.602,2.65089839 C9.49894451,2.65089839 9.39296788,2.65441527 9.28509392,2.66172851 C8.41111079,2.72097959 7.41258628,3.02942637 6.834,3.73570197 C6.189,4.53260651 6,5.84772931 6,7.11103029 L6,10.0178223 L3,10.0178223 Z" fill="#000000" sketch:type="MSShapeGroup"></path><path d="M3,10.0178223 L1,10.0845369 C0.421,10.2438046 0,10.6084343 0,11.0882532 L0,20.991977 C0,21.4707879 0.527,22 1,22 L18,22 C18.476,22 19,20.9597202 19,20.9597202 L19,11.0882532 C19,10.0802302 18.475,10.0178223 18,10.0178223 L16,10.0178223 L3,10.0178223 Z" fill="#000000" sketch:type="MSShapeGroup"></path></g></svg>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  617: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="nav-wrapper"><div data-subview="primaryNav"></div><div data-subview="secondaryNav"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  618: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="splash-bg" data-img-src="' + (null == (__t = splash.image) ? "" : _.escape(__t)) + '"></div><div class="splash-sections"><div class="splash-section top"><a href="/login" class="splash-login">' + (null == (__t = __("Log in")) ? "" : _.escape(__t)) + '</a></div><div class="splash-section middle"><div class="middle-inner"><span class="splash-pitch">' + (null == (__t = __("Splash headline")) ? "" : _.escape(__t)) + '</span> <a href="/register" class="signin flat-button blue">' + (null == (__t = __("Get started")) ? "" : _.escape(__t)) + "</a>", has_app && (__p += '<a href="' + (null == (__t = app_url) ? "" : _.escape(__t)) + '" class="flat-button get-the-app">' + (null == (__t = __("Get the app")) ? "" : _.escape(__t)) + "</a>"), __p += '</div></div><div class="splash-section bottom"><a href="' + (null == (__t = splash.url) ? "" : _.escape(__t)) + '" target="_blank" rel="nofollow" class="splash-avatar" style="background-image:url(' + (null == (__t = splash.avatar) ? "" : _.escape(__t)) + ')"></a> <a href="' + (null == (__t = splash.url) ? "" : _.escape(__t)) + '" target="_blank" rel="nofollow" class="splash-name">' + (null == (__t = __("Posted by")) ? "" : _.escape(__t)) + "&nbsp;<strong>" + (null == (__t = splash.name) ? "" : _.escape(__t)) + "</strong></a></div></div>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  619: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="mobile-logo-wrapper', show_page_title && (__p += " show-page-title "), __p += " ", !_.isUndefined(show_search_field) && show_search_field && (__p += " show-search-field "), __p += '"><div data-subview="logo"></div><div data-subview="pageTitle"></div><div data-subview="searchField"></div></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  620: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<a href="/" class="logo-link"><svg class="tumblr-svg-t" width="29px" height="39px" viewBox="0 0 29 39" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g class="t-logo" id="Dashboard" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><path class="large-shadow" d="M21.9956664,26.3 L21.9956664,19.0055544 L27.9954227,19.0055542 L27.9954227,13.0048828 L27.9954227,11.0108643 L23.522766,11.0108643 L23.5540067,11.6669807 L23.7388305,15.5486452 L17.6832886,15.4792482 L17.4,24 C17.5,26.3 18.8,26.5 19.8,26.5 C20.2,26.5 21.4956664,26.4 21.9956664,26.3 Z M18.7154541,4.00225829 L17.4,2.9 L17.4,8 L22.000122,7.34490957 L22.000122,4.00225829 L18.7154541,4.00225829 Z M24.3,29.6 L24.9,31.5 C23.8,32.9 21,34 18.4,34 L18.1,34 C16.3,34 14.8,33.7 13.6,33.2 C15,35.4 17.5999998,38.0021971 21.7999998,38.0021971 C21.7999996,38.6099361 22.0022113,38.0021971 22.0999998,38.0021971 C24.6999998,38.0021971 27.4,36.1 28.6,34.7 L26.7,28.8 C26,29.2 25.1,29.5 24.3,29.6 Z" id="Shape" opacity="0.5" fill="#000000"></path><path class="inner" d="M18.5,33.6 L18.3,33.6 C11.1,33.6 9,28.2005493 9,25.0005493 L9,15 C8.58245849,15 4.99298096,15 5,15 L4.99298096,10.0285034 C4.99298096,9.92850342 5.1,9.9 5.2,9.9 C8.9,8.5 11.3,6.7 11.9,2.3 C11.8,2 12,2 12,2 L16.8,2 L17,2 L17,9.00006104 L23.012207,9.00006104 L23.012207,15 L17,15 L17,24.0839844 C17,26.1839844 17.8,27.3 19.8,27.3 C20.6,27.3 21.5,27.1 22.4,26.8 C22.5,26.8 22.6,26.8 22.6,26.9 L24.1,31.3 L24.1,31.7 C23,32.8 20.7,33.6 18.5,33.6 Z"></path><path class="outer" d="M26.1,32.2 L26.3,31.9 L23.9,25.1 C23.9,25 23.8,25 23.8,25 L19.2,25 C19.1,25 19,25.1 19,25 C18.9,24.8 19,24.4 19,24.1 L19,17 L25,17 L25,7 C25,7 19,7 19,7 L19,0 L8,0 C7.3,0 6.4,0.8 6.3,1.8 C5.8,5.9 4.1,7.5 0.5,8.7 L0.1,8.8 C0,8.9 0,8.9 0,9 L0,17.0000006 C0,17.1000006 0.1,17 0.1,17 L4,17 L4,24.8 C4,31.8 8.46560059,36.0067139 17.3656006,36.0067139 C22.0656006,36.0067139 25,33.7 26.1,32.2 Z M18.5,33.6 L18.3,33.6 C11.1,33.6 9,28.2005493 9,25.0005493 L9,15 C8.58245849,15 4.99298096,15 5,15 L4.99298096,10.0285034 C4.99298096,9.92850342 5.1,9.9 5.2,9.9 C8.9,8.5 11.3,6.7 11.9,2.3 C11.8,2 12,2 12,2 L16.8,2 L17,2 L17,9.00006104 L23.012207,9.00006104 L23.012207,15 L17,15 L17,24.0839844 C17,26.1839844 17.8,27.3 19.8,27.3 C20.6,27.3 21.5,27.1 22.4,26.8 C22.5,26.8 22.6,26.8 22.6,26.9 L24.1,31.3 L24.1,31.7 C23,32.8 20.7,33.6 18.5,33.6 Z"></path><path class="small-shadow" d="M4,19 L7,19 L7,17.0833333 C7,17 6.9,17 6.9,17 L4,17 L4,19 L4,19 Z" opacity="0.5" fill="#37465D"></path></g></svg></a>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  621: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div class="menu-burger"><div class="burger bun top"></div><div class="burger patty"></div><div class="burger bun bottom"></div></div><div class="drawer" data-subview="drawer"></div><div class="sneeze-guard"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  622: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += "", __p += show_filter_icon ? ' <span class="toggle-filter"><div data-subview="filterIcon"></div><div data-subview="filters"></div></span>' : ' <span class="toggle-nsfw-filter"><div data-subview="lockIcon"></div></span>', __p += ' <span class="search-label" for="search-input"></span>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  623: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += "" + (null == (__t = page_title) ? "" : _.escape(__t));
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  624: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<nav class="nav-site-sections"><a href="/dashboard" class="nav-item with-icon"><span class="nav-text nav-item-dashboard">' + (null == (__t = __("Dashboard")) ? "" : _.escape(__t)) + '</span></a> <a href="/likes" class="nav-item with-icon"><span class="nav-count">', parseInt(likes, 10) > 0 && (__p += "" + (null == (__t = likes) ? "" : _.escape(__t))), __p += '</span><span class="nav-text nav-item-likes">' + (null == (__t = __("Likes")) ? "" : _.escape(__t)) + '</span></a> <a href="/following" class="nav-item with-icon"><span class="nav-count">' + (null == (__t = following) ? "" : _.escape(__t)) + '</span><span class="nav-text nav-item-following">' + (null == (__t = __("Following")) ? "" : _.escape(__t)) + '</span></a> <a href="/settings" class="nav-item with-icon" data-subnav="settings"><span class="nav-text nav-item-settings has-subnav">' + (null == (__t = __("Settings")) ? "" : _.escape(__t)) + '</span></a> <a href="' + (null == (__t = url_prefix) ? "" : _.escape(__t)) + '/new/text" class="nav-item with-icon"><span class="nav-text nav-item-create-post">' + (null == (__t = __("Create a post")) ? "" : _.escape(__t)) + '</span></a></nav><nav class="nav-blog-list"><span class="nav-section-title">' + (null == (__t = __("Blogs")) ? "" : _.escape(__t)) + "</span>", _.each(blogs, function (t) {
          __p += ' <a href="' + (null == (__t = t.url) ? "" : _.escape(__t)) + '" class="nav-item"><img src="' + (null == (__t = t.avatar) ? "" : _.escape(__t)) + '" class="blog-avatar"><div class="blog-name-wrapper"><span class="blog-name">' + (null == (__t = t.name) ? "" : _.escape(__t)) + '</span> <span class="blog-title">' + (null == (__t = t.safe_title) ? "" : __t) + "</span></div></a>"
        }), __p += "</nav>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  625: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<form action="/search" method="get"><input type="text" placeholder="' + (null == (__t = __("Search Tumblr")) ? "" : _.escape(__t)) + '" autocomplete="off" class="search-input" id="search-input" name="q" value="', search_term && (__p += "" + (null == (__t = search_term) ? "" : _.escape(__t))), __p += '"> <input type="hidden" class="search-nsfw-filter-input" name="filter_nsfw"> <input type="hidden" class="filter-sort-input" name="sort" value="top"> <input type="hidden" class="filter-post-type-input" name="filter_post_type" value="any">' + (null == (__t = _subview("loader")) ? "" : __t) + "</form>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  626: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __t, __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<nav class="nav-site-sections"><a href="/settings/password" class="nav-item"><span class="nav-text">' + (null == (__t = __("Change Password")) ? "" : _.escape(__t)) + '</span></a> <a href="/settings/tfa" class="nav-item"><span class="nav-text">' + (null == (__t = __("Two Factor Authentication")) ? "" : _.escape(__t)) + '</span></a> <a href="/help" class="nav-item"><span class="nav-text">' + (null == (__t = __("Help")) ? "" : _.escape(__t)) + '</span></a> <a href="/settings/account" class="nav-item" target="_blank"><span class="nav-text desktop-view">' + (null == (__t = __("Account")) ? "" : _.escape(__t)) + '</span></a> <a href="/settings/notifications" class="nav-item" target="_blank"><span class="nav-text desktop-view">' + (null == (__t = __("Notifications")) ? "" : _.escape(__t)) + '</span></a> <a href="/settings/apps" class="nav-item" target="_blank"><span class="nav-text desktop-view">' + (null == (__t = __("Apps")) ? "" : _.escape(__t)) + "</span></a></nav>";
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  627: [function (require, module, exports) {
    var _ = require("lodash");
    module.exports = Function(_.keys(_.templateSettings.imports), "return " + function (obj) {
        var __p = "";
        Array.prototype.join;
        with (obj || {})__p += '<div data-subview="navMenu"></div><div data-subview="logoTitle"></div><div data-subview="search"></div>';
        return __p
      }.toString()).apply(void 0, _.values(_.templateSettings.imports))
  }, {lodash: "MicNly"}],
  628: [function (t, e, i) {
    "use strict";
    var s = t("prima/views/base"), o = t("../templates/_filter-icon.tpl"), n = s.extend({
      template: o,
      className: "filter-icon",
      render: function () {
        return this.$el.html(this.template()), this
      }
    });
    e.exports = n
  }, {"../templates/_filter-icon.tpl": 615, "prima/views/base": 613}],
  629: [function (t, e, i) {
    "use strict";
    var s = t("jquery"), o = t("lodash"), n = t("prima/view"), a = t("prima/events"), r = t("prima/lib/domeventor"), l = t("prima/lib/flags"), h = t("prima/mixins/subviewable"), c = t("prima/mixins/accessor"), d = t("../templates/header.tpl"), u = t("./logo-title-view"), p = t("./nav-menu-view"), m = t("./nav-search"), g = n.extend({
      className: "mobile-header",
      mixins: [h, c],
      template: d,
      defaults: {logged_in: !1},
      initialize: function (t) {
        t = o.extend({}, t), o.extend(this.attributes, o.pick(t, o.keys(this.defaults))), this.subViews.logoTitle = new u(t), this.subViews.navMenu = new p(t), l.bool("mobile_web_sticky_header") && this.setSticky(), l.bool("mobile_web_search") && (this.subViews.search = new m(t))
      },
      render: function () {
        return this.$el.html(this.template()), this.attachSubViews(), this
      },
      setSticky: function () {
        s("body").addClass("sticky-header"), this.lastPosition = r.rect().windowScrollTop, this.listenTo(a, "DOMEventor:flatscroll", this.getScrollDirection)
      },
      getScrollDirection: function (t) {
        t.windowScrollTop > 45 ? o.delay(o.bind(function () {
          this.$el.addClass("sticky")
        }, this), 500) : this.$el.removeClass("sticky"), this.lastPosition < t.windowScrollTop && t.windowScrollTop > 45 ? this.$el.addClass("hide-nav") : this.$el.removeClass("hide-nav"), this.lastPosition = t.windowScrollTop
      }
    });
    e.exports = g
  }, {
    "../templates/header.tpl": 627,
    "./logo-title-view": 633,
    "./nav-menu-view": 635,
    "./nav-search": 636,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/domeventor": 550,
    "prima/lib/flags": "f/LVtH",
    "prima/mixins/accessor": 577,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  630: [function (t, e, i) {
    "use strict";
    var s = t("prima/view"), o = t("../templates/_lock-icon.tpl"), n = s.extend({
      template: o,
      className: "lock-icon",
      render: function () {
        return this.$el.html(this.template()), this
      }
    });
    e.exports = n
  }, {"../templates/_lock-icon.tpl": 616, "prima/view": 612}],
  631: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("prima/mixins/subviewable"), r = t("../templates/_logged-in-nav.tpl"), l = t("./primary-nav"), h = t("./secondary-nav"), c = o.extend({
      template: r,
      mixins: [a, n],
      className: "drawer logged-in",
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, t), this.subViews.primaryNav = new l(t), this.subViews.secondaryNav = new h(t)
      },
      render: function () {
        return this.$el.html(this.template(this.toJSON())), this.attachSubViews(), this
      }
    });
    e.exports = c
  }, {
    "../templates/_logged-in-nav.tpl": 617,
    "./primary-nav": 638,
    "./secondary-nav": 640,
    lodash: "MicNly",
    "prima/mixins/accessor": 577,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  632: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("prima/events"), r = t("../templates/_logged-out-nav.tpl"), l = o.extend({
      template: r,
      mixins: [n],
      className: "drawer logged-out",
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, t), this.listenToOnce(a, "drawer:open", this.downloadBackground)
      },
      downloadBackground: function () {
        var t = new Image, e = this.$splashBg.data("img-src");
        t.onload = s.bind(function () {
          this.$splashBg.css("background-image", "url(" + e + ")"), this.$splashBg.addClass("loaded")
        }, this), t.src = e
      },
      render: function () {
        return this.$el.html(this.template(this.toJSON())), this.$splashBg = this.$(".splash-bg"), this
      }
    });
    e.exports = l
  }, {
    "../templates/_logged-out-nav.tpl": 618,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/accessor": 577,
    "prima/view": 612
  }],
  633: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/lib/flags"), a = t("prima/mixins/subviewable"), r = t("prima/mixins/accessor"), l = t("../templates/_logo-title.tpl"), h = t("./logo-view"), c = t("./page-title-view"), d = t("./search-field-view"), u = o.extend({
      className: "nav-logo-title",
      mixins: [a, r],
      template: l,
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, t), this.subViews.logo = new h, n.bool("mobile_web_page_titles") && this.get("page_title") && this.get("logged_in") && !this.get("search_term") ? (this.subViews.pageTitle = new c(t), this.set("show_page_title", !0)) : this.set("show_page_title", !1), n.bool("mobile_web_search") ? (this.set("show_search_field", !!this.get("search_term")), this.subViews.searchField = new d(t)) : this.set("show_search_field", !1)
      },
      render: function () {
        return this.$el.html(this.template(this.toJSON())), this.attachSubViews(), this
      }
    });
    e.exports = u
  }, {
    "../templates/_logo-title.tpl": 619,
    "./logo-view": 634,
    "./page-title-view": 637,
    "./search-field-view": 639,
    lodash: "MicNly",
    "prima/lib/flags": "f/LVtH",
    "prima/mixins/accessor": 577,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  634: [function (t, e, i) {
    "use strict";
    var s = t("prima/view"), o = t("../templates/_logo.tpl"), n = s.extend({
      template: o,
      className: "mobile-logo",
      render: function () {
        return this.$el.html(this.template()), this
      }
    });
    e.exports = n
  }, {"../templates/_logo.tpl": 620, "prima/view": 612}],
  635: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("jquery"), n = t("prima/view"), a = t("prima/mixins/subviewable"), r = t("prima/mixins/accessor"), l = t("prima/events"), h = t("../templates/_nav-menu.tpl"), c = t("./logged-in-view"), d = t("./logged-out-view"), u = n.extend({
      className: "nav-menu",
      template: h,
      mixins: [a, r],
      events: {
        "click .menu-burger": "__clickMenuBurger",
        "click [data-subnav]": "__clickSubnav",
        "click .sneeze-guard": "__clickSneezeGuard"
      },
      __clickSneezeGuard: function (t) {
        t.preventDefault(), this.closeDrawer()
      },
      __clickSubnav: function (t) {
        t.preventDefault(), this.openSubNav(o(t.currentTarget).data("subnav"))
      },
      __clickMenuBurger: function (t) {
        t.preventDefault(), this.toggleDrawer()
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, t), this.get("drawer_open") && this.openDrawer(), this.get("logged_in") ? this.subViews.drawer = new c(t) : this.subViews.drawer = new d(t), this.listenTo(l, "mobileHeader:search:click", this.closeDrawer)
      },
      render: function () {
        return this.$el.html(this.template()), this.$body = o("body"), this.$html = o("html"), this.attachSubViews(), this
      },
      toggleDrawer: function () {
        this.$el.hasClass("subnav-active") ? this.closeSubNav() : this.get("drawer_open") ? this.closeDrawer() : this.openDrawer()
      },
      openDrawer: function () {
        this.set("drawer_open", !0), this.$body.addClass("nav-drawer-open"), this.$html.addClass("nav-drawer-open"), this.$el.addClass("active"), l.trigger("drawer:open")
      },
      closeDrawer: function () {
        this.set("drawer_open", !1), this.$body.removeClass("nav-drawer-open"), this.$html.removeClass("nav-drawer-open"), this.$el.removeClass("active subnav-active"), l.trigger("drawer:closed")
      },
      openSubNav: function (t) {
        this.$el.addClass("subnav-active"), l.trigger("drawer:subnav:open", t)
      },
      closeSubNav: function () {
        this.$el.removeClass("subnav-active"), l.trigger("drawer:subnav:close")
      }
    });
    e.exports = u
  }, {
    "../templates/_nav-menu.tpl": 621,
    "./logged-in-view": 631,
    "./logged-out-view": 632,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/accessor": 577,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  636: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/events"), n = t("prima/view"), a = t("prima/mixins/subviewable"), r = t("prima/mixins/accessor"), l = t("prima/lib/flags"), h = t("../templates/_nav-search.tpl"), c = t("./lock-icon-view"), d = t("./filter-icon-view"), u = t("app/context/indash-blog/components/blog-search/views/popovers/blog-search-filter-popover"), p = t("app/context/indash-blog/components/blog-search/models/blog-search-model"), m = n.extend({
      className: "nav-search",
      mixins: [a, r],
      template: h,
      defaults: {show_filter_icon: !1},
      events: {"click .toggle-nsfw-filter": "__lockIconClick", "click .search-label": "__searchLabelClick"},
      __lockIconClick: function () {
        this.set("filter_nsfw", !this.get("filter_nsfw")), this.lockIconUpdate(), o.trigger("mobileHeader:nsfw:update", this.get("filter_nsfw"))
      },
      __searchLabelClick: function () {
        o.trigger("mobileHeader:search:click")
      },
      lockIconUpdate: function () {
        this.get("filter_nsfw") ? this.lockIconUpdateEnable() : this.lockIconUpdateDisable()
      },
      lockIconUpdateDisable: function () {
        this.set("filter_nsfw", !1), this.$el.removeClass("nsfw-filter-on"), this.$el.addClass("nsfw-filter-off")
      },
      lockIconUpdateEnable: function () {
        this.set("filter_nsfw", !0), this.$el.removeClass("nsfw-filter-off"), this.$el.addClass("nsfw-filter-on")
      },
      togglePopover: function () {
        this.popover || (this.popover = new u({
          pinnedTarget: this.subViews.filterIcon.$el,
          model: this.model
        }), this.popover.render(), this.listenTo(this.popover, "close", this.onPopoverClose))
      },
      onPopoverClose: function () {
        s.defer(s.bind(function () {
          this.popover = null
        }, this))
      },
      __filterIconClick: function () {
        this.togglePopover()
      },
      onFilterChange: function (t) {
        o.trigger("mobileHeader:filter:update", t), this.popover.hide()
      },
      bindEvents: function () {
        this.model && (this.listenTo(this.model, "change:sort", this.onFilterChange), this.listenTo(this.model, "change:post_type", this.onFilterChange), this.listenTo(this.model, "change:filter_nsfw", this.onFilterChange)), this.events["click .toggle-filter"] = "__filterIconClick"
      },
      initialize: function (t) {
        this.subViews.lockIcon = new c, t = s.extend({}, t), s.extend(this.attributes, t), l.bool("mobile_web_search_filter") && this.get("logged_in") && (this.subViews.filterIcon = new d, this.set("show_filter_icon", !0), this.model = new p({
          showOriginalPostsSwitch: !1,
          showNsfwSwitch: !0,
          sort: this.get("filter_sort").toUpperCase(),
          post_type: this.get("filter_post_type").toUpperCase(),
          filter_nsfw: this.get("filter_nsfw")
        }), this.bindEvents())
      },
      render: function () {
        return this.lockIconUpdate(), this.$el.html(this.template(this.toJSON())), this.attachSubViews(), this
      },
      teardown: function () {
        this.popover && this.popover.teardown()
      }
    });
    e.exports = m
  }, {
    "../templates/_nav-search.tpl": 622,
    "./filter-icon-view": 628,
    "./lock-icon-view": 630,
    "app/context/indash-blog/components/blog-search/models/blog-search-model": 413,
    "app/context/indash-blog/components/blog-search/views/popovers/blog-search-filter-popover": 429,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/lib/flags": "f/LVtH",
    "prima/mixins/accessor": 577,
    "prima/mixins/subviewable": 587,
    "prima/view": 612
  }],
  637: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("../templates/_page-title.tpl"), r = o.extend({
      template: a,
      className: "page-title",
      mixins: [n],
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, t)
      },
      render: function () {
        return this.$el.html(this.template(this.toJSON())), this
      }
    });
    e.exports = r
  }, {"../templates/_page-title.tpl": 623, lodash: "MicNly", "prima/mixins/accessor": 577, "prima/view": 612}],
  638: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("../templates/_primary-nav.tpl"), r = o.extend({
      template: a,
      mixins: [n],
      className: "primary-nav",
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, t)
      },
      render: function () {
        return this.$el.html(this.template(this.toJSON())), this
      }
    });
    e.exports = r
  }, {"../templates/_primary-nav.tpl": 624, lodash: "MicNly", "prima/mixins/accessor": 577, "prima/view": 612}],
  639: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/events"), a = t("prima/mixins/accessor"), r = t("../templates/_search-field.tpl"), l = t("components/loader"), h = o.extend({
      template: r,
      className: "search-field",
      mixins: [a],
      events: {"submit form": "__submitForm"},
      __submitForm: function () {
        this.toggleLoader(!0)
      },
      __handleSearchClick: function () {
        var t = this.$searchInput.val();
        this.$el.hasClass("search-term-exists") ? t === this.get("search_term") ? this.setFocus() : this.$submitForm.trigger("submit") : !t && this.$mobileLogoWrapper.hasClass("show-search-field") ? this.hideSearchField() : t && this.$mobileLogoWrapper.hasClass("show-search-field") ? this.$submitForm.trigger("submit") : this.showSearchField()
      },
      __handleNsfwFilterClick: function (t) {
        this.$searchNsfwFilterInput.val(t), this.$submitForm.prop("action", "/search/" + this.get("search_term")), this.$searchInput.prop("name", ""), this.$submitForm.trigger("submit")
      },
      __handleFilterChange: function (t) {
        var e = "top";
        "CREATED_DESC" === t.get("sort") && (e = "recent");
        var i = t.get("post_type").toLowerCase();
        this.$searchFilterSortInput.val(e), this.$searchFilterPostTypeInput.val(i), this.$searchNsfwFilterInput.val(t.get("filter_nsfw")), this.$submitForm.prop("action", "/search/" + this.get("search_term")), this.$searchInput.prop("name", ""), this.$submitForm.trigger("submit")
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, t), this.listenTo(n, "mobileHeader:search:click", this.__handleSearchClick), this.listenTo(n, "mobileHeader:nsfw:update", this.__handleNsfwFilterClick), this.listenTo(n, "mobileHeader:filter:update", this.__handleFilterChange), this.listenTo(n, "drawer:open", this.hideSearchField)
      },
      render: function () {
        return this.get("search_term") && this.$el.addClass("search-term-exists"), this.$el.html(this.template(this.toJSON())), this.$searchInput = this.$(".search-input"), this.$searchNsfwFilterInput = this.$(".search-nsfw-filter-input"), this.$searchFilterSortInput = this.$(".filter-sort-input"), this.$searchFilterPostTypeInput = this.$(".filter-post-type-input"), this.$submitForm = this.$("form"), this.$mobileLogoWrapper = this.$el.parent(), this
      },
      toggleLoader: function (t) {
        t ? this.loader ? this.loader.set("loading", !0) : this.loader = new l({
          $container: this.$el,
          type: "bar",
          classModifiers: "top",
          loading: !0
        }) : this.loader.set("loading", !1)
      },
      showSearchField: function () {
        this.$mobileLogoWrapper.addClass("show-search-field"), s.delay(s.bind(this.setFocus, this), 250)
      },
      hideSearchField: function () {
        this.$searchInput.blur(), this.$mobileLogoWrapper.removeClass("show-search-field")
      },
      setFocus: function () {
        var t = 2 * this.$searchInput.val().length;
        this.$searchInput.focus(), this.$searchInput.get(0).setSelectionRange(t, t)
      }
    });
    e.exports = h
  }, {
    "../templates/_search-field.tpl": 625,
    "components/loader": 499,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/accessor": 577,
    "prima/view": 612
  }],
  640: [function (t, e, i) {
    "use strict";
    var s = t("lodash"), o = t("prima/view"), n = t("prima/mixins/accessor"), a = t("prima/events"), r = o.extend({
      mixins: [n],
      className: "secondary-nav",
      templates: {settings: t("../templates/_settings-nav.tpl")},
      _getTemplate: function (t) {
        return "settings" === t ? this.templates.settings(this.toJSON()) : void 0
      },
      initialize: function (t) {
        t = s.extend({}, t), s.extend(this.attributes, t), this.listenTo(a, "drawer:subnav:open", this.render)
      },
      render: function (t) {
        return t ? (this.$el.html(this._getTemplate(t)), this) : this
      }
    });
    e.exports = r
  }, {
    "../templates/_settings-nav.tpl": 626,
    lodash: "MicNly",
    "prima/events": 546,
    "prima/mixins/accessor": 577,
    "prima/view": 612
  }],
  641: [function (t, e, i) {
    !function (t) {
      "use strict";
      function i() {
        this.frames = [], this.lastId = 0, this.raf = s, this.batch = {hash: {}, read: [], write: [], mode: null}
      }

      var s = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.msRequestAnimationFrame || function (t) {
          return window.setTimeout(t, 1e3 / 60)
        };
      window.cancelAnimationFrame || window.cancelRequestAnimationFrame || window.mozCancelAnimationFrame || window.mozCancelRequestAnimationFrame || window.webkitCancelAnimationFrame || window.webkitCancelRequestAnimationFrame || window.msCancelAnimationFrame || window.msCancelRequestAnimationFrame || function (t) {
        window.clearTimeout(t)
      };
      i.prototype.read = function (t, e) {
        var i = this.add("read", t, e), s = i.id;
        this.batch.read.push(i.id);
        var o = "reading" === this.batch.mode || this.batch.scheduled;
        return o ? s : (this.scheduleBatch(), s)
      }, i.prototype.write = function (t, e) {
        var i = this.add("write", t, e), s = this.batch.mode, o = i.id;
        this.batch.write.push(i.id);
        var n = "writing" === s || "reading" === s || this.batch.scheduled;
        return n ? o : (this.scheduleBatch(), o)
      }, i.prototype.defer = function (t, e, i) {
        "function" == typeof t && (i = e, e = t, t = 1);
        var s = this, o = t - 1;
        return this.schedule(o, function () {
          s.run({fn: e, ctx: i})
        })
      }, i.prototype.clear = function (t) {
        if ("function" == typeof t)return this.clearFrame(t);
        var e = this.batch.hash[t];
        if (e) {
          var i = this.batch[e.type], s = i.indexOf(t);
          delete this.batch.hash[t], ~s && i.splice(s, 1)
        }
      }, i.prototype.clearFrame = function (t) {
        var e = this.frames.indexOf(t);
        ~e && this.frames.splice(e, 1)
      }, i.prototype.scheduleBatch = function () {
        var t = this;
        this.schedule(0, function () {
          t.batch.scheduled = !1, t.runBatch()
        }), this.batch.scheduled = !0
      }, i.prototype.uniqueId = function () {
        return ++this.lastId
      }, i.prototype.flush = function (t) {
        for (var e; e = t.shift();)this.run(this.batch.hash[e])
      }, i.prototype.runBatch = function () {
        try {
          this.batch.mode = "reading", this.flush(this.batch.read), this.batch.mode = "writing", this.flush(this.batch.write), this.batch.mode = null
        } catch (t) {
          throw this.runBatch(), t
        }
      }, i.prototype.add = function (t, e, i) {
        var s = this.uniqueId();
        return this.batch.hash[s] = {id: s, fn: e, ctx: i, type: t}
      }, i.prototype.run = function (t) {
        var e = t.ctx || this, i = t.fn;
        if (delete this.batch.hash[t.id], !this.onError)return i.call(e);
        try {
          i.call(e)
        } catch (s) {
          this.onError(s)
        }
      }, i.prototype.loop = function () {
        var t = this, e = this.raf;
        this.looping || (e(function i() {
          var s = t.frames.shift();
          t.frames.length ? e(i) : t.looping = !1, s && s()
        }), this.looping = !0)
      }, i.prototype.schedule = function (t, e) {
        return this.frames[t] ? this.schedule(t + 1, e) : (this.loop(), this.frames[t] = e)
      }, t = t || new i, "undefined" != typeof e && e.exports ? e.exports = t : "function" == typeof define && define.amd ? define(function () {
        return t
      }) : window.fastdom = t
    }(window.fastdom)
  }, {}],
  642: [function (t, e, i) {
    (function (t) {
      function e(t, i) {
        if ({}.hasOwnProperty.call(e.cache, t))return e.cache[t];
        var s = e.resolve(t);
        if (!s)throw new Error("Failed to resolve module " + t);
        var o = {id: t, require: e, filename: t, exports: {}, loaded: !1, parent: i, children: []};
        i && i.children.push(o);
        var n = t.slice(0, t.lastIndexOf("/") + 1);
        return e.cache[t] = o.exports, s.call(o.exports, o, o.exports, n, t), o.loaded = !0, e.cache[t] = o.exports
      }

      e.modules = {}, e.cache = {}, e.resolve = function (t) {
        return {}.hasOwnProperty.call(e.modules, t) ? e.modules[t] : void 0
      }, e.define = function (t, i) {
        e.modules[t] = i
      };
      var i = function (e) {
        return e = "/", {
          title: "browser",
          version: "v0.10.26",
          browser: !0,
          env: {},
          argv: [],
          nextTick: t.setImmediate || function (t) {
            setTimeout(t, 0)
          },
          cwd: function () {
            return e
          },
          chdir: function (t) {
            e = t
          }
        }
      }();
      e.define("/gif.coffee", function (t, i, s, o) {
        function n(t, e) {
          return {}.hasOwnProperty.call(t, e)
        }

        function a(t, e) {
          for (var i = 0, s = e.length; s > i; ++i)if (i in e && e[i] === t)return !0;
          return !1
        }

        function r(t, e) {
          function i() {
            this.constructor = t
          }

          for (var s in e)n(e, s) && (t[s] = e[s]);
          return i.prototype = e.prototype, t.prototype = new i, t.__super__ = e.prototype, t
        }

        var l, h, c, d, u;
        c = e("events", t).EventEmitter, l = e("/browser.coffee", t), u = function (t) {
          function e(t) {
            var e, i;
            this.running = !1, this.options = {}, this.frames = [], this.freeWorkers = [], this.activeWorkers = [], this.setOptions(t);
            for (e in h)i = h[e], null != this.options[e] ? this.options[e] : this.options[e] = i
          }

          return r(e, t), h = {
            workerScript: "gif.worker.js",
            workers: 2,
            repeat: 0,
            background: "#fff",
            quality: 10,
            width: null,
            height: null,
            transparent: null
          }, d = {delay: 500, copy: !1}, e.prototype.setOption = function (t, e) {
            return this.options[t] = e, null == this._canvas || "width" !== t && "height" !== t ? void 0 : this._canvas[t] = e
          }, e.prototype.setOptions = function (t) {
            var e, i;
            return function (s) {
              for (e in t)n(t, e) && (i = t[e], s.push(this.setOption(e, i)));
              return s
            }.call(this, [])
          }, e.prototype.addFrame = function (t, e) {
            var i, s;
            null == e && (e = {}), i = {}, i.transparent = this.options.transparent;
            for (s in d)i[s] = e[s] || d[s];
            if (null != this.options.width || this.setOption("width", t.width), null != this.options.height || this.setOption("height", t.height), "undefined" != typeof ImageData && null != ImageData && t instanceof ImageData)i.data = t.data; else if ("undefined" != typeof CanvasRenderingContext2D && null != CanvasRenderingContext2D && t instanceof CanvasRenderingContext2D || "undefined" != typeof WebGLRenderingContext && null != WebGLRenderingContext && t instanceof WebGLRenderingContext)e.copy ? i.data = this.getContextData(t) : i.context = t; else {
              if (null == t.childNodes)throw new Error("Invalid image");
              e.copy ? i.data = this.getImageData(t) : i.image = t
            }
            return this.frames.push(i)
          }, e.prototype.render = function () {
            var t, e;
            if (this.running)throw new Error("Already running");
            if (null == this.options.width || null == this.options.height)throw new Error("Width and height must be set prior to rendering");
            this.running = !0, this.nextFrame = 0, this.finishedFrames = 0, this.imageParts = function (e) {
              for (var i = function () {
                var t;
                t = [];
                for (var e = 0; 0 <= this.frames.length ? e < this.frames.length : e > this.frames.length; 0 <= this.frames.length ? ++e : --e)t.push(e);
                return t
              }.apply(this, arguments), s = 0, o = i.length; o > s; ++s)t = i[s], e.push(null);
              return e
            }.call(this, []), e = this.spawnWorkers();
            for (var i = function () {
              var t;
              t = [];
              for (var i = 0; e >= 0 ? e > i : i > e; e >= 0 ? ++i : --i)t.push(i);
              return t
            }.apply(this, arguments), s = 0, o = i.length; o > s; ++s)t = i[s], this.renderNextFrame();
            return this.emit("start"), this.emit("progress", 0)
          }, e.prototype.abort = function () {
            for (var t; ;) {
              if (t = this.activeWorkers.shift(), !(null != t))break;
              console.log("killing active worker"), t.terminate()
            }
            return this.running = !1, this.emit("abort")
          }, e.prototype.spawnWorkers = function () {
            var t;
            return t = Math.min(this.options.workers, this.frames.length), function () {
              var e;
              e = [];
              for (var i = this.freeWorkers.length; this.freeWorkers.length <= t ? t > i : i > t; this.freeWorkers.length <= t ? ++i : --i)e.push(i);
              return e
            }.apply(this, arguments).forEach(function (t) {
              return function (e) {
                var i;
                return console.log("spawning worker " + e), i = new Worker(t.options.workerScript), i.onmessage = function (t) {
                  return function (e) {
                    return t.activeWorkers.splice(t.activeWorkers.indexOf(i), 1), t.freeWorkers.push(i), t.frameFinished(e.data)
                  }
                }(t), t.freeWorkers.push(i)
              }
            }(this)), t
          }, e.prototype.frameFinished = function (t) {
            return console.log("frame " + t.index + " finished - " + this.activeWorkers.length + " active"), this.finishedFrames++, this.emit("progress", this.finishedFrames / this.frames.length), this.imageParts[t.index] = t, a(null, this.imageParts) ? this.renderNextFrame() : this.finishRendering()
          }, e.prototype.finishRendering = function () {
            var t, e, i, s, o, n, a;
            o = 0;
            for (var r = 0, l = this.imageParts.length; l > r; ++r)e = this.imageParts[r], o += (e.data.length - 1) * e.pageSize + e.cursor;
            o += e.pageSize - e.cursor, console.log("rendering finished - filesize " + Math.round(o / 1e3) + "kb"), t = new Uint8Array(o), n = 0;
            for (var h = 0, c = this.imageParts.length; c > h; ++h) {
              e = this.imageParts[h];
              for (var d = 0, u = e.data.length; u > d; ++d)a = e.data[d], i = d, t.set(a, n), n += i === e.data.length - 1 ? e.cursor : e.pageSize
            }
            return s = new Blob([t], {type: "image/gif"}), this.emit("finished", s, t)
          }, e.prototype.renderNextFrame = function () {
            var t, e, i;
            if (0 === this.freeWorkers.length)throw new Error("No free workers");
            return this.nextFrame >= this.frames.length ? void 0 : (t = this.frames[this.nextFrame++], i = this.freeWorkers.shift(), e = this.getTask(t), console.log("starting frame " + (e.index + 1) + " of " + this.frames.length), this.activeWorkers.push(i), i.postMessage(e))
          }, e.prototype.getContextData = function (t) {
            return t.getImageData(0, 0, this.options.width, this.options.height).data
          }, e.prototype.getImageData = function (t) {
            var e;
            return null != this._canvas || (this._canvas = document.createElement("canvas"), this._canvas.width = this.options.width, this._canvas.height = this.options.height), e = this._canvas.getContext("2d"), e.setFill = this.options.background, e.fillRect(0, 0, this.options.width, this.options.height), e.drawImage(t, 0, 0), this.getContextData(e)
          }, e.prototype.getTask = function (t) {
            var e, i;
            if (e = this.frames.indexOf(t), i = {
                index: e,
                last: e === this.frames.length - 1,
                delay: t.delay,
                transparent: t.transparent,
                width: this.options.width,
                height: this.options.height,
                quality: this.options.quality,
                repeat: this.options.repeat,
                canTransfer: "chrome" === l.name
              }, null != t.data)i.data = t.data; else if (null != t.context)i.data = this.getContextData(t.context); else {
              if (null == t.image)throw new Error("Invalid frame");
              i.data = this.getImageData(t.image)
            }
            return i
          }, e
        }(c), t.exports = u
      }), e.define("/browser.coffee", function (t, e, i, s) {
        var o, n, a, r, l;
        r = navigator.userAgent.toLowerCase(), a = navigator.platform.toLowerCase(), l = r.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/) || [null, "unknown", 0], n = "ie" === l[1] && document.documentMode, o = {
          name: "version" === l[1] ? l[3] : l[1],
          version: n || parseFloat("opera" === l[1] && l[4] ? l[4] : l[2]),
          platform: {name: r.match(/ip(?:ad|od|hone)/) ? "ios" : (r.match(/(?:webos|android)/) || a.match(/mac|win|linux/) || ["other"])[0]}
        }, o[o.name] = !0, o[o.name + parseInt(o.version, 10)] = !0, o.platform[o.platform.name] = !0, t.exports = o
      }), e.define("events", function (t, e, s, o) {
        i.EventEmitter || (i.EventEmitter = function () {
        });
        var n = e.EventEmitter = i.EventEmitter, a = "function" == typeof Array.isArray ? Array.isArray : function (t) {
          return "[object Array]" === Object.prototype.toString.call(t)
        }, r = 10;
        n.prototype.setMaxListeners = function (t) {
          this._events || (this._events = {}), this._events.maxListeners = t
        }, n.prototype.emit = function (t) {
          if ("error" === t && (!this._events || !this._events.error || a(this._events.error) && !this._events.error.length))throw arguments[1] instanceof Error ? arguments[1] : new Error("Uncaught, unspecified 'error' event.");
          if (!this._events)return !1;
          var e = this._events[t];
          if (!e)return !1;
          if ("function" != typeof e) {
            if (a(e)) {
              for (var i = Array.prototype.slice.call(arguments, 1), s = e.slice(), o = 0, n = s.length; n > o; o++)s[o].apply(this, i);
              return !0
            }
            return !1
          }
          switch (arguments.length) {
            case 1:
              e.call(this);
              break;
            case 2:
              e.call(this, arguments[1]);
              break;
            case 3:
              e.call(this, arguments[1], arguments[2]);
              break;
            default:
              var i = Array.prototype.slice.call(arguments, 1);
              e.apply(this, i)
          }
          return !0
        }, n.prototype.addListener = function (t, e) {
          if ("function" != typeof e)throw new Error("addListener only takes instances of Function");
          if (this._events || (this._events = {}), this.emit("newListener", t, e), this._events[t])if (a(this._events[t])) {
            if (!this._events[t].warned) {
              var i;
              i = void 0 !== this._events.maxListeners ? this._events.maxListeners : r, i && i > 0 && this._events[t].length > i && (this._events[t].warned = !0, console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.", this._events[t].length), console.trace())
            }
            this._events[t].push(e)
          } else this._events[t] = [this._events[t], e]; else this._events[t] = e;
          return this
        }, n.prototype.on = n.prototype.addListener, n.prototype.once = function (t, e) {
          var i = this;
          return i.on(t, function s() {
            i.removeListener(t, s), e.apply(this, arguments)
          }), this
        }, n.prototype.removeListener = function (t, e) {
          if ("function" != typeof e)throw new Error("removeListener only takes instances of Function");
          if (!this._events || !this._events[t])return this;
          var i = this._events[t];
          if (a(i)) {
            var s = i.indexOf(e);
            if (0 > s)return this;
            i.splice(s, 1), 0 == i.length && delete this._events[t]
          } else this._events[t] === e && delete this._events[t];
          return this
        }, n.prototype.removeAllListeners = function (t) {
          return t && this._events && this._events[t] && (this._events[t] = null), this
        }, n.prototype.listeners = function (t) {
          return this._events || (this._events = {}), this._events[t] || (this._events[t] = []), a(this._events[t]) || (this._events[t] = [this._events[t]]), this._events[t]
        }
      }), t.GIF = e("/gif.coffee")
    }).call(this, this)
  }, {}],
  643: [function (t, e, i) {
    var s = t("./debugConsole"), o = function () {
      function t(t, e) {
        "number" == typeof t && "number" == typeof e && this.element.css({left: t + "px", top: e + "px"})
      }

      function e() {
        var t = this.element.get(0).getBoundingClientRect().left;
        0 > t && this.element.css("left", "+=" + -1 * t + "px");
        var e = this.element.get(0).getBoundingClientRect().top;
        0 > e && this.element.css("top", "+=" + -1 * e + "px")
      }

      var i = function (t) {
        return this.element ? (t = t || {}, this.onShow = t.onShow || function (t) {
            t.element.show()
          }, this.onHide = t.onHide || function (t) {
            t.element.hide()
          }, this.isShown = !1, void this.element.hide()) : (s.error("ControlBase requires an element"), null)
      };
      return i.prototype.hide = function () {
        this.isShown && (this.isShown = !1, this.onHide(this))
      }, i.prototype.showOverTarget = function (t, i) {
        var s = t - this.element.width() / 2, o = i - this.element.height() - 10;
        this.show(s, o), e.call(this)
      }, i.prototype.show = function (e, i) {
        t.call(this, e, i), this.isShown || (this.isShown = !0, this.onShow(this))
      }, i.prototype.size = function (t, e) {
        t && "number" == typeof t && this.element.width(t), e && "number" == typeof e && this.element.width(e)
      }, i
    }();
    e.exports = o
  }, {"./debugConsole": 645}],
  644: [function (t, e, i) {
    var s = t("lodash"), o = t("jquery"), n = t("./sanitize"), a = function () {
      function t(t) {
        t.normalize();
        for (var e = document.createTreeWalker(t, NodeFilter.SHOW_TEXT, null, !1); e.nextNode();) {
          var i = e.currentNode, s = o(i).parent().is(t);
          s && "" !== i.nodeValue.trim() && o(i).wrap("<p>")
        }
      }

      function e(e) {
        t(e), o(e).children().each(function () {
          var t = o(this).get(0), e = t.nodeName === _, i = t.nodeName === f;
          v(t) || b(t) || e || i || o(this).wrap("<p>")
        })
      }

      function i(t) {
        return s.filter(o(t).find("*").toArray(), function (t) {
          return v(t) || w(t)
        })
      }

      function a(t, n) {
        t.normalize(), n || e(t);
        var a = i(t);
        (a.length || !n) && (n && (e(t), a = i(t)), o(t).empty(), s.each(a, function (e) {
          var i = s.some(o(e).children().toArray(), function (t) {
            return v(t)
          });
          (w(e) || !d(e) && !i) && o(t).append(e)
        }))
      }

      function r(t) {
        if (!w(t)) {
          var e = o(t).children(m.join()).toArray(), i = !1;
          s.each(e, function (t) {
            i || (o(t).unwrap(), i = !0), r(t)
          })
        }
      }

      function l(t, e) {
        var n = i(t);
        s.each(n, function (t) {
          o(t).find("li").contents().unwrap(), e && (o(t).find("br:last-child").remove(), o(t).append("<br>")), o(t).contents().unwrap()
        })
      }

      function h(t) {
        var i = x(t);
        i.shift();
        for (var s = i.shift(); s && !o(s).is("[contentEditable]");) {
          var n = s.parentNode;
          o(s).contents().unwrap(), e(n), s = i.shift()
        }
      }

      function c(t) {
        if (t && t.length) {
          for (var e = t.shift(), i = !1, n = ["style", "dir"]; e;) {
            var a = o(e).find("span").toArray();
            "SPAN" === e.nodeName && a.push(e), a.length && (i = !0), o(a).contents().unwrap(), s.each(n, function (t) {
              o(e).removeAttr(t), o(e).find("[" + t + "]").removeAttr(t)
            }), e = t.shift()
          }
          return i
        }
      }

      function d(t, e) {
        var i = o(t).text();
        e && (i = i.replace(/\n|\r/gm, "").trim());
        var s = t && t.nodeName === f;
        return "" === i && !b(t) && !y(t) && !s
      }

      function u(t) {
        var e = document.implementation.createHTMLDocument("");
        return e.body.innerHTML = t, e.body
      }

      function p(t) {
        var e = document.implementation.createHTMLDocument("");
        return e.body.appendChild(t.cloneNode(!0)), e.body
      }

      var m = ["P", "FIGURE", "H2", "BLOCKQUOTE", "UL", "OL", "PRE"], g = ["FIGURE", "IFRAME", "IMG", "HR"], _ = "DIV", f = "HR", v = function (t) {
        return s.contains(m, t.nodeName)
      }, b = function (t) {
        return t && s.contains(g, t.nodeName)
      }, y = function (t) {
        return o(t).find(g.join()).length
      }, w = function (t) {
        return "false" === o(t).attr("contenteditable")
      }, x = function (t) {
        return s.filter(t, function (t) {
          return s.contains(m, t.nodeName)
        })
      }, C = function (t) {
        this.sanitizeConfig = t
      };
      return C.prototype.flattenBlocksDown = function (t, e) {
        a(t, e)
      }, C.prototype.unBlock = function (t) {
        r(t)
      }, C.prototype.unwrapParentBlocks = function (t) {
        h(t)
      }, C.prototype.scrubSpansAndBadAttrs = function (t, e) {
        return c(t, e)
      }, C.prototype.blockifyInlineNodes = function (t) {
        e(t)
      }, C.prototype.inlinify = function (t, e) {
        l(t, e)
      }, C.prototype.getBlockNodes = function (t) {
        return i(t)
      }, C.prototype.isEmptyElement = function (t, e) {
        return d(t, e)
      }, C.prototype.filterHTML = function (t) {
        var e = u(t), i = new n(this.sanitizeConfig), s = i.clean_node(e), o = p(s), a = o.innerHTML, r = a.replace(/[<]p[>][ ]*[<]\/p[>]/g, "");
        return r
      }, C.prototype.filterPlaintext = function (t, e) {
        var i = s.escape(t);
        return i = i.replace(/\r\n/g, "\n"), i = i.replace(/\r/g, "\n"), e && (i = i.replace(/\n([ ]*\n)+/g, "</p><p>")), i = i.replace(/\n/g, "<br>"), e && (i = "<p>" + i + "</p>"), i
      }, C.prototype.convertToBrowserSpaces = function (t) {
        return t.replace(/[ ]{2}/g, " ").replace(/[ ]$/, "")
      }, C.prototype.sanitizeIFrames = function (t) {
        var e = u(t);
        return o(e).find("iframe").each(function () {
          o(this).attr("data-original-src", o(this).attr("src")), o(this).attr("src", "javascript:''")
        }), e.innerHTML
      }, C.prototype.unSanitizeIFrames = function (t) {
        var e = u(t);
        return o(e).find("iframe[data-original-src]").each(function () {
          o(this).attr("src", o(this).attr("data-original-src")), o(this).removeAttr("data-original-src")
        }), e.innerHTML
      }, C
    }();
    e.exports = a
  }, {"./sanitize": 655, jquery: "HlZQrA", lodash: "MicNly"}],
  645: [function (t, e, i) {
    var s = t("lodash"), o = t("./ligature"), n = ["assert", "clear", "constructor", "count", "debug", "dir", "dirxml", "error", "group", "groupCollapsed", "groupEnd", "info", "log", "markTimeline", "profile", "profileEnd", "table", "time", "timeEnd", "timeStamp", "timeline", "timelineEnd", "trace", "warn"], a = function (t) {
      return function () {
        return o.debugMode ? window.console[t].bind(window.console).apply(this, arguments) : s.noop
      }
    }, r = {};
    s.each(n, function (t) {
      r[t] = a(t)
    }), e.exports = r
  }, {"./ligature": 650, lodash: "MicNly"}],
  646: [function (t, e, i) {
    var s = t("lodash"), o = t("jquery"), n = t("velocity-animate"), a = n.animate, r = t("./controlBase"), l = function () {
      function t() {
        var t = this, e = s.reduce(this.controlsOrder, function (t, e) {
          return s.has(this.controls, e) && t.push(this.template(s.extend({name: e}, this.controls[e]))), t
        }, [], this);
        this.element = o("<div />", {"class": "bubbles"}).css({
          position: "absolute",
          top: 0,
          left: 0
        }).html(e), this.buttons = o(this.element).find("[data-command]"), this.hide(), this.buttons.on("mousedown", function (t) {
          t.preventDefault()
        }), this.buttons.on("mouseup", function (e) {
          e.preventDefault(), l.call(t, this)
        })
      }

      function e() {
        s.each(this.controls, function (t, e) {
          s.has(t, "keyboard") && this.keyboardEvents.on(t.keyboard, s.partial(n.bind(this), e)), s.has(t, "keyboardInverse") && this.keyboardEvents.on(t.keyboardInverse, s.partial(i.bind(this), e))
        }, this)
      }

      function i(t) {
        s.has(this.controls, t) && u[t] && n.call(this, t)
      }

      function n(t) {
        var e, i, o, n;
        s.has(this.controls, t) && (e = u[t], i = this.controls[t], o = i.command, n = i.el, e && this.inverseCommand && "function" == typeof this.inverseCommand ? this.inverseCommand(o, n, this) : this.applyCommand && "function" == typeof this.applyCommand && this.applyCommand(o, n, this), this.onAction(this))
      }

      function l(t) {
        n.call(this, o(t).attr("data-name"))
      }

      function h() {
        this.buttons.removeClass("active"), this.buttons.filter(function () {
          return u[o(this).attr("data-name")]
        }).addClass("active")
      }

      function c(t, e) {
        var i = !1;
        return o.each(t, function (t, s) {
          return s === e || "undefined" != typeof s.nodeName && s.nodeName === e ? (i = !0, !1) : void 0
        }), i
      }

      var d = '<div class="<%= className %>" title="<%= title %>" data-name="<%= name %>" data-el="<%= el %>" data-command="<%= command %>" data-type="<%= type %>">&nbsp;</div>', u = {}, p = function (i, o, n) {
        n = n || {}, this.applyCommand = i, this.inverseCommand = o, this.template = s.template(n.template || d), this.controls = n.controls || {}, this.controlsOrder = n.controlsOrder || s.keys(this.controls), this.onAction = n.onAction || s.noop, this.keyboardEvents = n.keyboardEvents, t.call(this), this.keyboardEvents && e.call(this), r.call(this, n)
      };
      return s.assign(p.prototype, r.prototype), p.prototype.setActives = function (t) {
        u = s.reduce(this.controls, function (e, i, s) {
          var o = i.command, n = (i.el || "").toUpperCase(), a = c(t, n), r = !1;
          try {
            r = document.queryCommandEnabled(o) && document.queryCommandState(o)
          } catch (l) {
            r = !1
          }
          return e[s] = r || a, e
        }, {}, this), h.call(this)
      }, p.prototype.open = function (t, e) {
        if (!this.isShown) {
          var i = o(this.element).children("[data-command]"), s = o(this.element).find(".shim");
          o(this.element).css({width: "auto"}), s.remove(), i.removeAttr("style")
        }
        this.showOverTarget(t, e)
      }, p.prototype.closeWithShim = function (t, e, i, n) {
        var r = o(this.element), l = o(t), h = o('<div class="shim">&nbsp;</div>').get(0), c = s.has(a, "Promise");
        i = c ? i : 200;
        var d = r.width();
        r.css("width", d + e);
        var u = l.position().left, p = d / 2 - (u + e / 2);
        l.before(h).hide();
        var m = o(h).offset().left + p, g = o(h).offset().top;
        this.isAnimating = !0, s.forEach(this.buttons, function (t, e) {
          a(t, "stop"), a(t, {opacity: 0}, {duration: .5 * i})
        }), a(r, {left: "+=" + p}, {easing: "ease", duration: i});
        var _ = a(h, {width: e}, {easing: "ease", duration: i}), f = s.bind(function () {
          s.isFunction(n) && n.call(this, m, g), this.isAnimating = !1, this.hide()
        }, this);
        c ? _.then(f) : s.delay(f, i)
      }, p.prototype.getActiveStates = function () {
        return u
      }, p
    }();
    e.exports = l
  }, {"./controlBase": 643, jquery: "HlZQrA", lodash: "MicNly", "velocity-animate": "lWl/mc"}],
  647: [function (t, e, i) {
    var s = t("lodash"), o = function () {
      function t() {
        return navigator.platform.match(/^Win/i) ? "Win" : navigator.platform.match(/^Mac/i) ? "Mac" : navigator.platform.match(/^Linux/i) ? "Linux" : navigator.platform
      }

      function e() {
        return s.extend({}, this.prettyMapping, this.platformPrettyMapping[t.call(this)])
      }

      function i() {
        return this.platformModifiers[t.call(this)] || {}
      }

      function o() {
        var e = t.call(this);
        return s.has(this.platformPrettySeperators, e) ? this.platformPrettySeperators[e] : this.seperator
      }

      function n(t) {
        return this.specialKeys[t.keyCode] || String.fromCharCode(t.keyCode)
      }

      function a(t) {
        return s.filter(this.modifiers, function (e) {
          return t[e + "Key"]
        })
      }

      function r(t) {
        return t.charAt(0).toUpperCase() + t.slice(1).toLowerCase()
      }

      var l = ["ctrl", "meta", "alt", "shift"], h = "+", c = {
        37: "LEFT",
        38: "UP",
        39: "RIGHT",
        40: "DOWN",
        187: "PLUS",
        61: "PLUS",
        188: "COMMA",
        189: "MINUS",
        173: "MINUS",
        190: "DOT",
        32: "SPACE"
      }, d = {
        LEFT: "",
        RIGHT: "",
        DOWN: "",
        UP: "",
        PLUS: "+",
        COMMA: ",",
        MINUS: "-",
        DOT: ".",
        SPACE: "Space"
      }, u = {Win: {meta: "ctrl"}, Linux: {meta: "ctrl"}}, p = {Mac: {meta: "", shift: "", alt: ""}}, m = {
        Win: "-",
        Linux: "-",
        Mac: ""
      }, g = function (t) {
        t = t || {}, this.modifiers = t.modifiers || l, this.separator = t.separator || h, this.specialKeys = t.specialKeys || c, this.prettyMapping = t.prettyMapping || d, this.platformModifiers = t.platformsModififiers || u, this.platformPrettyMapping = t.platformPrettyModifiers || p, this.platformPrettySeperators = t.platformPrettySeperators || m
      };
      return g.prototype.translate = function (t) {
        var e = a.call(this, t);
        return 0 === e.length ? null : e.concat(n.call(this, t)).join(this.separator)
      }, g.prototype.normalize = function (t) {
        var e = t.split(this.separator), o = i.call(this), n = "";
        return s.each(this.modifiers, function (t) {
          var i = s.indexOf(e, t.toLowerCase()), a = o[t] || t;
          i >= 0 && (n += a + this.separator, e.splice(i, 1))
        }, this), n + e.join(this.separator).toUpperCase()
      }, g.prototype.pretty = function (t) {
        var i = this.normalize(t), n = e.call(this), a = o.call(this);
        return s.map(i.split(this.separator), function (t) {
          return n[t] || r(t)
        }, this).join(a)
      }, g
    }();
    e.exports = o
  }, {lodash: "MicNly"}],
  648: [function (t, e, i) {
    var s = t("lodash"), o = t("jquery"), n = t("./controlBase"), a = function () {
      function t() {
        this.element = o("<div />", {"class": "inline-controls"}).css({
          position: "absolute",
          top: 0,
          left: 0
        }), this.opener = o("<div />", {"class": "opener"}), this.isTrayOpen = !1;
        var t = this;
        this.opener.on("mousedown", function (i) {
          return i.preventDefault(), i.stopPropagation(), e.call(t, null, !0), !1
        }), this.tray = o("<div />", {"class": "tray"}), this.element.append(this.opener), this.element.append(this.tray), this.hide()
      }

      function e(t, e) {
        "boolean" != typeof t && (t = !this.isTrayOpen), t ? (this.openTray.call(this, this.tray), this.isTrayOpen = !0, this.onTrayOpened.call(this, e)) : (this.closeTray.call(this, this.tray), this.isTrayOpen = !1, this.onTrayClosed.call(this, e)), o(this.opener).toggleClass("open", this.isTrayOpen), e ? o(this.opener).toggleClass("closed", !this.isTrayOpen) : o(this.opener).removeClass("closed")
      }

      var i = function (e) {
        e = e || {}, this.openTray = e.openTray || this.openTray, this.closeTray = e.closeTray || this.closeTray, this.onTrayOpened = e.onTrayOpened || function (t) {
          }, this.onTrayClosed = e.onTrayClosed || function (t) {
          }, this.customOffset = e.customOffset || s.noop, this.keyboardEvents = e.keyboardEvents, t.call(this), n.call(this, e)
      };
      s.assign(i.prototype, n.prototype);
      var a = s.memoize(function (t, e) {
        var i;
        return s.isFunction(e) ? i = e.call() : s.isObject(e) && (i = e), s.pick(s.defaults(s.isObject(i) ? i : {}, {
          x: t.x || t,
          y: t.y || 0
        }), ["x", "y"])
      });
      return i.prototype.addToTray = function (t, e) {
        var i;
        e = e || {}, this.tray.append(t), i = e.keyboard, this.keyboardEvents && i && this.keyboardEvents.on(i.shortcut, i.callback, i.context)
      }, i.prototype.openTray = function (t) {
        t.show()
      }, i.prototype.closeTray = function (t) {
        t.hide()
      }, i.prototype.open = function (t, i) {
        if (t) {
          i = a(i || 0, this.customOffset || 0);
          var s = o(t).position(), n = parseInt(o(t).css("margin-top"), 10) || 0;
          e.call(this, !1), this.show(s.left + i.x, s.top + i.y + n)
        }
      }, i.prototype.close = function () {
        e.call(this, !1), this.hide()
      }, i.prototype.toggleTrayWithIntent = function (t) {
        e.call(this, t, !0)
      }, i
    }();
    e.exports = a
  }, {"./controlBase": 643, jquery: "HlZQrA", lodash: "MicNly"}],
  649: [function (t, e, i) {
    var s = t("lodash"), o = t("jquery"), n = t("./humanKeys"), a = function () {
      function t() {
        o(this.element).on("keydown.keycombos", i.bind(this)), this.listening = !0
      }

      function e() {
        o(this.element).off("keydown.keycombos"), this.listening = !1
      }

      function i(t) {
        var e = this.humanKeys.translate(t);
        e && r.call(this, e) && (a.call(this, e, t), t.preventDefault(), t.stopImmediatePropagation())
      }

      function a(t, e) {
        s.each(h.call(this, t), function (i) {
          s.has(i, "callback") && s.has(i, "context") && i.callback.call(i.context, e, t)
        })
      }

      function r(t) {
        return h.call(this, t).length > 0
      }

      function l(t, e) {
        var i = h.call(this, t);
        return s.filter(i, {callback: e}).length > 0
      }

      function h(t) {
        return s.has(this.subscribers, t) ? this.subscribers[t] : []
      }

      function c(e, i, o) {
        return l.call(this, e, i) ? void 0 : (s.has(this.subscribers, e) || (this.subscribers[e] = []), this.subscribers[e].push({
          callback: i,
          context: o
        }), this.listening || t.call(this), this)
      }

      function d() {
        this.subscribers = {}, e.call(this)
      }

      function u(t, i) {
        return t ? s.has(this.subscribers, t) ? (i && (this.subscribers[t] = s.reject(this.subscribers[t], {callback: i})), i && 0 !== this.subscribers[t].length || delete this.subscribers[t], 0 === s.values(this.subscribers).length && e.call(this), this) : this : (d.call(this), this)
      }

      var p = function (t) {
        t = t || {}, this.debounceRate = t.debounceRate || 100, this.element = t.element || document, this.humanKeys = t.humanKeys || new n, this.subscribers = {}, this.listening = !1
      };
      return p.prototype.on = function (t, e, i) {
        s.each((t || "").split(" "), function (t) {
          c.call(this, this.humanKeys.normalize(t), e, i)
        }, this)
      }, p.prototype.off = function (t, e) {
        t ? s.each(t.split(" "), function (t) {
          u.call(this, this.humanKeys.normalize(t), e)
        }, this) : u.call(this, null, e)
      }, p
    }();
    e.exports = a
  }, {"./humanKeys": 647, jquery: "HlZQrA", lodash: "MicNly"}],
  650: [function (t, e, i) {
    var s = {debugMode: !1};
    e.exports = s
  }, {}],
  651: [function (t, e, i) {
    var s = t("lodash"), o = t("jquery"), n = t("velocity-animate"), a = t("./utils"), r = t("./selectionPersistence"), l = t("./controlBase"), h = t("./debugConsole"), c = function () {
      function t() {
        this.element = o("<div />", {"class": "link-bubbles"}).css({
          position: "absolute",
          top: 0,
          left: 0
        }), this.linkUrl = o("<div />", {"class": "url"}), this.linkEditInput = o("<input />", {
          type: "text",
          placeholder: "http://"
        }), this.linkEditDone = o("<div />", {"class": "done"}).text(this.actionNames.done), this.linkUrl.hide(), this.linkUrl.append(this.linkEditInput).append(this.linkEditDone), e.call(this), this.element.append(this.linkUrl), this.hide()
      }

      function e() {
        var t = this, e = o("<div />", {"class": "options"}), s = {
          edit: function () {
            i.call(this)
          }, remove: function () {
            var t = window.getSelection(), e = document.createRange();
            e.selectNodeContents(this.linkElement), t.removeAllRanges(), t.addRange(e), window.document.execCommand("unlink", !1, null), t.removeAllRanges(), this.onChange(), this.hide()
          }, open: function () {
            var t = o(this.linkElement).attr("href");
            -1 === t.indexOf("://") && (t = "http://" + t), window.open(t, "_blank")
          }
        };
        for (var n in s) {
          var a = o("<div />", {"class": n}).text(this.actionNames[n]);
          o(a).on("click", function (e) {
            return function () {
              e.call(t)
            }
          }(s[n])), e.append(a)
        }
        e.hide(), o(this.element).append(e)
      }

      function i() {
        this.linkElement || h.error("Cannot edit link without a valid linkElement");
        var t = this.linkElement;
        c.call(this, function (e) {
          o(t).attr("href", e)
        }, o(t).attr("href"))
      }

      function c(t, e) {
        e && (this.linkEditInput.val(e), this.linkUrl.addClass("modified"));
        var i = this, s = function () {
          var e = o(i.linkEditInput).val().trim();
          t(e), i.onChange(), i.close()
        };
        o(this.linkEditInput).on("keydown", function (t) {
          i.linkUrl.addClass("modified"), t.keyCode === u.enter ? (t.preventDefault(), s()) : t.keyCode === u.esc && (i.close(), i.onDismiss(), t.stopPropagation())
        }), o(this.linkEditInput).on("keyup", function (t) {
          t.keyCode !== u.esc && t.keyCode !== u.enter && d.call(i)
        }), o(this.linkEditInput).on("paste", function (t) {
          i.linkUrl.addClass("modified"), d.call(i)
        }), this.linkEditDone.on("click", function (t) {
          t.preventDefault(), s()
        }), this.element.find(".options").hide(), this.linkUrl.show(), this.show(), d.call(this), o(this.linkEditInput).focus()
      }

      function d() {
        var t = o(this.linkEditInput).val(), e = o(this.linkEditDone).outerWidth(), i = o(this.linkUrl).outerWidth() - o(this.linkUrl).width(), s = a.calcTextWidth(o(this.linkEditInput).get(0), t), r = a.calcTextWidth(o(this.linkEditInput).get(0), "A"), l = s + e + i + r, h = l < this.minWidth ? this.minWidth : l;
        h = h > this.maxWidth ? this.maxWidth : h;
        var c = o(this.element), d = h - c.width();
        if (0 !== d) {
          var u = Math.floor(d / 2);
          n(c, {width: h, left: "-=" + u}, {duration: 40, easing: "ease"})
        }
      }

      var u = {shift: 16, enter: 13, esc: 27, "delete": 8, tab: 9}, p = function (e) {
        this.onChange = "onChange" in e && s.isFunction(e.onChange) ? e.onChange : s.noop, this.onDismiss = e.onDismiss || s.noop, this.bypassClasses = "bypassClasses" in e && s.isArray(e.bypassClasses) ? e.bypassClasses : [], this.maxWidth = "maxWidth" in e && s.isNumber(e.maxWidth) ? e.maxWidth : 600, this.minWidth = "minWidth" in e && s.isNumber(e.minWidth) ? e.minWidth : 200, this.linkElement = null, this.labels = s.extend({}, {
          Edit: "Edit",
          Remove: "Remove",
          Open: "Open",
          Done: "Done"
        }, e.labels), this.actionNames = {
          edit: this.labels.Edit,
          remove: this.labels.Remove,
          open: this.labels.Open,
          done: this.labels.Done
        }, t.call(this), l.call(this)
      };
      return s.assign(p.prototype, l.prototype), p.prototype.createLink = function (t) {
        c.call(this, function (e) {
          r.restoreSelection(t), window.document.execCommand("createLink", !1, e);
          var i = window.getSelection(), s = i.getRangeAt(0);
          s.collapse(!1), i.removeAllRanges(), i.addRange(s)
        })
      }, p.prototype.showOptions = function (t) {
        this.linkElement = t, this.linkUrl.hide(), this.element.css({
          width: "",
          left: 0
        }), this.element.find(".options").show()
      }, p.prototype.close = function () {
        this.linkUrl.hide(), this.element.find(".options").hide(), this.element.css("width", ""), this.linkEditInput.val("").unbind(), this.linkEditDone.unbind(), this.linkUrl.removeClass("modified"), this.linkElement = null, this.hide()
      }, p.prototype.isValidLink = function (t) {
        return t ? !s.some(this.bypassClasses, function (e) {
          return o(t).hasClass(e)
        }) : !1
      }, p
    }();
    e.exports = c
  }, {
    "./controlBase": 643,
    "./debugConsole": 645,
    "./selectionPersistence": 657,
    "./utils": 660,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "velocity-animate": "lWl/mc"
  }],
  652: [function (t, e, i) {
    var s = t("lodash"), o = t("./ligature");
    e.exports = s.extend(o, {
      RichTextEditor: t("./richTextEditor"),
      PlainTextEditor: t("./plainTextEditor"),
      SelectionContext: t("./selectionContext"),
      SelectionPersistence: t("./selectionPersistence"),
      Utils: t("./utils"),
      HumanKeys: t("./humanKeys")
    })
  }, {
    "./humanKeys": 647,
    "./ligature": 650,
    "./plainTextEditor": 653,
    "./richTextEditor": 654,
    "./selectionContext": 656,
    "./selectionPersistence": 657,
    "./utils": 660,
    lodash: "MicNly"
  }],
  653: [function (t, e, i) {
    var s = t("lodash"), o = t("jquery"), n = t("./dataFilter"), a = t("./selectionPersistence"), r = t("./selectionContext"), l = t("./undoManager"), h = t("./smartQuoter"), c = t("./keyComboEvents"), d = t("./debugConsole"), u = function () {
      function t() {
        g.call(this, k);
        var t = o("<div />", {
          "data-js": "editor-wrapper",
          "class": "editor-wrapper"
        }).css("position", "relative"), i = o("<div />", {
          "data-js": "editor-slot",
          "class": "editor-slot"
        }).css("position", "relative");
        o(this.element).wrap(t).wrap(i), this.placeholderElement = o("<div />", {
          "data-js": "editor-placeholder",
          "class": "editor-placeholder"
        }).css("position", "absolute"), i = o(this.element).parent(), i.append(this.placeholderElement), u.call(this), e.call(this)
      }

      function e() {
        var t = this, e = function () {
          y.call(this), i.call(this), this.onChange()
        };
        o(this.element).on("input keydown keyup keypress mousedown mouseup", function (e) {
          t.config.onClientEvent.call(t, e)
        }), o(this.element).on("keydown", function (e) {
          if (e.keyCode === E.shift)t.keyModifiers.shift = !0; else if (e.keyCode === E.backspace)C.call(t); else if (e.keyCode === E.enter)return t.config.forceSingleLine || e.metaKey || v.call(t, this, !1), void e.preventDefault();
          s.defer(function () {
            t.onChange(e)
          })
        }), o(this.element).on("keyup", function (i) {
          i.keyCode === E.shift ? t.keyModifiers.shift = !1 : i.keyCode === E.enter ? C.call(t) : (i.keyCode === E.backspace || i.keyCode === E["delete"]) && s.defer(function () {
            C.call(t)
          }), e.call(t)
        }), o(this.element).on("input", function (i) {
          e.call(t)
        }), o(this.element).on("blur", function (e) {
          t.onChange()
        });
        var n = !1;
        o(this.element).on("mouseup", function () {
          n = !1, i.call(t)
        }), o(this.element).on("mousedown", function (t) {
          n = !0
        }), o(this.element).on("mouseleave", function () {
          n && i.call(t)
        }), o(this.element).on("paste", function (e) {
          var i = (e.originalEvent || e).clipboardData;
          t.config.pasteHook(i, t.keyModifiers.shift) || p.call(t, i, e), e.preventDefault()
        }), o(this.element).on("drop", function (t) {
          t.stopPropagation(), t.preventDefault()
        }), this.placeholderElement.on("click", function () {
          t.isEmpty() && o(t.element).focus()
        }), o(this.element).on("focus", function () {
          s.defer(function () {
            t.onChange()
          })
        })
      }

      function i() {
        var t = this;
        setTimeout(function () {
          var e = r.getSelection();
          t.config.onSelection.call(t, e)
        }, 200)
      }

      function u() {
        var t = this.isEmpty() ? this.config.placeholder : "", e = o(this.placeholderElement);
        e.html(t);
        var i = e.outerHeight();
        i && o(this.element).css("min-height", Math.max(parseInt(e.css("min-height"), 10) || 0, i))
      }

      function p(t, e) {
        var i = "";
        if (s.contains(t.types, "text/plain"))i = t.getData("text/plain"), i = this.dataFilter.filterPlaintext(i), f.call(this, i); else {
          if (!s.contains(t.types, "text/html"))return;
          i = t.getData("text/html"), i = this.dataFilter.filterHTML(i);
          var o = i.replace(/<br(\s*)\/*>/gi, "\n").replace(/(<[p|div])/gi, "\n$1"), n = document.implementation.createHTMLDocument("");
          n.body.innerHTML = o;
          var a = n.body, r = a.textContent || a.innerText || "", l = r.split("\n").join("<br>");
          f.call(this, l)
        }
        if (this.config.forceSingleLine) {
          var h = _.call(this).replace(/<br\s*\/*>/g, " ");
          g.call(this, h)
        }
        this.onChange(e)
      }

      function m() {
        o(this.element).contents().filter(function () {
          return 3 === this.nodeType
        }).wrap("<span></span>")
      }

      function g(t) {
        o(this.element).html(t)
      }

      function _() {
        return o(this.element).html().trim()
      }

      function f(t) {
        if (t = t.replace(/[<]br\s?\/?[>]$/, ""), t = this.dataFilter.convertToBrowserSpaces(t), !t)return void d.warn("Cannot insert empty data");
        var e = r.getSelection();
        if (!e || !e.focusNode)return void d.warn("Cannot insert without the editor having a cursor or selection");
        var i = e.getRangeAt(0);
        i.deleteContents();
        var s = i.createContextualFragment(t);
        i.insertNode(s), e.removeAllRanges(), i.collapse(!1), e.addRange(i)
      }

      function v(t, e) {
        e || t.lastChild && "br" === t.lastChild.nodeName.toLowerCase() || t.appendChild(document.createElement("br"));
        var i = r.getSelection();
        if (i) {
          var s = i.getRangeAt(0), o = document.createElement("br");
          s.deleteContents(), s.insertNode(o), s.setStartAfter(o), s.setEndAfter(o), s.collapse(!1), i.removeAllRanges(), i.addRange(s)
        }
      }

      function b(t) {
        o(t).contents().each(function (t, e) {
          e.nodeType === Node.TEXT_NODE ? e.textContent = e.textContent.replace(T, "") : e.nodeType === Node.ELEMENT_NODE && b(e)
        })
      }

      function y() {
        if (!this.isEmpty()) {
          var t = w.call(this);
          if (t && t.nodeType === Node.ELEMENT_NODE) {
            var e = t.textContent || t.innerText || "", i = e.match(T);
            if (i) {
              var s = a.saveSelection(t);
              s.start -= (e.substr(0, s.start).match(T) || "").length || 0, s.end -= (e.substr(0, s.end).match(T) || "").length || 0, b(t), a.restoreSelection(s)
            }
          }
        }
      }

      function w() {
        var t = x.call(this);
        if (!t) {
          var e = o(this.element).children();
          if (!e.length)return null;
          t = e.last().get(0)
        }
        return t
      }

      function x(t) {
        return t || (t = !r.getSelection() && this.lastSelection ? r.getParentNodes(this.lastSelection.anchorNode) : r.getNodeList()), s.find(t.reverse(), function (t) {
          return t.nodeType === Node.ELEMENT_NODE
        })
      }

      function C() {
        this.isEmpty() && (g.call(this, k), this.setCursorToEnd())
      }

      var k = "<span>&#8203;</span>", S = "<span></span>", T = /\u200B/g, E = {
        shift: 16,
        enter: 13,
        esc: 27,
        backspace: 8,
        "delete": 46,
        tab: 9,
        right: 39
      }, $ = function (e, i) {
        if (!e)throw new Error("A valid element parameter is required to initalize the editor");
        this.element = e, this.keyComboEvents = i.keyComboEvents || new c({element: this.element}), this.keyComboEvents.on("meta+b meta+i meta+k meta+u", s.noop), this.config = {
          placeholder: !1,
          onChange: function () {
          },
          onSelection: function (t) {
          },
          onClientEvent: function (t) {
          },
          pasteHook: function (t, e) {
            return !1
          },
          filterForSetData: function (t) {
            return t
          },
          filterForGetData: function (t) {
            return t
          },
          filterRules: {
            elements: ["p", "br", "div"],
            attributes: {},
            remove_contents: ["style", "noscript", "script", "meta"],
            protocols: {}
          },
          forceSingleLine: !1,
          smartQuotes: {enabled: !1, config: {}}
        }, s.extend(this.config, i || {}), this.dataFilter = new n(this.config.filterRules), this.onChange = function () {
          this.previousRawData !== _.call(this) && (m.call(this), u.call(this), this.config.onChange.apply(this, arguments), this.previousRawData = _.call(this))
        }, this.keyModifiers = {shift: !1}, this.undoManager = new l(this), this.config.smartQuotes.enabled && (this.smartQuoter = new h(this)), t.call(this)
      };
      return $.prototype.getData = function (t) {
        var e = _.call(this);
        e = this.config.filterForGetData.call(this, e);
        var i = e.replace(/<br(\s*)\/*>/gi, "\n").replace(/(<[p|div])/gi, "\n$1").replace(T, ""), s = document.createElement("div");
        s.innerHTML = i;
        var o = s.textContent || s.innerText || "", n = t ? o.trim() : o;
        return n
      }, $.prototype.setData = function (t) {
        t = this.config.filterForSetData.call(this, t), t = this.dataFilter.filterPlaintext(t), g.call(this, t), C.call(this), this.onChange()
      }, $.prototype.setHTML = function (t) {
        g.call(this, t), this.onChange()
      }, $.prototype.getHTML = function () {
        return _.call(this)
      }, $.prototype.insertData = function (t, e) {
        e && (t = this.dataFilter.filterHTML(t)), f.call(this, t), this.onChange()
      }, $.prototype.blur = function () {
        return o(this.element).blur()
      }, $.prototype.focus = function (t) {
        var e = o(this.element).focus();
        return t || this.setCursorToEnd(), e
      }, $.prototype.hasFocus = function () {
        return o(this.element).is(":focus")
      }, $.prototype.setPlaceholder = function (t) {
        this.config.placeholder = t, u.call(this)
      }, $.prototype.isEmpty = function () {
        var t = this.getData(!1);
        if ("" === t || "\n" === t || "\r\n" === t)return !0;
        var e = _.call(this);
        return e === k || e === S || "" === e
      }, $.prototype.getCurrentElement = function () {
        return r.getNearestElement()
      }, $.prototype.setCursorToStart = function (t) {
        var e = o(this.element);
        t = t && e.find(t).first().get(0) || e.children().first().get(0), t && a.setToStart(t)
      }, $.prototype.setCursorToEnd = function (t) {
        var e = o(this.element);
        t = t && e.find(t).last().get(0) || e.children().last().get(0), t && a.setToEnd(t)
      }, $.prototype.teardown = function () {
        this.undoManager.teardown(), this.keyComboEvents.off()
      }, $
    }();
    e.exports = u
  }, {
    "./dataFilter": 644,
    "./debugConsole": 645,
    "./keyComboEvents": 649,
    "./selectionContext": 656,
    "./selectionPersistence": 657,
    "./smartQuoter": 658,
    "./undoManager": 659,
    jquery: "HlZQrA",
    lodash: "MicNly"
  }],
  654: [function (t, e, i) {
    var s = t("lodash"), o = t("jquery"), n = t("velocity-animate").animate, a = t("./linkControl"), r = t("./formattingControls"), l = t("./dataFilter"), h = t("./selectionPersistence"), c = t("./selectionContext"), d = t("./inlineControls"), u = t("./utils"), p = t("./undoManager"), m = t("./smartQuoter"), g = t("./keyComboEvents"), _ = t("./humanKeys"), f = (window.URL || window.webkitURL || window.mozURL || window.msURL || {}).createObjectURL, v = t("./debugConsole"), b = function () {
      function t(t, e) {
        return s.mapValues(t, function (t, e) {
          return e.match(/^on[A-Z]/) && s.isFunction(t) ? s.bind(t, this) : t
        }, e)
      }

      function e() {
        B.call(this, ct);
        var t = o("<div />", {
          "data-js": "editor-wrapper",
          "class": "editor-wrapper"
        }).css("position", "relative"), e = o("<div />", {
          "data-js": "editor-slot",
          "class": "editor-slot"
        }).css("position", "relative");
        o(this.element).wrap(t).wrap(e), e = o(this.element).parent(), this.wrapper = e.parent().get(0), this.placeholderElement = o("<div />", {
          "data-js": "editor-placeholder",
          "class": "editor-placeholder"
        }).css("position", "absolute"), e.append(this.contextualControls.element), e.append(this.linkControl.element), e.append(this.placeholderElement), e.append(this.inlineControls.element), O.call(this), this.controlBar = o("<div />", {
          "data-js": "control-bar",
          "class": "control-bar disabled"
        });
        var n = o("<div />", {"class": "static-controls control"});
        this.controlBar.append(n), this.controlBar.append(this.staticControls.element);
        var a = this;
        n.on("mousedown", function (t) {
          t.preventDefault(), t.stopPropagation();
          var e = c.getNodeList();
          a.staticControls.setActives(s.pluck(e, "nodeName"));
          var i = o(this).position();
          return a.staticControls.isShown ? a.staticControls.hide() : a.staticControls.open(i.left + o(this).width() / 2, 0), a.contextualControls.hide(), a.linkControl.close(), !1
        }), this.config.showStaticControls && o(this.wrapper).append(this.controlBar), i.call(this), S.call(this)
      }

      function i() {
        var t = this, e = function () {
          var e = t.inlineControls.isTrayOpen || t.contextualControls.isShown || t.staticControls.isShown || t.linkControl.isShown;
          return e
        };
        o(this.element).on("input keydown keyup keypress mousedown mouseup", function (e) {
          t.controlBar.removeClass("disabled"), t.config.onClientEvent.call(t, e)
        });
        var i = function () {
          I.call(this), this.onChange()
        };
        o(this.element).on("keydown", function (i) {
          if (i.keyCode === vt.shift)t.keyModifiers.shift = !0; else {
            if (i.keyCode === vt.esc)return void(e() && (t.contextualControls.hide(), t.staticControls.hide(), t.inlineControls.isTrayOpen && t.inlineControls.toggleTrayWithIntent(!1), i.stopPropagation()));
            i.keyCode === vt.backspace ? (k.call(t, i), z.call(t)) : i.keyCode === vt.enter && (w.call(t, i), y.call(t, i), u.browser.safari && i.shiftKey && (i.preventDefault(), b.call(t)))
          }
          M.call(t, i), I.call(t, i)
        }), o(this.element).on("keyup", function (e) {
          e.keyCode === vt.shift ? t.keyModifiers.shift = !1 : e.keyCode === vt.enter ? z.call(t) : (e.keyCode === vt.backspace || e.keyCode === vt["delete"]) && (N.call(t), s.defer(function () {
            C.call(t)
          }));
          var o = !1;
          e.keyCode === vt.right && !e.shiftKey && t.inlineControls && (o = t.inlineControls.isShown), e.keyCode === vt.esc || o || i.call(t)
        }), o(this.element).on("input", function () {
          i.call(t)
        });
        var n = !1;
        o(this.element).on("mouseup", function () {
          n = !1, I.call(t)
        }), o(this.element).on("mousedown", function (t) {
          n = !0
        }), document.addEventListener("mousedown", function (e) {
          var i = function () {
            n = !1, x.call(t), t.controlBar.addClass("disabled")
          };
          t.wrapper === e.target || o.contains(t.wrapper, e.target) || t.config.documentMousedownHook(e, i) || i()
        }, !0), document.addEventListener("mouseup", function (e) {
          n && (I.call(t), n = !1)
        }, !0), o(this.element).on("focus", function () {
          if (t.controlBar.removeClass("disabled"), !H.call(t)) {
            var e = o(t.element).children(ut.join());
            if (e.length) {
              var i = e.first().get(0);
              h.setToStart(i)
            }
          }
          s.defer(function () {
            t.onChange()
          })
        }), o(this.element).on("blur", function (i) {
          var o = function (i) {
            if (!e()) {
              var o = c.getSelection();
              o && c.isInContext(o, t.element) && o.removeAllRanges(), t.lastSelection = null, I.call(t, function () {
                t.onChange(), s.isFunction(i) && i()
              })
            }
          };
          t.config.blurHook(i, o) || s.defer(o)
        }), o(this.element).on("paste", function (e) {
          var i = (e.originalEvent || e).clipboardData;
          i && (t.config.pasteHook(i, t.keyModifiers.shift) || D.call(t, i), L.call(t), e.preventDefault())
        }), o(this.element).on("cut", function (e) {
          t.contextualControls.hide(), t.staticControls.hide(), t.linkControl.close(), s.defer(function () {
            C.call(t), L.call(t), t.onChange()
          })
        })
      }

      function b() {
        for (var t = H.call(this), e = s.contains(mt, t.nodeName) ? "\n" : "<br>", i = c.isCursorAtEnd(t) && !c.isCursorAtStart(t) ? 1 : 0, o = 0; i > o; o++)e += e;
        V.call(this, e)
      }

      function y(t) {
        var e, i, n = c.getNodeByNames(mt);
        n && !this.keyModifiers.shift && c.isCursorAtEnd(n) && (i = o(n), e = i.text(), t.preventDefault(), e.match(/\n\n$/) ? (s.last(i.contents()).remove(), this.insertNewParagraphAfter(n)) : (i.append("\n\n"), h.setToEnd(n)))
      }

      function w(t) {
        var e = c.getNodeByNames(["BLOCKQUOTE"]);
        if (e && !this.keyModifiers.shift && c.isCursorAtEnd(e, !0)) {
          var i = "P" === e.lastElementChild.nodeName ? e.lastChild : null;
          i && i.previousSibling && this.dataFilter.isEmptyElement(i, !0) && (t.preventDefault(), o(i).remove(), this.insertNewParagraphAfter(e))
        }
      }

      function x() {
        this.contextualControls.hide(), this.staticControls.hide(), this.linkControl.close(), this.inlineControls.close()
      }

      function C() {
        if (!o(this.element).has(ft.join()).length) {
          var t = o(this.element).find("ul:not(:has(li)),ol:not(:has(li))");
          t.remove();
          var e = s.some(o(this.element).children().toArray(), function (t) {
            return t.textContent.length > 0
          });
          e || (B.call(this, ""), z.call(this), O.call(this))
        }
      }

      function k(t) {
        var e = c.getSelection();
        if (e.isCollapsed) {
          var i = H.call(this);
          if (i && !(h.saveSelection(i).start > 0)) {
            var s = o(i).prev().get(0);
            s && rt.call(this, s) && (o(s).remove(), t.preventDefault())
          }
        }
      }

      function S() {
        var t = this, e = o(t.element).offset().top, i = null, n = "dragstart dragenter dragleave dragover dragend drop", a = !1, r = function (t) {
          var e = t.dataTransfer.types && s.some(t.dataTransfer.types, function (t) {
              return "Files" === t
            });
          return e
        }, l = function (t) {
          return "false" === o(t.target || t.srcElement).attr("contenteditable")
        }, h = function (e, i, o) {
          e.length && (t.onChange(), s.each(e, function (e) {
            t.config.onFileAdded.call(t, e, i, o)
          }), I.call(t))
        }, c = function (t, e) {
          return t < e.top + .66 * e.height
        }, d = function (t, i) {
          var s = o(i).offset().top - e, n = o(i).get(0).getBoundingClientRect().height, a = t > s + .66 * n;
          return {element: i, top: s, bottom: s + n, height: n, isAfter: a}
        }, u = function () {
          o(t.element).find(".over-top, .over-bottom").each(function () {
            o(this).removeClass("over-top").removeClass("over-bottom"), "" === o(this).attr("class").trim() && o(this).removeAttr("class")
          })
        }, p = function (s) {
          var n = null, a = s.pageY - e, r = o(t.element).children();
          i && a > i.top && c(a, i) || (r.each(function () {
            var t = d(a, this);
            return c(a, t) && (s.target || s.srcElement) !== this ? (n = t, !1) : void 0
          }), n || (n = d(a, r.last().get(0)), n.isAfter = !0), n && i && i.element === n.element && i.isAfter === n.isAfter || (u(), i = n))
        };
        o(t.element).unbind(n), o(t.element).on("dragleave", function (t) {
          u()
        }), o(t.element).on("dragover", function (t) {
          return a ? (s.debounce(p, 100)(t.originalEvent), i && (o(i.element).addClass(i.isAfter ? "over-bottom" : "over-top"), r(t.originalEvent) && t.stopPropagation()), void t.preventDefault()) : (t.preventDefault(), void t.stopPropagation())
        }), o(t.element).on("dragenter", function (t) {
          t.preventDefault(), r(t.originalEvent) && (a = "file");
        }), o(t.element).on("dragstart", function (e) {
          if (x.call(t), l(e.originalEvent)) {
            a = "media";
            var i = e.originalEvent.target || e.originalEvent.srcElement, n = e.originalEvent.dataTransfer;
            if (n) {
              n.effectAllowed = "move", n.dropEffect = "move";
              try {
                var r = o(i).find("img").attr("src") || "";
                r.match(/^\s*data:/) && (r = ""), n.setData("text/uri-list", r), n.setData("text/plain", r)
              } catch (e) {
              }
            }
            s.defer(function () {
              o(i).addClass("dragging")
            })
          }
        }), o(t.element).on("drop", function (t) {
          u(), r(t.originalEvent) && h(t.originalEvent.dataTransfer.files, i.element, i.isAfter ? 1 : -1), t.stopPropagation(), t.preventDefault()
        }), o(t.element).on("dragend", function (e) {
          if (l(e.originalEvent)) {
            u();
            var s = e.originalEvent.target || e.originalEvent.srcElement, n = o(s).data("origHeight"), r = s;
            if (i && r !== i.element) {
              var h = o(s).remove();
              i.isAfter ? o(i.element).after(h) : o(i.element).before(h), st.call(t, h)
            }
            o(r).animate({height: n}, 200, function () {
              o(r).removeClass("dragging")
            }), t.onChange(), I.call(t)
          }
          a = !1
        })
      }

      function T(t, e, i) {
        var s = o(this.element), n = h.saveSelection(this.element);
        s.find(i).wrap("<" + e + ">"), s.find(i).contents().unwrap(), h.restoreSelection(n), window.document.execCommand(t), s.find(e).wrap("<" + i + ">"), s.find(e).contents().unwrap(), h.restoreSelection(n)
      }

      function E(t, e, i) {
        var n = this, a = function () {
          window.document.execCommand(t), n.config.flattenBlocks && F.call(n)
        }, r = function () {
          var t = h.saveSelection(n.element), e = 200, s = 240;
          !i || i.isAnimating || t.selection.isCollapsed || setTimeout(function () {
            o(n.linkControl.linkEditInput).focus();
            var a = function (i, s) {
              var a = i - o(n.wrapper).offset().left, r = s - o(n.wrapper).offset().top;
              n.linkControl.size(e), n.linkControl.show(a, r), n.linkControl.createLink(t)
            };
            i.closeWithShim(i.element.find(".link").get(0), e, s, a), t.selection.removeAllRanges(), n.blur(!0)
          }, 30)
        }, l = function (t) {
          var e = h.saveSelection(n.element), i = c.getRootElements();
          switch (s.each(pt, function (t) {
            var e = c.getNodesByNames(i, [t]);
            e.length && $.call(n, "formatBlock", t)
          }), j.call(n), t.toLowerCase()) {
            case"blockquote":
              i = c.getRootElements();
              var a = [], r = [];
              i = s.each(i, function (t) {
                s.contains(_t, t.nodeName.toUpperCase()) ? r.push(t) : (a.push(r), r = [])
              }), r.length && a.push(r), s.each(a, function (e) {
                o(e).wrapAll(document.createElement(t))
              });
              break;
            case"pre":
              window.document.execCommand("formatBlock", !1, "<" + t + ">"), P.call(this);
              break;
            default:
              window.document.execCommand("formatBlock", !1, "<" + t + ">")
          }
          h.restoreSelection(e)
        }, d = function () {
          var t = n.contextualControls.controls, e = n.contextualControls.getActiveStates();
          s.each(e, function (e, i) {
            var s = t[i];
            e && $.call(n, s.command, s.el)
          }), window.document.execCommand("removeFormat")
        };
        switch (t) {
          case"formatBlock":
            l(e);
            break;
          case"createLink":
            r();
            break;
          case"insertOrderedList":
            a();
            break;
          case"insertUnorderedList":
            a();
            break;
          case"removeFormat":
            d();
            break;
          case"insertHTML":
            T.call(this, "underline", "U", e);
            break;
          default:
            window.document.execCommand(t)
        }
        I.call(this), N.call(this), n.onChange()
      }

      function $(t, e) {
        var i = this;
        switch (t) {
          case"formatBlock":
            var n = h.saveSelection(this.element);
            j.call(i), s.each(c.getRootElements(), function (t) {
              i.dataFilter.unBlock(t), "pre" === t.nodeName.toLowerCase() && (t.innerHTML = t.innerHTML.replace("\n", "<br>"));
              var e = t.nodeName.toUpperCase();
              if (s.contains(pt, e)) {
                var n = o(t).contents();
                o(n).wrapAll("<p>"), o(t.firstChild).unwrap()
              }
            }), h.restoreSelection(n);
            break;
          case"insertOrderedList":
            j.call(this);
            break;
          case"insertUnorderedList":
            j.call(this);
            break;
          case"createLink":
            window.document.execCommand("unlink");
            break;
          case"insertHTML":
            T.call(this, "underline", "U", e);
            break;
          default:
            window.document.execCommand(t)
        }
        N.call(this), I.call(this), this.onChange()
      }

      function M(t) {
        var e = function () {
          var t = c.getNodeByNames(["UL", "OL"]);
          return !!t
        };
        t.keyCode === vt.tab && e() && (t.preventDefault(), t.stopPropagation(), t.shiftKey ? (E.call(this, "outdent"), e() || E.call(this, "formatBlock", "p")) : E.call(this, "indent"))
      }

      function P() {
        var t = c.getNodeByNames(mt);
        t && o(t).find("br").replaceWith("\n")
      }

      function j() {
        var t = c.getNodeByNames(gt);
        if (t) {
          do window.document.execCommand("outdent"); while (c.getNodeByNames(gt));
          c.getNodeByNames(["H2"]) || window.document.execCommand("formatBlock", !1, "<p>"), this.dataFilter.blockifyInlineNodes(this.element)
        }
      }

      function F() {
        var t = h.saveSelection(this.element), e = c.getNodeList(null, !0);
        this.dataFilter.unwrapParentBlocks(e), h.restoreSelection(t)
      }

      function N() {
        var t = h.saveSelection(this.element), e = c.getNodeList(), i = this.dataFilter.scrubSpansAndBadAttrs(e);
        i && t.end > t.start && h.restoreSelection(t)
      }

      function I(t) {
        var e = this;
        setTimeout(function () {
          var i = c.getSelection();
          return i ? (i.isCollapsed ? A.call(e, i) : R.call(e, i), tt.call(e), W.call(e), e.config.onSelection.call(e, i), c.isInContext(i, e.element) && (e.lastSelection = h.saveSelection(e.element)), L.call(e), O.call(e), void(s.isFunction(t) && t())) : (tt.call(e), void(s.isFunction(t) && t()))
        }, 20)
      }

      function R(t) {
        if (c.isInContext(t, this.element)) {
          var e = c.getContextCoordinates(o(this.element).parent().parent()), i = c.getNodeList(t);
          this.contextualControls.setActives(s.pluck(i, "nodeName")), this.staticControls.setActives(s.pluck(i, "nodeName")), this.linkControl.close(), this.inlineControls.close(), "" !== t.toString().trim() && e && !this.staticControls.isShown && this.contextualControls.open(e.x, e.y)
        }
      }

      function A(t) {
        this.contextualControls.hide();
        var e = c.getNodeList(t), i = s.find(e, function (t) {
          return "A" === t.nodeName
        });
        if (this.linkControl.isValidLink(i)) {
          var n = c.getContextCoordinates(o(this.element).parent().parent(), i);
          this.linkControl.showOptions(i), this.linkControl.showOverTarget(n.x, n.y)
        } else this.linkControl.close();
        this.staticControls.setActives(s.pluck(e, "nodeName"))
      }

      function L() {
        var t = c.getSelection(), e = t && t.isCollapsed;
        if (!e || !c.isInContext(t, this.element))return void this.inlineControls.close();
        var i = H.call(this);
        if (i && "P" === i.nodeName && this.dataFilter.isEmptyElement(i) && !this.isEmpty())this.inlineControls.open(i); else if (this.isEmpty()) {
          this.inlineControls.open(i);
          var s = u.calcTextWidth(this.placeholderElement, this.config.placeholder);
          this.inlineControls.open(i, s)
        } else this.inlineControls.close()
      }

      function O() {
        var t = this.isEmpty() ? this.config.placeholder : "", e = o(this.placeholderElement);
        e.html(t);
        var i = e.outerHeight();
        i && o(this.element).css("min-height", Math.max(parseInt(e.css("min-height"), 10) || 0, i))
      }

      function D(t) {
        var e = "";
        if (t.items && t.items.length) {
          var i = s.find(t.items, function (t) {
            return /image\/\w+/.test(t.type)
          });
          if (i) {
            var n = i.getAsFile();
            if (n)return void this.config.onFileAdded.call(this, n)
          }
        }
        s.contains(t.types, "text/html") ? e = t.getData("text/html") : (e = t.getData("text/plain"), e = this.dataFilter.filterPlaintext(e, !0)), e = e.replace(new RegExp("</t(d|h)></tr>", "g"), "<br></td></tr>"), e = e.replace(/\u00a0/g, " "), e = this.dataFilter.filterHTML(e), e = this.dataFilter.convertToBrowserSpaces(e);
        var a = document.createElement("div");
        a.innerHTML = e, this.dataFilter.flattenBlocksDown(a, !0), o(a).find(ft.join()).remove();
        var r = s.some(a.children, function (t) {
          return s.contains(ut, t.nodeName)
        });
        if (r) {
          var l = c.getSelection(), h = l.getRangeAt(0);
          h.deleteContents();
          var d = H.call(this);
          if ("" === o(d).text().trim()) {
            var u = o(d).index(), p = o(d).parent(), m = u + a.children.length - 1;
            o(d).replaceWith(a.children);
            var g = o(p).children().eq(m).get(0);
            h.selectNodeContents(g), h.collapse(!1), l.removeAllRanges(), l.addRange(h)
          } else this.dataFilter.inlinify(a), V.call(this, a.innerHTML)
        } else V.call(this, a.innerHTML);
        this.onChange()
      }

      function B(t) {
        o(this.element).html(t)
      }

      function q() {
        return o(this.element).html().trim()
      }

      function V(t) {
        if (!t)return void v.warn("Cannot insert empty data");
        var e = c.getSelection();
        if (!e || !e.focusNode)return void v.warn("Cannot insert without the editor having a cursor or selection");
        var i = e.getRangeAt(0);
        i.deleteContents(), t = this.dataFilter.convertToBrowserSpaces(t);
        var s = document.createElement("div");
        s.innerHTML = t;
        for (var o, n = s.lastChild, a = document.createDocumentFragment(); o = s.firstChild;)a.appendChild(o);
        i.insertNode(a), i.setStartAfter(n), i.collapse(!1), e.removeAllRanges(), e.addRange(i)
      }

      function U() {
        var t = H.call(this);
        if (!t) {
          var e = o(this.element).children(ut.join());
          if (!e.length)return null;
          t = e.last().get(0)
        }
        return t
      }

      function H() {
        var t = c.getSelection() || this.lastSelection;
        return c.getNodeByNames(ut, !0, t)
      }

      function z() {
        var t = U.call(this);
        if (t) {
          if ("div" === t.nodeName.toLowerCase())try {
            window.document.execCommand("formatBlock", !1, "<p>")
          } catch (e) {
          }
        } else B.call(this, ct), this.setCursorToStart()
      }

      function W() {
        var t = o(this.element).children(_t.join()).last().get(0);
        t || o(this.element).append(ct)
      }

      function G(t, e, i, n, a) {
        var r = this, l = function (t) {
          var l, h, c, d, u = s.uniqueId(), p = 0 === t.lastIndexOf("data:", 0) ? "file" : t;
          r.mediaTracker[u] = {
            originalSource: p,
            file: e
          }, h = o("<img />", {src: t}), l = h.get(0), d = o("<figure />"), c = d.get(0), h.attr(r.config.imgKeyAttr, u), d.append(h), Y.call(r, c, i, n, a), Q.call(r, l, function (i) {
            K.call(r, l, i), r.config.onAsyncImageAdded.call(r, u, t, e, i || {})
          }), r.onChange()
        };
        if (!t && e)if (f)l(f(e)); else {
          var h = new FileReader;
          h.onload = function (t) {
            l(t.target.result)
          }, h.readAsDataURL(e)
        } else {
          if ("string" != typeof t)return void r.config.onAsyncImageFailed.call(r);
          l(t)
        }
      }

      function K(t, e) {
        var i, n = {}, a = this.config, r = o(t).parent("figure").get(0), l = {toImg: t, toImgParent: r};
        a.addImgAttrs && (i = s.reduce(l, function (t, e, i) {
          return (a.addImgAttrs === !0 || a.addImgAttrs[i] === !0) && t.push(e), t
        }, [])), s.isEmpty(i) || !a.imgSizeAttrs || s.isEmpty(e) || (a.imgSizeAttrs.height && (n[a.imgSizeAttrs.height] = e.height), a.imgSizeAttrs.height && (n[a.imgSizeAttrs.width] = e.width), o(i).attr(n))
      }

      function Q(t, e) {
        var i = function (t) {
          var i = {width: t.naturalWidth, height: t.naturalHeight};
          s.isFunction(e) && e.call(this, i)
        };
        t.complete ? i.call(this, t) : o(t).one({
          "load.getImageAttributes": s.bind(s.partial(i, t), this),
          error: s.bind(function () {
            o(t).off(".getImageAttributes"), e.call(this, null)
          }, this)
        })
      }

      function J(t) {
        return o(this.element).find("img[" + this.config.imgKeyAttr + '="' + t + '"]').get(0)
      }

      function Z(t, e, i) {
        var n = J.call(this, t);
        s.isEmpty(i) || n && K.call(this, n, i), e && (o(n).attr("src", e), this.mediaTracker[t].updatedSource = e)
      }

      function Y(t, e, i, s) {
        var n;
        e = e || U.call(this), n = this.dataFilter.isEmptyElement(e.outerHTML, !0) ? 0 : c.isCursorAtStart(e) ? -1 : 1, i = "number" == typeof i ? i : n;
        var a = o(t).get(0), r = it.call(this, a);
        st.call(this, r), 0 > i ? o(e).before(r) : i > 0 ? o(e).after(r) : 0 === i && o(e).replaceWith(r), x.call(this);
        var l = o(r).nextAll(_t.join()).get(0);
        l || (l = o(ct).get(0), o(r).after(l)), s || (this.focus(!0), h.setToStart(l)), X.call(this, r, !1, I)
      }

      function X(t, e, i) {
        var a = this;
        e = e || !1, i = i || s.noop;
        var r = o(t), l = r.find("figure"), h = r.find(".media-button"), c = 200;
        return r.length && l.length ? (e && h.length && h.hide(), n(l, {
          opacity: e ? 0 : [1, 0],
          translateY: e ? -25 : [0, -25]
        }, {
          duration: .9 * c, easing: "easeOutQuad", complete: function () {
            l.removeAttr("style")
          }
        }), void n(t, e ? "slideUp" : "slideDown", {
          duration: c, easing: "easeOutQuart", begin: function () {
            r.css("pointer-events", "none")
          }, complete: function () {
            r.css("pointer-events", ""), i.call(a, t)
          }
        })) : void i.call(a)
      }

      function tt() {
        var t = this, e = H.call(this);
        o(e).removeClass(t.config.fakeClass), o(t.element).children("p").each(function (i, s) {
          e !== s && t.dataFilter.isEmptyElement(s) && (0 === i && rt.call(t, o(s).next().get(0)) || o(s).is(":last-child") && rt.call(t, o(s).prev().get(0)) ? et.call(t, s) : rt.call(t, o(s).prev().get(0)) && rt.call(t, o(s).next().get(0)) ? et.call(t, s) : o(s).hasClass(t.config.fakeClass) && o(s).remove()), void 0 !== o(s).attr("class") && "" === o(s).attr("class").trim() && o(s).removeAttr("class")
        }), o(this.element).children("." + this.config.mediaHolderClass).each(function (e, i) {
          var s = o(this).next().get(0);
          (!s || rt.call(t, s)) && o(this).after(et.call(t));
          var n = o(this).prev().get(0);
          n || o(this).before(et.call(t))
        })
      }

      function et(t) {
        return t = t || o(ct).get(0), o(t).addClass(this.config.fakeClass), t
      }

      function it(t) {
        var e = o(t), i = o("<div />", {"class": this.config.mediaHolderClass, contentEditable: !1, draggable: !0});
        e.wrap(i), i = e.parent(), s.isFunction(this.config.mediaHolderCallback) && this.config.mediaHolderCallback(this, t, e, i);
        var n = o(this.config.mediaKillerMarkup);
        n.addClass("media-killer"), i.append(n);
        var a = !i.hasClass("media-holder-draggable");
        if (a) {
          var r = o(this.config.mediaMoverMarkup);
          r.addClass("media-mover"), i.append(r)
        }
        return i
      }

      function st(t) {
        var e = this, i = t ? o(t) : o(this.element).find('[contenteditable="false"]'), s = this.config.mediaHolderEvents;
        i.each(function (t, i) {
          var n = o(i), a = null;
          n.off("keydown").on("keydown", function (t) {
            s.keydown.call(null, t, n), t.isPropagationStopped() || ((t.keyCode === vt["delete"] || t.keyCode === vt.backspace) && n.remove(), t.preventDefault(), t.stopPropagation())
          }), n.off("keyup").on("keyup", function (t) {
            s.keyup.call(null, t, n)
          }), n.on("mousedown", function (t) {
            a = t.originalEvent.target, s.mousedown.call(null, t, n, a)
          }), n.on("mouseup", function (t) {
            s.mouseup.call(null, t, n, a);
            var i = o(a);
            i.hasClass("media-killer") && a === t.target && X.call(e, n, !0, function () {
              n.remove(), C.call(e), I.call(e), e.onChange()
            })
          }), n.on("mouseenter", function (t) {
            o(t.currentTarget).addClass("show-controls"), s.mouseenter.call(null, t, n, a)
          }), n.on("mouseleave", function (t) {
            o(t.currentTarget).removeClass("show-controls"), s.mouseleave.call(null, t, n, a)
          }), n.on("dragstart", function (t) {
            var e = o(a);
            e.hasClass("media-killer") && (t.preventDefault(), t.stopPropagation()), n.hasClass("media-holder-draggable") || e.hasClass("media-mover") || (t.preventDefault(), t.stopPropagation()), s.dragstart.call(null, t, n, a)
          })
        })
      }

      function ot(t) {
        s.each(o(t).find("." + this.config.mediaHolderClass), function (t) {
          o(t).find(".media-killer, .media-mover").remove();
          var e = o(t).children().first();
          e.length ? o(e).unwrap() : (o(t).contents().wrap("<div>"), o(t).children().first().unwrap().contents().unwrap())
        })
      }

      function nt(t) {
        var e = this, i = o(t).find("." + this.config.fakeClass + ", ." + this.config.fakeClass + "-intent");
        s.each(i, function (t) {
          e.dataFilter.isEmptyElement(t) && o(t).remove()
        })
      }

      function at() {
        var t = this;
        s.each(o(this.element).find(ft.join()), function (e) {
          var i = c.getParentNodes(e), o = s.some(i, function (t) {
            return s.contains(ft, t.nodeName)
          });
          lt.call(t, e) || o || it.call(t, e)
        })
      }

      function rt(t) {
        return o(t).hasClass(this.config.mediaHolderClass)
      }

      function lt(t) {
        var e = o(t).closest("[class=" + this.config.mediaHolderClass + "]");
        return e.length ? e.get(0) : null
      }

      function ht(t, e, i) {
        var n, a;
        return e = s.isBoolean(e) ? e : !1, t = t || U.call(this), n = o(t)[e ? "prev" : "next"](), !i && n.length > 0 && this.dataFilter.isEmptyElement(n) ? (h.setToStart(n.get(0)), n) : (a = o(ct).get(0), o(t)[e ? "before" : "after"](a), h.setToStart(a), a)
      }

      var ct = "<p><br></p>", dt = "<p></p>", ut = ["P", "FIGURE", "H2", "BLOCKQUOTE", "UL", "OL", "DIV", "PRE"], pt = ["H2", "BLOCKQUOTE", "PRE"], mt = ["PRE"], gt = ["UL", "OL"], _t = ["P", "H2", "BLOCKQUOTE", "UL", "OL", "PRE"], ft = ["IMG", "IFRAME", "FIGURE", "HR"], vt = {
        shift: 16,
        enter: 13,
        esc: 27,
        backspace: 8,
        "delete": 46,
        tab: 9,
        right: 39
      }, bt = function (i, n) {
        if (!i)throw new Error("A valid element parameter is required to initalize the editor");
        n = n || {}, this.element = i, this.humanKeys = new _, this.keyComboEvents = n.keyComboEvents || new g({
            element: this.element,
            humanKeys: this.humanKeys
          });
        var u = s.template("<%= title %> (<%= shortcut %>)"), f = s.bind(function (t, e) {
          return u({title: t, shortcut: this.humanKeys.pretty(e)})
        }, this);
        this.config = {
          labels: {},
          placeholder: !1,
          onChange: s.noop,
          onSelection: function (t) {
          },
          onAsyncImageAdded: function (t, e, i, s) {
          },
          onAsyncImageFailed: function () {
            v.warn("Unknown source type for inserting an image.")
          },
          onFileAdded: function (t, e, i) {
          },
          onClientEvent: function (t) {
          },
          flattenBlocks: !0,
          smartQuotes: {enabled: !1, config: {}},
          runIFrameSanitization: !1,
          mediaHolderClass: "media-holder",
          mediaHolderCallback: function (t, e, i, o) {
            i.is("hr, img, figure") && s.isEmpty(i.find("iframe")) && o.addClass("media-holder-draggable"), o.addClass("media-holder-" + i.prop("tagName").toLowerCase())
          },
          mediaHolderEvents: {
            keydown: s.noop,
            keyup: s.noop,
            mousedown: s.noop,
            mouseup: s.noop,
            mouseenter: s.noop,
            mouseleave: s.noop,
            click: s.noop,
            dragstart: s.noop
          },
          imgKeyAttr: "data-img-key",
          imgSizeAttrs: {width: "data-orig-width", height: "data-orig-height"},
          addImgAttrs: {toImg: !1, toImgParent: !1},
          fakeClass: "fake",
          mediaKillerMarkup: "<div></div>",
          mediaMoverMarkup: "<div>&#8597;</div>",
          pasteHook: function (t, e) {
            return !1
          },
          blurHook: function (t) {
            return !1
          },
          documentMousedownHook: function (t) {
            return !1
          },
          filterForSetData: function (t) {
            return t
          },
          filterForGetData: function (t) {
            return t
          },
          filterRules: {
            elements: ["a", "b", "i", "ul", "ol", "li", "p", "h2", "blockquote", "img", "iframe", "figure", "br", "hr", "pre", "sub", "sup", "small"],
            attributes: {
              a: ["href", "title"],
              img: ["src", "alt", "data-orig-width", "data-orig-height"],
              hr: ["data-label"],
              iframe: ["src", "width", "height", "frameborder"],
              figure: ["data-orig-width", "data-orig-height"]
            },
            classnames: {hr: ["read-more"]},
            remove_contents: ["style", "noscript", "script", "meta"],
            protocols: {a: {href: ["http", "https", "mailto"]}}
          },
          animateShowControls: function (t) {
            t.element.show()
          },
          animateHideControls: function (t) {
            t.element.hide()
          },
          linkConfig: {
            bypassClasses: [], labels: n.labels, onChange: function () {
              this.onChange.call(this)
            }, onDismiss: function () {
              this.lastSelection && (h.restoreSelection(this.lastSelection), I.call(this))
            }
          },
          inlineControlsConfig: {
            openTray: d.prototype.openTray,
            closeTray: d.prototype.closeTray,
            onTrayOpened: function (t) {
            },
            onTrayClosed: function (t) {
            },
            keyboardEvents: this.keyComboEvents
          },
          formattingControlsConfig: {
            controls: {
              bold: {
                el: "b",
                className: "bold",
                command: "bold",
                type: "inline",
                title: f("Bold", "meta+b"),
                keyboard: "meta+b"
              },
              italic: {
                el: "i",
                className: "italic",
                command: "italic",
                type: "inline",
                title: f("Italic", "meta+i"),
                keyboard: "meta+i"
              },
              headline: {
                el: "h2",
                className: "headline",
                command: "formatBlock",
                type: "block",
                title: f("Headline", "meta+shift+2"),
                keyboard: "meta+shift+2"
              },
              link: {
                el: "a",
                className: "link",
                command: "createLink",
                type: "inline",
                title: f("Link", "meta+k"),
                keyboard: "meta+k"
              },
              strikethrough: {
                el: "strike",
                className: "strikethrough",
                command: "strikethrough",
                type: "inline",
                title: f("Strikethrough", "meta+shift+6"),
                keyboard: "meta+shift+6"
              },
              orderedList: {
                el: "ol",
                className: "ordered-list",
                command: "insertOrderedList",
                type: "list",
                title: f("Ordered List", "meta+shift+7"),
                keyboard: "meta+shift+7"
              },
              unorderedList: {
                el: "ul",
                className: "unordered-list",
                command: "insertUnorderedList",
                type: "list",
                title: f("Unordered List", "meta+shift+8"),
                keyboard: "meta+shift+8"
              },
              blockquote: {
                el: "blockquote",
                className: "quote",
                command: "formatBlock",
                type: "block",
                title: f("Blockquote", "meta+shift+9"),
                keyboard: "meta+shift+9"
              },
              clear: {el: "", command: "removeFormat", type: "inline", keyboard: "meta+shift+0"},
              pre: {el: "pre", command: "formatBlock", type: "block", keyboard: "meta+alt+1"},
              superscript: {el: "sup", command: "superscript", type: "inline", keyboard: "meta+dot"},
              subscript: {el: "sub", command: "subscript", type: "inline", keyboard: "meta+comma"},
              small: {
                el: "small",
                command: "insertHTML",
                type: "inline",
                keyboard: "meta+shift+minus",
                keyboardInverse: "meta+shift+plus"
              }
            },
            controlsOrder: ["bold", "italic", "headline", "link", "strikethrough", "orderedList", "unorderedList", "blockquote"],
            onShow: function (t) {
              s.isFunction(this.animateShowControls) ? this.animateShowControls.call(this, t) : t.element.show()
            },
            onHide: function (t) {
              s.isFunction(this.animateHideControls) ? this.animateHideControls.call(this, t) : t.element.hide()
            },
            onAction: function (t) {
              var e = c.getNodeList();
              t.setActives(e)
            }
          },
          showStaticControls: !0
        }, s.merge(this.config, n || {}), this.applyCommand = s.bind(E, this), this.inverseCommand = s.bind($, this), this.animateShowControls = s.bind(this.config.animateShowControls, this), this.animateHideControls = s.bind(this.config.animateHideControls, this), this.onChange = function (t) {
          var e = q.call(this);
          this.previousRawData !== e && (O.call(this), this.config.onChange.call(this), this.previousRawData = e)
        };
        var b = t(this.config.linkConfig, this);
        this.linkControl = new a(b);
        var y = t(this.config.inlineControlsConfig, this);
        this.inlineControls = new d(y);
        var w = t(s.defaults({keyboardEvents: this.keyComboEvents}, this.config.formattingControlsConfig), this);
        this.contextualControls = new r(this.applyCommand, this.inverseCommand, w);
        var x = this.config.formattingControlsConfig.onShow, C = this.config.formattingControlsConfig.onHide, k = t(s.defaults({
          onShow: function (t) {
            x.apply(this, arguments), t.listener = t.listener || function (e) {
                var i = c.getNodeList();
                t.setActives(i), document.removeEventListener("mousedown", t.listener, !1)
              }, document.addEventListener("mousedown", t.listener)
          }, onHide: function (t) {
            C.apply(this, arguments), document.removeEventListener("mousedown", t.listener, !1)
          }
        }, this.config.formattingControlsConfig), this);
        this.staticControls = new r(this.applyCommand, this.inverseCommand, k), this.dataFilter = new l(this.config.filterRules), this.keyModifiers = {shift: !1}, this.undoManager = new p(this, s.bind(function () {
          for (var t in this.mediaTracker) {
            var e = this.mediaTracker[t].updatedSource;
            if (e) {
              var i = J.call(this, t);
              o(i).attr("src", e)
            }
          }
          L.call(this)
        }, this)), this.config.smartQuotes.enabled && (this.smartQuoter = new m(this, this.config.smartQuotes.config)), this.mediaTracker = {}, e.call(this)
      };
      return bt.prototype.getData = function (t, e) {
        var i = this, n = q.call(this);
        n = this.config.filterForGetData.call(this, n), this.config.runIFrameSanitization && (n = this.dataFilter.unSanitizeIFrames(n));
        var a = document.createElement("div");
        if (a.innerHTML = n, ot.call(this, a), nt.call(this, a), e || o(a).find("[" + i.config.imgKeyAttr + "]").removeAttr(i.config.imgKeyAttr), t)for (var r = function (t) {
          var e = o(a).children(":" + t + "-child").get(0);
          return e && i.dataFilter.isEmptyElement(e, !0) ? e : null
        }, l = function () {
          return s.compact([r("first"), r("last")])
        }; l().length;)s.forEach(l(), function (t) {
          o(t).remove()
        });
        return a.innerHTML
      }, bt.prototype.setData = function (t, e, i) {
        e && (t = this.config.filterForSetData.call(this, t), t = this.dataFilter.filterHTML(t)), this.config.runIFrameSanitization && (t = this.dataFilter.sanitizeIFrames(t)), B.call(this, t), i ? this.dataFilter.flattenBlocksDown(this.element) : this.dataFilter.blockifyInlineNodes(this.element), z.call(this), at.call(this), st.call(this), W.call(this), this.onChange()
      }, bt.prototype.insertData = function (t, e, i) {
        e && (t = this.dataFilter.filterHTML(t)), V.call(this, t), i && this.dataFilter.flattenBlocksDown(c.getNearestElement()), this.onChange()
      }, bt.prototype.blur = function (t) {
        return t || x.call(this), o(this.element).blur()
      }, bt.prototype.focus = function (t) {
        var e = o(this.element).focus();
        return t || this.setCursorToEnd(), e
      }, bt.prototype.hasFocus = function () {
        return o(this.element).is(":focus")
      }, bt.prototype.setPlaceholder = function (t) {
        this.config.placeholder = t, O.call(this)
      }, bt.prototype.insertMedia = function (t, e, i, s) {
        e && (t = this.dataFilter.filterHTML(t)), Y.call(this, t, i, s), this.onChange()
      }, bt.prototype.addControl = function (t) {
        var e = o(this.wrapper).find("[data-js=control-bar]");
        e.append(t)
      }, bt.prototype.isEmpty = function () {
        var t = q.call(this);
        return "" === t || "<br>" === t || t === ct || t === dt
      }, bt.prototype.getCurrentElement = function () {
        return c.getNearestElement()
      }, bt.prototype.getAsyncImage = function (t) {
        return J.call(this, t)
      }, bt.prototype.insertAsyncImage = function (t, e, i, s, o) {
        G.call(this, t, e, i, s, o), this.onChange()
      }, bt.prototype.updateAsyncImage = function (t, e, i) {
        Z.call(this, t, e, i), this.onChange("updateAsyncImage")
      }, bt.prototype.setCursorToStart = function (t, e) {
        var i = o(this.element);
        t = t && i.find(t).first().get(0) || i.children().first().get(0), t && h.setToStart(t), e || I.call(this)
      }, bt.prototype.setCursorToEnd = function (t, e) {
        var i = o(this.element);
        t = t && i.find(t).last().get(0) || i.children().last().get(0), t && h.setToEnd(t), e || I.call(this)
      }, bt.prototype.insertNewParagraphAfter = function (t, e) {
        return ht.call(this, t, !1, e)
      }, bt.prototype.insertNewParagraphBefore = function (t, e) {
        return ht.call(this, t, !0, e)
      }, bt.prototype.isEmptyElement = function (t) {
        return t = t || U.call(this), this.dataFilter.isEmptyElement(t)
      }, bt.prototype.hasSelection = function (t) {
        return t = t || U.call(this), c.hasSelection(t)
      }, bt.prototype.isCursorAtEnd = function (t) {
        return t = t || U.call(this), c.isCursorAtEnd(t)
      }, bt.prototype.isCursorAtStart = function (t) {
        return t = t || U.call(this), c.isCursorAtStart(t)
      }, bt.prototype.teardown = function () {
        this.undoManager.teardown(), this.keyComboEvents.off()
      }, bt
    }();
    e.exports = b
  }, {
    "./dataFilter": 644,
    "./debugConsole": 645,
    "./formattingControls": 646,
    "./humanKeys": 647,
    "./inlineControls": 648,
    "./keyComboEvents": 649,
    "./linkControl": 651,
    "./selectionContext": 656,
    "./selectionPersistence": 657,
    "./smartQuoter": 658,
    "./undoManager": 659,
    "./utils": 660,
    jquery: "HlZQrA",
    lodash: "MicNly",
    "velocity-animate": "lWl/mc"
  }],
  655: [function (t, e, i) {
    function s() {
      var t, e;
      for (e = arguments[0] || {}, this.config = {}, this.config.elements = e.elements ? e.elements : [], this.config.attributes = e.attributes ? e.attributes : {}, this.config.attributes[s.ALL] = this.config.attributes[s.ALL] ? this.config.attributes[s.ALL] : [], this.config.allow_comments = e.allow_comments ? e.allow_comments : !1, this.allowed_elements = {}, this.config.protocols = e.protocols ? e.protocols : {}, this.config.classnames = e.classnames ? e.classnames : {}, this.config.add_attributes = e.add_attributes ? e.add_attributes : {}, this.dom = e.dom ? e.dom : document, t = 0; t < this.config.elements.length; t++)this.allowed_elements[this.config.elements[t]] = !0;
      if (this.config.remove_element_contents = {}, this.config.remove_all_contents = !1, e.remove_contents)if (e.remove_contents instanceof Array)for (t = 0; t < e.remove_contents.length; t++)this.config.remove_element_contents[e.remove_contents[t]] = !0; else this.config.remove_all_contents = !0;
      this.transformers = e.transformers ? e.transformers : []
    }

    s.REGEX_PROTOCOL = /^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i, s.RELATIVE = "__RELATIVE__", s.ALL = "__ALL__", s.prototype.clean_node = function (t) {
      function e(t, e) {
        var i;
        for (i = 0; i < e.length; i++)if (e[i] === t)return i;
        return -1
      }

      function i() {
        var t, e, i = [], s = {};
        for (t = 0; t < arguments.length; t++)if (arguments[t] && arguments[t].length)for (e = 0; e < arguments[t].length; e++)s[arguments[t][e]] || (s[arguments[t][e]] = !0, i.push(arguments[t][e]));
        return i
      }

      function o(t) {
        var e;
        switch (t.nodeType) {
          case 1:
            a.call(this, t);
            break;
          case 3:
            e = t.cloneNode(!1), this.current_element.appendChild(e);
            break;
          case 5:
            e = t.cloneNode(!1), this.current_element.appendChild(e);
            break;
          case 8:
            this.config.allow_comments && (e = t.cloneNode(!1), this.current_element.appendChild(e));
            break;
          default:
            console && console.log && console.log("unknown node type", t.nodeType)
        }
      }

      function n(t, i) {
        for (var s = [], o = 0; o < t.length; o++)-1 !== e(t[o], i) && s.push(t[o]);
        return s
      }

      function a(t) {
        var a, l, h, c, d, u, p, m, g, _, f = r.call(this, t);
        if (t = f.node, h = t.nodeName.toLowerCase(), l = this.current_element, this.allowed_elements[h] || f.whitelist) {
          this.current_element = this.dom.createElement(t.nodeName), l.appendChild(this.current_element);
          var v = this.config.attributes;
          for (c = i(v[h], v[s.ALL], f.attr_whitelist), this.config.classnames[h] && this.config.classnames[h].length && c.push("class"), a = 0; a < c.length; a++) {
            u = c[a];
            var b = "object" == typeof c[a] || c[a] instanceof Object;
            if (u = b ? c[a].name : c[a], d = t.attributes[u]) {
              m = d.value;
              var y = m.toLowerCase();
              if (_ = !0, this.config.protocols[h] && this.config.protocols[h][u]) {
                _ = !1, g = this.config.protocols[h][u], g.push(s.RELATIVE);
                for (var a in g)if (0 === y.indexOf(g[a].toLowerCase())) {
                  _ = !0;
                  break
                }
              }
              "class" === u && this.config.classnames[h] && (m = n(m.split(" "), this.config.classnames[h]).join(" "), _ = !!m), b && (_ = y.match(c[a].value)), _ && (p = document.createAttribute(u), p.value = m, this.current_element.setAttributeNode(p))
            }
          }
          if (this.config.add_attributes[h])for (u in this.config.add_attributes[h])p = document.createAttribute(u), p.value = this.config.add_attributes[h][u], this.current_element.setAttributeNode(p)
        } else if (-1 !== e(t, this.whitelist_nodes)) {
          for (this.current_element = t.cloneNode(!0); this.current_element.childNodes.length > 0;)this.current_element.removeChild(this.current_element.firstChild);
          l.appendChild(this.current_element)
        }
        if (!this.config.remove_all_contents && !this.config.remove_element_contents[h])for (a = 0; a < t.childNodes.length; a++)o.call(this, t.childNodes[a]);
        this.current_element.normalize && this.current_element.normalize(), this.current_element = l
      }

      function r(t) {
        var s, o, n, a = {attr_whitelist: [], node: t, whitelist: !1};
        for (s = 0; s < this.transformers.length; s++)if (n = this.transformers[s]({
            allowed_elements: this.allowed_elements,
            config: this.config,
            node: t,
            node_name: t.nodeName.toLowerCase(),
            whitelist_nodes: this.whitelist_nodes,
            dom: this.dom
          }), null !== n) {
          if ("object" != typeof n)throw new Error("transformer output must be an object or null");
          if (n.whitelist_nodes && n.whitelist_nodes instanceof Array)for (o = 0; o < n.whitelist_nodes.length; o++)-1 === e(n.whitelist_nodes[o], this.whitelist_nodes) && this.whitelist_nodes.push(n.whitelist_nodes[o]);
          a.whitelist = n.whitelist ? !0 : !1, n.attr_whitelist && (a.attr_whitelist = i(a.attr_whitelist, n.attr_whitelist)), a.node = n.node ? n.node : a.node
        }
        return a
      }

      var l = this.dom.createDocumentFragment();
      this.current_element = l, this.whitelist_nodes = [];
      for (var h = 0; h < t.childNodes.length; h++)o.call(this, t.childNodes[h]);
      return l.normalize && l.normalize(), l
    }, e.exports = s
  }, {}],
  656: [function (t, e, i) {
    var s = t("lodash"), o = t("jquery"), n = function () {
      var t = function (t) {
        return Array.prototype.indexOf.call(t.parentNode.childNodes, t)
      }, e = function (t) {
        return t instanceof HTMLElement
      }, i = {
        getParentNodes: function (t, e) {
          if (e = e || [], !t || i.isEditorNode(t))return e;
          var s = t.parentNode;
          return i.isEditorNode(s) ? e : s ? (e.push(s), i.getParentNodes(s, e)) : e
        }, getRootElements: function (s) {
          s = s || i.getSelection();
          var o = s && s.anchorNode ? s.anchorNode : null;
          if (!o || i.isEditorNode(o))return [];
          var n = i.getParentNodes(o), a = s.focusNode, r = i.getParentNodes(a), l = n.length ? n.pop() : o, h = r.length ? r.pop() : a, c = t(l), d = t(h);
          if (c > d) {
            var u = c;
            c = d, d = u
          }
          for (var p = [], m = l.parentNode, g = c; d >= g; g++) {
            var _ = m.childNodes[g];
            e(_) && p.push(_)
          }
          return p
        }, getNodeList: function (t, e) {
          t = t || i.getSelection();
          var o = t && t.anchorNode ? t.anchorNode : null;
          if (!o || i.isEditorNode(o))return [];
          var n = t.focusNode, a = [o];
          n && !i.isEditorNode(n) && (a = a.concat([n]));
          var r = i.getParentNodes(o);
          if (a = a.concat(r), !e) {
            var l = i.getParentNodes(n);
            a = a.concat(l)
          }
          var h = s.union(a);
          return h
        }, getNodeByNames: function (t, e, s) {
          var o = i.getNodeList(s);
          return o = e ? o.reverse() : o, this.getNodesByNames(o, t)[0]
        }, getNodesByNames: function (t, e) {
          return s.filter(t, function (t) {
            return -1 !== s.indexOf(e, t.nodeName)
          })
        }, getNearestElement: function (t) {
          t = t || i.getSelection();
          var e = i.getNodeList();
          return s.find(e, function (t) {
            return 1 === t.nodeType
          })
        }, getContextCoordinates: function (t, e) {
          var s = i.getSelection(), n = s.getRangeAt(0).cloneRange(), a = o(t).offset();
          if (e || !s.isCollapsed) {
            var r = (e || n).getBoundingClientRect();
            return {x: r.left + r.width / 2 - a.left, y: r.top - a.top + o(window).scrollTop()}
          }
          if (n.getClientRects) {
            n.collapse(!0);
            var l = n.getClientRects()[0];
            if (l)return {x: l.left - a.left, y: l.top - a.top + o(window).scrollTop()}
          }
        }, getSelection: function () {
          var t = window.getSelection();
          if (t.anchorNode) {
            var e = o(t.anchorNode).closest("[contenteditable]").length;
            return e ? t : null
          }
          return null
        }, collapseToEnd: function () {
          var t = i.getSelection();
          t && t.collapseToEnd()
        }, collapseToStart: function () {
          var t = i.getSelection();
          t && t.collapseToStart()
        }, isInContext: function (t, e) {
          return o(t.anchorNode).closest(e).length > 0
        }, isEditorNode: function (t) {
          return o(t).is('[contentEditable="true"]')
        }, hasSelection: function () {
          var t = i.getSelection();
          return t && !t.isCollapsed
        }, rangeFromElement: function (t) {
          var e, s, o = i.getSelection();
          return o && o.isCollapsed ? (s = o.getRangeAt(0), e = s.cloneRange(), e.selectNodeContents(t), e.setEnd(s.startContainer, s.startOffset), e) : !1
        }, isCursorAtEnd: function (t, e) {
          var i = this.rangeFromElement(t);
          if (!i)return !1;
          var s = i.toString(), o = t.textContent;
          return e && (s = s.trim(), o = o.trim()), s.length === o.length
        }, isCursorAtStart: function (t) {
          var e = this.rangeFromElement(t);
          return e ? 0 === e.startOffset && 0 === e.endOffset : !1
        }
      };
      return i
    }();
    e.exports = n
  }, {jquery: "HlZQrA", lodash: "MicNly"}],
  657: [function (t, e, i) {
    var s = function () {
      return {
        saveSelection: function (t, e) {
          if (e = e || window.getSelection(), !e || !e.rangeCount)return null;
          for (var i, s, o, n = e.getRangeAt(0), a = 0, r = [t]; !o && (i = r.pop());) {
            if (i.nodeType === i.TEXT_NODE)i === n.startContainer ? (a += n.startOffset, o = !0) : a += i.length; else {
              var l = i.childNodes.length;
              if ("false" !== i.getAttribute("contenteditable"))for (; l--;)r.push(i.childNodes[l])
            }
            s = i
          }
          return {
            container: t,
            endContainer: n.endContainer,
            start: a,
            end: a + n.toString().length,
            selection: e,
            anchorNode: e.anchorNode
          }
        }, restoreSelection: function (t) {
          if (t) {
            var e = 0, i = document.createRange();
            i.setStart(t.container, 0), i.collapse(!0);
            for (var s, o, n = [t.container], a = !1, r = !1; !r && (s = n.pop());) {
              if (s.nodeType === s.TEXT_NODE) {
                var l = e + s.length;
                !a && t.start >= e && t.start < l && (i.setStart(s, t.start - e), a = !0), a || l !== t.end || (i.setStart(s, t.end - e), a = !0), a && t.end >= e && t.end <= l && (i.setEnd(s, t.end - e), r = !0), e = l
              } else {
                var h = s.childNodes.length;
                if ("false" !== s.getAttribute("contenteditable"))for (; h--;)n.push(s.childNodes[h])
              }
              o = s
            }
            if (!r) {
              var c = t.end - e;
              try {
                i.setEnd(t.endContainer, c)
              } catch (d) {
              }
            }
            var u = window.getSelection();
            u.removeAllRanges();
            try {
              u.addRange(i)
            } catch (d) {
            }
          }
        }, setToStart: function (t) {
          if (t) {
            var e = document.createRange();
            e.setStart(t, 0),
              e.setEnd(t, 0), e.collapse(!0);
            var i = window.getSelection();
            i.removeAllRanges();
            try {
              i.addRange(e)
            } catch (s) {
            }
          }
        }, setToEnd: function (t) {
          for (var e = [t], i = null, s = t, o = 0; i = e.pop();)if (3 === i.nodeType)s = i, o = i.length; else for (var n = i.childNodes.length; n--;)e.push(i.childNodes[n]);
          var a = document.createRange();
          a.setStart(s, o), a.setEnd(s, o), a.collapse(!0);
          var r = window.getSelection();
          r.removeAllRanges();
          try {
            r.addRange(a)
          } catch (l) {
          }
        }
      }
    }();
    e.exports = s
  }, {}],
  658: [function (t, e, i) {
    var s = t("lodash"), o = t("jquery"), n = t("./selectionContext"), a = t("./selectionPersistence"), r = t("./utils"), l = function () {
      function t() {
        var t = this;
        o(this.editor.element).on("keypress", function (s) {
          var o = !1;
          if (34 === s.charCode)o = i.call(t); else {
            if (39 !== s.charCode)return;
            o = e.call(t)
          }
          o && s.preventDefault()
        })
      }

      function e() {
        var t = this.config.singleQuotes;
        return l.call(this, t.open, t.close, t.prime)
      }

      function i() {
        var t = this.config.doubleQuotes;
        return l.call(this, t.open, t.close, t.prime)
      }

      function l(t, e, i) {
        var r = n.getSelection();
        if (!r.isCollapsed)return !1;
        var l = r.anchorNode;
        l.normalize();
        var h = a.saveSelection(l), c = l.textContent, d = c.slice(0, h.start), u = d.charAt(d.length - 1), p = l.lastChild && "BR" === l.lastChild.nodeName ? l.lastChild : null, m = s.any(this.config.openingMatches, function (t) {
            return t.test(u)
          }) || p, g = "";
        g = !u || m ? t : /\d/.test(u) ? i : e;
        var _ = document.createTextNode(g), f = r.getRangeAt(0);
        return f.deleteContents(), f.insertNode(_), p && p.previousSibling && "BR" === p.previousSibling.nodeName && o(p).remove(), f.setEndAfter(_), f.collapse(!1), r.removeAllRanges(), r.addRange(f), !0
      }

      var h = function (e, i) {
        return r.browser.msie ? null : (this.editor = e, this.config = {
          openingMatches: [/\s/, /\u200B/, /[=]/],
          singleQuotes: {open: "", close: "", prime: ""},
          doubleQuotes: {open: "", close: "", prime: ""}
        }, s.extend(this.config, i || {}), void t.call(this))
      };
      return h
    }();
    e.exports = l
  }, {"./selectionContext": 656, "./selectionPersistence": 657, "./utils": 660, jquery: "HlZQrA", lodash: "MicNly"}],
  659: [function (t, e, i) {
    var s = t("lodash"), o = t("jquery"), n = t("./selectionPersistence"), a = function () {
      function t() {
        var t = this, s = function (t) {
          return /Mac/.test(navigator.platform) ? t.metaKey : t.ctrlKey
        };
        o(this.editor.element).on("keydown.undoManager", function (o) {
          return o.keyCode === c.z && s(o) && !o.altKey ? (o.shiftKey ? i.call(t) : e.call(t), o.preventDefault(), !1) : void 0
        })
      }

      function e() {
        if (l.call(this), this.undoStates.length) {
          var t = this.undoStates.pop();
          h.call(this, t), this.redoStates.push(this.currState), a.call(this)
        }
      }

      function i() {
        if (this.redoStates.length) {
          var t = this.redoStates.pop();
          h.call(this, t), this.undoStates.push(this.currState), a.call(this)
        }
      }

      function a() {
        this.currState = r.call(this)
      }

      function r() {
        var t = {data: this.editor.getData(!0, !0), selection: n.saveSelection(this.editor.element)};
        return t
      }

      function l() {
        var t = r.call(this);
        return this.currState ? void(t.data !== this.currState.data && (this.undoStates.push(this.currState), this.currState = t)) : void(this.currState = t)
      }

      function h(t) {
        if (this.isRestoring = !0, this.editor.setData(t.data, !0), t.selection)n.restoreSelection(t.selection); else {
          var e = window.getSelection();
          e.removeAllRanges()
        }
        this.afterRestore()
      }

      var c = {command: 91, control: 17, shift: 16, z: 90}, d = 500, u = function (e, i) {
        this.editor = e, this.modifierKeyCode = !1, this.isShift = !1, this.currState = null, this.undoStates = [], this.redoStates = [], this.afterRestore = i || function () {
          }, this.isRestoring = !1;
        var o = this, n = s.debounce(function () {
          o.isTorndown || l.call(o)
        }, d);
        this.defaultOnChange = e.onChange, e.onChange = function (t) {
          if (o.isRestoring)o.isRestoring = !1; else {
            if ("updateAsyncImage" === t)return;
            o.currState ? n() : l.call(o)
          }
          o.defaultOnChange.call(this)
        }, t.call(this)
      };
      return u.prototype.undo = function () {
        e.call(this)
      }, u.prototype.redo = function () {
        i.call(this)
      }, u.prototype.teardown = function () {
        this.isTorndown = !0, this.editor.onChange = this.defaultOnChange, this.undoStates.length = 0, this.redoStates.length = 0, this.currState = null, o(this.editor.element).off(".undoManager")
      }, u
    }();
    e.exports = a
  }, {"./selectionPersistence": 657, jquery: "HlZQrA", lodash: "MicNly"}],
  660: [function (t, e, i) {
    var s = t("lodash"), o = t("jquery"), n = function () {
      var t = function () {
      };
      return t.calcTextWidth = function (t, e) {
        var i = ["font-style", "font-weight", "font-size", "font-family"], n = s.reduce(i, function (e, i) {
          return e + " " + o(t).css(i)
        }, "").trim(), a = document.createElement("canvas"), r = a.getContext("2d");
        r.font = n;
        var l = r.measureText(e);
        return Math.round(l.width)
      }, t.browser = function () {
        var t = function (t) {
          t = t.toLowerCase();
          var e = /(chrome)[ \/]([\w.]+)/.exec(t) || /(webkit)[ \/]([\w.]+)/.exec(t) || /(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t) || /(trident)[ \/]([\w.]+)/.exec(t) || /(msie) ([\w.]+)/.exec(t) || t.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t) || [];
          return {browser: e[1] || "", version: e[2] || "0"}
        }, e = t(navigator.userAgent), i = {};
        return e.browser && (i[e.browser] = !0, i.version = e.version), i.trident && (i.msie = !0), i.chrome ? i.webkit = !0 : i.webkit && (i.safari = !0), i
      }(), t
    }();
    e.exports = n
  }, {jquery: "HlZQrA", lodash: "MicNly"}],
  661: [function (t, e, i) {
    "use strict";
    function s(t, e) {
      return e ? t.replace(r, function (t, i, s) {
        return !s || l.test(s) ? i : ("/" !== s[0] && (s = "/" + s), 'url("' + e + s + '")')
      }) : t
    }

    function o(t) {
      a.styleSheet.cssText = t
    }

    function n(t) {
      for (; a.hasChildNodes();)a.removeChild(a.firstChild);
      a.appendChild(document.createTextNode(t))
    }

    var a = document.createElement("style");
    document.head.appendChild(a);
    var r = /(url(?:\(['|"]?)(.*?)(?:['|"]?\)))/g, l = /^\s*(https?:)\/\//, h = a.styleSheet ? o : n, c = function (t) {
      return h(a.innerHTML.replace(t, ""))
    };
    i.insertHost = s, i.element = a, i.inject = h, i.eject = c
  }, {}],
  662: [function (t, e, i) {
    !function (t) {
      t(function (t) {
        var e = t("./when"), i = e.Promise.all, s = Array.prototype.slice;
        return function (t) {
          function o(t) {
            return n.push(t), n
          }

          var n = [];
          return i(s.call(arguments, 1)).then(function (i) {
            return e.reduce(t, function (t, s) {
              return e(s.apply(void 0, i), o)
            }, n)
          })
        }
      })
    }("function" == typeof define && define.amd ? define : function (i) {
      e.exports = i(t)
    })
  }, {"./when": "RG2dij"}]
}, {}, []);